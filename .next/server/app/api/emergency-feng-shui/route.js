(()=>{var e={};e.id=9718,e.ids=[9718],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},16493:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>h,routeModule:()=>u,serverHooks:()=>g,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>d});var o={};r.r(o),r.d(o,{POST:()=>c});var n=r(96559),s=r(48088),i=r(37719),l=r(32190);function a(e){try{let t=new Date(e),r=t.getFullYear(),o=t.getMonth()+1;t.getDate();let n=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],s=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],i=(r-4)%10,l=n[i]+s[(r-4)%12],a=n[(2*i+o)%10]+s[(o+1)%12],c=Math.floor(t.getTime()/864e5),u=n[(c+4)%10]+s[(c+4)%12];return{year:l,month:a,day:u,hour:"甲子"}}catch(e){return console.error("BaZi calculation error:",e),null}}async function c(e){try{let{femaleUser:t,maleUser:r,femaleBazi:o,maleBazi:n,requestType:s}=await e.json();if(!t||!r)return l.NextResponse.json({error:"Missing user data"},{status:400});let i=o||a(t.birthDate),c=n||a(r.birthDate);if(!i||!c)return l.NextResponse.json({error:"Failed to calculate BaZi data"},{status:400});let u=`
作為專業風水師，請為這對情侶提供72小時內的緊急風水改善方案。

女方八字：${i.year} ${i.month} ${i.day} ${i.hour}
男方八字：${c.year} ${c.month} ${c.day} ${c.hour}

請提供3個具體的風水改善建議，每個建議需要：
1. 具體的行動方案（標題）
2. 詳細的操作說明和風水原理（內容）

要求：
- 每個建議都要具體可執行
- 說明風水原理和效果
- 重點關注感情和和諧
- 內容控制在80-100字內
- 不要使用標題符號或格式符號

請直接提供3個建議：
`,p=await fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.DEEPSEEK_API_KEY}`},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:"你是專業的風水師，專門提供實用的風水改善建議。回答要具體、實用、易於執行。"},{role:"user",content:u}],temperature:.7,max_tokens:1e3})});if(!p.ok)throw Error(`DeepSeek API error: ${p.status}`);let d=await p.json(),g=d.choices?.[0]?.message?.content;if(!g)throw Error("No content received from AI");console.log("\uD83E\uDD16 AI Response:",g);let h=function(e){try{if(!e||"string"!=typeof e)return console.log("⚠️ Invalid content provided to parser"),null;console.log("\uD83D\uDD0D Parsing content:",e.substring(0,200)+"...");let t=["#B08D57","#C4839F","#7B8B5C"],r=e.split(/\n\s*\n/).filter(e=>e.trim().length>0);console.log("\uD83D\uDCDD Found sections:",r.length);let o=[];for(let e=0;e<r.length&&o.length<3;e++){let n=r[e].trim().split("\n").map(e=>e.trim()).filter(e=>e.length>0);if(n.length>=2){let e=n[0].replace(/^\d+[\.\)]\s*/,"").replace(/^【|】$/g,""),r=n.slice(1).join(" ").substring(0,150);e.length>0&&r.length>0&&o.push({title:e,description:r,color:t[o.length]})}}if(console.log("✅ Parsed recommendations:",o.length),0===o.length){let r=e.split("\n").map(e=>e.trim()).filter(e=>e.length>20);for(let e=0;e<r.length&&o.length<3;e++){let n=r[e];if(n.includes("擺放")||n.includes("點燃")||n.includes("放置")||n.includes("鋪設")){let s=r[e+1];o.push({title:n.substring(0,30),description:s||"具體的風水改善建議，有助於提升感情和諧。",color:t[o.length]})}}}if(0===o.length)return console.log("⚠️ No recommendations parsed from AI response"),null;for(;o.length<3;){let e=[{title:"臥室擺放金屬風鈴",description:"在臥室東側掛置小型金屬風鈴，調和五行能量，增強感情和諧，每日清晨輕撥一次。",color:"#B08D57"},{title:"客廳點燃暖色蠟燭",description:"每晚點燃暖黃色蠟燭30分鐘，營造溫馨氛圍，促進深度溝通，建議使用天然蜂蠟。",color:"#C4839F"},{title:"床頭放置紅色元素",description:"在床頭擺放紅色靠枕或花朵，激活愛情能量，增強彼此感情連結。",color:"#7B8B5C"}];o.push(e[o.length])}return{recommendations:o.slice(0,3)}}catch(e){return console.error("Parsing error:",e),null}}(g);if(console.log("\uD83D\uDCCA Parsed Data:",h),!h)return l.NextResponse.json({recommendations:[{title:"臥室擺放金屬擺件",description:"在臥室東側放置小型銅製飾品，能調和五行能量，增強感情穩定性，建議每晚睡前整理一次。",color:"#B08D57"},{title:"床頭點燃暖色蠟燭",description:"每晚點燃暖黃色蠟燭約30分鍾，營造溫馨氛圍，暖光能柔化彼此情緒，促進深度溝通。",color:"#C4839F"},{title:"客廳西南角鋪紅毯",description:"在客廳西南方向鋪設小塊紅色地毯，激活坤土能量，增強家庭和諧與包容心。",color:"#7B8B5C"}]});return l.NextResponse.json(h)}catch(e){return console.error("Emergency Feng Shui API error:",e),l.NextResponse.json({recommendations:[{title:"生成建議中",description:"正在分析您的風水配置，請稍候片刻...",color:"#B08D57"}]},{status:200})}}let u=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/emergency-feng-shui/route",pathname:"/api/emergency-feng-shui",filename:"route",bundlePath:"app/api/emergency-feng-shui/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/emergency-feng-shui/route.js",nextConfigOutput:"",userland:o}),{workAsyncStorage:p,workUnitAsyncStorage:d,serverHooks:g}=u;function h(){return(0,i.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:d})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[7719,580],()=>r(16493));module.exports=o})();