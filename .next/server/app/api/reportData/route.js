(()=>{var e={};e.id=4120,e.ids=[4120],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43211:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>R,routeModule:()=>f,serverHooks:()=>w,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>D});var a={};r.r(a),r.d(a,{DELETE:()=>S,GET:()=>h,PATCH:()=>x,POST:()=>m});var n=r(96559),s=r(48088),o=r(37719),i=r(32190),u=r(56364),p=r(85704),d=r(56037),c=r.n(d);let l=new(c()).Schema({sessionId:{type:String,required:!0,unique:!0,index:!0},birthDateTime:{type:String,required:!0},gender:{type:String,required:!0},language:{type:String,default:"zh-TW"},basicReportData:{mingLiData:c().Schema.Types.Mixed,liuNianData:c().Schema.Types.Mixed,jiajuProData:c().Schema.Types.Mixed},fourFortuneData:{healthFortuneData:c().Schema.Types.Mixed,careerFortuneData:c().Schema.Types.Mixed,wealthFortuneData:c().Schema.Types.Mixed,relationshipFortuneData:c().Schema.Types.Mixed},aiGeneratedContent:{sessionId:String,generatedAt:String,generationStatus:String,fourFortuneAI:{healthFortuneData:c().Schema.Types.Mixed,careerFortuneData:c().Schema.Types.Mixed,wealthFortuneData:c().Schema.Types.Mixed,relationshipFortuneData:c().Schema.Types.Mixed},comprehensiveAI:{lifeAdvice:c().Schema.Types.Mixed},wuxingAnalysis:c().Schema.Types.Mixed,lifeStageAnalysis:{年柱:c().Schema.Types.Mixed,月柱:c().Schema.Types.Mixed,日柱:c().Schema.Types.Mixed,時柱:c().Schema.Types.Mixed}},reportStatus:{type:String,enum:["generating","partial","complete"],default:"generating"},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}},{timestamps:!0}),g=c().models.ReportData||c().model("ReportData",l);async function h(e){try{let{searchParams:t}=new URL(e.url),r=t.get("sessionId");if(!r)return i.NextResponse.json((0,p.J4)("SessionId is required"));await (0,u.A)();let a=await g.findOne({sessionId:r}).select("-__v");return i.NextResponse.json((0,p.Cs)(a))}catch(e){return console.error("Error fetching report data:",e),i.NextResponse.json((0,p.J4)("Error fetching report data"))}}async function m(e){try{let t=await e.json(),{sessionId:r,birthDateTime:a,gender:n}=t;if(!r||!a||!n)return i.NextResponse.json((0,p.J4)("SessionId, birthDateTime, and gender are required"));if(await (0,u.A)(),await g.findOne({sessionId:r}))return i.NextResponse.json((0,p.J4)("Report with this sessionId already exists"));let s=await g.create({sessionId:r,birthDateTime:a,gender:n,language:t.language||"zh-TW",basicReportData:t.basicReportData||{},fourFortuneData:t.fourFortuneData||{},aiGeneratedContent:t.aiGeneratedContent||{},reportStatus:t.reportStatus||"generating"});return console.log("✅ Report data created successfully for session:",r),i.NextResponse.json((0,p.Cs)(s))}catch(e){return console.error("Error creating report data:",e),i.NextResponse.json((0,p.J4)("Error creating report data"))}}async function x(e){try{let t=await e.json(),{sessionId:r}=t;if(!r)return i.NextResponse.json((0,p.J4)("SessionId is required"));await (0,u.A)();let a=await g.findOne({sessionId:r});return a||(a=await g.create({sessionId:r,birthDateTime:t.birthDateTime||new Date().toISOString(),gender:t.gender||"male",language:t.language||"zh-TW"}),console.log("✅ New report data created for session:",r)),t.basicReportData&&(a.basicReportData={...a.basicReportData.toObject(),...t.basicReportData}),t.fourFortuneData&&(a.fourFortuneData={...a.fourFortuneData.toObject(),...t.fourFortuneData}),t.aiGeneratedContent&&(a.aiGeneratedContent={...a.aiGeneratedContent.toObject(),...t.aiGeneratedContent}),t.reportStatus&&(a.reportStatus=t.reportStatus),a.updatedAt=new Date,await a.save(),console.log("✅ Report data updated successfully for session:",r),i.NextResponse.json((0,p.Cs)(a))}catch(e){return console.error("Error updating report data:",e),i.NextResponse.json((0,p.J4)("Error updating report data"))}}async function S(e){try{let{searchParams:t}=new URL(e.url),r=t.get("sessionId");if(!r)return i.NextResponse.json((0,p.J4)("SessionId is required"));return await (0,u.A)(),await g.deleteOne({sessionId:r}),console.log("✅ Report data deleted successfully for session:",r),i.NextResponse.json((0,p.Cs)())}catch(e){return console.error("Error deleting report data:",e),i.NextResponse.json((0,p.J4)("Error deleting report data"))}}let f=new n.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/reportData/route",pathname:"/api/reportData",filename:"route",bundlePath:"app/api/reportData/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/reportData/route.js",nextConfigOutput:"",userland:a}),{workAsyncStorage:y,workUnitAsyncStorage:D,serverHooks:w}=f;function R(){return(0,o.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:D})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56037:e=>{"use strict";e.exports=require("mongoose")},56364:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,X:()=>i});var a=r(56037),n=r.n(a);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env");let o=global.mongoose;async function i(){if(o.conn)return o.conn;o.promise||(o.promise=n().connect(s,{serverSelectionTimeoutMS:3e4,socketTimeoutMS:3e4}).then(e=>e).catch(e=>{throw e}));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}o||(o=global.mongoose={conn:null,promise:null});let u=i},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},85704:(e,t,r)=>{"use strict";function a(e){return{status:401,message:e||"Unauthorized"}}function n(e){let t={status:0};return e&&(t.data=e),t}function s(e){return{status:-1,message:e||"server error"}}r.d(t,{Cs:()=>n,J4:()=>s,kn:()=>a})},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[7719,580],()=>r(43211));module.exports=a})();