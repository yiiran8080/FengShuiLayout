(()=>{var e={};e.id=5317,e.ids=[5317],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74474:(e,a,n)=>{"use strict";n.d(a,{Ay:()=>$});var t=n(44794),r=n(42457),o=n(81540),m=n(14250),i=n(96002),s=n.n(i),h=n(22246);m.A.extend(t.t).extend(r.sM).extend(o.z0);let c=(0,m.A)(s()().format("YYYY-MM-DD")).char8.year.toString(),{LYGanzhiMap:u,LYzhiMap:l,LYStarMap:d,LYSihuaMap:y,spouseStarMap:p,spouseSihuaMap:S}=function(){let e=s()().format("YYYY"),a={},n={},t={},r={},o={},m={};for(let i=1;i<=12;i++){let s=e+"-"+(i<10?"0"+i:""+i)+"-15",c=h.astro.bySolar(s,0,"男",!0,"zh-CN").horoscope(s);n[i]=c.monthly.earthlyBranch,a[i]=c.monthly.heavenlyStem+c.monthly.earthlyBranch,t[i]=c.palace("命宫","monthly").majorStars.map(e=>e.name).toString(),o[i]=c.palace("夫妻","monthly").majorStars.map(e=>e.name).toString(),r[i]=c.palace("命宫","monthly").mutagedPlaces().map(e=>e.name).toString(),m[i]=c.palace("夫妻","monthly").mutagedPlaces().map(e=>e.name).toString()}return{LYGanzhiMap:a,LYzhiMap:n,LYStarMap:t,LYSihuaMap:r,spouseStarMap:o,spouseSihuaMap:m}}();(function(){let e=s()().format("YYYY-MM-DD");(0,m.A)(e).char8.month.toString()})(),function(){let e=s()().format("YYYY-MM-DD");h.astro.bySolar(e,0,"男",!0,"zh-CN").horoscope(e,0).palace("夫妻","yearly").majorStars.map(e=>e.name).toString()}();let g={};function $(e,a){var n;let t=s()(e).format("YYYY-MM-DD HH:mm:ss");if(console.log("birthStr",t),g[t+"-"+a])return g[t+"-"+a];let r=Math.floor(s()(e).hour()/2),o=s()(e).format("YYYY-MM-DD"),i=h.astro.bySolar(o,r,"female"==a?"女":"男",!0,"zh-CN"),u=i.palace("命宫"),l=i.palace("身宫"),d=i.palace("迁移").majorStars.map(e=>e.name).toString(),y=i.horoscope(o,r),p=(0,m.A)(t),S=function(e,a,n,t,r,o,m,i){let s={金:0,木:0,水:0,火:0,土:0},h=[e,a,n,t,r,o,m,i];h.forEach(e=>{["金","木","水","火","土"].includes(e)&&s[e]++});let c=h.length;return`金:${(s.金/c*100).toFixed(2)}%，木:${(s.木/c*100).toFixed(2)}%，水:${(s.水/c*100).toFixed(2)}%，火:${(s.火/c*100).toFixed(2)}%，土:${(s.土/c*100).toFixed(2)}%`}(p.char8.year.stem.e5.name,p.char8.year.branch.e5.name,p.char8.month.stem.e5.name,p.char8.month.branch.e5.name,p.char8.day.stem.e5.name,p.char8.day.branch.e5.name,p.char8.hour.stem.e5.name,p.char8.hour.branch.e5.name),$=p.char8.day.branch.hiddenStems.map(e=>e.name).toString(),f=p.char8.year.branch.hiddenStems,b=p.char8.month.branch.hiddenStems,Y=p.char8.day.branch.hiddenStems,G=p.char8.hour.branch.hiddenStems,v=p.char8ex(+("female"!==a)),M=v.year,j=v.month,k=v.day,B=v.hour,T={nayin:p.char8.year.takeSound,wuxingJu:(n=p.char8.year.takeSoundE5.toString(),`${n}${x[n]}局`),year:p.char8.year.toString(),month:p.char8.month.toString(),day:p.char8.day.toString(),hour:p.char8.hour.toString(),wuxingScale:S,rizhiCanggan:$,mingPalace:`{主星：${u.majorStars.map(e=>e.name).toString()},主星亮度：${u.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${u.minorStars.map(e=>e.name).toString()}, 四化：${u.mutagedPlaces().map(e=>e.name).toString()}}`,bodyPalace:`{主星：${l.majorStars.map(e=>e.name).toString()},主星亮度：${l.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${l.minorStars.map(e=>e.name).toString()}, 四化：${l.mutagedPlaces().map(e=>e.name).toString()}}`,qianyiPalace:d,dayunGanzhi:y.decadal.heavenlyStem+y.decadal.earthlyBranch,liunianGanzhi:c,yearStemTenGod:M.stemTenGod.name,yearBranchTenGod:M.branchTenGod.map(e=>e.name).toString(),monthStemTenGod:j.stemTenGod.name,monthBranchTenGod:j.branchTenGod.map(e=>e.name).toString(),dayStemTenGod:k.stemTenGod.name,dayBranchTenGod:k.branchTenGod.map(e=>e.name).toString(),hourStemTenGod:B.stemTenGod.name,hourBranchTenGod:B.branchTenGod.map(e=>e.name).toString(),yearGods:M.gods.map(e=>e.name).toString(),monthGods:j.gods.map(e=>e.name).toString(),dayGods:k.gods.map(e=>e.name).toString(),yearStem:p.char8.year.stem.name,yearStemWuxing:p.char8.year.stem.e5.name,yearBranch:p.char8.year.branch.name,yearBranchWuxing:p.char8.year.branch.e5.name,monthStem:p.char8.month.stem.name,monthStemWuxing:p.char8.month.stem.e5.name,monthBranch:p.char8.month.branch.name,monthBranchWuxing:p.char8.month.branch.e5.name,dayStem:p.char8.day.stem.name,dayStemWuxing:p.char8.day.stem.e5.name,dayBranch:p.char8.day.branch.name,dayBranchWuxing:p.char8.day.branch.e5.name,hourStem:p.char8.hour.stem.name,hourStemWuxing:p.char8.hour.stem.e5.name,hourBranch:p.char8.hour.branch.name,hourBranchWuxing:p.char8.hour.branch.e5.name,yearNayin:p.char8.year.takeSound,monthNayin:p.char8.month.takeSound,dayNayin:p.char8.day.takeSound,hourNayin:p.char8.hour.takeSound,yearNayinWuxing:p.char8.year.takeSoundE5.toString(),monthNayinWuxing:p.char8.month.takeSoundE5.toString(),dayNayinWuxing:p.char8.day.takeSoundE5.toString(),hourNayinWuxing:p.char8.hour.takeSoundE5.toString(),yearBranchHiddenStems:f.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),monthBranchHiddenStems:b.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),dayBranchHiddenStems:Y.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),hourBranchHiddenStems:G.map(e=>({stem:e.name,element:e.e5.name,strength:e.value}))};return g[t+"-"+a]=T,console.log("result",T),T}let x={水:"二",木:"三",金:"四",土:"五",火:"六"}},78335:()=>{},93850:(e,a,n)=>{"use strict";n.r(a),n.d(a,{patchFetch:()=>x,routeModule:()=>p,serverHooks:()=>$,workAsyncStorage:()=>S,workUnitAsyncStorage:()=>g});var t={};n.r(t),n.d(t,{POST:()=>c});var r=n(96559),o=n(48088),m=n(37719),i=n(32190),s=n(95209),h=n(74474);async function c(e){try{let{user1Birthday:a,user2Birthday:n,user1Element:t,user2Element:r,currentYear:o,nextYear:m,currentMonth:s,compatibilityData:h,requestType:c}=await e.json();if(!a||!n)return i.NextResponse.json({error:"Missing required birthday information"},{status:400});let l=await u(a,n,t,r,o,m,s,h);return i.NextResponse.json({success:!0,annualStrategy:l,timestamp:new Date().toISOString()})}catch(e){return console.error("Error in couple annual analysis:",e),i.NextResponse.json({error:"Failed to generate annual analysis",details:e.message},{status:500})}}async function u(e,a,n,t,r,o,m,i){try{let c=(0,h.Ay)(e,"male"),u=(0,h.Ay)(a,"female"),p=`作為專業的八字合婚分析師，請根據以下信息生成詳細的流年應對策略：

**基本信息：**
- 男方生日：${e}，${n}命
- 女方生日：${a}，${t}命
- 八字分析：男方 ${c.year} ${c.month} ${c.day} ${c.hour}
- 八字分析：女方 ${u.year} ${u.month} ${u.day} ${u.hour}
- 配對評分：${i?.score||75}分
- 當前年份：${r}年${m}月
- 分析年份：${r}年和${o}年

**請提供以下詳細分析：**

1. **${r}年感情運勢分析**
   - 整體趨勢和重點月份
   - 具體的月份建議（特別是當前${m}月份之後）
   - 需要注意的時期和建議

2. **${o}年關鍵應對策略**
   - 年度整體運勢預測
   - 重要時期的具體建議
   - 財務和感情方面的策略

3. **具體月份建議**
   - 請提供類似"${r}年農曆四月，避免重大決定，可安排短途旅行（寅木解巳申之刑）"的具體建議
   - 請提供類似"${o}丙午年，女方財星過旺，男方須警惕'庚金正財被剋'引發的財務焦慮，建議提前設立共同儲備金"的專業建議

**分析要求：**
- 基於真實的八字理論和五行相生相剋原理
- 提供實用的生活建議
- 考慮兩人的五行配合情況
- 包含具體的時間節點和應對方法
- 專業術語與通俗解釋並重

請用繁體中文回答，格式要清晰專業。`,S=await s.EnhancedInitialAnalysis.generateCoupleAIAnalysis(new Date(e),new Date(a),n,t,p);return function(e,a,n,t,r,o,m){let i=e.split("\n").filter(e=>e.trim()),s="",h="",c="",u="";for(let e of i){let t=e.trim();t.includes(a.toString())&&t.includes("年")?(u="currentYear",s+=t+"\n"):t.includes(n.toString())&&t.includes("年")?(u="nextYear",h+=t+"\n"):t.includes("月份")||t.includes("農曆")||t.includes("應對")?(u="monthly",c+=t+"\n"):u&&t.length>10&&("currentYear"===u?s+=t+"\n":"nextYear"===u?h+=t+"\n":"monthly"===u&&(c+=t+"\n"))}return{[a]:{title:`${a}年感情運勢`,description:s.trim()||d(a,r,o,m),monthlyFocus:l(c,a)||y(a,t,r,o)},[n]:{title:`${n}年關鍵應對策略`,description:h.trim()||d(n,r,o,m),monthlyFocus:l(c,n)||y(n,6,r,o)}}}(S,r,o,m,n,t,i)}catch(e){var c,u,p,S,g,$;return console.error("Error generating AI annual analysis:",e),c=r,u=o,p=m,{[c]:{title:`${c}年感情運勢`,description:d(c,S=n,g=t,$=i),monthlyFocus:y(c,p,S,g)},[u]:{title:`${u}年關鍵應對策略`,description:d(u,S,g,$),monthlyFocus:y(u,6,S,g)}}}}function l(e,a){for(let n of e.split("\n"))if(n.includes(a.toString())&&(n.includes("月")||n.includes("建議")))return n.trim();return null}function d(e,a,n,t){let r=t?.score||75,o=function(e,a,n){let t={金水:"金水相生，感情和諧，",水木:"水木相生，關係持續成長，",木火:"木火相生，熱情洋溢，",火土:"火土相生，感情踏實穩固，",土金:"土金相生，相互支持，",金火:"金火相剋，需要調和，",火水:"水火不容，需要包容，",水土:"水土相剋，需要理解，",土木:"土木相剋，需要溝通，",木金:"金克木，需要平衡，"},r=`${e}${a}`,o=`${a}${e}`;return t[r]||t[o]||"需要相互調適，"}(a,n,0);return`${e}年整體配對評分${r}分，屬於${r>=80?"優秀":r>=70?"良好":"穩定"}配對。${o}建議加強溝通，維持感情穩定發展。`}function y(e,a,n,t){return`${e}年${a}月，${({spring:"春季感情昇溫，適合增進感情",summer:"夏季需要冷靜，避免情緒化決定",autumn:"秋季適合規劃未來，討論重要事項",winter:"冬季注重內在交流，培養默契"})[a<=3?"winter":a<=6?"spring":a<=9?"summer":"autumn"]}。根據${n}命與${t}命的配合，建議此時期重點關注相互理解和支持。`}let p=new r.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/couple-annual-analysis/route",pathname:"/api/couple-annual-analysis",filename:"route",bundlePath:"app/api/couple-annual-analysis/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/couple-annual-analysis/route.js",nextConfigOutput:"",userland:t}),{workAsyncStorage:S,workUnitAsyncStorage:g,serverHooks:$}=p;function x(){return(0,m.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:g})}},96487:()=>{}};var a=require("../../../webpack-runtime.js");a.C(e);var n=e=>a(a.s=e),t=a.X(0,[7719,580,6219,5209],()=>n(93850));module.exports=t})();