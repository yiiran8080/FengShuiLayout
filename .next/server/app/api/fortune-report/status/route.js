(()=>{var e={};e.id=6737,e.ids=[6737],e.modules={1379:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(56037),n=r.n(s);let i=new(n()).Schema({sessionId:{type:String,required:!0,unique:!0,index:!0},userId:{type:String,required:!1,index:!0},userEmail:{type:String,required:!1},paymentStatus:{type:String,enum:["pending","paid","expired"],default:"paid"},paymentAmount:{type:Number,required:!0},paymentCurrency:{type:String,default:"USD"},userInputs:{birthday:{type:String,required:!0},gender:{type:String,required:!0},concern:{type:String,required:!0},problem:{type:String,required:!0},partnerBirthday:{type:String,required:!1}},reportGenerated:{type:Boolean,default:!1},reportGeneratedAt:{type:Date,required:!1},reportContent:{fiveElementAnalysis:{type:n().Schema.Types.Mixed,required:!1},zodiacAnalysis:{type:n().Schema.Types.Mixed,required:!1},liuNianKeyWordAnalysis:{type:n().Schema.Types.Mixed,required:!1},mingJuAnalysis:{type:n().Schema.Types.Mixed,required:!1},ganZhiAnalysis:{type:n().Schema.Types.Mixed,required:!1},jiXiongAnalysis:{type:n().Schema.Types.Mixed,required:!1},seasonAnalysis:{type:n().Schema.Types.Mixed,required:!1},coreSuggestionAnalysis:{type:n().Schema.Types.Mixed,required:!1},specificSuggestionAnalysis:{type:n().Schema.Types.Mixed,required:!1},questionFocusAnalysis:{type:n().Schema.Types.Mixed,required:!1},coupleAnalysis:{type:n().Schema.Types.Mixed,required:!1}},accessCount:{type:Number,default:0},lastAccessedAt:{type:Date,default:Date.now},reportType:{type:String,default:"fortune"},reportVersion:{type:String,default:"1.0"},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});i.pre("save",function(e){this.updatedAt=Date.now(),e()}),i.index({sessionId:1}),i.index({userId:1}),i.index({userEmail:1}),i.index({createdAt:-1}),i.index({reportGenerated:1});let a=n().models.FortuneReport||n().model("FortuneReport",i)},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56037:e=>{"use strict";e.exports=require("mongoose")},56364:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,X:()=>o});var s=r(56037),n=r.n(s);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env");let a=global.mongoose;async function o(){if(a.conn)return a.conn;a.promise||(a.promise=n().connect(i,{serverSelectionTimeoutMS:3e4,socketTimeoutMS:3e4}).then(e=>e).catch(e=>{throw e}));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}a||(a=global.mongoose={conn:null,promise:null});let u=o},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{},99254:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>x,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>y,workUnitAsyncStorage:()=>l});var s={};r.r(s),r.d(s,{GET:()=>d});var n=r(96559),i=r(48088),a=r(37719),o=r(32190),u=r(56364),p=r(1379);async function d(e){try{let{searchParams:t}=new URL(e.url),r=t.get("sessionId");if(!r)return o.NextResponse.json({error:"Session ID is required"},{status:400});await (0,u.A)();let s=await p.A.findOne({sessionId:r}).select({sessionId:1,reportGenerated:1,reportGeneratedAt:1,accessCount:1,lastAccessedAt:1,paymentStatus:1,createdAt:1});if(!s)return o.NextResponse.json({error:"Report not found"},{status:404});return o.NextResponse.json({status:0,data:{sessionId:s.sessionId,reportGenerated:s.reportGenerated,reportGeneratedAt:s.reportGeneratedAt,accessCount:s.accessCount,lastAccessedAt:s.lastAccessedAt,paymentStatus:s.paymentStatus,createdAt:s.createdAt,canRegenerateReport:!1}})}catch(e){return console.error("Report status check error:",e),o.NextResponse.json({error:"檢查報告狀態失敗"},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/fortune-report/status/route",pathname:"/api/fortune-report/status",filename:"route",bundlePath:"app/api/fortune-report/status/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/fortune-report/status/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:y,workUnitAsyncStorage:l,serverHooks:m}=c;function x(){return(0,a.patchFetch)({workAsyncStorage:y,workUnitAsyncStorage:l})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580],()=>r(99254));module.exports=s})();