(()=>{var e={};e.id=6522,e.ids=[6522],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51561:(e,a,n)=>{"use strict";n.r(a),n.d(a,{patchFetch:()=>k,routeModule:()=>x,serverHooks:()=>M,workAsyncStorage:()=>b,workUnitAsyncStorage:()=>E});var t={};n.r(t),n.d(t,{POST:()=>g});var r=n(96559),o=n(48088),m=n(37719),s=n(32190),i=n(95209),h=n(74474),d=n(96002),c=n.n(d),l=n(14250),y=n(44794),u=n(42457);function S(e,a="male"){try{let n=e;e.includes("T")||e.includes(" ")||(n=`${e} 12:00:00`);let t=c()(n).format("YYYY-MM-DD HH:mm:ss"),r=(0,l.A)(t);r.char8ex(+("female"!==a));let o={year:{stem:r.char8.year.stem.name,stemElement:r.char8.year.stem.e5.name,branch:r.char8.year.branch.name,branchElement:r.char8.year.branch.e5.name,nayin:r.char8.year.takeSound,nayinElement:r.char8.year.takeSoundE5.toString()},month:{stem:r.char8.month.stem.name,stemElement:r.char8.month.stem.e5.name,branch:r.char8.month.branch.name,branchElement:r.char8.month.branch.e5.name,nayin:r.char8.month.takeSound,nayinElement:r.char8.month.takeSoundE5.toString()},day:{stem:r.char8.day.stem.name,stemElement:r.char8.day.stem.e5.name,branch:r.char8.day.branch.name,branchElement:r.char8.day.branch.e5.name,nayin:r.char8.day.takeSound,nayinElement:r.char8.day.takeSoundE5.toString()},hour:{stem:r.char8.hour.stem.name,stemElement:r.char8.hour.stem.e5.name,branch:r.char8.hour.branch.name,branchElement:r.char8.hour.branch.e5.name,nayin:r.char8.hour.takeSound,nayinElement:r.char8.hour.takeSoundE5.toString()}},m={金:0,木:0,水:0,火:0,土:0};Object.values(o).forEach(e=>{e.stemElement&&m[e.stemElement]++,e.branchElement&&m[e.branchElement]++});let s=Object.keys(m).reduce((e,a)=>m[e]>m[a]?e:a),i=Object.entries(m).filter(([e,a])=>0===a).map(([e])=>e);return{dayMasterElement:o.day.stemElement,dayMasterStem:o.day.stem,lifeElement:o.year.nayinElement,lifeNayin:o.year.nayin,fourPillars:o,elementCounts:m,dominantElement:s,missingElements:i,birthDateTime:t,gender:a,calculationMethod:"lunisolar_unified"}}catch(e){throw console.error("Unified element calculation error:",e),Error(`Element calculation failed: ${e.message}`)}}async function g(e){try{let{user1Birthday:a,user2Birthday:n,user1Name:t,user2Name:r,compatibilityData:o,analysisType:m}=await e.json();if(!a||!n)return s.NextResponse.json({error:"Missing required birthday information"},{status:400});let i=await p(a,n,t,r,o);return s.NextResponse.json({success:!0,godExplanations:i,timestamp:new Date().toISOString()})}catch(e){return console.error("Error in couple god analysis:",e),s.NextResponse.json({error:"Failed to generate god analysis",details:e.message},{status:500})}}async function p(e,a,n,t,r){try{let r=S(e,"male"),o=S(a,"female"),m=(0,h.Ay)(e,"male"),s=(0,h.Ay)(a,"female");m.dayStem=r.dayMasterStem,m.dayStemWuxing=r.dayMasterElement,s.dayStem=o.dayMasterStem,s.dayStemWuxing=o.dayMasterElement;let d=$(m),c=$(s);console.log("\uD83D\uDD0D Unified Element Calculation Results:"),console.log(`男方 (${e}): ${m.dayStem}${m.dayStemWuxing} (Day Master)`),console.log(`女方 (${a}): ${s.dayStem}${s.dayStemWuxing} (Day Master)`),console.log("\uD83C\uDFAF Ten Gods Calculation:"),console.log(`男方 Ten Gods:`,d.primaryGods),console.log(`女方 Ten Gods:`,c.primaryGods);let l=`作為頂尖的八字命理分析師，請根據以下雙方八字信息，進行深度的「十神互動精微解讀」分析：

**基本信息：**
- ${n}（男方）：${e}
- ${t}（女方）：${a}
- 男方八字：${m.yearStem}${m.yearBranch} ${m.monthStem}${m.monthBranch} ${m.dayStem}${m.dayBranch} ${m.hourStem}${m.hourBranch}
- 女方八字：${s.yearStem}${s.yearBranch} ${s.monthStem}${s.monthBranch} ${s.dayStem}${s.dayBranch} ${s.hourStem}${s.hourBranch}

**實際十神分析：**
- 男方主要十神：${d.primaryGods.join("、")}
- 女方主要十神：${c.primaryGods.join("、")}
- 男方日主：${m.dayStem}${m.dayStemWuxing}
- 女方日主：${s.dayStem}${s.dayStemWuxing}

**分析要求：**
請基於實際的八字十神配置，提供2-3個關鍵的十神互動分析：

**第一個分析（女方→男方）：**
請分析女方的主要十神（${c.primaryGods[0]||"偏印"}）如何影響男方的十神（${d.primaryGods[0]||"食神"}）

**第二個分析（男方→女方）：**
請分析男方的主要十神（${d.primaryGods[0]||"正官"}）如何影響女方的十神（${c.primaryGods[0]||"七殺"}）

**格式要求：**
1. 使用實際的天干地支和十神名稱
2. 格式：女方[天干][十神] → 男方[天干][十神]
3. 例如：女方庚金偏印 → 男方己土食神
4. 說明組合的核心機制和化解建議

**根據實際八字數據進行分析，不要使用假設數據。**

請用繁體中文回答。`,y=await i.EnhancedInitialAnalysis.generateCoupleAIAnalysis(new Date(e),new Date(a),m.dayStemWuxing||"土",s.dayStemWuxing||"土",l);return function(e,a,n,t,r,o,m){let s=[];for(let a of e.split(/(?=\d+[\.\)、])|(?=女方.*→)|(?=男方.*→)|(?=財星對沖)|(?=官殺混雜)|(?=印星)|(?=食神)|(?=正財)|(?=偏財)/)){let e=a.trim();if(e.length<30)continue;let n={category:"互動神",fromGod:"",toGod:"",interaction:"",keyIssues:"",problems:[],solution:""},i=!1;for(let a of[/(女方)([^→]*?)(偏印|正印|食神|傷官|偏財|正財|偏官|七殺|正官|比肩|劫財)[^→]*?→\s*(男方)([^。]*?)(偏印|正印|食神|傷官|偏財|正財|偏官|七殺|正官|比肩|劫財)/,/(男方)([^→]*?)(偏印|正印|食神|傷官|偏財|正財|偏官|七殺|正官|比肩|劫財)[^→]*?→\s*(女方)([^。]*?)(偏印|正印|食神|傷官|偏財|正財|偏官|七殺|正官|比肩|劫財)/,/(女方)([^→]+)→\s*(男方)([^。]+)/,/(男方)([^→]+)→\s*(女方)([^。]+)/]){let t=e.match(a);if(t){t.length>=6?(n.fromGod=t[1]+t[2]+t[3],n.toGod=t[4]+t[5]+t[6]):(n.fromGod=t[1]+t[2].trim(),n.toGod=t[3]+t[4].trim()),i=!0;break}}if(i)for(let a of(!n.fromGod||n.fromGod.includes("女方")||n.fromGod.includes("男方")||(n.fromGod=`女方${n.fromGod}`),!n.toGod||n.toGod.includes("女方")||n.toGod.includes("男方")||(n.toGod=`男方${n.toGod}`),e.substring(e.indexOf("→")+1).split(/[。；]/))){let e=a.trim();e.length<5||(e.includes("此為")||e.includes("組合")?n.interaction+=e+"。":e.includes("關鍵")||e.includes("注意")?n.keyIssues+=e+"。":e.includes("化解")||e.includes("建議")?n.solution+=e+"。":""!==n.interaction||(n.interaction+=e+"。"))}(n.interaction.trim()||n.problems.length>0)&&(n.interaction=n.interaction.trim(),n.keyIssues=n.keyIssues.trim(),n.solution=n.solution.trim(),n.fromGod||(0===s.length?(n.fromGod=m.primaryGods[0]||`${r}主要十神`,n.toGod=o.primaryGods[0]||`${t}主要十神`):(n.fromGod=o.primaryGods[0]||`${t}主要十神`,n.toGod=m.primaryGods[0]||`${r}主要十神`)),n.toGod||(n.toGod=0===s.length?o.primaryGods[0]||`${t}主要十神`:m.primaryGods[0]||`${r}主要十神`),s.push(n))}return 0===s.length?f(a,n,o,m,t,r):s}(y,m,s,n,t,d,c)}catch(c){console.error("Error generating AI god analysis:",c);let r=S(e,"male"),o=S(a,"female"),m=(0,h.Ay)(e,"male"),s=(0,h.Ay)(a,"female");m.dayStem=r.dayMasterStem,m.dayStemWuxing=r.dayMasterElement,s.dayStem=o.dayMasterStem,s.dayStemWuxing=o.dayMasterElement;let i=$(m),d=$(s);return f(m,s,i,d,n,t)}}function $(e){let a=e.dayStemWuxing,n=e.dayStem,t=[{heavenly:e.yearStem,earthly:e.yearBranch},{heavenly:e.monthStem,earthly:e.monthBranch},{heavenly:e.dayStem,earthly:e.dayBranch},{heavenly:e.hourStem,earthly:e.hourBranch}],r=[],o=[];return t.forEach((e,t)=>{if(e.heavenly&&e.heavenly!==n){let m=function(e,a,n){let t={甲:"木",乙:"木",丙:"火",丁:"火",戊:"土",己:"土",庚:"金",辛:"金",壬:"水",癸:"水"}[a],r=(["甲","丙","戊","庚","壬"].includes(e)?"yang":"yin")==(["甲","丙","戊","庚","壬"].includes(a)?"yang":"yin");return n===t?r?"比肩":"劫財":({木:"火",火:"土",土:"金",金:"水",水:"木"})[n]===t?r?"食神":"傷官":({火:"木",土:"火",金:"土",水:"金",木:"水"})[n]===t?r?"偏印":"正印":({木:"土",火:"金",土:"水",金:"木",水:"火"})[n]===t?r?"偏財":"正財":({土:"木",金:"火",水:"土",木:"金",火:"水"})[n]===t?r?"七殺":"正官":"比肩"}(n,e.heavenly,a);m&&(r.push(`${e.heavenly}${G(e.heavenly)}${m}`),t<2&&o.push(`${e.heavenly}${G(e.heavenly)}${m}`))}}),0===o.length&&r.length>0&&o.push(r[0]),{allGods:r,primaryGods:o.length>0?o:[`${n}${a}比肩`]}}function G(e){return({甲:"木",乙:"木",丙:"火",丁:"火",戊:"土",己:"土",庚:"金",辛:"金",壬:"水",癸:"水"})[e]||"土"}function f(e,a,n,t,r,o){let m=[];console.log("\uD83D\uDD0D Fallback Debug - Raw Ten Gods:"),console.log("Female Ten Gods:",t.primaryGods),console.log("Male Ten Gods:",n.primaryGods);let s=t.primaryGods[0]||`${a.dayStemWuxing||"五行"}命`,i=n.primaryGods[0]||`${e.dayStemWuxing||"五行"}命`,h=s.includes("女方")?s:`女方${s}`,d=i.includes("男方")?i:`男方${i}`;if(console.log("\uD83C\uDFAF Processed Ten Gods:"),console.log("Female God:",h),console.log("Male God:",d),m.push({category:"互動分析",fromGod:h,toGod:d,interaction:`此為${h}與${d}的互動組合。基於實際八字分析，雙方在五行能量上形成特定的相互作用關係。`,keyIssues:`關鍵在於理解${a.dayStemWuxing||"女方"}命與${e.dayStemWuxing||"男方"}命的五行生剋關係，以及如何在日常相處中化解潛在衝突。`,problems:[],solution:`建議雙方根據各自的五行特質調整相處模式，${o}發揮${a.dayStemWuxing||"女方"}的優勢，${r}善用${e.dayStemWuxing||"男方"}的特質，達到互補平衡。`}),n.primaryGods.length>1||t.primaryGods.length>1){let e=n.primaryGods[1]||n.primaryGods[0],a=t.primaryGods[1]||t.primaryGods[0],r=e.includes("男方")?e:`男方${e}`,o=a.includes("女方")?a:`女方${a}`;m.push({category:"相互影響",fromGod:r,toGod:o,interaction:`${r}對${o}產生的影響分析。這個組合反映了雙方在不同層面的互動模式。`,keyIssues:`需要注意的是雙方的能量表達方式差異，避免因理解偏差而產生誤會。`,problems:[],solution:`建議透過增進溝通理解，讓雙方的優勢特質能夠相互支持而非對立。`})}return m}l.A.extend(y.t).extend(u.sM);let x=new r.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/couple-god-analysis/route",pathname:"/api/couple-god-analysis",filename:"route",bundlePath:"app/api/couple-god-analysis/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/couple-god-analysis/route.js",nextConfigOutput:"",userland:t}),{workAsyncStorage:b,workUnitAsyncStorage:E,serverHooks:M}=x;function k(){return(0,m.patchFetch)({workAsyncStorage:b,workUnitAsyncStorage:E})}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74474:(e,a,n)=>{"use strict";n.d(a,{Ay:()=>$});var t=n(44794),r=n(42457),o=n(81540),m=n(14250),s=n(96002),i=n.n(s),h=n(22246);m.A.extend(t.t).extend(r.sM).extend(o.z0);let d=(0,m.A)(i()().format("YYYY-MM-DD")).char8.year.toString(),{LYGanzhiMap:c,LYzhiMap:l,LYStarMap:y,LYSihuaMap:u,spouseStarMap:S,spouseSihuaMap:g}=function(){let e=i()().format("YYYY"),a={},n={},t={},r={},o={},m={};for(let s=1;s<=12;s++){let i=e+"-"+(s<10?"0"+s:""+s)+"-15",d=h.astro.bySolar(i,0,"男",!0,"zh-CN").horoscope(i);n[s]=d.monthly.earthlyBranch,a[s]=d.monthly.heavenlyStem+d.monthly.earthlyBranch,t[s]=d.palace("命宫","monthly").majorStars.map(e=>e.name).toString(),o[s]=d.palace("夫妻","monthly").majorStars.map(e=>e.name).toString(),r[s]=d.palace("命宫","monthly").mutagedPlaces().map(e=>e.name).toString(),m[s]=d.palace("夫妻","monthly").mutagedPlaces().map(e=>e.name).toString()}return{LYGanzhiMap:a,LYzhiMap:n,LYStarMap:t,LYSihuaMap:r,spouseStarMap:o,spouseSihuaMap:m}}();(function(){let e=i()().format("YYYY-MM-DD");(0,m.A)(e).char8.month.toString()})(),function(){let e=i()().format("YYYY-MM-DD");h.astro.bySolar(e,0,"男",!0,"zh-CN").horoscope(e,0).palace("夫妻","yearly").majorStars.map(e=>e.name).toString()}();let p={};function $(e,a){var n;let t=i()(e).format("YYYY-MM-DD HH:mm:ss");if(console.log("birthStr",t),p[t+"-"+a])return p[t+"-"+a];let r=Math.floor(i()(e).hour()/2),o=i()(e).format("YYYY-MM-DD"),s=h.astro.bySolar(o,r,"female"==a?"女":"男",!0,"zh-CN"),c=s.palace("命宫"),l=s.palace("身宫"),y=s.palace("迁移").majorStars.map(e=>e.name).toString(),u=s.horoscope(o,r),S=(0,m.A)(t),g=function(e,a,n,t,r,o,m,s){let i={金:0,木:0,水:0,火:0,土:0},h=[e,a,n,t,r,o,m,s];h.forEach(e=>{["金","木","水","火","土"].includes(e)&&i[e]++});let d=h.length;return`金:${(i.金/d*100).toFixed(2)}%，木:${(i.木/d*100).toFixed(2)}%，水:${(i.水/d*100).toFixed(2)}%，火:${(i.火/d*100).toFixed(2)}%，土:${(i.土/d*100).toFixed(2)}%`}(S.char8.year.stem.e5.name,S.char8.year.branch.e5.name,S.char8.month.stem.e5.name,S.char8.month.branch.e5.name,S.char8.day.stem.e5.name,S.char8.day.branch.e5.name,S.char8.hour.stem.e5.name,S.char8.hour.branch.e5.name),$=S.char8.day.branch.hiddenStems.map(e=>e.name).toString(),f=S.char8.year.branch.hiddenStems,x=S.char8.month.branch.hiddenStems,b=S.char8.day.branch.hiddenStems,E=S.char8.hour.branch.hiddenStems,M=S.char8ex(+("female"!==a)),k=M.year,v=M.month,B=M.day,Y=M.hour,W={nayin:S.char8.year.takeSound,wuxingJu:(n=S.char8.year.takeSoundE5.toString(),`${n}${G[n]}局`),year:S.char8.year.toString(),month:S.char8.month.toString(),day:S.char8.day.toString(),hour:S.char8.hour.toString(),wuxingScale:g,rizhiCanggan:$,mingPalace:`{主星：${c.majorStars.map(e=>e.name).toString()},主星亮度：${c.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${c.minorStars.map(e=>e.name).toString()}, 四化：${c.mutagedPlaces().map(e=>e.name).toString()}}`,bodyPalace:`{主星：${l.majorStars.map(e=>e.name).toString()},主星亮度：${l.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${l.minorStars.map(e=>e.name).toString()}, 四化：${l.mutagedPlaces().map(e=>e.name).toString()}}`,qianyiPalace:y,dayunGanzhi:u.decadal.heavenlyStem+u.decadal.earthlyBranch,liunianGanzhi:d,yearStemTenGod:k.stemTenGod.name,yearBranchTenGod:k.branchTenGod.map(e=>e.name).toString(),monthStemTenGod:v.stemTenGod.name,monthBranchTenGod:v.branchTenGod.map(e=>e.name).toString(),dayStemTenGod:B.stemTenGod.name,dayBranchTenGod:B.branchTenGod.map(e=>e.name).toString(),hourStemTenGod:Y.stemTenGod.name,hourBranchTenGod:Y.branchTenGod.map(e=>e.name).toString(),yearGods:k.gods.map(e=>e.name).toString(),monthGods:v.gods.map(e=>e.name).toString(),dayGods:B.gods.map(e=>e.name).toString(),yearStem:S.char8.year.stem.name,yearStemWuxing:S.char8.year.stem.e5.name,yearBranch:S.char8.year.branch.name,yearBranchWuxing:S.char8.year.branch.e5.name,monthStem:S.char8.month.stem.name,monthStemWuxing:S.char8.month.stem.e5.name,monthBranch:S.char8.month.branch.name,monthBranchWuxing:S.char8.month.branch.e5.name,dayStem:S.char8.day.stem.name,dayStemWuxing:S.char8.day.stem.e5.name,dayBranch:S.char8.day.branch.name,dayBranchWuxing:S.char8.day.branch.e5.name,hourStem:S.char8.hour.stem.name,hourStemWuxing:S.char8.hour.stem.e5.name,hourBranch:S.char8.hour.branch.name,hourBranchWuxing:S.char8.hour.branch.e5.name,yearNayin:S.char8.year.takeSound,monthNayin:S.char8.month.takeSound,dayNayin:S.char8.day.takeSound,hourNayin:S.char8.hour.takeSound,yearNayinWuxing:S.char8.year.takeSoundE5.toString(),monthNayinWuxing:S.char8.month.takeSoundE5.toString(),dayNayinWuxing:S.char8.day.takeSoundE5.toString(),hourNayinWuxing:S.char8.hour.takeSoundE5.toString(),yearBranchHiddenStems:f.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),monthBranchHiddenStems:x.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),dayBranchHiddenStems:b.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),hourBranchHiddenStems:E.map(e=>({stem:e.name,element:e.e5.name,strength:e.value}))};return p[t+"-"+a]=W,console.log("result",W),W}let G={水:"二",木:"三",金:"四",土:"五",火:"六"}},78335:()=>{},96487:()=>{}};var a=require("../../../webpack-runtime.js");a.C(e);var n=e=>a(a.s=e),t=a.X(0,[7719,580,6219,5209],()=>n(51561));module.exports=t})();