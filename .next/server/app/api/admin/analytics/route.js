(()=>{var e={};e.id=678,e.ids=[678],e.modules={6745:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(56037),a=r.n(n);let i=new(a()).Schema({userId:{type:String,required:!0,unique:!0},password:{type:String,required:!1},provider:{type:String,default:"credentials",required:!1},name:{type:String,required:!1},gender:{type:String,enum:["female","male"],required:!0,default:"female"},birthDateTime:{type:Date,required:!0,default:new Date(1996,2,12,22)},email:{type:String,required:!1},isLock:{type:Boolean,required:!0,default:!0},genStatus:{type:String,enum:["none","waiting","done"],required:!1},emailVerified:{type:Boolean,default:!1},verificationToken:{type:String,required:!1},freeReportStats:{totalGenerated:{type:Number,default:0},lastGeneratedAt:{type:Date,default:null},firstGeneratedAt:{type:Date,default:null},favoriteRoomType:{type:String,default:null},favoriteDirection:{type:String,default:null}},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});i.virtual("freeReportActivities",{ref:"FreeReportActivity",localField:"userId",foreignField:"userId"}),i.virtual("projects",{ref:"Project",localField:"userId",foreignField:"owner"}),i.set("toJSON",{virtuals:!0}),i.set("toObject",{virtuals:!0}),a().models.User&&delete a().models.User,a().modelSchemas&&a().modelSchemas.User&&delete a().modelSchemas.User;let s=a().model("User",i)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},20845:(e,t,r)=>{"use strict";r.d(t,{Rx:()=>d,XQ:()=>l,wL:()=>c});var n=r(56037),a=r.n(n);let i=new(a()).Schema({username:{type:String,required:!0,unique:!0},password:{type:String,required:!0},email:{type:String,required:!0},role:{type:String,enum:["admin","super_admin"],default:"admin"},lastLogin:{type:Date},isActive:{type:Boolean,default:!0},loginAttempts:{type:Number,default:0},lockUntil:{type:Date}},{timestamps:!0});i.virtual("isLocked").get(function(){return!!(this.lockUntil&&this.lockUntil>Date.now())});let s=new(a()).Schema({userId:{type:String,required:!0,index:!0},sessionId:{type:String,index:!0},activityType:{type:String,enum:["login","chat_start","chat_message","topic_selection","birthday_input","payment_initiate","payment_complete","report_generate","report_view","page_visit","logout","error_occurred"],required:!0},activityData:{type:a().Schema.Types.Mixed},metadata:{ipAddress:String,userAgent:String,deviceType:String,browser:String,platform:String,referrer:String,language:String,timezone:String},duration:{type:Number},success:{type:Boolean,default:!0},errorDetails:{type:String}},{timestamps:!0,indexes:[{userId:1,createdAt:-1},{activityType:1,createdAt:-1},{sessionId:1,createdAt:-1}]}),o=new(a()).Schema({date:{type:Date,required:!0,unique:!0},metrics:{dailyActiveUsers:{type:Number,default:0},newUsers:{type:Number,default:0},totalConversations:{type:Number,default:0},completedConsultations:{type:Number,default:0},paymentTransactions:{type:Number,default:0},totalRevenue:{type:Number,default:0},averageSessionDuration:{type:Number,default:0},topConcerns:[{concern:String,count:Number}],userTypeDistribution:{新手用戶:{type:Number,default:0},回頭客:{type:Number,default:0},專業用戶:{type:Number,default:0}},deviceStats:{mobile:{type:Number,default:0},desktop:{type:Number,default:0},tablet:{type:Number,default:0}},errorRate:{type:Number,default:0},responseTime:{type:Number,default:0}}},{timestamps:!0}),u=new(a()).Schema({adminId:{type:String,required:!0,index:!0},action:{type:String,enum:["user_view","user_edit","conversation_view","conversation_moderate","system_setting_change","user_block","user_unblock","data_export","broadcast_message","report_generate","payment_refund","content_edit"],required:!0},targetType:{type:String,enum:["user","conversation","system","content"]},targetId:{type:String},details:{type:a().Schema.Types.Mixed},ipAddress:{type:String}},{timestamps:!0,indexes:[{adminId:1,createdAt:-1},{action:1,createdAt:-1}]}),d=a().models.AdminUser||a().model("AdminUser",i),l=a().models.UserActivity||a().model("UserActivity",s);a().models.SystemMetrics||a().model("SystemMetrics",o);let c=a().models.AdminActionLog||a().model("AdminActionLog",u)},27910:e=>{"use strict";e.exports=require("stream")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33280:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>q,routeModule:()=>x,serverHooks:()=>T,workAsyncStorage:()=>R,workUnitAsyncStorage:()=>k});var n={};r.r(n),r.d(n,{GET:()=>m});var a=r(96559),i=r(48088),s=r(37719),o=r(96440),u=r(20845),d=r(41926),l=r(45012),c=r(6745),p=r(56364);async function m(e){try{let t=await (0,o.verifyAdminToken)(e);if(t.error)return Response.json({error:t.error},{status:t.status});await (0,p.A)();let{searchParams:r}=new URL(e.url),n=r.get("action"),a=r.get("timeRange")||"7d";switch(n){case"dashboard_overview":return await g(a);case"user_activities":return await y(r);case"chat_analytics":return await h(r);case"user_list":return await f(r);case"conversation_list":return await v(r);case"system_health":return await S();default:return Response.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Admin dashboard error:",e),Response.json({error:"Internal server error"},{status:500})}}async function g(e){let t=A(e);try{let[r,n,a,i,s]=await Promise.all([c.A.countDocuments(),d.A.countDocuments(),_(t),w(t),u.XQ.find(t).sort({createdAt:-1}).limit(50)]),o=await l.A.aggregate([{$match:t},{$group:{_id:"$aiAnalysis.userType",count:{$sum:1}}},{$sort:{count:-1}}]),p=await l.A.aggregate([{$match:t},{$group:{_id:"$primaryConcern",count:{$sum:1}}},{$sort:{count:-1}}]),m=await l.A.aggregate([{$match:t},{$group:{_id:"$conversationState",count:{$sum:1}}}]);return Response.json({success:!0,data:{overview:{totalUsers:r,totalConversations:n,activeUsersToday:a,totalRevenue:i.total,avgSessionDuration:await $(t)},userTypeDistribution:o,concernDistribution:p,completionStats:m,recentActivities:s.map(e=>({id:e._id,userId:e.userId,type:e.activityType,timestamp:e.createdAt,details:e.activityData,success:e.success})),timeRange:e}})}catch(e){return console.error("Dashboard overview error:",e),Response.json({error:"Failed to get dashboard overview"},{status:500})}}async function y(e){let t=parseInt(e.get("page"))||1,r=parseInt(e.get("limit"))||50,n=e.get("userId"),a=e.get("activityType"),i=A(e.get("timeRange")||"7d");n&&(i.userId=n),a&&(i.activityType=a);try{let e=(t-1)*r,[n,a]=await Promise.all([u.XQ.find(i).sort({createdAt:-1}).skip(e).limit(r),u.XQ.countDocuments(i)]);return Response.json({success:!0,data:{activities:n.map(e=>({id:e._id,userId:e.userId,sessionId:e.sessionId,type:e.activityType,data:e.activityData,metadata:e.metadata,duration:e.duration,success:e.success,timestamp:e.createdAt,errorDetails:e.errorDetails})),pagination:{page:t,limit:r,total:a,pages:Math.ceil(a/r)}}})}catch(e){return console.error("User activities error:",e),Response.json({error:"Failed to get user activities"},{status:500})}}async function h(e){let t=e.get("timeRange")||"7d",r=A(t);try{let e=await d.A.aggregate([{$match:r},{$group:{_id:{year:{$year:"$createdAt"},month:{$month:"$createdAt"},day:{$dayOfMonth:"$createdAt"}},conversationCount:{$sum:1},messageCount:{$sum:{$size:"$messages"}}}},{$sort:{"_id.year":1,"_id.month":1,"_id.day":1}}]),n=await d.A.aggregate([{$match:r},{$group:{_id:null,avgMessages:{$avg:{$size:"$messages"}}}}]),a=await d.A.aggregate([{$match:r},{$group:{_id:"$primaryConcern",count:{$sum:1}}},{$sort:{count:-1}}]),i=await l.A.aggregate([{$match:r},{$group:{_id:"$aiAnalysis.engagementLevel",count:{$sum:1}}}]);return Response.json({success:!0,data:{chatVolumeByDay:e,avgMessagesPerConversation:n[0]?.avgMessages||0,topicDistribution:a,engagementPatterns:i,timeRange:t}})}catch(e){return console.error("Chat analytics error:",e),Response.json({error:"Failed to get chat analytics"},{status:500})}}async function f(e){let t=parseInt(e.get("page"))||1,r=parseInt(e.get("limit"))||20,n=e.get("search"),a=e.get("userType");try{let e=(t-1)*r,i={};n&&(i.$or=[{userId:{$regex:n,$options:"i"}},{email:{$regex:n,$options:"i"}}]);let s=[{$match:i},{$lookup:{from:"smartuserintents",localField:"userId",foreignField:"userId",as:"intents"}},{$lookup:{from:"chathistories",localField:"userId",foreignField:"userId",as:"conversations"}},{$addFields:{latestIntent:{$arrayElemAt:[{$sortArray:{input:"$intents",sortBy:{createdAt:-1}}},0]},conversationCount:{$size:"$conversations"},totalMessages:{$sum:{$map:{input:"$conversations",as:"conv",in:{$size:"$$conv.messages"}}}}}}];a&&s.push({$match:{"latestIntent.aiAnalysis.userType":a}}),s.push({$sort:{createdAt:-1}},{$skip:e},{$limit:r});let[o,u]=await Promise.all([c.A.aggregate(s),c.A.countDocuments(i)]);return Response.json({success:!0,data:{users:o.map(e=>({id:e._id,userId:e.userId,email:e.email,gender:e.gender,birthDateTime:e.birthDateTime,provider:e.provider,isLock:e.isLock,createdAt:e.createdAt,userType:e.latestIntent?.aiAnalysis?.userType,emotionalState:e.latestIntent?.aiAnalysis?.emotionalState,conversationCount:e.conversationCount,totalMessages:e.totalMessages,lastActivity:e.latestIntent?.updatedAt})),pagination:{page:t,limit:r,total:u,pages:Math.ceil(u/r)}}})}catch(e){return console.error("User list error:",e),Response.json({error:"Failed to get user list"},{status:500})}}async function v(e){let t=parseInt(e.get("page"))||1,r=parseInt(e.get("limit"))||20,n=e.get("userId"),a=e.get("primaryConcern");try{let e=(t-1)*r,i={};n&&(i.userId=n),a&&(i.primaryConcern=a);let[s,o]=await Promise.all([d.A.find(i).sort({updatedAt:-1}).skip(e).limit(r),d.A.countDocuments(i)]);return Response.json({success:!0,data:{conversations:s.map(e=>({id:e._id,conversationId:e.conversationId,userId:e.userId,title:e.title,primaryConcern:e.primaryConcern,messageCount:e.messages.length,lastMessage:e.messages[e.messages.length-1],createdAt:e.createdAt,updatedAt:e.updatedAt})),pagination:{page:t,limit:r,total:o,pages:Math.ceil(o/r)}}})}catch(e){return console.error("Conversation list error:",e),Response.json({error:"Failed to get conversation list"},{status:500})}}async function S(){try{let[e,t,r]=await Promise.all([D(),I(),b()]);return Response.json({success:!0,data:{database:e,errors:t,performance:r,timestamp:new Date}})}catch(e){return console.error("System health error:",e),Response.json({error:"Failed to get system health"},{status:500})}}function A(e){let t=new Date,r={"1d":new Date(t.getTime()-864e5),"7d":new Date(t.getTime()-6048e5),"30d":new Date(t.getTime()-2592e6),"90d":new Date(t.getTime()-7776e6)};return{createdAt:{$gte:r[e]||r["7d"]}}}async function _(e){return await u.XQ.distinct("userId",e).then(e=>e.length)}async function w(e){return(await l.A.aggregate([{$match:{...e,paymentCompleted:!0}},{$group:{_id:null,total:{$sum:"$paymentAmount"},count:{$sum:1}}}]))[0]||{total:0,count:0}}async function $(e){let t=await u.XQ.aggregate([{$match:{...e,duration:{$exists:!0}}},{$group:{_id:null,avgDuration:{$avg:"$duration"}}}]);return t[0]?.avgDuration||0}async function D(){try{return await c.A.findOne({}).limit(1),{status:"healthy",message:"Database connection OK"}}catch(e){return{status:"error",message:e.message}}}async function I(){return await u.XQ.find({success:!1,createdAt:{$gte:new Date(Date.now()-864e5)}}).sort({createdAt:-1}).limit(10)}async function b(){return{responseTime:100*Math.random()+50,cpuUsage:100*Math.random(),memoryUsage:100*Math.random(),uptime:process.uptime()}}let x=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/admin/analytics/route",pathname:"/api/admin/analytics",filename:"route",bundlePath:"app/api/admin/analytics/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/admin/analytics/route.js",nextConfigOutput:"",userland:n}),{workAsyncStorage:R,workUnitAsyncStorage:k,serverHooks:T}=x;function q(){return(0,s.patchFetch)({workAsyncStorage:R,workUnitAsyncStorage:k})}},41926:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(56037),a=r.n(n);a().models.ChatHistory&&delete a().models.ChatHistory;let i=new(a()).Schema({conversationId:{type:String,required:!0,index:!0},sessionId:{type:String,required:!0,index:!0},userId:{type:String,required:!0,index:!0},userEmail:{type:String,required:!1},title:{type:String,required:!0},primaryConcern:{type:String,enum:["工作","感情","財運","子女","人際關係","健康","因緣","風水佈局","其他"],required:!1},conversationState:{type:String,enum:["initial","ai_analyzing","birthday_collection","asking_detailed_report","ready_for_detailed_report","collecting_payment_info","completed"],default:"initial"},messages:[{messageId:{type:String,required:!0},role:{type:String,enum:["user","assistant"],required:!0},content:{type:String,required:!0},timestamp:{type:Date,default:Date.now},aiAnalysis:{detectedTopic:String,isWithinScope:Boolean,confidence:Number,specificProblem:String},systemType:{type:String,default:"smart-chat2"}}],stats:{totalMessages:{type:Number,default:0},lastActivity:{type:Date,default:Date.now},userEngagement:{type:Number,min:0,max:1,default:.5}},context:{topics:[String],lastTopic:String,conversationSummary:String,emotionalState:String},userData:{userBirthday:Date,partnerBirthday:Date,gender:String,partnerGender:String,relationshipType:String},isActive:{type:Boolean,default:!0},isArchived:{type:Boolean,default:!1}},{timestamps:!0,indexes:[{userId:1,conversationId:1},{userId:1,isActive:1},{sessionId:1},{"stats.lastActivity":-1},{createdAt:-1}]});i.methods.addMessage=function(e,t,r=null){let n=`msg-${Date.now()}-${Math.random().toString(36).substr(2,9)}`;return this.messages.push({messageId:n,role:e,content:t,timestamp:new Date,aiAnalysis:r,systemType:"smart-chat2"}),this.stats.totalMessages=this.messages.length,this.stats.lastActivity=new Date,n},i.methods.updateContext=function(e,t=null){e&&!this.context.topics.includes(e)&&this.context.topics.push(e),e&&(this.context.lastTopic=e),t&&(this.context.emotionalState=t)},i.methods.generateSummary=function(){let e=this.stats.totalMessages,t=this.primaryConcern||"一般諮詢";return 0===e?`剛開始的${t}對話`:e<5?`${t}初步討論（${e}輪）`:`${t}深入討論（${e}輪）`};let s=a().models.ChatHistory||a().model("ChatHistory",i)},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},45012:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(56037),a=r.n(n);a().models.SmartUserIntent&&delete a().models.SmartUserIntent;let i=new(a()).Schema({userEmail:{type:String,required:!1,index:!0},userId:{type:String,required:!1,index:!0},sessionId:{type:String,index:!0},primaryConcern:{type:String,enum:["工作","感情","財運","子女","人際關係","健康","因緣","風水佈局","其他"],required:!1},nonCoreUserInput:{type:String,maxlength:500},nonCoreAnalysis:{isTypo:{type:Boolean,default:!1},suggestedCoreArea:{type:String,enum:["工作","感情","財運","子女","人際關係","健康","因緣","風水佈局","其他"]},aiResponse:{type:String,maxlength:1e3},analysisTimestamp:{type:Date,default:Date.now}},aiAnalysis:{userType:{type:String,enum:["新手用戶","回頭客","專業用戶"]},emotionalState:{type:String,enum:["平靜","焦慮","興奮","困惑","絕望","希望"]},urgencyLevel:{type:String,enum:["低","中","高","緊急"]},conversationPattern:{type:String,enum:["探索型","問題解決型","決策支持型","學習型"]},serviceDepth:{type:String,enum:["快速諮詢","標準分析","深度服務","專家諮詢"]},personalityType:{type:String,enum:["理性分析型","感性直覺型","務實行動型","謹慎保守型"]},engagementLevel:{type:String,enum:["低","中","高"]},topicFocus:[{type:String,enum:["感情","財運","工作","健康","人際關係","子女","因緣","風水佈局","其他"]}],communicationStyle:{type:String,enum:["直接","委婉","詳細","簡潔"]},recommendedApproach:{type:String,enum:["引導式","支持式","分析式","教育式"]},confidence:{type:Number,min:0,max:1,default:.5},lastAnalyzed:{type:Date,default:Date.now}},relationshipAnalysisType:{type:String,enum:["individual","couple"],required:!1},breakupStatus:{type:String,enum:["A","B","C","D"],required:!1},emotionalState:{type:String,enum:["just_broke_up","ready_to_restart","long_single","has_crush","want_reconcile","new_relationship","looking_for_new","long_term_relationship","healing","new_beginning","understand_reasons"],required:!1},specificQuestion:{type:String,maxlength:500},originalSpecificProblem:{type:String,maxlength:1e3},conversationState:{type:String,enum:["initial","concern_detected","asking_specific","asking_relationship_type","emotion_state_selection","breakup_guidance_provided","waiting_confirmation","problem_confirmed","ready_for_modal","ready_for_report","birthday_collected","birthday_provided","birthday_collection","asking_partner_birthday","asking_detailed_report","ready_for_detailed_report","ready_for_payment","confirming_birthday","confirming_partner_birthday","collecting_payment_info","report_generated","ai_analyzing","ai_analyzed","choice_selection"],default:"initial"},conversationActive:{type:Boolean,default:!0},readyForPayment:{type:Boolean,default:!1},conversationHistory:[{role:{type:String,enum:["user","assistant"],required:!0},content:{type:String,required:!0},timestamp:{type:Date,default:Date.now},detectedConcern:String,state:String}],paymentCompleted:{type:Boolean,default:!1},paymentAmount:{type:Number,min:0},paymentDate:{type:Date},serviceType:{type:String,enum:["work-analysis","relationship-analysis","wealth-analysis","children-analysis","social-analysis","love-analysis","destiny-analysis"]},birthDate:{type:Date},userBirthday:{type:Date},partnerBirthday:{type:Date},birthdayConfirmed:{type:Boolean,default:!1},partnerBirthdayConfirmed:{type:Boolean,default:!1},birthTime:{type:String},gender:{type:String,enum:["male","female"]},reportGenerated:{type:Boolean,default:!1},reportContent:{baziAnalysis:{yearElement:String,dayElement:String,strengthAnalysis:{description:String,advice:String},personality:String},currentSituation:String,futureOutlook:String,specificAdvice:String,fengShuiSolutions:String,timingAdvice:String,generatedAt:{type:Date,default:Date.now}}},{timestamps:!0,indexes:[{userEmail:1,conversationActive:1},{userId:1,conversationActive:1},{userEmail:1,paymentCompleted:1},{userId:1,paymentCompleted:1},{createdAt:-1}]});i.methods.isConversationComplete=function(){return"ready_for_payment"===this.conversationState||this.paymentCompleted},i.methods.getProgress=function(){let e=["initial","concern_detected","asking_specific","waiting_confirmation","asking_detailed_report","ready_for_detailed_report","ready_for_payment"],t=e.indexOf(this.conversationState);return{current:t+1,total:e.length,percentage:Math.round((t+1)/e.length*100)}};let s=a().models.SmartUserIntent||a().model("SmartUserIntent",i)},55511:e=>{"use strict";e.exports=require("crypto")},56037:e=>{"use strict";e.exports=require("mongoose")},56364:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,X:()=>o});var n=r(56037),a=r.n(n);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env");let s=global.mongoose;async function o(){if(s.conn)return s.conn;s.promise||(s.promise=a().connect(i,{serverSelectionTimeoutMS:3e4,socketTimeoutMS:3e4}).then(e=>e).catch(e=>{throw e}));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}s||(s=global.mongoose={conn:null,promise:null});let u=o},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79428:e=>{"use strict";e.exports=require("buffer")},96440:(e,t,r)=>{"use strict";r.r(t),r.d(t,{POST:()=>d,logAdminAction:()=>g,verifyAdminToken:()=>p});var n=r(85663),a=r(43205),i=r.n(a),s=r(20845),o=r(56364);let u=process.env.ADMIN_JWT_SECRET||"your-super-secret-admin-key-change-this";async function d(e){try{await (0,o.A)();let{username:t,password:r,action:n}=await e.json();if("checkSetup"===n)return await m();if(!t||!r||!n)return Response.json({error:"Missing required fields"},{status:400});if("login"===n)return await l(t,r,e);if("createAdmin"===n)return await c(t,r,e);return Response.json({error:"Invalid action"},{status:400})}catch(e){return console.error("Admin auth error:",e),Response.json({error:"Internal server error"},{status:500})}}async function l(e,t,r){try{let a=await s.Rx.findOne({username:e,isActive:!0});if(!a)return Response.json({error:"無效的用戶名或密碼"},{status:401});if(a.isLocked)return Response.json({error:"帳戶已被鎖定，請稍後再試",lockUntil:a.lockUntil},{status:423});if(!await n.Ay.compare(t,a.password)){if(a.loginAttempts+=1,a.loginAttempts>=5)return a.lockUntil=Date.now()+18e5,await a.save(),Response.json({error:"登入失敗次數過多，帳戶已被鎖定30分鐘",lockUntil:a.lockUntil},{status:423});return await a.save(),Response.json({error:`無效的用戶名或密碼，剩餘嘗試次數: ${5-a.loginAttempts}`},{status:401})}a.loginAttempts=0,a.lockUntil=void 0,a.lastLogin=new Date,await a.save();let o=i().sign({adminId:a._id,username:a.username,role:a.role},u,{expiresIn:"8h"});return await g(a._id,"login",null,null,{loginTime:new Date,ipAddress:function(e){let t=e.headers.get("x-forwarded-for"),r=e.headers.get("x-real-ip");return t?t.split(",")[0].trim():r||"unknown"}(r)}),Response.json({success:!0,token:o,admin:{id:a._id,username:a.username,email:a.email,role:a.role,lastLogin:a.lastLogin}})}catch(e){return console.error("Login error:",e),Response.json({error:"登入過程發生錯誤"},{status:500})}}async function c(e,t,r){try{if(await s.Rx.findOne({}))return Response.json({error:"管理員帳戶已存在"},{status:403});if(!e||!t)return Response.json({error:"用戶名和密碼為必填項"},{status:400});if(t.length<8)return Response.json({error:"密碼長度至少8個字符"},{status:400});let r=await n.Ay.hash(t,12),a=new s.Rx({username:e,password:r,email:`${e}@fengshui-admin.local`,role:"super_admin"});return await a.save(),Response.json({success:!0,message:"管理員帳戶創建成功",admin:{id:a._id,username:a.username,role:a.role}})}catch(e){return console.error("Create admin error:",e),Response.json({error:"創建管理員帳戶失敗"},{status:500})}}async function p(e){try{let t=e.headers.get("authorization");if(!t||!t.startsWith("Bearer "))return{error:"Missing or invalid authorization header",status:401};let r=t.substring(7),n=i().verify(r,u);await (0,o.A)();let a=await s.Rx.findById(n.adminId);if(!a||!a.isActive)return{error:"Invalid or inactive admin account",status:401};return{admin:n}}catch(e){return console.error("Token verification error:",e),{error:"Invalid token",status:401}}}async function m(){try{let e=await s.Rx.findOne({});return Response.json({hasAdmin:!!e,message:e?"管理員帳戶已存在":"需要創建管理員帳戶"})}catch(e){return console.error("Check setup error:",e),Response.json({error:"檢查設定失敗"},{status:500})}}async function g(e,t,r,n,a){try{let i=new s.wL({adminId:e,action:t,targetType:r,targetId:n,details:a,ipAddress:a?.ipAddress});await i.save()}catch(e){console.error("Error logging admin action:",e)}}},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7719,5663,8291],()=>r(33280));module.exports=n})();