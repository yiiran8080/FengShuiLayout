(()=>{var e={};e.id=4796,e.ids=[4796],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},33934:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>S,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>g});var n={};r.r(n),r.d(n,{POST:()=>d});var i=r(96559),s=r(48088),o=r(37719),a=r(32190),u=r(56364),p=r(95135);async function d(e){try{let{intentId:t,status:r}=await e.json();if(!t||!r)return a.NextResponse.json({error:"缺少必要參數"},{status:400});await (0,u.X)();let n={};"generated"===r&&(n.reportGenerated=!0,n.updatedAt=new Date);let i=await p.A.findByIdAndUpdate(t,n,{new:!0});if(!i)return a.NextResponse.json({error:"找不到對應記錄"},{status:404});return a.NextResponse.json({success:!0,message:"狀態更新成功",intent:i})}catch(e){return console.error("更新報告狀態失敗:",e),a.NextResponse.json({error:"更新失敗"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/admin/update-report/route",pathname:"/api/admin/update-report",filename:"route",bundlePath:"app/api/admin/update-report/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/admin/update-report/route.js",nextConfigOutput:"",userland:n}),{workAsyncStorage:l,workUnitAsyncStorage:g,serverHooks:m}=c;function S(){return(0,o.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:g})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56037:e=>{"use strict";e.exports=require("mongoose")},56364:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,X:()=>a});var n=r(56037),i=r.n(n);let s=process.env.MONGODB_URI;if(!s)throw Error("Please define the MONGODB_URI environment variable inside .env");let o=global.mongoose;async function a(){if(o.conn)return o.conn;o.promise||(o.promise=i().connect(s,{serverSelectionTimeoutMS:3e4,socketTimeoutMS:3e4}).then(e=>e).catch(e=>{throw e}));try{o.conn=await o.promise}catch(e){throw o.promise=null,e}return o.conn}o||(o=global.mongoose={conn:null,promise:null});let u=a},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},95135:(e,t,r)=>{"use strict";r.d(t,{A:()=>o});var n=r(56037),i=r.n(n);let s=new(i()).Schema({userId:{type:String,required:!0},email:{type:String,required:!0},name:{type:String,required:!0},birthday:{type:Date,required:!0},birthTime:{type:String},primaryConcern:{type:String,enum:["感情","財運","工作","子女","人際關係","桃花","因緣"],required:!0},specificQuestion:{type:String,required:!0},conversationHistory:[{timestamp:{type:Date,default:Date.now},userMessage:String,assistantResponse:String,emotion:String,intent:String}],paymentStatus:{type:String,enum:["pending","paid","expired"],default:"pending"},paymentLink:String,paymentId:String,reportGenerated:{type:Boolean,default:!1},reportContent:{baziAnalysis:String,currentSituation:String,futureOutlook:String,specificAdvice:String,fengShuiSolutions:String,personalChanges:String,timingAdvice:String},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});s.pre("save",function(e){this.updatedAt=Date.now(),e()}),i().models.UserIntent&&delete i().models.UserIntent;let o=i().model("UserIntent",s)},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7719,580],()=>r(33934));module.exports=n})();