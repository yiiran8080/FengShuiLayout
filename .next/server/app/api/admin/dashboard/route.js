(()=>{var e={};e.id=7426,e.ids=[7426],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},56037:e=>{"use strict";e.exports=require("mongoose")},56364:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,X:()=>o});var n=r(56037),i=r.n(n);let a=process.env.MONGODB_URI;if(!a)throw Error("Please define the MONGODB_URI environment variable inside .env");let s=global.mongoose;async function o(){if(s.conn)return s.conn;s.promise||(s.promise=i().connect(a,{serverSelectionTimeoutMS:3e4,socketTimeoutMS:3e4}).then(e=>e).catch(e=>{throw e}));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}s||(s=global.mongoose={conn:null,promise:null});let u=o},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},70437:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>y,routeModule:()=>c,serverHooks:()=>g,workAsyncStorage:()=>l,workUnitAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{GET:()=>d});var i=r(96559),a=r(48088),s=r(37719),o=r(32190),u=r(56364),p=r(95135);async function d(){try{await (0,u.X)();let e=await p.A.countDocuments(),t=await p.A.countDocuments({paymentCompleted:!0}),r=await p.A.countDocuments({paymentCompleted:!0,reportGenerated:!0}),n=e>0?Math.round(t/e*100):0,i=await p.A.distinct("userEmail"),a=await p.A.find().sort({createdAt:-1}).limit(20).select({userEmail:1,primaryConcern:1,specificQuestion:1,paymentCompleted:1,reportGenerated:1,createdAt:1});return o.NextResponse.json({success:!0,stats:{totalUsers:i.length,totalReports:r,totalRevenue:299*t,conversionRate:n},recentIntents:a})}catch(e){return console.error("獲取儀表板數據失敗:",e),o.NextResponse.json({error:"獲取數據失敗"},{status:500})}}let c=new i.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/admin/dashboard/route",pathname:"/api/admin/dashboard",filename:"route",bundlePath:"app/api/admin/dashboard/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/admin/dashboard/route.js",nextConfigOutput:"",userland:n}),{workAsyncStorage:l,workUnitAsyncStorage:m,serverHooks:g}=c;function y(){return(0,s.patchFetch)({workAsyncStorage:l,workUnitAsyncStorage:m})}},78335:()=>{},95135:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(56037),i=r.n(n);let a=new(i()).Schema({userId:{type:String,required:!0},email:{type:String,required:!0},name:{type:String,required:!0},birthday:{type:Date,required:!0},birthTime:{type:String},primaryConcern:{type:String,enum:["感情","財運","工作","子女","人際關係","桃花","因緣"],required:!0},specificQuestion:{type:String,required:!0},conversationHistory:[{timestamp:{type:Date,default:Date.now},userMessage:String,assistantResponse:String,emotion:String,intent:String}],paymentStatus:{type:String,enum:["pending","paid","expired"],default:"pending"},paymentLink:String,paymentId:String,reportGenerated:{type:Boolean,default:!1},reportContent:{baziAnalysis:String,currentSituation:String,futureOutlook:String,specificAdvice:String,fengShuiSolutions:String,personalChanges:String,timingAdvice:String},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});a.pre("save",function(e){this.updatedAt=Date.now(),e()}),i().models.UserIntent&&delete i().models.UserIntent;let s=i().model("UserIntent",a)},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7719,580],()=>r(70437));module.exports=n})();