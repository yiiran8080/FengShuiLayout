(()=>{var e={};e.id=1536,e.ids=[1536],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},28354:e=>{"use strict";e.exports=require("util")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},47528:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>C,routeModule:()=>d,serverHooks:()=>_,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>m});var s={};t.r(s),t.d(s,{POST:()=>l});var o=t(96559),n=t(48088),c=t(37719),u=t(32190),i=t(97877),a=t(98870);let p=new i.A(process.env.STRIPE_SECRET_KEY);async function l(e){try{let{concern:r,fromChat:t,specificProblem:s,locale:o}=await e.json();if(!r)return u.NextResponse.json({error:"Concern type is required"},{status:400});let n=(0,a.y3)(e),c=o||n,i=e.headers.get("referer")||"",l=e.headers.get("origin")||"",d=e.url||"";"zh-TW"===c&&(i.includes("/zh-CN")||l.includes("/zh-CN")||d.includes("/zh-CN"))&&(c="zh-CN",console.log("\uD83D\uDD04 Fortune payment - Overriding locale from URL context: zh-CN"));let h=c;console.log(`ðŸŒ Fortune payment - Detected locale: ${h}`),console.log(`ðŸ” Fortune payment - Request body locale: ${o}`),console.log(`ðŸ” Fortune payment - Headers locale: ${n}`),console.log(`ðŸ” Fortune payment - Referer URL: ${i}`);let m=(0,a._j)(h,"fortune");console.log(`ðŸ’° Fortune payment - Using price ID: ${m} for fortune ${h}`);let _=process.env.NEXTAUTH_URL,C=`${_}/${h}/success?session_id={CHECKOUT_SESSION_ID}&type=fortune&concern=${r}`;t&&s&&(C+=`&specificProblem=${encodeURIComponent(s)}&fromChat=true`);let y=await p.checkout.sessions.create({payment_method_types:["card","wechat_pay","alipay"],payment_method_options:{wechat_pay:{client:"web"}},line_items:[{price:m,quantity:1}],mode:"payment",success_url:C,cancel_url:`${_}/${h}/price`,locale:"zh-CN"===h?"zh":"zh-TW",custom_text:{submit:{message:"zh-CN"===h?"å®Œæˆä»˜æ¬¾åŽï¼Œæ‚¨å°†æ”¶åˆ°ä¸“å±žçš„è¿åŠ¿åˆ†æžæŠ¥å‘Š":"å®Œæˆä»˜æ¬¾å¾Œï¼Œæ‚¨å°‡æ”¶åˆ°å°ˆå±¬çš„é‹å‹¢åˆ†æžå ±å‘Š"}},metadata:{type:"fortune",concern:r,locale:h,...t&&s&&{specificProblem:s,fromChat:"true"}}});return u.NextResponse.json({sessionId:y.id})}catch(e){return console.error("Stripe error:",e),u.NextResponse.json({error:"Error creating checkout session"},{status:500})}}let d=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/payment-fortune/route",pathname:"/api/payment-fortune",filename:"route",bundlePath:"app/api/payment-fortune/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/payment-fortune/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:m,serverHooks:_}=d;function C(){return(0,c.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:m})}},55511:e=>{"use strict";e.exports=require("crypto")},55591:e=>{"use strict";e.exports=require("https")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},79646:e=>{"use strict";e.exports=require("child_process")},81630:e=>{"use strict";e.exports=require("http")},94735:e=>{"use strict";e.exports=require("events")},96487:()=>{},98870:(e,r,t)=>{"use strict";function s(e,r){let t="zh-CN"===e?"CNY":"HKD",s={CNY:{fengshui:process.env.PRICE_ID2_CNY,life:process.env.PRICE_ID4_CNY,fortune:process.env.PRICE_ID5_CNY,couple:process.env.PRICE_ID6_CNY},HKD:{fengshui:process.env.PRICE_ID2_HKD,life:process.env.PRICE_ID4_HKD,fortune:process.env.PRICE_ID5_HKD,couple:process.env.PRICE_ID6_HKD}},o=s[t]?.[r];return o?(console.log(`âœ… Selected price ID: ${o} for ${t} ${r}`),o):(console.error(`âŒ No price ID found for currency: ${t}, paymentType: ${r}`),s.HKD[r]||process.env.PRICE_ID2_HKD)}function o(e){let r=new URL(e.url).pathname.split("/");return"zh-CN"===r[1]?"zh-CN":"zh-TW"===r[1]?"zh-TW":(e.headers.get("accept-language")||"").includes("zh-CN")||(e.headers.get("referer")||"").includes("/zh-CN/")?"zh-CN":"zh-TW"}t.d(r,{_j:()=>s,y3:()=>o})}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7719,580,7877],()=>t(47528));module.exports=s})();