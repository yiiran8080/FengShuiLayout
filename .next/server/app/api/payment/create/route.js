(()=>{var e={};e.id=3775,e.ids=[3775],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},4573:e=>{"use strict";e.exports=require("node:buffer")},6745:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(56037),a=r.n(n);let i=new(a()).Schema({userId:{type:String,required:!0,unique:!0},password:{type:String,required:!1},provider:{type:String,default:"credentials",required:!1},name:{type:String,required:!1},gender:{type:String,enum:["female","male"],required:!0,default:"female"},birthDateTime:{type:Date,required:!0,default:new Date(1996,2,12,22)},email:{type:String,required:!1},isLock:{type:Boolean,required:!0,default:!0},genStatus:{type:String,enum:["none","waiting","done"],required:!1},emailVerified:{type:Boolean,default:!1},verificationToken:{type:String,required:!1},freeReportStats:{totalGenerated:{type:Number,default:0},lastGeneratedAt:{type:Date,default:null},firstGeneratedAt:{type:Date,default:null},favoriteRoomType:{type:String,default:null},favoriteDirection:{type:String,default:null}},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});i.virtual("freeReportActivities",{ref:"FreeReportActivity",localField:"userId",foreignField:"userId"}),i.virtual("projects",{ref:"Project",localField:"userId",foreignField:"owner"}),i.set("toJSON",{virtuals:!0}),i.set("toObject",{virtuals:!0}),a().models.User&&delete a().models.User,a().modelSchemas&&a().modelSchemas.User&&delete a().modelSchemas.User;let s=a().model("User",i)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},14807:(e,t,r)=>{"use strict";r.d(t,{j2:()=>h,Y9:()=>d});var n=r(30091),a=r(56056),i=r(18068),s=r(10189),o=r(56364),u=r(6745);async function l(e,t){try{await (0,o.A)();let r=await u.A.findOne({userId:e});if(!r){let r=new u.A({userId:e,email:t,gender:"female",birthDateTime:new Date(1996,2,12,22),isLock:!0,genStatus:"none"});return await r.save(),r}return r}catch(e){throw e}}var c=r(49316);let{handlers:d,signIn:g,signOut:p,auth:h}=(0,n.Ay)({trustHost:!0,providers:[(0,a.A)({clientId:process.env.GOOGLE_CLIENT_ID,clientSecret:process.env.GOOGLE_CLIENT_SECRET}),(0,i.A)({clientId:process.env.APPLE_ID,clientSecret:process.env.APPLE_CLIENT_SECRET}),(0,s.A)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.email||!e?.password)return null;try{await (0,o.A)();let t=await u.A.findOne({$or:[{email:e.email},{userId:e.email}],provider:"credentials"});if(!t||!t.password||!await (0,c.BE)(e.password,t.password))return null;return{id:t._id.toString(),email:t.email,name:t.name,userId:t.userId}}catch(e){return console.error("Authentication error:",e),null}}})],secret:process.env.NEXTAUTH_SECRET,callbacks:{async signIn({user:e,account:t,profile:r}){try{let r=e.email;if(!r)return!1;return(t?.provider==="google"||t?.provider==="apple")&&await l(r,e.email),!0}catch(e){return console.error("Error in signIn callback:",e),!1}},jwt:async({token:e,user:t,account:r})=>(r&&t&&(e.accessToken=r.access_token,e.id=t.id,e.userId=t.userId||t.email),e),session:async({session:e,token:t})=>(t&&e.user&&(e.user={...e.user,id:t.sub,userId:t.userId||e.user.email}),e)},pages:{signIn:"/auth/login"}})},19121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},34089:(e,t,r)=>{"use strict";r.d(t,{h:()=>n}),e=r.hmd(e);class n{static{this.tianGan=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"]}static{this.diZhi=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"]}static{this.wuXing={甲:"木",乙:"木",丙:"火",丁:"火",戊:"土",己:"土",庚:"金",辛:"金",壬:"水",癸:"水",子:"水",丑:"土",寅:"木",卯:"木",辰:"土",巳:"火",午:"火",未:"土",申:"金",酉:"金",戌:"土",亥:"水"}}static getYearPillar(e){let t=(e-4)%10;return{tianGan:this.tianGan[t],diZhi:this.diZhi[(e-4)%12],element:this.wuXing[this.tianGan[t]]}}static getDayPillar(e){let t=new Date("1900-01-01"),r=Math.floor((new Date(e)-t)/864e5),n=r%10;return{tianGan:this.tianGan[n],diZhi:this.diZhi[r%12],element:this.wuXing[this.tianGan[n]]}}static analyzeElementStrength(e,t){let r=new Date().getMonth()+1,n="";return n=r>=3&&r<=5?"春季":r>=6&&r<=8?"夏季":r>=9&&r<=11?"秋季":"冬季",{description:({木:{strong:"春季出生，木旺",weak:"秋季出生，金克木"},火:{strong:"夏季出生，火旺",weak:"冬季出生，水克火"},土:{strong:"四季末出生，土旺",weak:"春季出生，木克土"},金:{strong:"秋季出生，金旺",weak:"夏季出生，火克金"},水:{strong:"冬季出生，水旺",weak:"夏季出生，土克水"}})[t]?.strong||"中等強度",season:n,advice:this.getElementAdvice(t)}}static getElementAdvice(e){return({木:"宜東方發展，忌金屬尖銳物品，多接觸綠色植物",火:"宜南方發展，忌水濕環境，多使用紅色物品",土:"宜中央或西南發展，穩重踏實，多使用黃色物品",金:"宜西方發展，忌火熱環境，多使用白色金屬物品",水:"宜北方發展，忌土燥環境，多使用黑色或藍色物品"})[e]||"根據個人情況調整"}static getPersonalityAnalysis(e){return({木:"性格正直，具有成長性和創造力，但有時過於理想化",火:"性格熱情，具有領導力和行動力，但有時過於急躁",土:"性格穩重，具有包容性和責任感，但有時過於保守",金:"性格堅毅，具有組織力和決斷力，但有時過於固執",水:"性格靈活，具有智慧和適應力，但有時過於多變"})[e]||"性格特質需要進一步分析"}}e.exports&&(e.exports={BaziCalculator:n})},37610:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>f,routeModule:()=>h,serverHooks:()=>S,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>y});var n={};r.r(n),r.d(n,{POST:()=>g,PUT:()=>p});var a=r(96559),i=r(48088),s=r(37719),o=r(32190),u=r(56364),l=r(95135),c=r(60938),d=r(14807);async function g(e){try{if(!await (0,d.j2)())return o.NextResponse.json({error:"Unauthorized"},{status:401});await (0,u.A)(),await e.json();let t=await l.A.findById(userIntentId);if(!t)return o.NextResponse.json({error:"找不到用戶記錄"},{status:404});let r=`pay_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;t.paymentId=r,t.paymentStatus="pending",await t.save();let n=`/payment/process?paymentId=${r}&amount=${amount}`;return o.NextResponse.json({success:!0,paymentId:r,paymentUrl:n,message:"付款連結已生成"})}catch(e){return console.error("Payment creation error:",e),o.NextResponse.json({error:"付款處理失敗"},{status:500})}}async function p(e){try{let{paymentId:t,status:r}=await e.json();await (0,u.A)();let n=await l.A.findOne({paymentId:t});if(!n)return o.NextResponse.json({error:"找不到付款記錄"},{status:404});if("paid"===r){n.paymentStatus="paid",await n.save();try{console.log("開始生成報告...");let e=await c.E.generatePersonalizedReport(n);return n.reportContent=e,n.reportGenerated=!0,await n.save(),console.log("報告生成完成"),o.NextResponse.json({success:!0,message:"付款成功，報告已生成",reportReady:!0})}catch(e){return console.error("Report generation error:",e),o.NextResponse.json({success:!0,message:"付款成功，報告生成中，請稍後查看",reportReady:!1})}}else if("failed"===r)return n.paymentStatus="expired",await n.save(),o.NextResponse.json({success:!1,message:"付款失敗"});return o.NextResponse.json({success:!0})}catch(e){return console.error("Payment update error:",e),o.NextResponse.json({error:"付款狀態更新失敗"},{status:500})}}let h=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/payment/create/route",pathname:"/api/payment/create",filename:"route",bundlePath:"app/api/payment/create/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/payment/create/route.js",nextConfigOutput:"",userland:n}),{workAsyncStorage:m,workUnitAsyncStorage:y,serverHooks:S}=h;function f(){return(0,s.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:y})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49316:(e,t,r)=>{"use strict";r.d(t,{BE:()=>i,DT:()=>o,Er:()=>a,Oj:()=>s});var n=r(85663);async function a(e){return await n.Ay.hash(e,12)}async function i(e,t){return await n.Ay.compare(e,t)}function s(e){let t=/[a-zA-Z]/.test(e),r=/\d/.test(e);return{isValid:e.length>=8&&t&&r,message:e.length<8?"Password must be at least 8 characters long":t&&r?"":"Password must contain at least one letter and one number"}}function o(e){let t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return{isValid:t.test(e),message:t.test(e)?"":"Please enter a valid email address"}}},55511:e=>{"use strict";e.exports=require("crypto")},56037:e=>{"use strict";e.exports=require("mongoose")},56364:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,X:()=>o});var n=r(56037),a=r.n(n);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env");let s=global.mongoose;async function o(){if(s.conn)return s.conn;s.promise||(s.promise=a().connect(i,{serverSelectionTimeoutMS:3e4,socketTimeoutMS:3e4}).then(e=>e).catch(e=>{throw e}));try{s.conn=await s.promise}catch(e){throw s.promise=null,e}return s.conn}s||(s=global.mongoose={conn:null,promise:null});let u=o},57975:e=>{"use strict";e.exports=require("node:util")},60938:(e,t,r)=>{"use strict";r.d(t,{E:()=>n}),r(34089),e=r.hmd(e);class n{static async generatePersonalizedReport(e,t){let{primaryConcern:r,specificQuestion:n,birthday:a,birthTime:i,userId:s}=e;try{let e=await this.generateBaziAnalysis(a,i),t=await this.generateConcernAnalysis(r,e,n),s=await this.generateFengShuiSolutions(r,e),o=await this.generateTimingAdvice(r,e),u=await this.generatePersonalChangeAdvice(r,e);return{baziAnalysis:e,currentSituation:t.current,futureOutlook:t.future,specificAdvice:this.generateSpecificAdvice(n,r,e),fengShuiSolutions:s,personalChanges:u,timingAdvice:o}}catch(e){throw console.error("Report generation error:",e),Error("報告生成失敗")}}static async generateBaziAnalysis(e,t){let r=new Date(e),n=r.getFullYear(),a=r.getMonth()+1,i=r.getDate(),s=this.getYearElement(n),o=this.getDayElement(n,a,i),u=this.getPersonalityAnalysis(s,o),l=this.getBaseFortune(s,o);return{yearElement:s,dayElement:o,personality:u,baseFortune:l,hasTimeData:!!t,strengthAnalysis:this.getElementStrength(s,o,t)}}static async generateConcernAnalysis(e,t,r){let n={工作:{current:this.generateCareerCurrent(t),future:this.generateCareerFuture(t)},感情:{current:this.generateRelationshipCurrent(t),future:this.generateRelationshipFuture(t)},財運:{current:this.generateWealthCurrent(t),future:this.generateWealthFuture(t)},子女:{current:this.generateChildrenCurrent(t),future:this.generateChildrenFuture(t)},人際關係:{current:this.generateSocialCurrent(t),future:this.generateSocialFuture(t)},桃花:{current:this.generateLoveLuckCurrent(t),future:this.generateLoveLuckFuture(t)},因緣:{current:this.generateDestinyCurrent(t),future:this.generateDestinyFuture(t)}};return n[e]||n["工作"]}static generateCareerCurrent(e){let{yearElement:t,dayElement:r,strengthAnalysis:n}=e,a=`根據你嘅八字分析，你係${t}命人，`;return"金"===t?a+="具有堅毅果斷嘅性格，適合從事需要決策和領導嘅工作。目前你嘅事業運處於"+(n.strong?"上升期，":"調整期，")+(n.strong?"是展現能力和爭取晉升嘅好時機。":"需要耐心等待機會，現在重點係提升自己。"):"水"===t?a+="聰明靈活，善於溝通，適合創意和服務行業。目前你嘅事業運"+(n.strong?"流動性大，機會較多，":"相對平穩，")+(n.strong?"但要注意選擇最適合嘅方向。":"適合穩紮穩打地發展。"):"木"===t?a+="有創造力和成長性，適合新興行業和有發展空間嘅工作。目前"+(n.strong?"正值成長期，":"處於積累期，")+(n.strong?"可以大膽嘗試新嘅發展方向。":"需要更多學習和準備。"):"火"===t?a+="熱情積極，有領導魅力，適合面對人群嘅工作。目前你嘅事業運"+(n.strong?"正旺，":"需要控制，")+(n.strong?"是推動重要項目和計劃嘅最佳時期。":"避免衝動決定，要多聽取意見。"):"土"===t&&(a+="穩重可靠，適合需要責任心和耐性嘅工作。目前你嘅事業運"+(n.strong?"基礎紮實，":"需要更多耐性，")+(n.strong?"可以考慮長期投資和規劃。":"暫時避免大變動，專注現有工作。")),a}static generateCareerFuture(e){let{yearElement:t,strengthAnalysis:r}=e,n=new Date().getFullYear(),a="未來三年事業發展趨勢：\n\n";return[n+1,n+2,n+3].forEach((t,r)=>{let n=this.calculateYearLuck(t,e);a+=`${t}年：${n.career}
`}),a+=`
整體而言，作為${t}命人，你嘅事業發展重點係：
`,a+=this.getCareerAdviceByElement(t)}static generateFengShuiSolutions(e,t){let r={工作:this.getCareerFengShui(t),感情:this.getRelationshipFengShui(t),財運:this.getWealthFengShui(t),子女:this.getChildrenFengShui(t),人際關係:this.getSocialFengShui(t),桃花:this.getLoveLuckFengShui(t),因緣:this.getDestinyFengShui(t)};return r[e]||r["工作"]}static getCareerFengShui(e){let{yearElement:t}=e,r=`基於你嘅${t}命特質，工作風水建議：

`;return"金"===t?r+=`
**辦公桌風水：**
• 坐西朝東或坐東北朝西南（金命人嘅旺位）
• 桌上放置圓形金屬擺件（水晶球、金屬筆筒）
• 使用白色、金色文具和裝飾

**辦公室佈置：**
• 在右前方（白虎位）放一個小型金屬擺設
• 避免桌上有太多紅色物品（火克金）
• 可以放一盆白色花卉或多肉植物

**穿衣建議：**
• 多穿白色、米色、銀色嘅衣服
• 佩戴金屬飾品（手錶、項鍊）
• 避免全身紅色搭配`:"水"===t&&(r+=`
**辦公桌風水：**
• 坐北朝南（水命人嘅本命位）
• 桌上可放小型流水擺設或藍色擺件
• 多用藍色、黑色文具

**辦公室佈置：**
• 在北方位置放一杯清水（每日更換）
• 可以放一個小魚缸或水生植物
• 避免桌面雜亂，保持整潔流暢

**穿衣建議：**
• 多穿藍色、黑色、深色系衣服
• 可以佩戴珍珠或水晶飾品
• 避免全身土黃色（土克水）`),r}static generateTimingAdvice(e,t){let r=new Date().getFullYear(),n=new Date().getMonth()+1,a=`基於你嘅八字和當前時運，時機建議：

`;return"工作"===e?a+=this.getCareerTimingAdvice(t,r,n):"感情"===e?a+=this.getRelationshipTimingAdvice(t,r,n):"財運"===e&&(a+=this.getWealthTimingAdvice(t,r,n)),a}static getYearElement(e){return["金","金","水","水","木","木","火","火","土","土"][e%10]}static getDayElement(e,t,r){return["甲木","乙木","丙火","丁火","戊土","己土","庚金","辛金","壬水","癸水"][Math.floor((new Date(e,t-1,r)-new Date(1900,0,1))/864e5)%10]}static getPersonalityAnalysis(e,t){let r={金:"性格堅毅果斷，有領導能力，做事有條理，但有時過於固執。",水:"聰明靈活，適應力強，善於溝通，但有時容易猶豫不決。",木:"積極進取，有創造力，樂觀向上，但有時急躁缺乏耐性。",火:"熱情開朗，有魅力，行動力強，但有時衝動欠考慮。",土:"穩重踏實，有責任心，值得信賴，但有時過於保守。"};return r[e]||r["金"]}static getElementStrength(e,t,r){let n=Math.random()>.5;return{strong:n,hasTime:!!r,description:n?"五行氣勢較旺":"五行氣勢較弱"}}static calculateYearLuck(e,t){let r=this.getYearElement(e),n={金水:"生助",水木:"生助",木火:"生助",火土:"生助",土金:"生助",金木:"克制",木土:"克制",土水:"克制",水火:"克制",火金:"克制"}[t.yearElement+r]||"平和";return"生助"===n?{career:"事業運勢上升，適合積極發展"}:"克制"===n?{career:"事業運勢有挑戰，宜保守發展"}:{career:"事業運勢平穩，可穩步推進"}}static getCareerAdviceByElement(e){let t={金:"發揮領導才能，勇於承擔責任，適合管理和決策性工作。",水:"靈活運用溝通技巧，善用人脈關係，適合服務和創意性工作。",木:"把握成長機會，勇於創新嘗試，適合新興和發展性工作。",火:"發揮熱情和魅力，積極推動計劃，適合銷售和表演性工作。",土:"發揮穩重特質，建立長期規劃，適合財務和技術性工作。"};return t[e]||t["金"]}static getCareerTimingAdvice(e,t,r){let{yearElement:n}=e,a=`**${t}年工作時機分析：**

`;return a+=`作為${n}命人，`,r>=3&&r<=5&&(a+="春季（3-5月）是你嘅發展期，適合：\n",a+="• 提出新嘅工作計劃和想法\n",a+="• 尋求升職或轉崗機會\n",a+="• 建立新嘅工作關係\n\n"),a+="**最佳行動時機：**\n",a+=this.getBestActionTiming(e,t)}static getBestActionTiming(e,t){let{yearElement:r}=e;return`根據你嘅${r}命特質，最佳行動時機係${({金:"秋季（7-9月）和冬季初期（10-11月）",水:"冬季（12-2月）和春季初期（3-4月）",木:"春季（3-5月）和夏季初期（6月）",火:"夏季（6-8月）和秋季初期（9月）",土:"四季轉換期（3月、6月、9月、12月）"})[r]}。`}static generateSpecificAdvice(e,t,r){let n=`**針對你嘅具體問題：「${e}」**

`;return"工作"===t&&(e.includes("轉工")||e.includes("換工作")?n+=this.getJobChangeAdvice(r):e.includes("創業")||e.includes("做生意")?n+=this.getBusinessAdvice(r):e.includes("升職")||e.includes("加薪")?n+=this.getPromotionAdvice(r):n+=this.getGeneralCareerAdvice(r)),n}static getJobChangeAdvice(e){let{yearElement:t,strengthAnalysis:r}=e,n="**轉工建議：**\n\n";return r.strong?(n+=`作為${t}命人，你現在嘅運勢較旺，係轉工嘅好時機。建議：

`,n+="• 可以積極尋找更好嘅機會\n",n+="• 選擇有發展前景嘅公司和職位\n",n+="• 談薪時可以稍微進取啲\n",n+="• 最好喺春夏季轉工（生氣較旺）\n\n"):(n+=`你而家嘅運勢處於調整期，轉工要更謹慎。建議：

`,n+="• 除非現職有重大問題，否則建議觀望\n",n+="• 如果一定要轉，選擇穩定性高嘅公司\n",n+="• 薪酬要求唔好過高，重點係學習機會\n",n+="• 最好等到下半年運勢好轉時再行動\n\n"),n+=`**適合${t}命人嘅行業：**
`,n+=this.getSuitableIndustries(e.yearElement)}static getSuitableIndustries(e){let t={金:"• 金融投資、銀行保險\n• 機械製造、汽車工業\n• 珠寶首飾、精密儀器\n• 法律諮詢、會計審計",水:"• 貿易物流、國際業務\n• 傳媒廣告、創意設計\n• 旅遊酒店、餐飲服務\n• 清潔環保、水產漁業",木:"• 教育培訓、文化出版\n• 醫療保健、生技製藥\n• 農林園藝、環保能源\n• 服裝紡織、家具建材",火:"• 電子科技、通訊網絡\n• 娛樂傳媒、表演藝術\n• 餐飲烹飪、化工能源\n• 銷售行銷、公關活動",土:"• 房地產、建築工程\n• 農業畜牧、礦業開採\n• 倉儲物流、製造業\n• 政府機關、社會服務"};return t[e]||t["金"]}}e.exports&&(e.exports={ReportGenerator:n})},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},77598:e=>{"use strict";e.exports=require("node:crypto")},78335:()=>{},95135:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var n=r(56037),a=r.n(n);let i=new(a()).Schema({userId:{type:String,required:!0},email:{type:String,required:!0},name:{type:String,required:!0},birthday:{type:Date,required:!0},birthTime:{type:String},primaryConcern:{type:String,enum:["感情","財運","工作","子女","人際關係","桃花","因緣"],required:!0},specificQuestion:{type:String,required:!0},conversationHistory:[{timestamp:{type:Date,default:Date.now},userMessage:String,assistantResponse:String,emotion:String,intent:String}],paymentStatus:{type:String,enum:["pending","paid","expired"],default:"pending"},paymentLink:String,paymentId:String,reportGenerated:{type:Boolean,default:!1},reportContent:{baziAnalysis:String,currentSituation:String,futureOutlook:String,specificAdvice:String,fengShuiSolutions:String,personalChanges:String,timingAdvice:String},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});i.pre("save",function(e){this.updatedAt=Date.now(),e()}),a().models.UserIntent&&delete a().models.UserIntent;let s=a().model("UserIntent",i)},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[7719,580,7380,9916,5663,2395],()=>r(37610));module.exports=n})();