(()=>{var e={};e.id=3907,e.ids=[3907],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},31700:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>f,routeModule:()=>h,serverHooks:()=>m,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>y});var n={};t.r(n),t.d(n,{POST:()=>d});var a=t(96559),s=t(48088),i=t(37719),o=t(32190);let l=process.env.DEEPSEEK_API_KEY,p=(e,r,t="未知")=>e&&e[r]||t,c=e=>e&&Array.isArray(e)?{year:e[0]||{heavenly:"甲",earthly:"子"},month:e[1]||{heavenly:"乙",earthly:"丑"},day:e[2]||{heavenly:"丙",earthly:"寅"},hour:e[3]||{heavenly:"丁",earthly:"卯"}}:{year:{heavenly:"甲",earthly:"子"},month:{heavenly:"乙",earthly:"丑"},day:{heavenly:"丙",earthly:"寅"},hour:{heavenly:"丁",earthly:"卯"}},u=e=>{console.log("\uD83D\uDCCB Parsing feng shui transformation response:",e);try{let r=e.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim().match(/\{[\s\S]*\}/);if(r)try{let e=JSON.parse(r[0]);if(e.transformations&&Array.isArray(e.transformations)){let r=e.transformations.filter(e=>e.title&&e.steps&&Array.isArray(e.steps)&&e.principle);if(r.length>0)return console.log("✅ Successfully parsed JSON response"),{transformations:r.map(e=>({...e,gradient:e.gradient||"linear-gradient(135deg, #C74772 0%, #D09900 100%)"})),actionPrinciple:e.actionPrinciple||"風水轉化的核心是順應五行生剋，針對具體問題進行環境調整。"}}}catch(e){console.log("❌ JSON parsing failed, falling back to text parsing:",e.message)}let t=[],n=e.split("\n").filter(e=>e.trim()),a=null,s=[],i="";for(let e of n){let r=e.trim();if(!(!r||r.includes("```")||r.startsWith("#"))){if(r.includes("✦")&&!r.includes("步驟")&&!r.includes("原理")){a&&t.push({title:a,steps:[...s],principle:i,gradient:"linear-gradient(135deg, #C74772 0%, #D09900 100%)"}),a=r.replace(/[✦*\-]/g,"").trim(),s=[],i="";continue}if(r.includes("步驟")||r.includes("行動")||/^\d+[\.)]\s*/.test(r)){let e=r.replace(/^\d+[\.)]\s*/,"").replace(/步驟[:：]/g,"").replace(/行動[:：]/g,"").trim();e&&!e.includes("原理")&&s.push(e);continue}if(r.includes("原理")||r.includes("八字")||r.includes("五行")){i=r.replace(/原理[:：]/g,"").replace(/解釋[:：]/g,"").trim();continue}a&&r.length>10&&(!i&&(r.includes("相生")||r.includes("化解")||r.includes("平衡"))?i=r:s.length<4&&s.push(r))}}a&&t.push({title:a,steps:[...s],principle:i,gradient:"linear-gradient(135deg, #C74772 0%, #D09900 100%)"});let o="風水轉化的核心是順應五行生剋，針對具體問題進行環境調整。通過精準的方位佈局與元素配置，可以在短時間內平衡氣場，改善感情能量流動。",l=e.match(/轉化原理[:：]?\s*([^]*?)(?=\n\n|\n$|$)/i);l&&(o=l[1].trim());let p={transformations:t.length>0?t:[{title:"能量場調和法",steps:["在臥室東南角放置綠色植物，激活木氣","配合暖黃色檯燈，形成木火相生","每日晚間共同在此區域靜心5分鐘"],principle:"根據八字配置，用木火相生平衡過旺的金水元素，創造和諧感情氛圍",gradient:"linear-gradient(135deg, #C74772 0%, #D09900 100%)"}],actionPrinciple:o};return console.log("\uD83D\uDCCA Final parsed feng shui transformation result:",p),p}catch(e){return console.error("❌ Error parsing feng shui transformation response:",e),{transformations:[{title:"基礎能量平衡法",steps:["在住所中心放置五行水晶陣","每日點燃檀香淨化空間","配合輕音樂創造和諧氛圍"],principle:"五行平衡是風水的基礎，通過能量調和改善感情關係",gradient:"linear-gradient(135deg, #C74772 0%, #D09900 100%)"}],actionPrinciple:"風水轉化注重實用性與速效性，針對個人八字特質進行環境調整，達到氣場平衡的效果。"}}};async function d(e){try{let r=await e.json();console.log("\uD83D\uDD25 Feng Shui Transformation API - Received request:",r);let{femaleUser:t,maleUser:n,femaleBazi:a,maleBazi:s,femalePillars:i,malePillars:d}=r;if(!t||!n)return o.NextResponse.json({error:"Missing user data"},{status:400});let h=p(a,"name","female"),g=p(s,"name","male"),y=c(i),m=c(d);console.log("\uD83D\uDCCA BaZi Data:",{femaleBaziInfo:h,maleBaziInfo:g,femalePillarsInfo:y,malePillarsInfo:m});let f=`你是專業的風水命理師，請為這對情侶設計具體的風水轉化方案。

**情侶資料：**
女方：${t.name}
- 天干地支：年柱 ${y.year.heavenly}${y.year.earthly}、月柱 ${y.month.heavenly}${y.month.earthly}、日柱 ${y.day.heavenly}${y.day.earthly}、時柱 ${y.hour.heavenly}${y.hour.earthly}

男方：${n.name}  
- 天干地支：年柱 ${m.year.heavenly}${m.year.earthly}、月柱 ${m.month.heavenly}${m.month.earthly}、日柱 ${m.day.heavenly}${m.day.earthly}、時柱 ${m.hour.heavenly}${m.hour.earthly}

請以JSON格式回應，包含3-4個風水轉化方案：

{
  "transformations": [
    {
      "title": "方案一：臥室桃花位佈局",
      "steps": [
        "在臥室西南方（流年桃花位）放置雙數粉色水晶或鮮花",
        "床頭櫃成對擺放圓形燈具，每晚點亮2小時",
        "懸掛雙鳥圖案畫作（需成對出現，如鴛鴦、喜鵲）"
      ],
      "principle": "本方案以「火土相生」為主軸（粉晶/紅花/檀香屬火，陶瓷/五帝錢屬土），透過空間五行連環相生（火→土→金→水→木），針對情侶常見的「金木交戰」（爭執）與「水火未濟」（情緒起伏）設計速效調和點。",
      "gradient": "linear-gradient(135deg, #C74772 0%, #D09900 100%)"
    }
  ],
  "actionPrinciple": "整體轉化原理說明"
}

**重要要求：**
- 每個方案的title要有「方案一：」、「方案二：」等編號
- steps陣列必須包含3個具體可執行的步驟
- principle要解釋五行原理和速效性
- 不要在steps中包含「**行動步驟**」這種標題文字，直接寫具體步驟
- 所有內容要根據他們的八字配置個性化設計

請分析他們的八字五行特點，設計針對性的風水調整方案。`;console.log("\uD83D\uDCE4 Sending prompt to DeepSeek:",f);let v=await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:"你是專業的風水命理師，擅長將八字分析與風水佈局結合，提供實用的居家風水建議。"},{role:"user",content:f}],max_tokens:2e3,temperature:.7})});if(!v.ok)throw console.error("❌ DeepSeek API error:",v.status,v.statusText),Error(`DeepSeek API error: ${v.status}`);let x=await v.json();console.log("✅ DeepSeek API response:",x);let $=x.choices?.[0]?.message?.content||"";console.log("\uD83E\uDD16 AI Response:",$);let P=u($);return console.log("\uD83D\uDCCB Parsed feng shui transformation result:",P),o.NextResponse.json(P)}catch(e){return console.error("❌ Feng Shui Transformation API error:",e),o.NextResponse.json({transformations:[{title:"東南木氣激活陣",steps:["在臥室東南角放置綠色植物（如富貴竹或綠蘿）","搭配暖黃色檯燈，每晚開燈2小時","週三木氣旺日進行植物澆水儀式"],principle:"木生火→火生土，針對八字中金過旺的問題，用木氣調和，激活感情溫暖能量",gradient:"linear-gradient(135deg, #C74772 0%, #D09900 100%)"},{title:"西南坤土穩固法",steps:["在客廳西南方位鋪設暖色地毯（紅褐或土黃色）","放置陶瓷花瓶配乾花，象徵土元素穩定","每日傍晚在此區域共同靜坐5分鐘"],principle:"坤土主婚姻，火生土相生循環，化解八字中水過旺的冷漠，建立感情穩固基礎",gradient:"linear-gradient(135deg, #C74772 0%, #D09900 100%)"},{title:"中宮太極平衡陣",steps:["在房屋中心位置放置五色水晶（白金、綠木、黑水、紅火、黃土）","每週日進行五行平衡淨化，順時針擺放調整","配合檀香或沉香薰香，提升整體氣場"],principle:"中宮統領八方，五行俱全達到陰陽平衡，解決八字配置中的相沖問題",gradient:"linear-gradient(135deg, #C74772 0%, #D09900 100%)"}],actionPrinciple:"風水轉化的核心是順應五行生剋，針對八字的具體問題進行環境調整。通過精準的方位佈局與元素配置，可以在短時間內平衡氣場，改善感情能量流動。建議按照優先順序執行，先從最需要的元素開始調整，循序漸進達到整體和諧。"})}}let h=new a.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/feng-shui-transformation/route",pathname:"/api/feng-shui-transformation",filename:"route",bundlePath:"app/api/feng-shui-transformation/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/feng-shui-transformation/route.js",nextConfigOutput:"",userland:n}),{workAsyncStorage:g,workUnitAsyncStorage:y,serverHooks:m}=h;function f(){return(0,i.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:y})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),n=r.X(0,[7719,580],()=>t(31700));module.exports=n})();