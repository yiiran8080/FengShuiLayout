(()=>{var e={};e.id=4279,e.ids=[4279],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},40885:(e,a,r)=>{"use strict";r.r(a),r.d(a,{patchFetch:()=>g,routeModule:()=>u,serverHooks:()=>y,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var t={};r.r(t),r.d(t,{POST:()=>h});var n=r(96559),o=r(48088),s=r(37719),i=r(32190),m=r(74241);async function h(e){try{let a;let{prompt:r,userInfo:t,wuxingData:n}=await e.json(),o=process.env.DEEPSEEK_API_KEY;if(!o)return console.warn("⚠️ DEEPSEEK_API_KEY not found, using mock data"),i.NextResponse.json({error:"API key not configured",analysis:c(t,n)});let s=await fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`,Accept:"application/json"},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:"你是一位專業的中醫師和命理師，擅長根據八字進行健康分析。請嚴格按照要求的JSON格式回應，不要添加任何額外的文字說明。"},{role:"user",content:r}],max_tokens:2048,temperature:.7})});if(!s.ok)return console.warn(`⚠️ DeepSeek API error: ${s.status}, using mock data`),i.NextResponse.json({error:`API error: ${s.status}`,analysis:c(t,n)});let m=await s.json(),h=m.choices[0]?.message?.content;if(!h)return console.warn("⚠️ No content from DeepSeek API, using mock data"),i.NextResponse.json({error:"No AI content received",analysis:c(t,n)});try{let e=h.replace(/```json\n?/g,"").replace(/```\n?/g,"").trim();a=JSON.parse(e)}catch(e){console.warn("⚠️ Failed to parse AI response, using mock data:",e.message),a=c(t,n)}return i.NextResponse.json({analysis:a,isAIGenerated:!0})}catch(e){return console.error("Health fortune analysis API error:",e),i.NextResponse.json({error:"Analysis failed",analysis:c(userInfo,wuxingData)})}}function c(e,a){let r=new Date(e.birthDateTime),t=new Date().getFullYear();r.getFullYear();let n=a.dayStem||"癸",o=a.dayStemWuxing||"水",s="male"===e.gender?"男":"女",i=e?.birthDateTime?(0,m.Nc)(e.birthDateTime,e.gender):null,h=i?.periods||[],c=h.find(e=>"future"===e.status)||h[2];return{summary:{title:`${o}${n}交戰，養腎固本為要`,description:`日主${n}${o}坐${a.dayBranch||"丑"}土七殺，生於${a.monthBranch||"巳"}月火旺之時，時柱${a.hourStem||"壬"}${a.hourBranch||"子"}劫財助身。月支${a.monthBranch||"巳"}火生旺己土七殺，形成「火生土→土剋${o}」的攻身格局，健康需重點調和${o}土矛盾。`},systems:{腎骨系統核心:{title:"腎骨系統核心",content:{description:`${n}${o}通腎，日支${a.dayBranch||"丑"}土為濕土晦火存${o}，雖有調和作用，但月柱己巳火土熾烈。`,advantages:`時柱${a.hourStem||"壬"}${a.hourBranch||"子"}強根護持，骨骼密度佳，傷口癒合能力強`,risks:[{period:`${s}性青年期 (20 - 35歲)`,description:`火土運旺易耗${"水"===o?"腎陰":"肝血"}，可能出現${"女"===s?"經期不準、":""}腰肌勞損`},{period:`${c?.yearRange||"2040年後"}${c?.dayun||"丙寅"}運`,description:`${c?.dayun?.[1]||"寅"}巳申三刑，需防關節退行性病變`}],keyYears:`${t+2}年丙午（火極）、${t+14}年戊午（三合火局）避免高溫曝曬`}},代謝循環特質:{title:"代謝循環特質",content:{description:`${a.monthBranch||"巳"}火當令透己土，火土旺而${o}受制：`,bloodCharacteristics:`血粘稠度易偏高（火煉金→金生${o}不足），${t+7}年後需定期檢測血脂`,digestiveFeatures:`${a.dayBranch||"丑"}土為濕土，常現脾胃濕熱（食慾好但消化滯緩），忌冰飲加重濕氣`,skinConcerns:`己土七殺主皮膚屏障弱，換季易發蕁麻疹（${t}年${a.dayBranch||"辰"}${a.dayBranch||"丑"}破尤甚）`}},神經免疫平衡:{title:"神經免疫平衡",content:{description:`月令${a.monthBranch||"巳"}火主心神，七殺攻身易心緒不寧：`,mentalState:`${a.yearStem}${a.yearBranch}劫財奪${o}，思慮過度，夜間易失眠（尤其亥時23-1點）`,immuneSystem:`日坐七殺土燥${o}，免疫力呈週期性波動，秋冬（申酉月）抵抗力較弱`,seasonalCare:`春天（寅卯月）肝${o}同源，是調理最佳時機，建議針灸或艾灸。`}}},advice:{diet:`飲食宜${"水"===o?"黑色補腎":"綠色養肝"}：黑豆、海帶、紫菜（補${o}制火）；忌辛辣上火食品，每餐後散步15分鐘助消化。`,exercise:`游泳最合適（一周2-3次，每次30-45分鐘），補${o}又降火，增強體力；中午11點到1點別劇烈運動，免得傷心氣。`,lifeStageReminder:`${h[1]?.startYear||t+5}年開始走${h[1]?.dayun||"丙寅"}運，春天（3-5月）要做肝膽排毒（像喝蒲公英茶或找專業調理），幫肝臟順氣，順應節氣變化。`}}}let u=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/health-fortune-analysis/route",pathname:"/api/health-fortune-analysis",filename:"route",bundlePath:"app/api/health-fortune-analysis/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/health-fortune-analysis/route.js",nextConfigOutput:"",userland:t}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:y}=u;function g(){return(0,s.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74241:(e,a,r)=>{"use strict";r.d(a,{Nc:()=>s,Us:()=>i});var t=r(74474);function n(){return{currentDayun:"丙寅",currentAge:25,birthYear:2e3,periods:o()}}function o(){return[{dayun:"甲子",ageRange:"15-24歲",yearRange:"2015-2024",status:"past",startYear:2015,endYear:2024,startAge:15,endAge:24},{dayun:"丙寅",ageRange:"25-34歲",yearRange:"2025-2034",status:"current",startYear:2025,endYear:2034,startAge:25,endAge:34},{dayun:"丁卯",ageRange:"35-44歲",yearRange:"2035-2044",status:"future",startYear:2035,endYear:2044,startAge:35,endAge:44},{dayun:"壬戌",ageRange:"45-54歲",yearRange:"2045-2054",status:"future",startYear:2045,endYear:2054,startAge:45,endAge:54}]}function s(e,a,r=2025){let i=function(e,a,r=2025){if(!e||!a)return console.error("Birth date and gender are required for fortune period calculation"),n();try{let s=(0,t.Ay)(e,a);if(!s||!s.dayunGanzhi)return console.error("Unable to calculate wuxing data"),n();let i=new Date(e),m=i.getFullYear(),h=r-m,c=function(e,a){let r=e.getMonth()+1;return"male"===a?r%2==1?7:5:r%2==0?6:4}(i,a),u=function(e,a,r,t,n){let s=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],i=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],m=e[0],h=e[1],c=s.indexOf(m),u=i.indexOf(h);if(-1===c||-1===u)return console.error("Invalid dayun format:",e),o();let d=[],l=10*Math.floor((n-r)/10)+r;for(let e=-2;e<=3;e++){let r=l+10*e,n=a+r,o=n+9,m=(c+e+10)%10,h=(u+e+12)%12,y=s[m]+i[h],g="future";t>=n&&t<=o?g="current":t>o&&(g="past"),d.push({dayun:y,ageRange:`${r}-${r+9}歲`,yearRange:`${n}-${o}`,status:g,startYear:n,endYear:o,startAge:r,endAge:r+9})}return d.sort((e,a)=>e.startYear-a.startYear)}(s.dayunGanzhi,m,c,r,h);return{currentDayun:s.dayunGanzhi,currentAge:h,birthYear:m,periods:u}}catch(e){return console.error("Error calculating fortune periods:",e),n()}}(e,a,r),m=i.periods.filter(e=>"current"===e.status||"future"===e.status).slice(0,3);return{current:i.currentDayun,periods:m,birthYear:i.birthYear,currentAge:i.currentAge}}function i(e,a=!0){return a?`${e.dayun}運（${e.yearRange}）`:`${e.dayun}運`}},74474:(e,a,r)=>{"use strict";r.d(a,{Ay:()=>$});var t=r(44794),n=r(42457),o=r(81540),s=r(14250),i=r(96002),m=r.n(i),h=r(22246);s.A.extend(t.t).extend(n.sM).extend(o.z0);let c=(0,s.A)(m()().format("YYYY-MM-DD")).char8.year.toString(),{LYGanzhiMap:u,LYzhiMap:d,LYStarMap:l,LYSihuaMap:y,spouseStarMap:g,spouseSihuaMap:p}=function(){let e=m()().format("YYYY"),a={},r={},t={},n={},o={},s={};for(let i=1;i<=12;i++){let m=e+"-"+(i<10?"0"+i:""+i)+"-15",c=h.astro.bySolar(m,0,"男",!0,"zh-CN").horoscope(m);r[i]=c.monthly.earthlyBranch,a[i]=c.monthly.heavenlyStem+c.monthly.earthlyBranch,t[i]=c.palace("命宫","monthly").majorStars.map(e=>e.name).toString(),o[i]=c.palace("夫妻","monthly").majorStars.map(e=>e.name).toString(),n[i]=c.palace("命宫","monthly").mutagedPlaces().map(e=>e.name).toString(),s[i]=c.palace("夫妻","monthly").mutagedPlaces().map(e=>e.name).toString()}return{LYGanzhiMap:a,LYzhiMap:r,LYStarMap:t,LYSihuaMap:n,spouseStarMap:o,spouseSihuaMap:s}}();(function(){let e=m()().format("YYYY-MM-DD");(0,s.A)(e).char8.month.toString()})(),function(){let e=m()().format("YYYY-MM-DD");h.astro.bySolar(e,0,"男",!0,"zh-CN").horoscope(e,0).palace("夫妻","yearly").majorStars.map(e=>e.name).toString()}();let S={};function $(e,a){var r;let t=m()(e).format("YYYY-MM-DD HH:mm:ss");if(console.log("birthStr",t),S[t+"-"+a])return S[t+"-"+a];let n=Math.floor(m()(e).hour()/2),o=m()(e).format("YYYY-MM-DD"),i=h.astro.bySolar(o,n,"female"==a?"女":"男",!0,"zh-CN"),u=i.palace("命宫"),d=i.palace("身宫"),l=i.palace("迁移").majorStars.map(e=>e.name).toString(),y=i.horoscope(o,n),g=(0,s.A)(t),p=function(e,a,r,t,n,o,s,i){let m={金:0,木:0,水:0,火:0,土:0},h=[e,a,r,t,n,o,s,i];h.forEach(e=>{["金","木","水","火","土"].includes(e)&&m[e]++});let c=h.length;return`金:${(m.金/c*100).toFixed(2)}%，木:${(m.木/c*100).toFixed(2)}%，水:${(m.水/c*100).toFixed(2)}%，火:${(m.火/c*100).toFixed(2)}%，土:${(m.土/c*100).toFixed(2)}%`}(g.char8.year.stem.e5.name,g.char8.year.branch.e5.name,g.char8.month.stem.e5.name,g.char8.month.branch.e5.name,g.char8.day.stem.e5.name,g.char8.day.branch.e5.name,g.char8.hour.stem.e5.name,g.char8.hour.branch.e5.name),$=g.char8.day.branch.hiddenStems.map(e=>e.name).toString(),x=g.char8.year.branch.hiddenStems,Y=g.char8.month.branch.hiddenStems,b=g.char8.day.branch.hiddenStems,A=g.char8.hour.branch.hiddenStems,k=g.char8ex(+("female"!==a)),B=k.year,v=k.month,D=k.day,G=k.hour,j={nayin:g.char8.year.takeSound,wuxingJu:(r=g.char8.year.takeSoundE5.toString(),`${r}${f[r]}局`),year:g.char8.year.toString(),month:g.char8.month.toString(),day:g.char8.day.toString(),hour:g.char8.hour.toString(),wuxingScale:p,rizhiCanggan:$,mingPalace:`{主星：${u.majorStars.map(e=>e.name).toString()},主星亮度：${u.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${u.minorStars.map(e=>e.name).toString()}, 四化：${u.mutagedPlaces().map(e=>e.name).toString()}}`,bodyPalace:`{主星：${d.majorStars.map(e=>e.name).toString()},主星亮度：${d.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${d.minorStars.map(e=>e.name).toString()}, 四化：${d.mutagedPlaces().map(e=>e.name).toString()}}`,qianyiPalace:l,dayunGanzhi:y.decadal.heavenlyStem+y.decadal.earthlyBranch,liunianGanzhi:c,yearStemTenGod:B.stemTenGod.name,yearBranchTenGod:B.branchTenGod.map(e=>e.name).toString(),monthStemTenGod:v.stemTenGod.name,monthBranchTenGod:v.branchTenGod.map(e=>e.name).toString(),dayStemTenGod:D.stemTenGod.name,dayBranchTenGod:D.branchTenGod.map(e=>e.name).toString(),hourStemTenGod:G.stemTenGod.name,hourBranchTenGod:G.branchTenGod.map(e=>e.name).toString(),yearGods:B.gods.map(e=>e.name).toString(),monthGods:v.gods.map(e=>e.name).toString(),dayGods:D.gods.map(e=>e.name).toString(),yearStem:g.char8.year.stem.name,yearStemWuxing:g.char8.year.stem.e5.name,yearBranch:g.char8.year.branch.name,yearBranchWuxing:g.char8.year.branch.e5.name,monthStem:g.char8.month.stem.name,monthStemWuxing:g.char8.month.stem.e5.name,monthBranch:g.char8.month.branch.name,monthBranchWuxing:g.char8.month.branch.e5.name,dayStem:g.char8.day.stem.name,dayStemWuxing:g.char8.day.stem.e5.name,dayBranch:g.char8.day.branch.name,dayBranchWuxing:g.char8.day.branch.e5.name,hourStem:g.char8.hour.stem.name,hourStemWuxing:g.char8.hour.stem.e5.name,hourBranch:g.char8.hour.branch.name,hourBranchWuxing:g.char8.hour.branch.e5.name,yearNayin:g.char8.year.takeSound,monthNayin:g.char8.month.takeSound,dayNayin:g.char8.day.takeSound,hourNayin:g.char8.hour.takeSound,yearNayinWuxing:g.char8.year.takeSoundE5.toString(),monthNayinWuxing:g.char8.month.takeSoundE5.toString(),dayNayinWuxing:g.char8.day.takeSoundE5.toString(),hourNayinWuxing:g.char8.hour.takeSoundE5.toString(),yearBranchHiddenStems:x.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),monthBranchHiddenStems:Y.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),dayBranchHiddenStems:b.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),hourBranchHiddenStems:A.map(e=>({stem:e.name,element:e.e5.name,strength:e.value}))};return S[t+"-"+a]=j,console.log("result",j),j}let f={水:"二",木:"三",金:"四",土:"五",火:"六"}},78335:()=>{},96487:()=>{}};var a=require("../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[7719,580,6219],()=>r(40885));module.exports=t})();