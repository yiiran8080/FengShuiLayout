(()=>{var e={};e.id=416,e.ids=[416],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},71349:(e,a,r)=>{"use strict";r.r(a),r.d(a,{patchFetch:()=>y,routeModule:()=>h,serverHooks:()=>g,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var t={};r.r(t),r.d(t,{POST:()=>u});var n=r(96559),o=r(48088),s=r(37719),i=r(32190),c=r(74241);async function u(e){try{let{prompt:a,userInfo:r,wuxingData:t}=await e.json(),n=process.env.DEEPSEEK_API_KEY;if(!n)return console.warn("⚠️ DEEPSEEK_API_KEY not found, using mock data"),i.NextResponse.json({success:!0,analysis:m(r,t),isAIGenerated:!1});try{let e;let r=await fetch("https://api.deepseek.com/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:"你是一位專業的八字命理師，專精財運分析。請基於用戶的八字信息，提供準確、詳細的財運發展分析。"},{role:"user",content:a}],temperature:.7,max_tokens:2e3})});if(!r.ok){let e=await r.text();throw console.error("❌ DeepSeek API Error:",r.status,e),Error(`DeepSeek API error: ${r.status}`)}let t=await r.json(),o=t.choices[0]?.message?.content;if(!o)throw Error("No content in AI response");try{let a=o.match(/```json\n([\s\S]*?)\n```/)||o.match(/```\n([\s\S]*?)\n```/),r=a?a[1]:o;e=JSON.parse(r)}catch(e){throw console.warn("⚠️ Failed to parse AI JSON response, using mock data"),Error("Invalid JSON from AI")}if(!e.summary||!e.threeStages||!e.wealthRules)throw console.warn("⚠️ AI response missing required fields, using mock data"),Error("Invalid response structure");return console.log("✅ Successfully generated AI wealth analysis"),i.NextResponse.json({success:!0,analysis:e,isAIGenerated:!0})}catch(e){return console.warn("\uD83D\uDD04 AI API failed, falling back to mock data:",e.message),i.NextResponse.json({success:!0,analysis:m(r,t),isAIGenerated:!1,error:e.message})}}catch(e){return console.error("\uD83D\uDCA5 Wealth analysis API error:",e),i.NextResponse.json({success:!1,error:e.message},{status:500})}}function m(e,a){let r=new Date(e.birthDateTime);new Date().getFullYear(),r.getFullYear();let t=a.dayStem||"壬";a.dayStemWuxing;let n=e?.birthDateTime?(0,c.Nc)(e.birthDateTime,e.gender):null,o=n?.periods||[],s=o[0]||{dayun:"丙寅",yearRange:"2025-2034",ageRange:"25-34歲"},i=o[1]||{dayun:"丁卯",yearRange:"2035-2044",ageRange:"35-44歲"},u=o[2]||{dayun:"壬戌",yearRange:"2045-2054",ageRange:"45-54歲"};return{summary:{title:`劫財奪財，置業守成為上`,description:`月干${a.monthStem}土七殺透出，時柱${t}${a.dayBranch}劫財坐旺，全局無明財星，財富需通過制殺獲取（金製木→木疏土→土生金循環）。`},threeStages:{奠基期:{title:"奠基期",ageRange:s.ageRange,fortune:`${s.dayun}運`,content:{phase1:{name:(0,c.Us)(s),description:`${s.dayun[0]}火偏財虛透，${s.dayun[1]}木食神生財，主勞力得財`,keyYear:`${s.startYear+3}年：利考金融證照（證券/基金從業資格）`,trapYear:`致命陷阱：${s.startYear+6}年慎防P2P理財`},phase2:{name:`次階段（${s.startYear+5} - ${s.endYear}）`,description:`${s.dayun[0]}火正財合身，${s.dayun[1]}木傷官生財，收入躍升但開支激增`,warning:`${s.endYear-2}年：合作投資需謹慎`}}},爆發期:{title:"爆發期",ageRange:i.ageRange,fortune:`${i.dayun}運`,content:{description:`${i.dayun[0]}木傷官制殺，${i.dayun[1]}水祿神助身`,keyYear:`${i.startYear+5}年：不動產增值收益可觀`,industries:`核心領域：${"子"===i.dayun[1]?"水處理工程":"相關行業"}、法律服務`,peakYear:`財富峰值：${i.endYear-2}年，利資源貿易`}},守成期:{title:"守成期",ageRange:u.ageRange,fortune:`${u.dayun}運`,content:{description:`${u.dayun[1]}土制劫財開財庫，財運穩定`,keyYear:`${u.startYear+5}年：金水相生，可建立家族信託基金`,avoidIndustries:"忌諱產業：餐飲（火）、林業（木剋土）"}}},wealthRules:{assetAllocation:{title:"資產配比",realEstate:"70%不動產：投資房地產，確保穩健回報",preciousMetals:"20%貴金屬：購買黃金、銀條或相關ETF，作為抗通脹保值資產",cash:"10%流動現金：保留現金或貨幣基金，應對緊急需求或短期投資機會"},partnerships:{title:"合作禁忌",zodiacA:{animal:"生肖馬（午沖子）",description:"屬馬者五行屬火，與子鼠相沖，合作易生衝突，導致決策分歧或財務損失。"},zodiacB:{animal:"生肖兔（卯刑子）",description:"屬兔者五行屬木，與子鼠相刑，易引發信任危機或隱性競爭，影響財運。"}},wealthDirection:{title:"催財方位",location:"臥室西北角（戌位）",description:"西北角屬乾卦，主財運與貴人運。擺放白水晶簇，可聚財旺氣，增強正財運勢。",warning:"注意事項：西北角避免堆放雜物，保持通風明亮；忌擺放尖銳物品或電子產品，以免破壞財氣場。"}}}}let h=new n.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/wealth-fortune-analysis/route",pathname:"/api/wealth-fortune-analysis",filename:"route",bundlePath:"app/api/wealth-fortune-analysis/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/wealth-fortune-analysis/route.js",nextConfigOutput:"",userland:t}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:g}=h;function y(){return(0,s.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},74241:(e,a,r)=>{"use strict";r.d(a,{Nc:()=>s,Us:()=>i});var t=r(74474);function n(){return{currentDayun:"丙寅",currentAge:25,birthYear:2e3,periods:o()}}function o(){return[{dayun:"甲子",ageRange:"15-24歲",yearRange:"2015-2024",status:"past",startYear:2015,endYear:2024,startAge:15,endAge:24},{dayun:"丙寅",ageRange:"25-34歲",yearRange:"2025-2034",status:"current",startYear:2025,endYear:2034,startAge:25,endAge:34},{dayun:"丁卯",ageRange:"35-44歲",yearRange:"2035-2044",status:"future",startYear:2035,endYear:2044,startAge:35,endAge:44},{dayun:"壬戌",ageRange:"45-54歲",yearRange:"2045-2054",status:"future",startYear:2045,endYear:2054,startAge:45,endAge:54}]}function s(e,a,r=2025){let i=function(e,a,r=2025){if(!e||!a)return console.error("Birth date and gender are required for fortune period calculation"),n();try{let s=(0,t.Ay)(e,a);if(!s||!s.dayunGanzhi)return console.error("Unable to calculate wuxing data"),n();let i=new Date(e),c=i.getFullYear(),u=r-c,m=function(e,a){let r=e.getMonth()+1;return"male"===a?r%2==1?7:5:r%2==0?6:4}(i,a),h=function(e,a,r,t,n){let s=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],i=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],c=e[0],u=e[1],m=s.indexOf(c),h=i.indexOf(u);if(-1===m||-1===h)return console.error("Invalid dayun format:",e),o();let d=[],l=10*Math.floor((n-r)/10)+r;for(let e=-2;e<=3;e++){let r=l+10*e,n=a+r,o=n+9,c=(m+e+10)%10,u=(h+e+12)%12,g=s[c]+i[u],y="future";t>=n&&t<=o?y="current":t>o&&(y="past"),d.push({dayun:g,ageRange:`${r}-${r+9}歲`,yearRange:`${n}-${o}`,status:y,startYear:n,endYear:o,startAge:r,endAge:r+9})}return d.sort((e,a)=>e.startYear-a.startYear)}(s.dayunGanzhi,c,m,r,u);return{currentDayun:s.dayunGanzhi,currentAge:u,birthYear:c,periods:h}}catch(e){return console.error("Error calculating fortune periods:",e),n()}}(e,a,r),c=i.periods.filter(e=>"current"===e.status||"future"===e.status).slice(0,3);return{current:i.currentDayun,periods:c,birthYear:i.birthYear,currentAge:i.currentAge}}function i(e,a=!0){return a?`${e.dayun}運（${e.yearRange}）`:`${e.dayun}運`}},74474:(e,a,r)=>{"use strict";r.d(a,{Ay:()=>f});var t=r(44794),n=r(42457),o=r(81540),s=r(14250),i=r(96002),c=r.n(i),u=r(22246);s.A.extend(t.t).extend(n.sM).extend(o.z0);let m=(0,s.A)(c()().format("YYYY-MM-DD")).char8.year.toString(),{LYGanzhiMap:h,LYzhiMap:d,LYStarMap:l,LYSihuaMap:g,spouseStarMap:y,spouseSihuaMap:p}=function(){let e=c()().format("YYYY"),a={},r={},t={},n={},o={},s={};for(let i=1;i<=12;i++){let c=e+"-"+(i<10?"0"+i:""+i)+"-15",m=u.astro.bySolar(c,0,"男",!0,"zh-CN").horoscope(c);r[i]=m.monthly.earthlyBranch,a[i]=m.monthly.heavenlyStem+m.monthly.earthlyBranch,t[i]=m.palace("命宫","monthly").majorStars.map(e=>e.name).toString(),o[i]=m.palace("夫妻","monthly").majorStars.map(e=>e.name).toString(),n[i]=m.palace("命宫","monthly").mutagedPlaces().map(e=>e.name).toString(),s[i]=m.palace("夫妻","monthly").mutagedPlaces().map(e=>e.name).toString()}return{LYGanzhiMap:a,LYzhiMap:r,LYStarMap:t,LYSihuaMap:n,spouseStarMap:o,spouseSihuaMap:s}}();(function(){let e=c()().format("YYYY-MM-DD");(0,s.A)(e).char8.month.toString()})(),function(){let e=c()().format("YYYY-MM-DD");u.astro.bySolar(e,0,"男",!0,"zh-CN").horoscope(e,0).palace("夫妻","yearly").majorStars.map(e=>e.name).toString()}();let S={};function f(e,a){var r;let t=c()(e).format("YYYY-MM-DD HH:mm:ss");if(console.log("birthStr",t),S[t+"-"+a])return S[t+"-"+a];let n=Math.floor(c()(e).hour()/2),o=c()(e).format("YYYY-MM-DD"),i=u.astro.bySolar(o,n,"female"==a?"女":"男",!0,"zh-CN"),h=i.palace("命宫"),d=i.palace("身宫"),l=i.palace("迁移").majorStars.map(e=>e.name).toString(),g=i.horoscope(o,n),y=(0,s.A)(t),p=function(e,a,r,t,n,o,s,i){let c={金:0,木:0,水:0,火:0,土:0},u=[e,a,r,t,n,o,s,i];u.forEach(e=>{["金","木","水","火","土"].includes(e)&&c[e]++});let m=u.length;return`金:${(c.金/m*100).toFixed(2)}%，木:${(c.木/m*100).toFixed(2)}%，水:${(c.水/m*100).toFixed(2)}%，火:${(c.火/m*100).toFixed(2)}%，土:${(c.土/m*100).toFixed(2)}%`}(y.char8.year.stem.e5.name,y.char8.year.branch.e5.name,y.char8.month.stem.e5.name,y.char8.month.branch.e5.name,y.char8.day.stem.e5.name,y.char8.day.branch.e5.name,y.char8.hour.stem.e5.name,y.char8.hour.branch.e5.name),f=y.char8.day.branch.hiddenStems.map(e=>e.name).toString(),x=y.char8.year.branch.hiddenStems,$=y.char8.month.branch.hiddenStems,A=y.char8.day.branch.hiddenStems,b=y.char8.hour.branch.hiddenStems,k=y.char8ex(+("female"!==a)),w=k.year,R=k.month,G=k.day,v=k.hour,D={nayin:y.char8.year.takeSound,wuxingJu:(r=y.char8.year.takeSoundE5.toString(),`${r}${Y[r]}局`),year:y.char8.year.toString(),month:y.char8.month.toString(),day:y.char8.day.toString(),hour:y.char8.hour.toString(),wuxingScale:p,rizhiCanggan:f,mingPalace:`{主星：${h.majorStars.map(e=>e.name).toString()},主星亮度：${h.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${h.minorStars.map(e=>e.name).toString()}, 四化：${h.mutagedPlaces().map(e=>e.name).toString()}}`,bodyPalace:`{主星：${d.majorStars.map(e=>e.name).toString()},主星亮度：${d.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${d.minorStars.map(e=>e.name).toString()}, 四化：${d.mutagedPlaces().map(e=>e.name).toString()}}`,qianyiPalace:l,dayunGanzhi:g.decadal.heavenlyStem+g.decadal.earthlyBranch,liunianGanzhi:m,yearStemTenGod:w.stemTenGod.name,yearBranchTenGod:w.branchTenGod.map(e=>e.name).toString(),monthStemTenGod:R.stemTenGod.name,monthBranchTenGod:R.branchTenGod.map(e=>e.name).toString(),dayStemTenGod:G.stemTenGod.name,dayBranchTenGod:G.branchTenGod.map(e=>e.name).toString(),hourStemTenGod:v.stemTenGod.name,hourBranchTenGod:v.branchTenGod.map(e=>e.name).toString(),yearGods:w.gods.map(e=>e.name).toString(),monthGods:R.gods.map(e=>e.name).toString(),dayGods:G.gods.map(e=>e.name).toString(),yearStem:y.char8.year.stem.name,yearStemWuxing:y.char8.year.stem.e5.name,yearBranch:y.char8.year.branch.name,yearBranchWuxing:y.char8.year.branch.e5.name,monthStem:y.char8.month.stem.name,monthStemWuxing:y.char8.month.stem.e5.name,monthBranch:y.char8.month.branch.name,monthBranchWuxing:y.char8.month.branch.e5.name,dayStem:y.char8.day.stem.name,dayStemWuxing:y.char8.day.stem.e5.name,dayBranch:y.char8.day.branch.name,dayBranchWuxing:y.char8.day.branch.e5.name,hourStem:y.char8.hour.stem.name,hourStemWuxing:y.char8.hour.stem.e5.name,hourBranch:y.char8.hour.branch.name,hourBranchWuxing:y.char8.hour.branch.e5.name,yearNayin:y.char8.year.takeSound,monthNayin:y.char8.month.takeSound,dayNayin:y.char8.day.takeSound,hourNayin:y.char8.hour.takeSound,yearNayinWuxing:y.char8.year.takeSoundE5.toString(),monthNayinWuxing:y.char8.month.takeSoundE5.toString(),dayNayinWuxing:y.char8.day.takeSoundE5.toString(),hourNayinWuxing:y.char8.hour.takeSoundE5.toString(),yearBranchHiddenStems:x.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),monthBranchHiddenStems:$.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),dayBranchHiddenStems:A.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),hourBranchHiddenStems:b.map(e=>({stem:e.name,element:e.e5.name,strength:e.value}))};return S[t+"-"+a]=D,console.log("result",D),D}let Y={水:"二",木:"三",金:"四",土:"五",火:"六"}},78335:()=>{},96487:()=>{}};var a=require("../../../webpack-runtime.js");a.C(e);var r=e=>a(a.s=e),t=a.X(0,[7719,580,6219],()=>r(71349));module.exports=t})();