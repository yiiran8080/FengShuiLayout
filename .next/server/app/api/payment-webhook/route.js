(()=>{var e={};e.id=5992,e.ids=[5992],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},12518:e=>{"use strict";e.exports=require("mongodb")},23400:(e,r,t)=>{"use strict";t.r(r),t.d(r,{patchFetch:()=>g,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var s={};t.r(s),t.d(s,{POST:()=>u});var o=t(96559),n=t(48088),i=t(37719),a=t(12518);let p=process.env.MONGODB_URI;async function u(e){try{let{sessionId:r,userId:t,userEmail:s,status:o,reportType:n}=await e.json();if("completed"===o){let e=new a.MongoClient(p);await e.connect();let o=e.db("HarmoniqFengShui"),i=new a.ObjectId,u=`/couple-report?id=${i}`,c=await o.collection("SmartUserIntents").findOne({sessionId:r});if(!c)return await e.close(),Response.json({success:!1,error:"Session not found"},{status:404});return await o.collection("SmartUserIntents").updateOne({sessionId:r},{$set:{reportUrl:u,paymentStatus:"completed",reportId:i.toString(),originalSpecificProblem:c.originalSpecificProblem,updatedAt:new Date}}),await o.collection("CoupleReports").insertOne({_id:i,sessionId:r,userId:t,userEmail:s,reportType:n,reportMetadata:{originalSpecificProblem:c.originalSpecificProblem,primaryConcern:c.primaryConcern,relationshipAnalysisType:c.relationshipAnalysisType,sessionId:r},userInputs:{birthday:c.userBirthday,birthday2:c.partnerBirthday,gender:c.userGender,gender2:c.partnerGender,time:c.userTime,time2:c.partnerTime,problem:c.specificQuestion},createdAt:new Date,status:"generated"}),await e.close(),Response.json({success:!0,reportUrl:u,reportId:i.toString()})}return Response.json({success:!1,message:"Payment not completed"})}catch(e){return console.error("Payment webhook error:",e),Response.json({success:!1,error:e.message},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/payment-webhook/route",pathname:"/api/payment-webhook",filename:"route",bundlePath:"app/api/payment-webhook/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/payment-webhook/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:m}=c;function g(){return(0,i.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{},96559:(e,r,t)=>{"use strict";e.exports=t(44870)}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[7719],()=>t(23400));module.exports=s})();