(()=>{var e={};e.id=6288,e.ids=[6288],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},8991:(e,t,a)=>{"use strict";a.r(t),a.d(t,{patchFetch:()=>d,routeModule:()=>p,serverHooks:()=>u,workAsyncStorage:()=>c,workUnitAsyncStorage:()=>m});var r={};a.r(r),a.d(r,{POST:()=>o});var i=a(96559),s=a(48088),l=a(37719),n=a(32190);async function o(e){try{let{femaleUser:t,maleUser:a,specificProblem:r}=await e.json(),i=e=>{if(!e)return"未提供";try{let t=new Date(e);return`${t.getFullYear()}年${String(t.getMonth()+1).padStart(2,"0")}月${String(t.getDate()).padStart(2,"0")}日${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}catch(t){return e}},s=e=>{let t=new Date(e),a=t.getFullYear(),r=t.getMonth()+1;t.getDate();let i=t.getHours(),s=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"],l=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"],n=s[(a-4)%10]+l[(a-4)%12],o=s[((a-4)*12+r-1)%10]+l[(r+1)%12],p=Math.floor((t-new Date("1900-01-01"))/864e5),c=(p+9)%10,m=(p+11)%12,u=s[c]+l[m],d=Math.floor((i+1)/2)%12,h=s[(12*c+d)%10]+l[d];return{year:n,month:o,day:u,hour:h,dayStem:s[c],dayBranch:l[m]}},l=(e,t)=>{let a=s(e),r=i(e),l=[`年柱-${a.year}`,`月柱-${a.month}`,`日柱-${a.day}`,`時柱-${a.hour}`],n=`${a.year} ${a.month} ${a.day} ${a.hour}`,o=a.dayStem,p=a.dayBranch,c=`日主${o}${p.includes("木")?"木":p.includes("火")?"火":p.includes("土")?"土":p.includes("金")?"金":"水"}，${{甲:"甲木如大樹，性格正直，具有領導能力",乙:"乙木如花草，性格溫和，適應力強",丙:"丙火如太陽，性格熱情，充滿活力",丁:"丁火如燭光，性格溫暖，富有創造力",戊:"戊土如山嶽，性格穩重，值得信賴",己:"己土如田園，性格務實，善於包容",庚:"庚金如刀劍，性格果斷，意志堅強",辛:"辛金如珠寶，性格細膩，追求完美",壬:"壬水如江河，性格靈活，智慧深邃",癸:"癸水如雨露，性格柔和，富有同情心"}[o]||"性格獨特，具有獨特的人格魅力"}`;return{birthDate:r,bazi:n,description:c,pillars:l}},o=l(t.birthDateTime,"female"),p=l(a.birthDateTime,"male"),c=`請根據以下真實八字資訊進行專業合盤分析：

女方資訊：
- 出生時間：${o.birthDate}
- 八字：${o.bazi}
- 性別：女

男方資訊：
- 出生時間：${p.birthDate}
- 八字：${p.bazi}  
- 性別：男

具體問題：${r}

請基於這些真實的八字資訊，提供專業的合盤分析和針對具體問題的建議。重點分析兩人的五行互補性、相沖相合情況，以及如何解決提到的具體問題。

請按照以下格式回覆：

1. **您的八字（女，${o.birthDate}）**  
   八字：${o.bazi}  
   （基於真實八字的詳細格局分析和性格特點）

2. **伴侶八字（男，${p.birthDate}）**  
   八字：${p.bazi}  
   （基於真實八字的詳細格局分析和性格特點）

請提供基於真實八字的專業命理分析，不要使用假設或示例數據。`,m=await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.DEEPSEEK_API_KEY}`},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:"你是專業的八字命理分析師，精通八字合盤分析。請提供準確的八字計算和詳細的命理解讀。"},{role:"user",content:c}],max_tokens:2e3,temperature:.7})});if(!m.ok)throw Error("DeepSeek API request failed");let u=await m.json(),d=u.choices[0]?.message?.content||"",h=(e=>{let r={female:{birthDate:i(t.birthDateTime),bazi:"",description:"",pillars:[]},male:{birthDate:i(a.birthDateTime),bazi:"",description:"",pillars:[]}},s=e.match(/1\.\s*\*\*您的八字（女[^）]*）\*\*\s*八字：([^\n]*)\n([^]*?)(?=2\.|$)/);if(s){r.female.bazi=s[1].trim(),r.female.description=s[2].replace(/（([^）]*)）/,"$1").trim();let e=s[1].trim().split(/\s+/);e.length>=4&&(r.female.pillars=[`年柱-${e[0]||"甲子"}`,`月柱-${e[1]||"乙丑"}`,`日柱-${e[2]||"丙寅"}`,`時柱-${e[3]||"丁卯"}`])}let l=e.match(/2\.\s*\*\*伴侶八字（男[^）]*）\*\*\s*八字：([^\n]*)\n([^]*?)$/);if(l){r.male.bazi=l[1].trim(),r.male.description=l[2].replace(/（([^）]*)）/,"$1").trim();let e=l[1].trim().split(/\s+/);e.length>=4&&(r.male.pillars=[`年柱-${e[0]||"戊辰"}`,`月柱-${e[1]||"己巳"}`,`日柱-${e[2]||"庚午"}`,`時柱-${e[3]||"辛未"}`])}return r})(d);return h.female.bazi&&""!==h.female.bazi.trim()||(h.female={...o,description:h.female.description||o.description}),h.male.bazi&&""!==h.male.bazi.trim()||(h.male={...p,description:h.male.description||p.description}),h.female.realBazi=o.bazi,h.male.realBazi=p.bazi,n.NextResponse.json({success:!0,female:h.female,male:h.male,rawResponse:d})}catch(e){console.error("Couple analysis error:",e);try{let e=generateBaZiAnalysis(femaleUser.birthDateTime,"female"),t=generateBaZiAnalysis(maleUser.birthDateTime,"male");return n.NextResponse.json({success:!1,female:e,male:t,error:"AI analysis failed, but real BaZi calculated successfully"})}catch(e){return console.error("BaZi calculation also failed:",e),n.NextResponse.json({success:!1,error:"Both AI analysis and BaZi calculation failed",female:{birthDate:formatBirthDate(femaleUser?.birthDateTime)||"未提供",bazi:"計算失敗",description:"無法計算八字，請檢查出生時間格式",pillars:["年柱-未知","月柱-未知","日柱-未知","時柱-未知"]},male:{birthDate:formatBirthDate(maleUser?.birthDateTime)||"未提供",bazi:"計算失敗",description:"無法計算八字，請檢查出生時間格式",pillars:["年柱-未知","月柱-未知","日柱-未知","時柱-未知"]}})}}}let p=new i.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/couple-specific-problem-analysis/route",pathname:"/api/couple-specific-problem-analysis",filename:"route",bundlePath:"app/api/couple-specific-problem-analysis/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/couple-specific-problem-analysis/route.js",nextConfigOutput:"",userland:r}),{workAsyncStorage:c,workUnitAsyncStorage:m,serverHooks:u}=p;function d(){return(0,l.patchFetch)({workAsyncStorage:c,workUnitAsyncStorage:m})}},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[7719,580],()=>a(8991));module.exports=r})();