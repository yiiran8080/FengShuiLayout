(()=>{var e={};e.id=1612,e.ids=[1612],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},6745:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var s=r(56037),a=r.n(s);let i=new(a()).Schema({userId:{type:String,required:!0,unique:!0},password:{type:String,required:!1},provider:{type:String,default:"credentials",required:!1},name:{type:String,required:!1},gender:{type:String,enum:["female","male"],required:!0,default:"female"},birthDateTime:{type:Date,required:!0,default:new Date(1996,2,12,22)},email:{type:String,required:!1},isLock:{type:Boolean,required:!0,default:!0},genStatus:{type:String,enum:["none","waiting","done"],required:!1},emailVerified:{type:Boolean,default:!1},verificationToken:{type:String,required:!1},freeReportStats:{totalGenerated:{type:Number,default:0},lastGeneratedAt:{type:Date,default:null},firstGeneratedAt:{type:Date,default:null},favoriteRoomType:{type:String,default:null},favoriteDirection:{type:String,default:null}},createdAt:{type:Date,default:Date.now},updatedAt:{type:Date,default:Date.now}});i.virtual("freeReportActivities",{ref:"FreeReportActivity",localField:"userId",foreignField:"userId"}),i.virtual("projects",{ref:"Project",localField:"userId",foreignField:"owner"}),i.set("toJSON",{virtuals:!0}),i.set("toObject",{virtuals:!0}),a().models.User&&delete a().models.User,a().modelSchemas&&a().modelSchemas.User&&delete a().modelSchemas.User;let n=a().model("User",i)},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},28728:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>c,serverHooks:()=>f,workAsyncStorage:()=>m,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>p});var a=r(96559),i=r(48088),n=r(37719),o=r(32190),u=r(56364),l=r(6745),d=r(49316);async function p(e){try{let{email:t,password:r,name:s}=await e.json();if(!t||!r||!s)return o.NextResponse.json({message:"Email, password, and name are required"},{status:400});let a=(0,d.DT)(t);if(!a.isValid)return o.NextResponse.json({message:a.message},{status:400});let i=(0,d.Oj)(r);if(!i.isValid)return o.NextResponse.json({message:i.message},{status:400});if(await (0,u.A)(),await l.A.findOne({$or:[{email:t},{userId:t}]}))return o.NextResponse.json({message:"User with this email already exists"},{status:400});let n=await (0,d.Er)(r),p={userId:t,email:t,password:n,name:s,provider:"credentials",emailVerified:!1,gender:"female",birthDateTime:new Date(1996,2,12,22),isLock:!0};console.log("Creating user with validated data:",p);let c=new l.A(p),m=c.validateSync();if(m)return console.error("Validation error before save:",m),o.NextResponse.json({message:"Validation failed",errors:Object.values(m.errors).map(e=>e.message)},{status:400});await c.save();let g={userId:c.userId,email:c.email,name:c.name,createdAt:c.createdAt};return o.NextResponse.json({message:"User registered successfully",user:g},{status:201})}catch(e){if(console.error("Registration error:",e),"ValidationError"===e.name){let t=Object.values(e.errors).map(e=>e.message);return o.NextResponse.json({message:"Validation failed",errors:t,details:e.errors},{status:400})}if(11e3===e.code)return o.NextResponse.json({message:"User with this email already exists"},{status:400});return o.NextResponse.json({message:"Internal server error"},{status:500})}}let c=new a.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/auth/register/route",pathname:"/api/auth/register",filename:"route",bundlePath:"app/api/auth/register/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/auth/register/route.js",nextConfigOutput:"",userland:s}),{workAsyncStorage:m,workUnitAsyncStorage:g,serverHooks:f}=c;function v(){return(0,n.patchFetch)({workAsyncStorage:m,workUnitAsyncStorage:g})}},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},49316:(e,t,r)=>{"use strict";r.d(t,{BE:()=>i,DT:()=>o,Er:()=>a,Oj:()=>n});var s=r(85663);async function a(e){return await s.Ay.hash(e,12)}async function i(e,t){return await s.Ay.compare(e,t)}function n(e){let t=/[a-zA-Z]/.test(e),r=/\d/.test(e);return{isValid:e.length>=8&&t&&r,message:e.length<8?"Password must be at least 8 characters long":t&&r?"":"Password must contain at least one letter and one number"}}function o(e){let t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return{isValid:t.test(e),message:t.test(e)?"":"Please enter a valid email address"}}},55511:e=>{"use strict";e.exports=require("crypto")},56037:e=>{"use strict";e.exports=require("mongoose")},56364:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,X:()=>o});var s=r(56037),a=r.n(s);let i=process.env.MONGODB_URI;if(!i)throw Error("Please define the MONGODB_URI environment variable inside .env");let n=global.mongoose;async function o(){if(n.conn)return n.conn;n.promise||(n.promise=a().connect(i,{serverSelectionTimeoutMS:3e4,socketTimeoutMS:3e4}).then(e=>e).catch(e=>{throw e}));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}n||(n=global.mongoose={conn:null,promise:null});let u=o},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[7719,580,5663],()=>r(28728));module.exports=s})();