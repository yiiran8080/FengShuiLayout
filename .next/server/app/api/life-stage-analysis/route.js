(()=>{var e={};e.id=9256,e.ids=[9256],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},43813:(e,t,a)=>{"use strict";a.r(t),a.d(t,{patchFetch:()=>y,routeModule:()=>u,serverHooks:()=>p,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>g});var n={};a.r(n),a.d(n,{POST:()=>h});var r=a(96559),o=a(48088),s=a(37719),i=a(32190),m=a(74474),c=a(51367);async function h(e){let t=Math.random().toString(36).substring(2,15),a=null,n=null,r=null;try{let o;let{pillarType:s,stage:h,pillarData:u,userInfo:d,prompt:g}=await e.json();if(!d||!s||!h)return i.NextResponse.json({error:"Missing required information"},{status:400});a=(0,c.hz)("life-stage-analysis",d,{pillarType:s,stage:h}),console.log(`[${t}] Cache key: ${a}`);let p=(0,c.I7)(a,t);if(p)return i.NextResponse.json(p);let y=await (0,c.Xu)(a,t);if(y)return i.NextResponse.json(y);let S=(0,c.NG)(a,t);if(n=S.resolvePending,r=S.rejectPending,!process.env.API_KEY)return console.error(`[${t}] API_KEY environment variable is not set`),i.NextResponse.json({error:"API configuration error"},{status:500});let $=(0,m.Ay)(d.birthDateTime,d.gender),f="",x="",b="",T="",w="";switch(s){case"年柱":f=$.year,x=$.yearStem,b=$.yearBranch,T=$.yearStemWuxing,w=$.yearBranchWuxing;break;case"月柱":f=$.month,x=$.monthStem,b=$.monthBranch,T=$.monthStemWuxing,w=$.monthBranchWuxing;break;case"日柱":f=$.day,x=$.dayStem,b=$.dayBranch,T=$.dayStemWuxing,w=$.dayBranchWuxing;break;case"時柱":f=$.hour,x=$.hourStem,b=$.hourBranch,T=$.hourStemWuxing,w=$.hourBranchWuxing}let k=`
請根據以下用戶的八字信息，為${s}（代表${h}）提供深度的生活解讀。

用戶基本信息：
- 性別: ${d.gender}
- 出生年月日時: ${d.year||new Date(d.birthDateTime).getFullYear()}年${d.month||new Date(d.birthDateTime).getMonth()+1}月${d.day||new Date(d.birthDateTime).getDate()}日 ${d.hour||new Date(d.birthDateTime).getHours()}時

完整八字信息：
- 年柱: ${$.year} (天干:${$.yearStem}${$.yearStemWuxing}, 地支:${$.yearBranch}${$.yearBranchWuxing})
- 月柱: ${$.month} (天干:${$.monthStem}${$.monthStemWuxing}, 地支:${$.monthBranch}${$.monthBranchWuxing})  
- 日柱: ${$.day} (天干:${$.dayStem}${$.dayStemWuxing}, 地支:${$.dayBranch}${$.dayBranchWuxing}) - 日主
- 時柱: ${$.hour} (天干:${$.hourStem}${$.hourStemWuxing}, 地支:${$.hourBranch}${$.hourBranchWuxing})

當前分析的${s}：
- 干支組合: ${f} (${x}${b})
- 天干: ${x}${T}
- 地支: ${b}${w}
- 代表生活階段: ${h}

**重要要求：**
1. 請嚴格按照以下JSON格式返回分析結果
2. 不要包含任何markdown代碼塊標記，直接返回純JSON
3. 所有字符串值都必須用雙引號包圍
4. 確保JSON格式完全正確，可以被JavaScript的JSON.parse()正確解析

**分析要求：**
基於${s}${f}的組合，分析用戶在${h}時期的特色：

1. **標題命名格式**：${s}${f}：{主要特征描述}的${h}
2. **白話解釋**：針對${h}階段，用通俗易懂的語言解釋這個干支組合在此生活階段的具體表現（150-200字）
3. **生活舉例**：提供具體、貼近生活的例子說明這種特征如何在${h}時期體現（80-120字）  
4. **深層智慧**：從命理角度分析這個組合的深層含義和人生啟示（120-150字）

請返回以下JSON格式：

{
  "title": "${s}${f}：{特征描述}的${h}",
  "content": "針對${h}時期的詳細白話解釋，說明${x}${T}和${b}${w}的組合如何影響這個生活階段的具體表現...",
  "example": "具體的生活場景例子，生動描述這種特征在${h}時期是如何體現的...",
  "wisdom": "從命理學角度分析這個組合的深層智慧和人生啟示，包括五行生克關係的影響..."
}

**注意事項：**
- 分析要基於真實的八字命理邏輯
- 內容要個人化，針對具體的干支組合
- 語言要通俗易懂，貼近現代生活
- 例子要具體生動，不能泛泛而談
- 確保JSON格式完全正確，不要有語法錯誤
`,N=new AbortController,j=setTimeout(()=>N.abort(),25e3),B=await fetch("https://api.deepseek.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${process.env.API_KEY}`},body:JSON.stringify({model:"deepseek-chat",messages:[{role:"system",content:"你是一位專業的命理分析師，精通八字命理和人生階段分析。請根據用戶的八字信息提供深度、個人化的生活階段解讀。重要：你必須返回有效的JSON格式，不要包含任何markdown標記或額外文本。所有字符串值必須用雙引號包圍，確保JSON格式完全正確。"},{role:"user",content:k}],temperature:.8,max_tokens:2e3,response_format:{type:"json_object"}}),signal:N.signal});if(clearTimeout(j),!B.ok){let e=await B.text();return console.error(`[${t}] DeepSeek API Error:`,B.status,B.statusText,e),i.NextResponse.json({success:!0,analysis:l(s,h),aiGenerated:!1,contentType:"fallback-data"})}let D=await B.json(),G=D.choices?.[0]?.message?.content;if(!G)return console.error(`[${t}] No content received from DeepSeek API`),i.NextResponse.json({success:!0,analysis:l(s,h),aiGenerated:!1,contentType:"fallback-data"});(G=G.trim()).startsWith("```json")?G=G.replace(/^```json\s*/,"").replace(/\s*```$/,""):G.startsWith("```")&&(G=G.replace(/^```\s*/,"").replace(/\s*```$/,""));try{o=JSON.parse(G)}catch(e){return console.error(`[${t}] Failed to parse AI response:`,e,"Content:",G.substring(0,500)),i.NextResponse.json({success:!0,analysis:l(s,h),aiGenerated:!1,contentType:"fallback-data"})}if(!o.title||!o.content)return console.error(`[${t}] Invalid analysis structure:`,o),i.NextResponse.json({success:!0,analysis:l(s,h),aiGenerated:!1,contentType:"fallback-data"});let Y={success:!0,analysis:o,aiGenerated:!0,contentType:"ai-generated",timestamp:new Date().toISOString(),requestId:t};return(0,c.e0)(a,Y,t),(0,c.dV)(a,Y,t,n),i.NextResponse.json(Y)}catch(e){return console.error(`[${t||"unknown"}] Life Stage Analysis API Error:`,e),(0,c.ME)(a,e,t,r),i.NextResponse.json({success:!0,analysis:l(body?.pillarType||"年柱",body?.stage||"童年"),aiGenerated:!1,contentType:"fallback-data"})}}function l(e,t){let a={年柱:{title:"年柱甲申：竞争与规则并存的童年",content:"你小时候的环境（家庭或学校）存在明显的竞争压力，比如兄弟姐妹比较成绩，或父母用严格标准要求你。同时生活中规则感很强，例如必须按时回家、作业错一题罚抄十遍等。",example:"就像玩游戏时，别人轻松过关，你却总被要求「先写完数学题才能玩」，这种约束让你早早就学会在压力下找方法。",wisdom:"智慧如地下暗流：指你天生会暗中观察、动脑筋解决问题。比如被父母禁止看电视，你会偷偷用电脑查资料完成作业来争取自由时间——这种「钻空子」不是叛逆，而是懂得灵活应对规则。"},月柱:{title:"月柱丁巳：才华耀眼但容易三分热度",content:"你青年时期（中学到大学）能力突出，像学新技能比同学快、比赛容易拿奖。但热情来得快去得快，可能今天想学画画，明天又迷上编程，最后都没坚持。",example:"就像参加社团时，你一周就能当上组长（火性爆发力），但三个月后觉得无聊就退社了（火旺难持久）。",wisdom:"火焚高木的警告：你像一棵长在火山边的树，长得快但易被烧伤。比如熬夜三天写完报告拿了高分（才华耀眼），结果感冒一周（消耗过度）。"},日柱:{title:"日柱丁酉：能力与压力互相成就",content:"你成年后靠实力赚钱（如专业技能、创意作品），但这些机会总伴随高压挑战。比如接到高薪项目，却要天天加班；或自己创业当老板，但每笔支出都心惊胆战。",example:"像你设计海报被客户夸赞（丁火发光），但改了20版才通过（酉金磨人）。",wisdom:"钗钏金的本质：你的价值像金首饰，需要被打磨才能闪耀。压力（客户挑剔/老板刁难）其实是让你更专业的「打磨工具」。"},時柱:{title:"时柱庚子：晚年要懂得放松与放手",content:"你老年可能地位高、说话有分量（如当了领导或家族长辈），但责任也更大，常为小事操心失眠。",example:"像退休后还被请去当顾问，既高兴被看重（庚金权威），又烦心年轻人不按你的方法做（子水暗忧）。",wisdom:"壁上土的提醒：这堵墙既是保护（比如存款够多不怕生病），也可能隔绝快乐（比如嫌旅游太累只在家发呆）。学会偶尔「拆墙」——像勉强同意儿女用新方法装修老房，反而发现效果不错。"}};return a[e]||a["年柱"]}let u=new r.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/life-stage-analysis/route",pathname:"/api/life-stage-analysis",filename:"route",bundlePath:"app/api/life-stage-analysis/route"},resolvedPagePath:"/Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/life-stage-analysis/route.js",nextConfigOutput:"",userland:n}),{workAsyncStorage:d,workUnitAsyncStorage:g,serverHooks:p}=u;function y(){return(0,s.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:g})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},51367:(e,t,a)=>{"use strict";a.d(t,{I7:()=>m,ME:()=>d,NG:()=>h,Xu:()=>c,dV:()=>u,e0:()=>l,hz:()=>s});let n=new Map,r=new Map,o={TTL:36e5,MAX_SIZE:1e3};function s(e,t,a={}){if(!t?.birthDateTime)return null;let n=new Date(t.birthDateTime),r=`${e}_${n.getFullYear()}_${n.getMonth()}_${n.getDate()}_${n.getHours()}_${t.gender||""}`,o=Object.keys(a).sort();return r+(o.length>0?"_"+o.map(e=>`${e}:${a[e]}`).join("_"):"")}function i(e){return Date.now()-e.timestamp>o.TTL}function m(e,t){if(!e||!n.has(e))return null;let a=n.get(e);return i(a)?(n.delete(e),console.log(`[${t}] 🗑️ Removed expired cache for ${e}`),null):(console.log(`[${t}] 🎯 RETURNING CACHED RESULT for ${e}`),{...a.data,cached:!0,requestId:t,originalRequestId:a.originalRequestId,cacheAge:Date.now()-a.timestamp})}async function c(e,t){if(!e||!r.has(e))return null;console.log(`[${t}] 🚨 REQUEST ALREADY PENDING for ${e}, waiting...`);try{let a=await r.get(e);return console.log(`[${t}] ✅ Got result from pending request`),{...a,waitedForResult:!0,requestId:t,originalRequestId:a.requestId}}catch(a){return console.log(`[${t}] ⚠️ Pending request failed, proceeding with new request`),r.delete(e),null}}function h(e,t){let a,n;if(!e)return{resolvePending:null,rejectPending:null};let o=new Promise((e,t)=>{a=e,n=t});return r.set(e,o),console.log(`[${t}] 🔄 Created pending request for ${e}`),{resolvePending:a,rejectPending:n}}function l(e,t,a){if(!e)return;n.size>.8*o.MAX_SIZE&&function(){for(let[e,t]of n.entries())i(t)&&n.delete(e);n.size>o.MAX_SIZE&&Array.from(n.entries()).sort((e,t)=>e[1].timestamp-t[1].timestamp).slice(0,n.size-o.MAX_SIZE).forEach(([e])=>n.delete(e))}();let r={data:t,timestamp:Date.now(),originalRequestId:t.requestId||a};n.set(e,r),console.log(`[${a}] ✅ CACHED result for ${e}`)}function u(e,t,a,n){e&&n&&(n(t),r.delete(e),console.log(`[${a}] ✅ Resolved pending promise for ${e}`))}function d(e,t,a,n){e&&n&&(n(t),r.delete(e),console.log(`[${a}] 🚨 Rejected pending promise for ${e}`))}},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74474:(e,t,a)=>{"use strict";a.d(t,{Ay:()=>$});var n=a(44794),r=a(42457),o=a(81540),s=a(14250),i=a(96002),m=a.n(i),c=a(22246);s.A.extend(n.t).extend(r.sM).extend(o.z0);let h=(0,s.A)(m()().format("YYYY-MM-DD")).char8.year.toString(),{LYGanzhiMap:l,LYzhiMap:u,LYStarMap:d,LYSihuaMap:g,spouseStarMap:p,spouseSihuaMap:y}=function(){let e=m()().format("YYYY"),t={},a={},n={},r={},o={},s={};for(let i=1;i<=12;i++){let m=e+"-"+(i<10?"0"+i:""+i)+"-15",h=c.astro.bySolar(m,0,"男",!0,"zh-CN").horoscope(m);a[i]=h.monthly.earthlyBranch,t[i]=h.monthly.heavenlyStem+h.monthly.earthlyBranch,n[i]=h.palace("命宫","monthly").majorStars.map(e=>e.name).toString(),o[i]=h.palace("夫妻","monthly").majorStars.map(e=>e.name).toString(),r[i]=h.palace("命宫","monthly").mutagedPlaces().map(e=>e.name).toString(),s[i]=h.palace("夫妻","monthly").mutagedPlaces().map(e=>e.name).toString()}return{LYGanzhiMap:t,LYzhiMap:a,LYStarMap:n,LYSihuaMap:r,spouseStarMap:o,spouseSihuaMap:s}}();(function(){let e=m()().format("YYYY-MM-DD");(0,s.A)(e).char8.month.toString()})(),function(){let e=m()().format("YYYY-MM-DD");c.astro.bySolar(e,0,"男",!0,"zh-CN").horoscope(e,0).palace("夫妻","yearly").majorStars.map(e=>e.name).toString()}();let S={};function $(e,t){var a;let n=m()(e).format("YYYY-MM-DD HH:mm:ss");if(console.log("birthStr",n),S[n+"-"+t])return S[n+"-"+t];let r=Math.floor(m()(e).hour()/2),o=m()(e).format("YYYY-MM-DD"),i=c.astro.bySolar(o,r,"female"==t?"女":"男",!0,"zh-CN"),l=i.palace("命宫"),u=i.palace("身宫"),d=i.palace("迁移").majorStars.map(e=>e.name).toString(),g=i.horoscope(o,r),p=(0,s.A)(n),y=function(e,t,a,n,r,o,s,i){let m={金:0,木:0,水:0,火:0,土:0},c=[e,t,a,n,r,o,s,i];c.forEach(e=>{["金","木","水","火","土"].includes(e)&&m[e]++});let h=c.length;return`金:${(m.金/h*100).toFixed(2)}%，木:${(m.木/h*100).toFixed(2)}%，水:${(m.水/h*100).toFixed(2)}%，火:${(m.火/h*100).toFixed(2)}%，土:${(m.土/h*100).toFixed(2)}%`}(p.char8.year.stem.e5.name,p.char8.year.branch.e5.name,p.char8.month.stem.e5.name,p.char8.month.branch.e5.name,p.char8.day.stem.e5.name,p.char8.day.branch.e5.name,p.char8.hour.stem.e5.name,p.char8.hour.branch.e5.name),$=p.char8.day.branch.hiddenStems.map(e=>e.name).toString(),x=p.char8.year.branch.hiddenStems,b=p.char8.month.branch.hiddenStems,T=p.char8.day.branch.hiddenStems,w=p.char8.hour.branch.hiddenStems,k=p.char8ex(+("female"!==t)),N=k.year,j=k.month,B=k.day,D=k.hour,G={nayin:p.char8.year.takeSound,wuxingJu:(a=p.char8.year.takeSoundE5.toString(),`${a}${f[a]}局`),year:p.char8.year.toString(),month:p.char8.month.toString(),day:p.char8.day.toString(),hour:p.char8.hour.toString(),wuxingScale:y,rizhiCanggan:$,mingPalace:`{主星：${l.majorStars.map(e=>e.name).toString()},主星亮度：${l.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${l.minorStars.map(e=>e.name).toString()}, 四化：${l.mutagedPlaces().map(e=>e.name).toString()}}`,bodyPalace:`{主星：${u.majorStars.map(e=>e.name).toString()},主星亮度：${u.majorStars.map(e=>e.brightness||"").toString()}, 辅星： ${u.minorStars.map(e=>e.name).toString()}, 四化：${u.mutagedPlaces().map(e=>e.name).toString()}}`,qianyiPalace:d,dayunGanzhi:g.decadal.heavenlyStem+g.decadal.earthlyBranch,liunianGanzhi:h,yearStemTenGod:N.stemTenGod.name,yearBranchTenGod:N.branchTenGod.map(e=>e.name).toString(),monthStemTenGod:j.stemTenGod.name,monthBranchTenGod:j.branchTenGod.map(e=>e.name).toString(),dayStemTenGod:B.stemTenGod.name,dayBranchTenGod:B.branchTenGod.map(e=>e.name).toString(),hourStemTenGod:D.stemTenGod.name,hourBranchTenGod:D.branchTenGod.map(e=>e.name).toString(),yearGods:N.gods.map(e=>e.name).toString(),monthGods:j.gods.map(e=>e.name).toString(),dayGods:B.gods.map(e=>e.name).toString(),yearStem:p.char8.year.stem.name,yearStemWuxing:p.char8.year.stem.e5.name,yearBranch:p.char8.year.branch.name,yearBranchWuxing:p.char8.year.branch.e5.name,monthStem:p.char8.month.stem.name,monthStemWuxing:p.char8.month.stem.e5.name,monthBranch:p.char8.month.branch.name,monthBranchWuxing:p.char8.month.branch.e5.name,dayStem:p.char8.day.stem.name,dayStemWuxing:p.char8.day.stem.e5.name,dayBranch:p.char8.day.branch.name,dayBranchWuxing:p.char8.day.branch.e5.name,hourStem:p.char8.hour.stem.name,hourStemWuxing:p.char8.hour.stem.e5.name,hourBranch:p.char8.hour.branch.name,hourBranchWuxing:p.char8.hour.branch.e5.name,yearNayin:p.char8.year.takeSound,monthNayin:p.char8.month.takeSound,dayNayin:p.char8.day.takeSound,hourNayin:p.char8.hour.takeSound,yearNayinWuxing:p.char8.year.takeSoundE5.toString(),monthNayinWuxing:p.char8.month.takeSoundE5.toString(),dayNayinWuxing:p.char8.day.takeSoundE5.toString(),hourNayinWuxing:p.char8.hour.takeSoundE5.toString(),yearBranchHiddenStems:x.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),monthBranchHiddenStems:b.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),dayBranchHiddenStems:T.map(e=>({stem:e.name,element:e.e5.name,strength:e.value})),hourBranchHiddenStems:w.map(e=>({stem:e.name,element:e.e5.name,strength:e.value}))};return S[n+"-"+t]=G,console.log("result",G),G}let f={水:"二",木:"三",金:"四",土:"五",火:"六"}},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),n=t.X(0,[7719,580,6219],()=>a(43813));module.exports=n})();