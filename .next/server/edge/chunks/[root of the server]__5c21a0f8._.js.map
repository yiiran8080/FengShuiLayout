{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/i18n/routing.ts"],"sourcesContent":["import { defineRouting } from \"next-intl/routing\";\n\nexport const routing = defineRouting({\n  // A list of all locales that are supported\n  locales: [\"zh-CN\", \"zh-TW\"],\n\n  // Used when no locale matches\n  defaultLocale: \"zh-TW\",\n});\n"],"names":[],"mappings":";;;AAAA;;AAEO,MAAM,UAAU,CAAA,GAAA,0OAAA,CAAA,gBAAa,AAAD,EAAE;IACnC,2CAA2C;IAC3C,SAAS;QAAC;QAAS;KAAQ;IAE3B,8BAA8B;IAC9B,eAAe;AACjB"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport createMiddleware from \"next-intl/middleware\";\nimport { getToken } from \"next-auth/jwt\";\nimport { routing } from \"./i18n/routing\";\n// Create the internationalization middleware\nconst intlMiddleware = createMiddleware(routing);\n\nexport default async function middleware(request) {\n\tconst { pathname } = request.nextUrl;\n\t// Skip auth check for public routes\n\tconst isPublicRoute =\n\t\tpathname === \"/\" ||\n\t\tpathname.startsWith(\"/auth\") ||\n\t\tpathname.startsWith(\"/api\") ||\n\t\tpathname.startsWith(\"/_next\") ||\n\t\tpathname.startsWith(\"/static\") ||\n\t\tpathname.includes(\".\") ||\n\t\tpathname.includes(\"/auth/login\") ||\n\t\tpathname === \"/favicon.ico\" ||\n\t\tpathname.includes(\"/price\") || // 添加 price 頁面為公共路由\n\t\tpathname.includes(\"/customer\") || // 允許 customer 頁面\n\t\tpathname.includes(\"/free\"); // 允許 free 頁面\n\n\t// Handle internationalization first\n\tconst response = intlMiddleware(request);\n\t// If it's a public route, no need to check authentication\n\tif (isPublicRoute) {\n\t\treturn response;\n\t}\n\n\t// Check if the user is authenticated\n\tconst token = await getToken({\n\t\tsecureCookie: process.env.NODE_ENV !== \"development\",\n\t\treq: request,\n\t\tsecret: process.env.NEXTAUTH_SECRET,\n\t});\n\t// If not authenticated, redirect to login page\n\tif (!token) {\n\t\t//console.log('pathname', request.nextUrl.pathname);\n\t\tconst referer = request.headers.get(\"referer\") || \"\";\n\t\t//console.log('request.url', request.nextUrl, referer);\n\t\t// // 检查来源是否已经是登录页，避免循环重定向\n\t\tif (referer.includes(\"/auth/login\")) {\n\t\t\treturn response;\n\t\t}\n\t\t//允许目标页面是首页、隐私条款等页面\n\t\tif (\n\t\t\t!request.nextUrl.pathname.includes(\"/design\") &&\n\t\t\t!request.nextUrl.pathname.includes(\"/report\")\n\t\t) {\n\t\t\treturn response;\n\t\t}\n\n\t\tconst locale = referer.indexOf(\"zh-CN\") >= 0 ? \"zh-CN\" : \"zh-TW\";\n\t\t// ?callbackUrl=${request.nextUrl.pathname}\n\n\t\treturn NextResponse.redirect(\n\t\t\tnew URL(\n\t\t\t\t`/${locale}/auth/login?callbackUrl=${request.nextUrl.pathname}`,\n\t\t\t\trequest.url\n\t\t\t)\n\t\t);\n\t}\n\treturn response;\n}\n\nexport const config = {\n\t// 匹配所有路径\n\tmatcher: [\"/((?!api|_next|.*\\\\..*).*)\", \"/\"],\n};\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;AAAA;AACA;;;;;AACA,6CAA6C;AAC7C,MAAM,iBAAiB,CAAA,GAAA,8LAAA,CAAA,UAAgB,AAAD,EAAE,8HAAA,CAAA,UAAO;AAEhC,eAAe,WAAW,OAAO;IAC/C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,oCAAoC;IACpC,MAAM,gBACL,aAAa,OACb,SAAS,UAAU,CAAC,YACpB,SAAS,UAAU,CAAC,WACpB,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,cACpB,SAAS,QAAQ,CAAC,QAClB,SAAS,QAAQ,CAAC,kBAClB,aAAa,kBACb,SAAS,QAAQ,CAAC,aAAa,mBAAmB;IAClD,SAAS,QAAQ,CAAC,gBAAgB,iBAAiB;IACnD,SAAS,QAAQ,CAAC,UAAU,aAAa;IAE1C,oCAAoC;IACpC,MAAM,WAAW,eAAe;IAChC,0DAA0D;IAC1D,IAAI,eAAe;QAClB,OAAO;IACR;IAEA,qCAAqC;IACrC,MAAM,QAAQ,MAAM,CAAA,GAAA,6IAAA,CAAA,WAAQ,AAAD,EAAE;QAC5B,cAAc,oDAAyB;QACvC,KAAK;QACL,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACpC;IACA,+CAA+C;IAC/C,IAAI,CAAC,OAAO;QACX,oDAAoD;QACpD,MAAM,UAAU,QAAQ,OAAO,CAAC,GAAG,CAAC,cAAc;QAClD,uDAAuD;QACvD,0BAA0B;QAC1B,IAAI,QAAQ,QAAQ,CAAC,gBAAgB;YACpC,OAAO;QACR;QACA,mBAAmB;QACnB,IACC,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,cACnC,CAAC,QAAQ,OAAO,CAAC,QAAQ,CAAC,QAAQ,CAAC,YAClC;YACD,OAAO;QACR;QAEA,MAAM,SAAS,QAAQ,OAAO,CAAC,YAAY,IAAI,UAAU;QACzD,2CAA2C;QAE3C,OAAO,6LAAA,CAAA,eAAY,CAAC,QAAQ,CAC3B,IAAI,IACH,CAAC,CAAC,EAAE,OAAO,wBAAwB,EAAE,QAAQ,OAAO,CAAC,QAAQ,EAAE,EAC/D,QAAQ,GAAG;IAGd;IACA,OAAO;AACR;AAEO,MAAM,SAAS;IACrB,SAAS;IACT,SAAS;QAAC;QAA8B;KAAI;AAC7C"}}]
}