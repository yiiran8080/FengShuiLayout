"use strict";exports.id=6893,exports.ids=[6893],exports.modules={67821:(e,t,r)=>{r.d(t,{A:()=>i});var l=r(60687),s=r(25324),a=r(30474),o=r(35950),n=r(77618);function i(){let e=(0,n.c3)("home.footer"),t={contact:[{name:e("contact"),href:"/customer/contact"}],law:[{name:e("privacy"),href:"/customer/privacy"},{name:e("terms"),href:"/customer/terms"}],social:[{icon:"/images/footer/Facebook.png",href:"https://www.facebook.com/profile.php?id=61578389876952"},{icon:"/images/footer/Instagram.png",href:"https://www.instagram.com/harmoniq_fengshui/"}]};return(0,l.jsx)("footer",{className:"bg-[#004F44] text-gray-300 px-5 md:px-0",style:{fontFamily:"Noto Serif TC, serif"},children:(0,l.jsxs)("div",{className:"container px-4 mx-auto py-25",children:[(0,l.jsxs)("div",{className:"justify-center item-center text-[50px] font-bold text-white text-center mb-10",children:[(0,l.jsx)("h1",{className:"text-white",style:{fontFamily:"Noto Serif TC, serif",fontWeight:400,fontSize:"46px"},children:e("title")}),(0,l.jsx)("p",{className:"mt-2 text-white",style:{fontFamily:"Noto Serif TC, serif",fontWeight:400,fontSize:"24px"},children:e("subtitle")}),(0,l.jsx)(s.N_,{href:"/price",className:"inline-flex items-center justify-center mt-10 transition-colors hover:bg-gray-50",style:{width:"172px",height:"50px",borderRadius:"20px",backgroundColor:"white",border:"1px solid #ccc",color:"#25826C",textDecoration:"none",fontSize:"18px",fontFamily:"Noto Serif TC, serif"},children:e("button")})]}),(0,l.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-5",children:[(0,l.jsxs)("div",{className:"flex gap-12",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mb-4 text-xl font-semibold text-white",style:{fontFamily:"Noto Serif TC, serif"},children:e("consult")}),(0,l.jsx)("ul",{className:"space-y-2",children:t.contact.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)(s.N_,{href:e.href,className:"text-xl transition-colors hover:text-white",style:{fontFamily:"Noto Serif TC, serif"},children:e.name})},e.name))})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mb-4 text-xl font-semibold text-white",style:{fontFamily:"Noto Serif TC, serif"},children:e("law")}),(0,l.jsx)("ul",{className:"space-y-2",children:t.law.map(e=>(0,l.jsx)("li",{children:(0,l.jsx)(s.N_,{href:e.href,className:"text-xl transition-colors hover:text-white",style:{fontFamily:"Noto Serif TC, serif"},children:e.name})},e.name))})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"mb-4 text-xl font-semibold text-white min-w-30",style:{fontFamily:"Noto Serif TC, serif"},children:e("focus")}),(0,l.jsx)("div",{className:"flex space-x-4",children:t.social.map(e=>e.href?(0,l.jsx)("a",{href:e.href,target:"_blank",rel:"noopener noreferrer",className:"transition-opacity hover:opacity-80",children:(0,l.jsx)(a.default,{src:e.icon,alt:"",width:30,height:30})},e.icon):(0,l.jsx)(a.default,{src:e.icon,alt:"",width:30,height:30},e.icon))})]})]}),(0,l.jsx)(o.Separator,{className:"mt-7.5"}),(0,l.jsx)("div",{className:"mt-5 font-semibold text-center border-t border-[#004F44] md:mt-10",style:{fontFamily:"Noto Serif TC, serif"},children:(0,l.jsxs)("p",{children:["\xa9 2025 HarmoniQ. ",e("copyright")]})})]})})}},93121:(e,t,r)=>{r.d(t,{A:()=>y});var l=r(60687),s=r(43210),a=r(30474);r(3696);var o=r(16189),n=r(95383),i=r(77618),c=r(99208),d=r(72879),m=r(93853);let h=Array.from({length:100},(e,t)=>1926+t),x=Array.from({length:12},(e,t)=>t+1),f=Array.from({length:31},(e,t)=>t+1),u=Array.from({length:24},(e,t)=>t+1),g={bedroom:"bedroom",livingRoom:"living_room",diningRoom:"dining_room",kitchen:"kitchen",bathroom:"bathroom",studyRoom:"study_room",balcony:"balcony",storageRoom:"storage_room"},p={north:"north",northEast:"northEast",east:"east",center:"center",southEast:"southEast",south:"south",southWest:"southWest",west:"west",northWest:"northWest"},b=e=>new Promise((t,r)=>{let l=new FileReader;l.readAsDataURL(e),l.onload=()=>t(l.result),l.onerror=e=>r(e)});function y({onResult:e}){let t=(0,i.c3)("upload"),[r,y]=(0,s.useState)(null),[v,w]=(0,s.useState)(null),[j,N]=(0,s.useState)(!1),[S,M]=(0,s.useState)(""),[R,D]=(0,s.useState)(""),[C,k]=(0,s.useState)(""),[A,F]=(0,s.useState)(""),[I,T]=(0,s.useState)(""),[z,$]=(0,s.useState)(""),[U,O]=(0,s.useState)(""),[E,L]=(0,s.useState)(""),[P,_]=(0,s.useState)(""),[B,W]=(0,s.useState)(!1),[J,V]=(0,s.useState)(!1),[q,G]=(0,s.useState)(null),[H,Q]=(0,s.useState)(!1),K=(0,s.useRef)(null),X=(0,o.useRouter)(),{setPreview:Y,setFile:Z}=(0,n.l)(),{data:ee,status:et}=(0,c.wV)(),er=Object.keys(g),el=Object.keys(p),es=()=>{try{localStorage.setItem("uploadPicFormData",JSON.stringify({gender:S,year:R,month:C,day:A,hour:I,roomType:z,direction:U,validationError:q})),console.log("Form data saved to localStorage")}catch(e){console.error("Error saving form data:",e)}},ea=async e=>{try{if(e){let t={base64:await b(e),name:e.name,size:e.size,type:e.type,lastModified:e.lastModified,timestamp:Date.now()};sessionStorage.setItem("uploadPicFileData",JSON.stringify(t)),console.log("File data saved to sessionStorage:",e.name)}}catch(e){console.error("Error saving file data:",e)}},eo=()=>{localStorage.removeItem("uploadPicFormData"),sessionStorage.removeItem("uploadPicFileData"),console.log("Saved data cleared")};async function en(){let e=g[z],l=p[U];if("loading"===et){m.oR.info(t("checkingAuth")||"Checking authentication...");return}if("unauthenticated"===et||!ee?.user?.userId){es(),r&&await ea(r);let s=`/freereport?roomType=${encodeURIComponent(e)}&direction=${encodeURIComponent(l)}`,a=`/auth/login?callbackUrl=${encodeURIComponent(s)}`;m.oR.info(t("redirectingToLogin")||"Please log in to continue..."),X.push(a);return}W(!0);try{let t=`${R}-${C.padStart(2,"0")}-${A.padStart(2,"0")}T${I.padStart(2,"0")}:00`,{status:r}=await (0,d.bE)(`/api/users/${ee.user.userId}`,{gender:S,birthDateTime:t});0===r?(await e_(e,l,{gender:S,birthDateTime:t},null),m.oR.success("保存成功！"),eo(),X.push(`/freereport?roomType=${encodeURIComponent(e)}&direction=${encodeURIComponent(l)}`)):m.oR.error("保存失败！")}catch(e){m.oR.error("保存失败："+e),console.error("Error saving user info:",e)}finally{W(!1)}}let ei=e=>new Promise(t=>{let r=document.createElement("img");r.onload=()=>{let e=document.createElement("canvas"),l=e.getContext("2d"),s=Math.min(512/r.width,512/r.height);e.width=r.width*s,e.height=r.height*s,l.drawImage(r,0,0,e.width,e.height);let a=ec(l.getImageData(0,0,e.width,e.height)),o=ed(a);console.log("Room Detection Analysis:",{...a,finalDecision:o?"ROOM DETECTED":"NOT A ROOM",confidence:a.overallScore}),URL.revokeObjectURL(r.src),t(o)},r.onerror=()=>{console.error("Failed to load image for room detection"),URL.revokeObjectURL(r.src),t(!1)},r.src=URL.createObjectURL(e)}),ec=e=>{let{data:t,width:r,height:l}=e;return{wallDetection:em(e),floorDetection:eh(e),ceilingDetection:ex(e),cornersDetection:ef(e),doorDetection:eg(e),windowDetection:eb(e),lightingAnalysis:ev(e),shadowAnalysis:ew(e),furnitureDetection:ej(e),textureAnalysis:eN(e),colorAnalysis:eM(e),perspectiveAnalysis:eR(e),depthAnalysis:eD(e),scaleAnalysis:eC(e),overallScore:0}},ed=e=>{let t=0,r=0;e.wallDetection.detected&&(t+=25*e.wallDetection.confidence),r+=25,e.floorDetection.detected&&(t+=20*e.floorDetection.confidence),r+=20,e.cornersDetection.detected&&(t+=15*e.cornersDetection.confidence),r+=15,e.doorDetection.detected&&(t+=15*e.doorDetection.confidence),r+=15,e.windowDetection.detected&&(t+=10*e.windowDetection.confidence),r+=10,e.lightingAnalysis.isIndoorLighting&&(t+=10*e.lightingAnalysis.confidence),r+=10,e.shadowAnalysis.hasIndoorShadows&&(t+=8*e.shadowAnalysis.confidence),r+=8,e.furnitureDetection.detected&&(t+=12*e.furnitureDetection.confidence),r+=12,e.textureAnalysis.hasIndoorTextures&&(t+=8*e.textureAnalysis.confidence),r+=8,e.colorAnalysis.hasIndoorColors&&(t+=7*e.colorAnalysis.confidence),r+=7,e.perspectiveAnalysis.hasIndoorPerspective&&(t+=5*e.perspectiveAnalysis.confidence),r+=5,e.depthAnalysis.hasIndoorDepth&&(t+=5*e.depthAnalysis.confidence),e.overallScore=t/(r+=5)*100;let l=e.overallScore>37,s=e.wallDetection.detected||e.floorDetection.detected||e.cornersDetection.detected||e.lightingAnalysis.isIndoorLighting||e.furnitureDetection.detected;return l&&s},em=e=>{let{data:t,width:r,height:l}=e,s=0,a=0;for(let e=10;e<r-10;e+=8){let o=0,n=null;for(let s=10;s<l-10;s+=8){let l=(s*r+e)*4,i=(t[l]+t[l+1]+t[l+2])/3;null!==n&&30>Math.abs(i-n)&&o++,n=i;let c=t[l];ek(c,t[l+1],t[l+2])&&a++}o>l/8*.6&&s++}let o=0;for(let e=.2*l;e<.8*l;e+=15){let l=0;for(let s=10;s<r-10;s+=10){let a=((e-5)*r+s)*4,o=((e+5)*r+s)*4;a>=0&&o<t.length&&Math.abs((t[a]+t[a+1]+t[a+2])/3-(t[o]+t[o+1]+t[o+2])/3)>25&&l++}l>r/10*.3&&o++}let n=s/(r/8)*.5+a/(r*l/64)*.3+o/10*.2;return{detected:n>.3,confidence:Math.min(n,1),verticalLines:s,wallTextures:a,horizontalBoundaries:o}},eh=e=>{let{data:t,width:r,height:l}=e,s=Math.floor(.6*l),a=0,o=0,n=0;for(let e=s;e<l-5;e+=6)for(let l=5;l<r-5;l+=8){let s=(e*r+l)*4,i=t[s],c=t[s+1],d=t[s+2];eA(i,c,d)&&a++;let m=(e*r+(l+8))*4;m<t.length&&25>Math.abs((i+c+d)/3-(t[m]+t[m+1]+t[m+2])/3)&&o++,n++}let i=a/n*.7+o/n*.3;return{detected:i>.25,confidence:Math.min(2*i,1),floorTextures:a,horizontalPatterns:o}},ex=e=>{let{data:t,width:r,height:l}=e,s=Math.floor(.4*l),a=0,o=0,n=0;for(let e=5;e<s;e+=8)for(let s=5;s<r-5;s+=8){let i=(e*r+s)*4,c=t[i],d=t[i+1],m=t[i+2];eF(c,d,m)&&a++;let h=0;for(let a=-4;a<=4;a+=4)for(let o=-4;o<=4;o+=4){let n=s+a,i=e+o;if(n>=0&&n<r&&i>=0&&i<l){let e=(i*r+n)*4;20>Math.abs((t[e]+t[e+1]+t[e+2])/3-(c+d+m)/3)&&h++}}h>=6&&o++,n++}let i=a/n*.6+o/n*.4;return{detected:i>.2,confidence:Math.min(2.5*i,1),ceilingTextures:a,uniformAreas:o}},ef=e=>{let{data:t,width:r,height:l}=e,s=0;return[{x:0,y:0,w:.3*r,h:.3*l},{x:.7*r,y:0,w:.3*r,h:.3*l},{x:0,y:.7*l,w:.3*r,h:.3*l},{x:.7*r,y:.7*l,w:.3*r,h:.3*l}].forEach(e=>{let a=0;for(let s=0;s<20;s++){let s=e.x+Math.random()*e.w,o=e.y+Math.random()*e.h;s>=5&&s<r-5&&o>=5&&o<l-5&&(a+=eu(t,r,l,Math.floor(s),Math.floor(o)))}a/20>.3&&s++}),{detected:s>=2,confidence:s/4,cornersFound:s}},eu=(e,t,r,l,s)=>{let a=(s*t+l)*4,o=(e[a]+e[a+1]+e[a+2])/3,n=0,i=[];return[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]].forEach(([a,c])=>{let d=l+3*a,m=s+3*c;if(d>=0&&d<t&&m>=0&&m<r){let r=(m*t+d)*4,l=Math.abs(o-(e[r]+e[r+1]+e[r+2])/3);i.push(l),l>30&&n++}}),n>=4?n/8:0},eg=e=>{let{data:t,width:r,height:l}=e,s=0;for(let e=.1*l;e<.9*l;e+=12)for(let a=10;a<r-40;a+=12)ep(t,r,l,a,e)>.5&&s++;return{detected:s>0,confidence:Math.min(s/3,1),doorShapes:s}},ep=(e,t,r,l,s)=>{if(l+30>=t||s+60>=r)return 0;let a=0,o=0,n=0;for(let r=s;r<s+60;r+=6)for(let i=l;i<l+30;i+=6){let c=(r*t+i)*4,d=(e[c]+e[c+1]+e[c+2])/3;d<80&&a++,(i===l||i===l+30-6||r===s||r===s+60-6)&&d>100&&o++,n++}return a/n*.7+o/(.3*n)*.3},eb=e=>{let{data:t,width:r,height:l}=e,s=0;for(let e=.1*l;e<.7*l;e+=15)for(let a=10;a<r-50;a+=15)ey(t,r,l,a,e)>.4&&s++;return{detected:s>0,confidence:Math.min(s/2,1),windowShapes:s}},ey=(e,t,r,l,s)=>{if(l+50>=t||s+40>=r)return 0;let a=0,o=0;for(let r=s+5;r<s+40-5;r+=6)for(let s=l+5;s<l+50-5;s+=6){let l=(r*t+s)*4;(e[l]+e[l+1]+e[l+2])/3>150&&a++,o++}return a/o},ev=e=>{let{data:t}=e,r=0,l=0,s=0,a=0;for(let e=0;e<t.length;e+=12){let o=(t[e]+t[e+1]+t[e+2])/3;o>180?r++:o<70?l++:s++,a++}let o=r/a,n=l/a,i=s/a,c=o>.05&&o<.4&&n>.1&&n<.5&&i>.3;return{isIndoorLighting:c,confidence:c?.8:.2,brightRatio:o,darkRatio:n,mediumRatio:i}},ew=e=>{let{data:t,width:r,height:l}=e,s=0,a=0,o=0;for(let e=10;e<l-10;e+=10)for(let l=10;l<r-10;l+=10){let n=(e*r+l)*4,i=(t[n]+t[n+1]+t[n+2])/3;if(i<60){s++;let o=(e*r+(l+10))*4;o<t.length&&(t[o]+t[o+1]+t[o+2])/3>i+40&&a++}o++}let n=s/o,i=a/o,c=n>.05&&n<.4&&i>.02;return{hasIndoorShadows:c,confidence:c?.7:.3,shadowRatio:n,transitionRatio:i}},ej=e=>{let{data:t,width:r,height:l}=e,s=0,a=0,o=0;for(let e=.3*l;e<l-20;e+=15)for(let n=20;n<r-20;n+=15){let i=(e*r+n)*4,c=t[i];eI(c,t[i+1],t[i+2])&&a++,eL(t,r,l,n,e,25,20)&&s++,o++}let n=a/o*.6+s/o*.4;return{detected:n>.15,confidence:Math.min(3*n,1),furnitureColors:a,furnitureShapes:s}},eN=e=>{let{data:t,width:r,height:l}=e,s=0,a=0,o=0;for(let e=10;e<l-10;e+=12)for(let n=10;n<r-10;n+=12){let i=eS(t,r,l,n,e);"smooth"===i?s++:"patterned"===i&&a++,o++}let n=s/o,i=a/o,c=n>.2||i>.1;return{hasIndoorTextures:c,confidence:c?.6:.4,smoothRatio:n,patternedRatio:i}},eS=(e,t,r,l,s)=>{let a=0,o=0,n=[];for(let a=-3;a<=3;a+=3)for(let i=-3;i<=3;i+=3){let c=l+i,d=s+a;if(c>=0&&c<t&&d>=0&&d<r){let r=(d*t+c)*4,l=(e[r]+e[r+1]+e[r+2])/3;n.push(l),o++}}if(o>0){let e=n.reduce((e,t)=>e+t,0)/o;a=n.reduce((t,r)=>t+Math.pow(r-e,2),0)/o}return a<200?"smooth":a>800?"rough":"patterned"},eM=e=>{let{data:t}=e,r=0,l=0,s=0,a=0;for(let e=0;e<t.length;e+=16){let o=t[e],n=t[e+1],i=t[e+2];eT(o,n,i)?r++:ez(o,n,i)?l++:e$(o,n,i)&&s++,a++}let o=r/a,n=l/a,i=s/a,c=o>.3&&i<.3;return{hasIndoorColors:c,confidence:c?.7:.3,neutralRatio:o,warmRatio:n,vibrantRatio:i}},eR=e=>{let{data:t,width:r,height:l}=e,s=0;for(let e=.3*l;e<.7*l;e+=20){let l=0;for(let s=10;s<r-10;s+=10){let a=(e*r+s)*4,o=(e*r+(s+10))*4;o<t.length&&Math.abs((t[a]+t[a+1]+t[a+2])/3-(t[o]+t[o+1]+t[o+2])/3)>25&&l++}l>r/10*.3&&s++}let a=s>=2;return{hasIndoorPerspective:a,confidence:a?.6:.4,horizontalLines:s}},eD=e=>{let{data:t,width:r,height:l}=e,s=0;Math.abs(eU(t,r,l,0,.7*l,r,l)-eU(t,r,l,0,0,r,.3*l))>20&&s++;let a=0;for(let e=.2*l;e<.8*l;e+=25)for(let s=.2*r;s<.8*r;s+=25)eO(t,r,l,s,e)&&a++;a>2&&s++;let o=s>=1;return{hasIndoorDepth:o,confidence:o?.5:.3,depthCues:s}},eC=e=>{let{data:t,width:r,height:l}=e,s=0,a=0;for(let e=20;e<l-40;e+=30)for(let o=20;o<r-40;o+=30){let n=eE(t,r,l,o,e);n>10&&n<.3*r&&s++,a++}let o=s/a,n=o>.3;return{hasAppropriateScale:n,confidence:n?.5:.3,scaleRatio:o}},ek=(e,t,r)=>{let l=(e+t+r)/3,s=Math.max(e,t,r)-Math.min(e,t,r);return l>120&&l<240&&s<40},eA=(e,t,r)=>{let l=e>80&&e<180&&t>60&&t<140&&r>30&&r<100,s=30>Math.abs(e-t)&&30>Math.abs(t-r)&&(e+t+r)/3>100,a=Math.max(e,t,r)-Math.min(e,t,r)>20&&(e+t+r)/3>60;return l||s||a},eF=(e,t,r)=>{let l=Math.max(e,t,r)-Math.min(e,t,r);return(e+t+r)/3>180&&l<30},eI=(e,t,r)=>{let l=e>60&&e<160&&t>40&&t<120&&r>20&&r<80,s=Math.max(e,t,r)-Math.min(e,t,r)>15&&(e+t+r)/3>50,a=e>80&&e<140&&t>50&&t<100&&r>30&&r<70;return l||s||a},eT=(e,t,r)=>{let l=(e+t+r)/3;return 30>Math.max(Math.abs(e-l),Math.abs(t-l),Math.abs(r-l))&&l>60&&l<200},ez=(e,t,r)=>e>t&&e>r&&e>100,e$=(e,t,r)=>Math.max(e,t,r)-Math.min(e,t,r)>60,eU=(e,t,r,l,s,a,o)=>{let n=0,i=0;for(let c=s;c<o;c+=5)for(let s=l;s<a;s+=5)if(s>=0&&s<t&&c>=0&&c<r){let r=(c*t+s)*4;n+=(e[r]+e[r+1]+e[r+2])/3,i++}return i>0?n/i:0},eO=(e,t,r,l,s)=>{let a=0;for(let o=-8;o<=8;o+=4)for(let n=-8;n<=8;n+=4){let i=l+n,c=s+o;if(i>=0&&i<t&&c>=0&&c<r){let r=(c*t+i)*4,o=(s*t+l)*4;Math.abs((e[r]+e[r+1]+e[r+2])/3-(e[o]+e[o+1]+e[o+2])/3)>30&&a++}}return a>8},eE=(e,t,r,l,s)=>{let a=new Set,o=[[l,s]],n=(s*t+l)*4,i=(e[n]+e[n+1]+e[n+2])/3,c=0;for(;o.length>0&&c<100;){let[l,s]=o.pop(),n=`${l},${s}`;if(a.has(n)||l<0||l>=t||s<0||s>=r)continue;a.add(n);let d=(s*t+l)*4;25>Math.abs((e[d]+e[d+1]+e[d+2])/3-i)&&(c++,o.push([l+1,s],[l-1,s],[l,s+1],[l,s-1]))}return c},eL=(e,t,r,l,s,a,o)=>{if(l+a>=t||s+o>=r)return!1;let n=0,i=0;for(let r=0;r<a;r+=3){let a=(s*t+(l+r))*4,c=((s+o)*t+(l+r))*4;c<e.length&&(20>Math.abs((e[a]+e[a+1]+e[a+2])/3-(e[c]+e[c+1]+e[c+2])/3)&&n++,i++)}for(let r=0;r<o;r+=3){let o=((s+r)*t+l)*4,c=((s+r)*t+(l+a))*4;c<e.length&&(20>Math.abs((e[o]+e[o+1]+e[o+2])/3-(e[c]+e[c+1]+e[c+2])/3)&&n++,i++)}return i>0&&n/i>.6},eP=async e=>{let r=e.target.files[0];if(r&&("image/jpeg"===r.type||"image/png"===r.type)&&r.size<=0xa00000){V(!0),G(null);try{let e=await ei(r),l=URL.createObjectURL(r);e?(y(r),w(l),Z(r),Y(l),m.oR.success(t("roomDetected"))):(G(t("invalidRoomImage")),y(r),w(l),Z(r),Y(l),m.oR.error(t("invalidRoomImage"))),await ea(r),console.log("File uploaded and saved:",r.name)}catch(t){console.error("Room validation error:",t);let e=URL.createObjectURL(r);y(r),w(e),Z(r),Y(e),G(null),await ea(r)}V(!1)}else m.oR.error(t("invalidFileFormat"))},e_=async(e,t,l,s)=>{try{let l={roomType:e,direction:t,userInfo:{gender:S,birthDateTime:`${R}-${C.padStart(2,"0")}-${A.padStart(2,"0")}T${I.padStart(2,"0")}:00`},hasUploadedImage:!!r,imageFileName:r?.name||null,analysisResult:s,locale:pathname.split("/")[1]||"zh-TW",timeSpentOnPage:Math.round((Date.now()-(window.pageStartTime||Date.now()))/1e3),referrer:document.referrer,sessionId:sessionStorage.getItem("ga_session_id")},a=await fetch("/api/track-free-report-generation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});if(a.ok){let e=await a.json();console.log("✅ Free report generation tracked:",e),e.totalGenerated>1?m.oR.success(`報告生成成功！這是您的第 ${e.totalGenerated} 份免費報告。`):m.oR.success("首份免費報告生成成功！")}}catch(e){console.error("Error tracking free report generation:",e)}};return(0,l.jsxs)("div",{className:"flex flex-col items-center justify-start w-full px-4 py-6 text-center mb-30 sm:px-6 md:px-8 lg:px-0",style:{fontFamily:'"Noto Serif TC", serif'},children:[(0,l.jsx)("h1",{className:"mb-4 text-xl font-normal mt-10 mb-30 text-[#004f44] sm:text-2xl md:text-3xl lg:text-4xl xl:text-5xl leading-tight sm:leading-normal",children:t("title")}),(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center w-full max-w-6xl gap-6 md:flex-row md:items-start lg:gap-8",children:[(0,l.jsxs)("div",{className:"w-full md:flex-1 md:max-w-5xl",children:[(0,l.jsxs)("div",{className:"h-48 sm:h-56 md:h-64 lg:h-80 rounded-lg bg-[#f7fffd] border-[#25826c] border-dashed border-2 box-border flex flex-col items-center justify-center p-4 sm:p-6 md:p-8",children:[J?(0,l.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,l.jsx)("div",{className:"w-8 h-8 border-2 border-[#318161] border-t-transparent rounded-full animate-spin"}),(0,l.jsx)("p",{className:"text-sm text-[#004f44]",children:t("validatingImage")})]}):(0,l.jsx)("label",{className:"flex items-center justify-center w-full h-full cursor-pointer",htmlFor:"file-upload",children:(0,l.jsxs)("div",{className:"flex flex-col items-center justify-center w-full gap-3 sm:gap-4 md:gap-6",children:[(0,l.jsx)(a.default,{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 lg:w-16 lg:h-16",loading:"lazy",width:66,height:66,alt:"",src:"/images/report/materialsymbolsupload.svg"}),(0,l.jsx)("h3",{className:"text-sm font-normal text-center sm:text-base md:text-lg lg:text-xl xl:text-2xl text-[#004f44] px-2",children:t("uploadAction")}),(0,l.jsx)("div",{className:"text-xs text-center sm:text-sm md:text-base lg:text-lg text-[#666] px-2",children:t("fileFormat")}),(0,l.jsx)("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-white transition-all duration-200 bg-transparent border-none rounded-lg cursor-pointer sm:px-6 sm:py-3 md:text-base lg:text-lg bg-gradient-to-r from-[#318161] to-[#318177] hover:scale-105 active:scale-95",onClick:()=>K.current?.click(),children:t("browseButton")})]})}),(0,l.jsx)("input",{className:"hidden",type:"file",id:"file-upload",accept:"image/jpeg,image/png",ref:K,onChange:eP,disabled:J})]}),(0,l.jsx)("div",{className:"mt-3 text-xs text-left sm:text-sm md:text-base text-[#004f44] px-1",children:t("disclaimer")})]}),r&&(0,l.jsxs)("div",{className:"flex flex-col items-center w-full gap-4 mt-4 md:items-end md:w-auto md:mt-0",children:[(0,l.jsxs)("div",{className:`flex items-center gap-3 p-3 border rounded-lg shadow-sm sm:gap-4 ${q?"bg-red-50 border-red-200":"bg-white border-gray-100"}`,children:[v&&(0,l.jsx)(a.default,{className:"object-cover w-12 h-12 rounded sm:w-14 sm:h-14 md:w-16 md:h-16",loading:"lazy",width:64,height:64,alt:"",src:v,onError:e=>{console.error("Image failed to load:",v),console.log("File object:",r)}}),(0,l.jsxs)("div",{className:"flex flex-col justify-center min-w-0",children:[(0,l.jsx)("div",{className:"text-sm font-medium truncate sm:text-base text-[#004f44] max-w-32 sm:max-w-40",children:r.name}),(0,l.jsxs)("div",{className:"text-xs text-gray-500 sm:text-sm",children:[(r.size/1024/1024).toFixed(2)," MB"]}),q&&(0,l.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,l.jsx)("svg",{className:"flex-shrink-0 w-3 h-3 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,l.jsx)("span",{className:"text-xs font-medium text-red-600 sm:text-sm",children:q})]})]})]}),(0,l.jsx)("button",{onClick:()=>{v&&v.startsWith("blob:")&&URL.revokeObjectURL(v),y(null),w(null),Z(null),Y(null),G(null),eo(),K.current&&(K.current.value="")},className:`flex items-center justify-center w-8 h-8 transition-colors rounded-full sm:w-10 sm:h-10 ${q?"bg-red-100 hover:bg-red-200":"bg-red-50 hover:bg-red-100"}`,children:(0,l.jsx)(a.default,{className:"w-4 h-4 sm:w-5 sm:h-5",loading:"lazy",width:20,height:20,alt:t("close"),src:"/images/linemdtrash.png"})})]})]}),r&&!q&&(0,l.jsx)("div",{className:"flex justify-center w-full mt-8 sm:mt-10",children:(0,l.jsx)("button",{type:"button",className:"w-full max-w-xs px-6 py-3 text-base font-medium text-white transition-all duration-200 rounded-lg shadow-lg sm:w-auto sm:px-8 sm:py-4 sm:text-lg bg-gradient-to-r from-[#7BB8A9] to-[#318177] hover:scale-105 hover:shadow-xl active:scale-95",onClick:()=>N(!0),children:t("nextStep")})}),r&&q&&(0,l.jsx)("div",{className:"flex justify-center w-full mt-8 sm:mt-10",children:(0,l.jsxs)("div",{className:"flex items-center max-w-md gap-3 px-4 py-3 text-sm text-red-700 border border-red-200 rounded-lg bg-red-50 sm:text-base",children:[(0,l.jsx)("svg",{className:"flex-shrink-0 w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,l.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,l.jsxs)("div",{children:[(0,l.jsx)("p",{className:"font-medium",children:t("uploadDifferentImage")}),(0,l.jsx)("p",{className:"mt-1 text-xs text-red-600",children:t("roomImageRequired")})]})]})}),j&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("div",{className:"fixed inset-0 z-40 bg-opacity-30 backdrop-blur-sm",onClick:()=>N(!1)}),(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,l.jsxs)("div",{className:"relative w-full max-w-md max-h-[90vh] overflow-y-auto bg-white rounded-xl shadow-2xl",children:[(0,l.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between p-4 bg-white border-b rounded-t-xl sm:p-6",children:[(0,l.jsx)("h2",{className:"text-lg font-bold text-center text-[#004f44] sm:text-xl",children:t("modalTitle")}),(0,l.jsx)("button",{className:"text-2xl text-gray-400 transition-colors hover:text-gray-600",onClick:()=>N(!1),"aria-label":t("close"),children:"\xd7"})]}),(0,l.jsxs)("div",{className:"p-4 space-y-4 sm:p-6 sm:space-y-6",children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-left text-[#004f44] sm:text-base",children:t("gender")}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-base",value:S,onChange:e=>M(e.target.value),children:[(0,l.jsx)("option",{value:"",children:t("genderSelect")}),(0,l.jsx)("option",{value:"male",children:t("male")}),(0,l.jsx)("option",{value:"female",children:t("female")})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-left text-[#004f44] sm:text-base",children:t("birthDateTime")}),(0,l.jsxs)("div",{className:"grid grid-cols-4 gap-2 sm:gap-3",children:[(0,l.jsxs)("select",{className:"px-2 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-sm",value:R,onChange:e=>D(e.target.value),children:[(0,l.jsx)("option",{value:"",children:t("year")}),h.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsxs)("select",{className:"px-2 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-sm",value:C,onChange:e=>k(e.target.value),children:[(0,l.jsx)("option",{value:"",children:t("month")}),x.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsxs)("select",{className:"px-2 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-sm",value:A,onChange:e=>F(e.target.value),children:[(0,l.jsx)("option",{value:"",children:t("day")}),f.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]}),(0,l.jsxs)("select",{className:"px-2 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-sm",value:I,onChange:e=>T(e.target.value),children:[(0,l.jsx)("option",{value:"",children:t("hour")}),u.map(e=>(0,l.jsx)("option",{value:e,children:e},e))]})]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-left text-[#004f44] sm:text-base",children:t("roomType")}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-base",value:z,onChange:e=>$(e.target.value),children:[(0,l.jsx)("option",{value:"",children:t("roomTypeSelect")}),er.map(e=>(0,l.jsx)("option",{value:e,children:t(`roomTypes.${e}`)},e))]})]}),(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium text-left text-[#004f44] sm:text-base",children:t("direction")}),(0,l.jsxs)("select",{className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-base",value:U,onChange:e=>O(e.target.value),children:[(0,l.jsx)("option",{value:"",children:t("directionSelect")}),el.map(e=>(0,l.jsx)("option",{value:e,children:t(`directions.${e}`)},e))]})]})]}),(0,l.jsxs)("div",{className:"sticky bottom-0 z-10 p-4 space-y-3 bg-white border-t rounded-b-xl sm:p-6",children:[(0,l.jsx)("button",{className:"w-full py-3 text-base font-bold text-white transition-all duration-200 rounded-lg shadow-lg sm:text-lg bg-gradient-to-r from-[#7BB8A9] to-[#318177] hover:scale-105 hover:shadow-xl active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",onClick:en,disabled:B||"loading"===et,children:B?t("calculating"):"loading"===et?t("checkingAuth")||"Checking...":t("startAnalysis")}),(0,l.jsx)("button",{className:"w-full px-3 py-2 text-sm text-gray-500 transition-colors bg-transparent rounded hover:text-gray-700 hover:bg-gray-50",onClick:()=>{N(!1)},children:t("back")})]})]})})]}),P&&(0,l.jsx)("div",{className:"w-full max-w-2xl p-4 mt-6 text-sm text-gray-800 whitespace-pre-line bg-gray-100 rounded-lg sm:text-base",children:P}),B&&(0,l.jsx)("div",{className:"mt-6 text-sm text-blue-500 sm:text-base",children:t("processing")})]})}}};