{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/lib/mongoose.js"],"sourcesContent":["import mongoose from 'mongoose';\n\n// 使用本地MongoDB服务\nconst MONGODB_URI = process.env.MONGODB_URI;\n\nif (!MONGODB_URI) {\n    throw new Error(\n        'Please define the MONGODB_URI environment variable inside .env'\n    );\n}\n\n/**\n * Global is used here to maintain a cached connection across hot reloads\n * in development. This prevents connections growing exponentially\n * during API Route usage.\n */\nlet cached = global.mongoose;\n\nif (!cached) {\n    cached = global.mongoose = { conn: null, promise: null };\n}\n\nasync function dbConnect() {\n    if (cached.conn) {\n        return cached.conn;\n    }\n\n    if (!cached.promise) {\n        const opts = {\n            // bufferCommands: false,\n            serverSelectionTimeoutMS: 30000,\n            socketTimeoutMS: 30000\n        };\n\n        cached.promise = mongoose.connect(MONGODB_URI, opts)\n            .then((mongoose) => {return mongoose;\n            })\n            .catch((e) => {throw e;\n            });\n    }\n\n    try {\n        cached.conn = await cached.promise;\n    } catch (e) {cached.promise = null;\n        throw e;\n    }\n\n    return cached.conn;\n}\n\nexport default dbConnect;\nexport { dbConnect as connectDB }; "],"names":[],"mappings":";;;;AAAA;;AAEA,gBAAgB;AAChB,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IACd,MAAM,IAAI,MACN;AAER;AAEA;;;;CAIC,GACD,IAAI,SAAS,OAAO,QAAQ;AAE5B,IAAI,CAAC,QAAQ;IACT,SAAS,OAAO,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAC3D;AAEA,eAAe;IACX,IAAI,OAAO,IAAI,EAAE;QACb,OAAO,OAAO,IAAI;IACtB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACjB,MAAM,OAAO;YACT,yBAAyB;YACzB,0BAA0B;YAC1B,iBAAiB;QACrB;QAEA,OAAO,OAAO,GAAG,yGAAA,CAAA,UAAQ,CAAC,OAAO,CAAC,aAAa,MAC1C,IAAI,CAAC,CAAC;YAAc,OAAO;QAC5B,GACC,KAAK,CAAC,CAAC;YAAO,MAAM;QACrB;IACR;IAEA,IAAI;QACA,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACtC,EAAE,OAAO,GAAG;QAAC,OAAO,OAAO,GAAG;QAC1B,MAAM;IACV;IAEA,OAAO,OAAO,IAAI;AACtB;uCAEe","debugId":null}},
    {"offset": {"line": 122, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/models/ChatHistory.js"],"sourcesContent":["import mongoose from \"mongoose\";\n\n// Clear cached model to ensure schema updates take effect\nif (mongoose.models.ChatHistory) {\n\tdelete mongoose.models.ChatHistory;\n}\n\nconst ChatHistorySchema = new mongoose.Schema(\n\t{\n\t\t// Conversation identifiers\n\t\tconversationId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tindex: true,\n\t\t},\n\t\tsessionId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tindex: true,\n\t\t},\n\t\tuserId: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t\tindex: true,\n\t\t},\n\t\tuserEmail: {\n\t\t\ttype: String,\n\t\t\trequired: false,\n\t\t},\n\n\t\t// Conversation metadata\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\trequired: true,\n\t\t},\n\t\tprimaryConcern: {\n\t\t\ttype: String,\n\t\t\tenum: [\n\t\t\t\t\"工作\",\n\t\t\t\t\"感情\",\n\t\t\t\t\"財運\",\n\t\t\t\t\"子女\",\n\t\t\t\t\"人際關係\",\n\t\t\t\t\"健康\",\n\t\t\t\t\"因緣\",\n\t\t\t\t\"風水佈局\",\n\t\t\t\t\"其他\",\n\t\t\t],\n\t\t\trequired: false,\n\t\t},\n\t\tconversationState: {\n\t\t\ttype: String,\n\t\t\tenum: [\n\t\t\t\t\"initial\",\n\t\t\t\t\"ai_analyzing\",\n\t\t\t\t\"birthday_collection\",\n\t\t\t\t\"asking_detailed_report\",\n\t\t\t\t\"ready_for_detailed_report\",\n\t\t\t\t\"collecting_payment_info\",\n\t\t\t\t\"completed\",\n\t\t\t],\n\t\t\tdefault: \"initial\",\n\t\t},\n\n\t\t// Messages array\n\t\tmessages: [\n\t\t\t{\n\t\t\t\tmessageId: {\n\t\t\t\t\ttype: String,\n\t\t\t\t\trequired: true,\n\t\t\t\t},\n\t\t\t\trole: {\n\t\t\t\t\ttype: String,\n\t\t\t\t\tenum: [\"user\", \"assistant\"],\n\t\t\t\t\trequired: true,\n\t\t\t\t},\n\t\t\t\tcontent: {\n\t\t\t\t\ttype: String,\n\t\t\t\t\trequired: true,\n\t\t\t\t},\n\t\t\t\ttimestamp: {\n\t\t\t\t\ttype: Date,\n\t\t\t\t\tdefault: Date.now,\n\t\t\t\t},\n\t\t\t\taiAnalysis: {\n\t\t\t\t\tdetectedTopic: String,\n\t\t\t\t\tisWithinScope: Boolean,\n\t\t\t\t\tconfidence: Number,\n\t\t\t\t\tspecificProblem: String,\n\t\t\t\t},\n\t\t\t\tsystemType: {\n\t\t\t\t\ttype: String,\n\t\t\t\t\tdefault: \"smart-chat2\",\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\n\t\t// Conversation statistics\n\t\tstats: {\n\t\t\ttotalMessages: {\n\t\t\t\ttype: Number,\n\t\t\t\tdefault: 0,\n\t\t\t},\n\t\t\tlastActivity: {\n\t\t\t\ttype: Date,\n\t\t\t\tdefault: Date.now,\n\t\t\t},\n\t\t\tuserEngagement: {\n\t\t\t\ttype: Number,\n\t\t\t\tmin: 0,\n\t\t\t\tmax: 1,\n\t\t\t\tdefault: 0.5,\n\t\t\t},\n\t\t},\n\n\t\t// Context preservation\n\t\tcontext: {\n\t\t\ttopics: [String],\n\t\t\tlastTopic: String,\n\t\t\tconversationSummary: String,\n\t\t\temotionalState: String,\n\t\t},\n\n\t\t// User data (if collected)\n\t\tuserData: {\n\t\t\tuserBirthday: Date,\n\t\t\tpartnerBirthday: Date,\n\t\t\tgender: String,\n\t\t\tpartnerGender: String,\n\t\t\trelationshipType: String,\n\t\t},\n\n\t\t// Status flags\n\t\tisActive: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: true,\n\t\t},\n\t\tisArchived: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false,\n\t\t},\n\t},\n\t{\n\t\ttimestamps: true,\n\t\tindexes: [\n\t\t\t{ userId: 1, conversationId: 1 },\n\t\t\t{ userId: 1, isActive: 1 },\n\t\t\t{ sessionId: 1 },\n\t\t\t{ \"stats.lastActivity\": -1 },\n\t\t\t{ createdAt: -1 },\n\t\t],\n\t}\n);\n\n// Instance methods\nChatHistorySchema.methods.addMessage = function (\n\trole,\n\tcontent,\n\taiAnalysis = null\n) {\n\tconst messageId = `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n\tthis.messages.push({\n\t\tmessageId,\n\t\trole,\n\t\tcontent,\n\t\ttimestamp: new Date(),\n\t\taiAnalysis,\n\t\tsystemType: \"smart-chat2\",\n\t});\n\n\tthis.stats.totalMessages = this.messages.length;\n\tthis.stats.lastActivity = new Date();\n\n\treturn messageId;\n};\n\nChatHistorySchema.methods.updateContext = function (\n\ttopic,\n\temotionalState = null\n) {\n\tif (topic && !this.context.topics.includes(topic)) {\n\t\tthis.context.topics.push(topic);\n\t}\n\n\tif (topic) {\n\t\tthis.context.lastTopic = topic;\n\t}\n\n\tif (emotionalState) {\n\t\tthis.context.emotionalState = emotionalState;\n\t}\n};\n\nChatHistorySchema.methods.generateSummary = function () {\n\tconst messageCount = this.stats.totalMessages;\n\tconst primaryConcern = this.primaryConcern || \"一般諮詢\";\n\n\tif (messageCount === 0) {\n\t\treturn `剛開始的${primaryConcern}對話`;\n\t} else if (messageCount < 5) {\n\t\treturn `${primaryConcern}初步討論（${messageCount}輪）`;\n\t} else {\n\t\treturn `${primaryConcern}深入討論（${messageCount}輪）`;\n\t}\n};\n\nexport default mongoose.models.ChatHistory ||\n\tmongoose.model(\"ChatHistory\", ChatHistorySchema);\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 329, "column": 0}, "map": {"version":3,"sources":["file:///Users/michaelng/Desktop/HarmoniqFengShui/FengShuiLayout/src/app/api/conversation-history/route.js"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport connectMongo from \"@/lib/mongoose\";\nimport ChatHistory from \"@/models/ChatHistory\";\n\nexport async function GET(request) {\n\ttry {\n\t\tawait connectMongo();\n\n\t\tconst { searchParams } = new URL(request.url);\n\t\tconst userEmail = searchParams.get(\"userEmail\");\n\t\tconst userId = searchParams.get(\"userId\");\n\t\tconst limit = parseInt(searchParams.get(\"limit\")) || 20;\n\n\t\t// 支援兩種用戶識別方式：userEmail 或 userId\n\t\tconst userIdentifier = userEmail || userId;\n\t\tif (!userIdentifier) {\n\t\t\treturn NextResponse.json(\n\t\t\t\t{ error: \"用戶識別參數不能為空 (userEmail 或 userId)\" },\n\t\t\t\t{ status: 400 }\n\t\t\t);\n\t\t}\n\n\t\tconsole.log(\"📚 從ChatHistory獲取用戶對話歷史:\", userIdentifier);\n\n\t\t// 從ChatHistory獲取對話歷史\n\t\tconst query = userEmail ? { userEmail: userEmail } : { userId: userId };\n\n\t\tconst chatHistories = await ChatHistory.find(query)\n\t\t\t.sort({ updatedAt: -1 })\n\t\t\t.limit(limit)\n\t\t\t.lean();\n\n\t\tconsole.log(`📊 找到 ${chatHistories.length} 個對話記錄`);\n\n\t\tconst conversationSummaries = chatHistories.map((chat) => {\n\t\t\tconst lastMessage = chat.messages?.[chat.messages.length - 1];\n\t\t\tconst lastUserMessage = chat.messages\n\t\t\t\t?.filter((msg) => msg.role === \"user\")\n\t\t\t\t?.slice(-1)[0];\n\n\t\t\treturn {\n\t\t\t\tconversationId: chat.conversationId,\n\t\t\t\tsessionId: chat.sessionId || chat.conversationId,\n\t\t\t\ttitle:\n\t\t\t\t\tchat.title ||\n\t\t\t\t\tgenerateConversationTitle(\n\t\t\t\t\t\tchat.primaryConcern,\n\t\t\t\t\t\tlastUserMessage?.content\n\t\t\t\t\t),\n\t\t\t\tprimaryConcern: chat.primaryConcern || \"一般諮詢\",\n\t\t\t\tmessageCount: chat.messages?.length || 0,\n\t\t\t\tlastUpdated: chat.updatedAt,\n\t\t\t\tlastActivity: chat.updatedAt,\n\t\t\t\tconversationState: chat.conversationState,\n\t\t\t\tpreview: generatePreview(lastUserMessage?.content || \"\"),\n\t\t\t\thasDetailedHistory: true, // ChatHistory總是有詳細歷史\n\t\t\t\ttopics:\n\t\t\t\t\tchat.context?.topics ||\n\t\t\t\t\t[chat.primaryConcern].filter(Boolean),\n\t\t\t};\n\t\t});\n\n\t\treturn NextResponse.json({\n\t\t\tsuccess: true,\n\t\t\tuserIdentifier: userIdentifier,\n\t\t\ttotalConversations: conversationSummaries.length,\n\t\t\tconversations: conversationSummaries,\n\t\t});\n\t} catch (error) {\n\t\tconsole.error(\"❌ 獲取對話歷史失敗:\", error);\n\t\treturn NextResponse.json(\n\t\t\t{\n\t\t\t\terror: \"獲取對話歷史失敗\",\n\t\t\t\tdetails: error.message,\n\t\t\t},\n\t\t\t{ status: 500 }\n\t\t);\n\t}\n}\n\n// 輔助函數：生成對話標題 - 顯示實際用戶問題\nfunction generateConversationTitle(primaryConcern, lastMessage) {\n\t// 優先使用實際的用戶問題作為標題\n\tif (lastMessage && typeof lastMessage === \"string\" && lastMessage.trim()) {\n\t\t// 清理和截取用戶問題，用作標題\n\t\tconst cleanedMessage = lastMessage.replace(/\\s+/g, \" \").trim();\n\n\t\t// 如果消息太長，截取前40個字符並加上省略號\n\t\tif (cleanedMessage.length > 40) {\n\t\t\treturn cleanedMessage.substring(0, 40) + \"...\";\n\t\t}\n\n\t\treturn cleanedMessage;\n\t}\n\n\t// 備用方案：使用傳統的分類標題\n\tconst concernTitles = {\n\t\t感情: \"感情諮詢\",\n\t\t工作: \"工作運勢\",\n\t\t財運: \"財運分析\",\n\t\t健康: \"健康運勢\",\n\t\t人際: \"人際關係\",\n\t\t子女: \"子女運勢\",\n\t\t居家佈局: \"居家風水\",\n\t};\n\n\tif (primaryConcern && concernTitles[primaryConcern]) {\n\t\treturn concernTitles[primaryConcern];\n\t}\n\n\treturn \"風水諮詢\";\n}\n\n// 輔助函數：生成預覽文字\nfunction generatePreview(message) {\n\tif (!message) return \"暫無內容\";\n\n\t// 清理文字並截取前30個字符\n\tconst cleaned = message.replace(/\\s+/g, \" \").trim();\n\treturn cleaned.length > 30 ? cleaned.substring(0, 30) + \"...\" : cleaned;\n}\n\n// 輔助函數：提取話題標籤\nfunction extractTopics(primaryConcern, lastMessage) {\n\tconst topics = [];\n\n\t// 主要關注領域\n\tif (primaryConcern) {\n\t\ttopics.push(primaryConcern);\n\t}\n\n\t// 從訊息內容提取其他話題\n\tif (lastMessage) {\n\t\tconst topicKeywords = {\n\t\t\t感情: [\"感情\", \"愛情\", \"桃花\", \"姻緣\", \"戀愛\", \"分手\", \"結婚\"],\n\t\t\t工作: [\"工作\", \"事業\", \"職場\", \"升職\", \"跳槽\", \"創業\"],\n\t\t\t財運: [\"財運\", \"賺錢\", \"投資\", \"理財\", \"收入\", \"金錢\"],\n\t\t\t健康: [\"健康\", \"身體\", \"養生\", \"病痛\", \"醫療\"],\n\t\t\t人際: [\"人際\", \"朋友\", \"同事\", \"合作\", \"社交\"],\n\t\t\t子女: [\"子女\", \"孩子\", \"教育\", \"學習\", \"考試\"],\n\t\t\t居家: [\"居家\", \"房子\", \"搬家\", \"裝修\", \"佈局\"],\n\t\t\t八字: [\"八字\", \"命盤\", \"五行\", \"天干\", \"地支\"],\n\t\t};\n\n\t\tfor (const [topic, keywords] of Object.entries(topicKeywords)) {\n\t\t\tif (keywords.some((keyword) => lastMessage.includes(keyword))) {\n\t\t\t\tif (!topics.includes(topic)) {\n\t\t\t\t\ttopics.push(topic);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn topics.slice(0, 3); // 最多返回3個話題\n}\n\n// 輔助函數：獲取最後一條用戶消息 - 支持兩種數據格式\nfunction getLastUserMessage(lastMessage) {\n\tif (!lastMessage) return null;\n\n\t// 新格式：role/content\n\tif (lastMessage.role && lastMessage.content) {\n\t\treturn lastMessage.role === \"user\" ? lastMessage.content : null;\n\t}\n\n\t// 舊格式：userMessage/assistantMessage\n\tif (lastMessage.userMessage) {\n\t\treturn lastMessage.userMessage;\n\t}\n\n\treturn null;\n}\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAO;IAChC,IAAI;QACH,MAAM,CAAA,GAAA,wHAAA,CAAA,UAAY,AAAD;QAEjB,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,YAAY,aAAa,GAAG,CAAC;QACnC,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,aAAa;QAErD,gCAAgC;QAChC,MAAM,iBAAiB,aAAa;QACpC,IAAI,CAAC,gBAAgB;YACpB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACvB;gBAAE,OAAO;YAAkC,GAC3C;gBAAE,QAAQ;YAAI;QAEhB;QAEA,QAAQ,GAAG,CAAC,4BAA4B;QAExC,qBAAqB;QACrB,MAAM,QAAQ,YAAY;YAAE,WAAW;QAAU,IAAI;YAAE,QAAQ;QAAO;QAEtE,MAAM,gBAAgB,MAAM,8HAAA,CAAA,UAAW,CAAC,IAAI,CAAC,OAC3C,IAAI,CAAC;YAAE,WAAW,CAAC;QAAE,GACrB,KAAK,CAAC,OACN,IAAI;QAEN,QAAQ,GAAG,CAAC,CAAC,MAAM,EAAE,cAAc,MAAM,CAAC,MAAM,CAAC;QAEjD,MAAM,wBAAwB,cAAc,GAAG,CAAC,CAAC;YAChD,MAAM,cAAc,KAAK,QAAQ,EAAE,CAAC,KAAK,QAAQ,CAAC,MAAM,GAAG,EAAE;YAC7D,MAAM,kBAAkB,KAAK,QAAQ,EAClC,OAAO,CAAC,MAAQ,IAAI,IAAI,KAAK,SAC7B,MAAM,CAAC,EAAE,CAAC,EAAE;YAEf,OAAO;gBACN,gBAAgB,KAAK,cAAc;gBACnC,WAAW,KAAK,SAAS,IAAI,KAAK,cAAc;gBAChD,OACC,KAAK,KAAK,IACV,0BACC,KAAK,cAAc,EACnB,iBAAiB;gBAEnB,gBAAgB,KAAK,cAAc,IAAI;gBACvC,cAAc,KAAK,QAAQ,EAAE,UAAU;gBACvC,aAAa,KAAK,SAAS;gBAC3B,cAAc,KAAK,SAAS;gBAC5B,mBAAmB,KAAK,iBAAiB;gBACzC,SAAS,gBAAgB,iBAAiB,WAAW;gBACrD,oBAAoB;gBACpB,QACC,KAAK,OAAO,EAAE,UACd;oBAAC,KAAK,cAAc;iBAAC,CAAC,MAAM,CAAC;YAC/B;QACD;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YACxB,SAAS;YACT,gBAAgB;YAChB,oBAAoB,sBAAsB,MAAM;YAChD,eAAe;QAChB;IACD,EAAE,OAAO,OAAO;QACf,QAAQ,KAAK,CAAC,eAAe;QAC7B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACvB;YACC,OAAO;YACP,SAAS,MAAM,OAAO;QACvB,GACA;YAAE,QAAQ;QAAI;IAEhB;AACD;AAEA,yBAAyB;AACzB,SAAS,0BAA0B,cAAc,EAAE,WAAW;IAC7D,kBAAkB;IAClB,IAAI,eAAe,OAAO,gBAAgB,YAAY,YAAY,IAAI,IAAI;QACzE,iBAAiB;QACjB,MAAM,iBAAiB,YAAY,OAAO,CAAC,QAAQ,KAAK,IAAI;QAE5D,wBAAwB;QACxB,IAAI,eAAe,MAAM,GAAG,IAAI;YAC/B,OAAO,eAAe,SAAS,CAAC,GAAG,MAAM;QAC1C;QAEA,OAAO;IACR;IAEA,iBAAiB;IACjB,MAAM,gBAAgB;QACrB,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,IAAI;QACJ,MAAM;IACP;IAEA,IAAI,kBAAkB,aAAa,CAAC,eAAe,EAAE;QACpD,OAAO,aAAa,CAAC,eAAe;IACrC;IAEA,OAAO;AACR;AAEA,cAAc;AACd,SAAS,gBAAgB,OAAO;IAC/B,IAAI,CAAC,SAAS,OAAO;IAErB,gBAAgB;IAChB,MAAM,UAAU,QAAQ,OAAO,CAAC,QAAQ,KAAK,IAAI;IACjD,OAAO,QAAQ,MAAM,GAAG,KAAK,QAAQ,SAAS,CAAC,GAAG,MAAM,QAAQ;AACjE;AAEA,cAAc;AACd,SAAS,cAAc,cAAc,EAAE,WAAW;IACjD,MAAM,SAAS,EAAE;IAEjB,SAAS;IACT,IAAI,gBAAgB;QACnB,OAAO,IAAI,CAAC;IACb;IAEA,cAAc;IACd,IAAI,aAAa;QAChB,MAAM,gBAAgB;YACrB,IAAI;gBAAC;gBAAM;gBAAM;gBAAM;gBAAM;gBAAM;gBAAM;aAAK;YAC9C,IAAI;gBAAC;gBAAM;gBAAM;gBAAM;gBAAM;gBAAM;aAAK;YACxC,IAAI;gBAAC;gBAAM;gBAAM;gBAAM;gBAAM;gBAAM;aAAK;YACxC,IAAI;gBAAC;gBAAM;gBAAM;gBAAM;gBAAM;aAAK;YAClC,IAAI;gBAAC;gBAAM;gBAAM;gBAAM;gBAAM;aAAK;YAClC,IAAI;gBAAC;gBAAM;gBAAM;gBAAM;gBAAM;aAAK;YAClC,IAAI;gBAAC;gBAAM;gBAAM;gBAAM;gBAAM;aAAK;YAClC,IAAI;gBAAC;gBAAM;gBAAM;gBAAM;gBAAM;aAAK;QACnC;QAEA,KAAK,MAAM,CAAC,OAAO,SAAS,IAAI,OAAO,OAAO,CAAC,eAAgB;YAC9D,IAAI,SAAS,IAAI,CAAC,CAAC,UAAY,YAAY,QAAQ,CAAC,WAAW;gBAC9D,IAAI,CAAC,OAAO,QAAQ,CAAC,QAAQ;oBAC5B,OAAO,IAAI,CAAC;gBACb;YACD;QACD;IACD;IAEA,OAAO,OAAO,KAAK,CAAC,GAAG,IAAI,WAAW;AACvC;AAEA,6BAA6B;AAC7B,SAAS,mBAAmB,WAAW;IACtC,IAAI,CAAC,aAAa,OAAO;IAEzB,mBAAmB;IACnB,IAAI,YAAY,IAAI,IAAI,YAAY,OAAO,EAAE;QAC5C,OAAO,YAAY,IAAI,KAAK,SAAS,YAAY,OAAO,GAAG;IAC5D;IAEA,mCAAmC;IACnC,IAAI,YAAY,WAAW,EAAE;QAC5B,OAAO,YAAY,WAAW;IAC/B;IAEA,OAAO;AACR","debugId":null}}]
}