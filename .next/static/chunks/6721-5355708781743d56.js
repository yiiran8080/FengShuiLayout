"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6721],{40003:(e,t,o)=>{o.d(t,{A:()=>i});var r=o(95155),l=o(60388),a=o(66766),s=o(22346),n=o(17652);function i(){let e=(0,n.c3)("home.footer"),t={contact:[{name:e("contact"),href:"/customer/contact"}],law:[{name:e("privacy"),href:"/customer/privacy"},{name:e("terms"),href:"/customer/terms"}],social:[{icon:"/images/footer/Facebook.png",href:"https://www.facebook.com/profile.php?id=61578389876952"},{icon:"/images/footer/Instagram.png",href:"https://www.instagram.com/harmoniq_fengshui/"}]};return(0,r.jsx)("footer",{className:"bg-[#004F44] text-gray-300 px-5 md:px-0",style:{fontFamily:"Noto Serif TC, serif"},children:(0,r.jsxs)("div",{className:"container px-4 mx-auto py-25",children:[(0,r.jsxs)("div",{className:"justify-center item-center text-[50px] font-bold text-white text-center mb-10",children:[(0,r.jsx)("h1",{className:"text-white",style:{fontFamily:"Noto Serif TC, serif",fontWeight:400,fontSize:"46px"},children:e("title")}),(0,r.jsx)("p",{className:"mt-2 text-white",style:{fontFamily:"Noto Serif TC, serif",fontWeight:400,fontSize:"24px"},children:e("subtitle")}),(0,r.jsx)(l.N_,{href:"/price",className:"inline-flex items-center justify-center mt-10 transition-colors hover:bg-gray-50",style:{width:"172px",height:"50px",borderRadius:"20px",backgroundColor:"white",border:"1px solid #ccc",color:"#25826C",textDecoration:"none",fontSize:"18px",fontFamily:"Noto Serif TC, serif"},children:e("button")})]}),(0,r.jsxs)("div",{className:"flex flex-wrap items-start justify-between gap-5",children:[(0,r.jsxs)("div",{className:"flex gap-12",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"mb-4 text-xl font-semibold text-white",style:{fontFamily:"Noto Serif TC, serif"},children:e("consult")}),(0,r.jsx)("ul",{className:"space-y-2",children:t.contact.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)(l.N_,{href:e.href,className:"text-xl transition-colors hover:text-white",style:{fontFamily:"Noto Serif TC, serif"},children:e.name})},e.name))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"mb-4 text-xl font-semibold text-white",style:{fontFamily:"Noto Serif TC, serif"},children:e("law")}),(0,r.jsx)("ul",{className:"space-y-2",children:t.law.map(e=>(0,r.jsx)("li",{children:(0,r.jsx)(l.N_,{href:e.href,className:"text-xl transition-colors hover:text-white",style:{fontFamily:"Noto Serif TC, serif"},children:e.name})},e.name))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"mb-4 text-xl font-semibold text-white min-w-30",style:{fontFamily:"Noto Serif TC, serif"},children:e("focus")}),(0,r.jsx)("div",{className:"flex space-x-4",children:t.social.map(e=>e.href?(0,r.jsx)("a",{href:e.href,target:"_blank",rel:"noopener noreferrer",className:"transition-opacity hover:opacity-80",children:(0,r.jsx)(a.default,{src:e.icon,alt:"",width:30,height:30})},e.icon):(0,r.jsx)(a.default,{src:e.icon,alt:"",width:30,height:30},e.icon))})]})]}),(0,r.jsx)(s.Separator,{className:"mt-7.5"}),(0,r.jsx)("div",{className:"mt-5 font-semibold text-center border-t border-[#004F44] md:mt-10",style:{fontFamily:"Noto Serif TC, serif"},children:(0,r.jsxs)("p",{children:["\xa9 2025 HarmoniQ. ",e("copyright")]})})]})})}},69303:(e,t,o)=>{o.d(t,{ImageProvider:()=>n,l:()=>i});var r=o(95155),l=o(12115);let a=(0,l.createContext)(),s=(e,t,o)=>{let r=e.split(","),l=r[0].match(/:(.*?);/)[1],a=atob(r[1]),s=a.length,n=new Uint8Array(s);for(;s--;)n[s]=a.charCodeAt(s);return new File([n],t,{type:l})};function n(e){let{children:t}=e,[o,n]=(0,l.useState)(null),[i,c]=(0,l.useState)(null),[d,m]=(0,l.useState)(!1);(0,l.useEffect)(()=>((async()=>{if(!d){try{let e=sessionStorage.getItem("uploadPicFileData");if(e){let t=JSON.parse(e);if(!t.timestamp||Date.now()-t.timestamp<36e5){let e=s(t.base64,t.name,t.type),o=URL.createObjectURL(e);c(e),n(o),console.log("ImageContext: File restored from sessionStorage:",t.name),console.log("ImageContext: Preview URL created:",o)}else sessionStorage.removeItem("uploadPicFileData"),console.log("ImageContext: Cleared old file data from sessionStorage")}}catch(e){console.error("ImageContext: Error loading saved image data:",e),sessionStorage.removeItem("uploadPicFileData")}m(!0)}})(),()=>{o&&o.startsWith("blob:")&&URL.revokeObjectURL(o)}),[]);let h=e=>{o&&o.startsWith("blob:")&&URL.revokeObjectURL(o),n(e)};return(0,r.jsx)(a.Provider,{value:{preview:o,setPreview:h,file:i,setFile:e=>{c(e),!e&&o&&h(null)},isInitialized:d},children:t})}function i(){return(0,l.useContext)(a)}},91247:(e,t,o)=>{o.d(t,{A:()=>v});var r=o(95155),l=o(12115),a=o(66766);o(29190);var s=o(35695),n=o(69303),i=o(17652),c=o(45493),d=o(91599),m=o(38543);let h=Array.from({length:100},(e,t)=>1926+t),f=Array.from({length:12},(e,t)=>t+1),x=Array.from({length:31},(e,t)=>t+1),u=Array.from({length:24},(e,t)=>t+1),g={bedroom:"bedroom",livingRoom:"living_room",diningRoom:"dining_room",kitchen:"kitchen",bathroom:"bathroom",studyRoom:"study_room",balcony:"balcony",storageRoom:"storage_room"},p={north:"north",northEast:"northEast",east:"east",center:"center",southEast:"southEast",south:"south",southWest:"southWest",west:"west",northWest:"northWest"},b=e=>new Promise((t,o)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>o(e)}),y=(e,t,o)=>{let r=e.split(","),l=r[0].match(/:(.*?);/)[1],a=atob(r[1]),s=a.length,n=new Uint8Array(s);for(;s--;)n[s]=a.charCodeAt(s);return new File([n],t,{type:l})};function v(e){let{onResult:t}=e,o=(0,i.c3)("upload"),[v,w]=(0,l.useState)(null),[j,N]=(0,l.useState)(null),[S,R]=(0,l.useState)(!1),[C,D]=(0,l.useState)(""),[F,M]=(0,l.useState)(""),[k,I]=(0,l.useState)(""),[A,U]=(0,l.useState)(""),[T,L]=(0,l.useState)(""),[E,O]=(0,l.useState)(""),[P,z]=(0,l.useState)(""),[_,W]=(0,l.useState)(""),[B,J]=(0,l.useState)(""),[V,q]=(0,l.useState)(!1),[G,H]=(0,l.useState)(!1),[Q,K]=(0,l.useState)(null),[X,Y]=(0,l.useState)(!1),Z=(0,l.useRef)(null),$=(0,s.useRouter)(),{setPreview:ee,setFile:et}=(0,n.l)(),{data:eo,status:er}=(0,c.wV)(),el=Object.keys(g),ea=Object.keys(p),es=()=>{try{localStorage.setItem("uploadPicFormData",JSON.stringify({gender:C,year:F,month:k,day:A,hour:T,roomType:E,direction:P,validationError:Q})),console.log("Form data saved to localStorage")}catch(e){console.error("Error saving form data:",e)}},en=()=>{try{let e=localStorage.getItem("uploadPicFormData");if(e){let t=JSON.parse(e);D(t.gender||""),M(t.year||""),I(t.month||""),U(t.day||""),L(t.hour||""),O(t.roomType||""),z(t.direction||""),K(t.validationError||null),console.log("Form data loaded from localStorage")}}catch(e){console.error("Error loading form data:",e)}},ei=async e=>{try{if(e){let t={base64:await b(e),name:e.name,size:e.size,type:e.type,lastModified:e.lastModified,timestamp:Date.now()};sessionStorage.setItem("uploadPicFileData",JSON.stringify(t)),console.log("File data saved to sessionStorage:",e.name)}}catch(e){console.error("Error saving file data:",e)}},ec=async()=>{try{let e=sessionStorage.getItem("uploadPicFileData");if(e){let t=JSON.parse(e);if(!t.timestamp||Date.now()-t.timestamp<36e5){let e=y(t.base64,t.name,t.type),o=URL.createObjectURL(e);return w(e),N(o),et(e),ee(o),console.log("File restored from sessionStorage:",t.name),console.log("Preview URL created:",o),!0}sessionStorage.removeItem("uploadPicFileData"),console.log("Cleared old file data from sessionStorage")}}catch(e){console.error("Error loading file data:",e),sessionStorage.removeItem("uploadPicFileData")}return!1},ed=()=>{localStorage.removeItem("uploadPicFormData"),sessionStorage.removeItem("uploadPicFileData"),console.log("Saved data cleared")};async function em(){var e;let t=g[E],r=p[P];if("loading"===er){m.oR.info(o("checkingAuth")||"Checking authentication...");return}if("unauthenticated"===er||!(null==eo?void 0:null===(e=eo.user)||void 0===e?void 0:e.userId)){es(),v&&await ei(v);let e="/freereport?roomType=".concat(encodeURIComponent(t),"&direction=").concat(encodeURIComponent(r)),l="/auth/login?callbackUrl=".concat(encodeURIComponent(e));m.oR.info(o("redirectingToLogin")||"Please log in to continue..."),$.push(l);return}q(!0);try{let e="".concat(F,"-").concat(k.padStart(2,"0"),"-").concat(A.padStart(2,"0"),"T").concat(T.padStart(2,"0"),":00"),{status:o}=await (0,d.bE)("/api/users/".concat(eo.user.userId),{gender:C,birthDateTime:e});0===o?(await eq(t,r,{gender:C,birthDateTime:e},null),m.oR.success("保存成功！"),ed(),$.push("/freereport?roomType=".concat(encodeURIComponent(t),"&direction=").concat(encodeURIComponent(r)))):m.oR.error("保存失败！")}catch(e){m.oR.error("保存失败："+e),console.error("Error saving user info:",e)}finally{q(!1)}}(0,l.useEffect)(()=>((async()=>{!X&&(console.log("Initializing component, loading saved data..."),console.log("Session status:",er),en(),await ec()?console.log("File successfully restored from storage"):console.log("No saved file found"),Y(!0))})(),()=>{j&&j.startsWith("blob:")&&URL.revokeObjectURL(j)}),[]),(0,l.useEffect)(()=>{"loading"!==er&&X&&(async()=>{v||j||(console.log("Session loaded, rechecking saved file data..."),await ec()&&console.log("File restored after login"))})()},[er,X,v,j]),(0,l.useEffect)(()=>{X&&(C||F||k||A||T||E||P)&&es()},[C,F,k,A,T,E,P,Q,X]);let eh=e=>new Promise(t=>{let o=document.createElement("img");o.onload=()=>{let e=document.createElement("canvas"),r=e.getContext("2d"),l=Math.min(512/o.width,512/o.height);e.width=o.width*l,e.height=o.height*l,r.drawImage(o,0,0,e.width,e.height);let a=ef(r.getImageData(0,0,e.width,e.height)),s=ex(a);console.log("Room Detection Analysis:",{...a,finalDecision:s?"ROOM DETECTED":"NOT A ROOM",confidence:a.overallScore}),URL.revokeObjectURL(o.src),t(s)},o.onerror=()=>{console.error("Failed to load image for room detection"),URL.revokeObjectURL(o.src),t(!1)},o.src=URL.createObjectURL(e)}),ef=e=>{let{data:t,width:o,height:r}=e;return{wallDetection:eu(e),floorDetection:eg(e),ceilingDetection:ep(e),cornersDetection:eb(e),doorDetection:ev(e),windowDetection:ej(e),lightingAnalysis:eS(e),shadowAnalysis:eR(e),furnitureDetection:eC(e),textureAnalysis:eD(e),colorAnalysis:eM(e),perspectiveAnalysis:ek(e),depthAnalysis:eI(e),scaleAnalysis:eA(e),overallScore:0}},ex=e=>{let t=0,o=0;e.wallDetection.detected&&(t+=25*e.wallDetection.confidence),o+=25,e.floorDetection.detected&&(t+=20*e.floorDetection.confidence),o+=20,e.cornersDetection.detected&&(t+=15*e.cornersDetection.confidence),o+=15,e.doorDetection.detected&&(t+=15*e.doorDetection.confidence),o+=15,e.windowDetection.detected&&(t+=10*e.windowDetection.confidence),o+=10,e.lightingAnalysis.isIndoorLighting&&(t+=10*e.lightingAnalysis.confidence),o+=10,e.shadowAnalysis.hasIndoorShadows&&(t+=8*e.shadowAnalysis.confidence),o+=8,e.furnitureDetection.detected&&(t+=12*e.furnitureDetection.confidence),o+=12,e.textureAnalysis.hasIndoorTextures&&(t+=8*e.textureAnalysis.confidence),o+=8,e.colorAnalysis.hasIndoorColors&&(t+=7*e.colorAnalysis.confidence),o+=7,e.perspectiveAnalysis.hasIndoorPerspective&&(t+=5*e.perspectiveAnalysis.confidence),o+=5,e.depthAnalysis.hasIndoorDepth&&(t+=5*e.depthAnalysis.confidence),e.overallScore=t/(o+=5)*100;let r=e.overallScore>37,l=e.wallDetection.detected||e.floorDetection.detected||e.cornersDetection.detected||e.lightingAnalysis.isIndoorLighting||e.furnitureDetection.detected;return r&&l},eu=e=>{let{data:t,width:o,height:r}=e,l=0,a=0;for(let e=10;e<o-10;e+=8){let s=0,n=null;for(let l=10;l<r-10;l+=8){let r=(l*o+e)*4,i=(t[r]+t[r+1]+t[r+2])/3;null!==n&&30>Math.abs(i-n)&&s++,n=i;let c=t[r];eU(c,t[r+1],t[r+2])&&a++}s>r/8*.6&&l++}let s=0;for(let e=.2*r;e<.8*r;e+=15){let r=0;for(let l=10;l<o-10;l+=10){let a=((e-5)*o+l)*4,s=((e+5)*o+l)*4;a>=0&&s<t.length&&Math.abs((t[a]+t[a+1]+t[a+2])/3-(t[s]+t[s+1]+t[s+2])/3)>25&&r++}r>o/10*.3&&s++}let n=l/(o/8)*.5+a/(o*r/64)*.3+s/10*.2;return{detected:n>.3,confidence:Math.min(n,1),verticalLines:l,wallTextures:a,horizontalBoundaries:s}},eg=e=>{let{data:t,width:o,height:r}=e,l=Math.floor(.6*r),a=0,s=0,n=0;for(let e=l;e<r-5;e+=6)for(let r=5;r<o-5;r+=8){let l=(e*o+r)*4,i=t[l],c=t[l+1],d=t[l+2];eT(i,c,d)&&a++;let m=(e*o+(r+8))*4;m<t.length&&25>Math.abs((i+c+d)/3-(t[m]+t[m+1]+t[m+2])/3)&&s++,n++}let i=a/n*.7+s/n*.3;return{detected:i>.25,confidence:Math.min(2*i,1),floorTextures:a,horizontalPatterns:s}},ep=e=>{let{data:t,width:o,height:r}=e,l=Math.floor(.4*r),a=0,s=0,n=0;for(let e=5;e<l;e+=8)for(let l=5;l<o-5;l+=8){let i=(e*o+l)*4,c=t[i],d=t[i+1],m=t[i+2];eL(c,d,m)&&a++;let h=0;for(let a=-4;a<=4;a+=4)for(let s=-4;s<=4;s+=4){let n=l+a,i=e+s;if(n>=0&&n<o&&i>=0&&i<r){let e=(i*o+n)*4;20>Math.abs((t[e]+t[e+1]+t[e+2])/3-(c+d+m)/3)&&h++}}h>=6&&s++,n++}let i=a/n*.6+s/n*.4;return{detected:i>.2,confidence:Math.min(2.5*i,1),ceilingTextures:a,uniformAreas:s}},eb=e=>{let{data:t,width:o,height:r}=e,l=0;return[{x:0,y:0,w:.3*o,h:.3*r},{x:.7*o,y:0,w:.3*o,h:.3*r},{x:0,y:.7*r,w:.3*o,h:.3*r},{x:.7*o,y:.7*r,w:.3*o,h:.3*r}].forEach(e=>{let a=0;for(let l=0;l<20;l++){let l=e.x+Math.random()*e.w,s=e.y+Math.random()*e.h;l>=5&&l<o-5&&s>=5&&s<r-5&&(a+=ey(t,o,r,Math.floor(l),Math.floor(s)))}a/20>.3&&l++}),{detected:l>=2,confidence:l/4,cornersFound:l}},ey=(e,t,o,r,l)=>{let a=(l*t+r)*4,s=(e[a]+e[a+1]+e[a+2])/3,n=0,i=[];return[[-1,-1],[0,-1],[1,-1],[-1,0],[1,0],[-1,1],[0,1],[1,1]].forEach(a=>{let[c,d]=a,m=r+3*c,h=l+3*d;if(m>=0&&m<t&&h>=0&&h<o){let o=(h*t+m)*4,r=Math.abs(s-(e[o]+e[o+1]+e[o+2])/3);i.push(r),r>30&&n++}}),n>=4?n/8:0},ev=e=>{let{data:t,width:o,height:r}=e,l=0;for(let e=.1*r;e<.9*r;e+=12)for(let a=10;a<o-40;a+=12)ew(t,o,r,a,e)>.5&&l++;return{detected:l>0,confidence:Math.min(l/3,1),doorShapes:l}},ew=(e,t,o,r,l)=>{if(r+30>=t||l+60>=o)return 0;let a=0,s=0,n=0;for(let o=l;o<l+60;o+=6)for(let i=r;i<r+30;i+=6){let c=(o*t+i)*4,d=(e[c]+e[c+1]+e[c+2])/3;d<80&&a++,(i===r||i===r+30-6||o===l||o===l+60-6)&&d>100&&s++,n++}return a/n*.7+s/(.3*n)*.3},ej=e=>{let{data:t,width:o,height:r}=e,l=0;for(let e=.1*r;e<.7*r;e+=15)for(let a=10;a<o-50;a+=15)eN(t,o,r,a,e)>.4&&l++;return{detected:l>0,confidence:Math.min(l/2,1),windowShapes:l}},eN=(e,t,o,r,l)=>{if(r+50>=t||l+40>=o)return 0;let a=0,s=0;for(let o=l+5;o<l+40-5;o+=6)for(let l=r+5;l<r+50-5;l+=6){let r=(o*t+l)*4;(e[r]+e[r+1]+e[r+2])/3>150&&a++,s++}return a/s},eS=e=>{let{data:t}=e,o=0,r=0,l=0,a=0;for(let e=0;e<t.length;e+=12){let s=(t[e]+t[e+1]+t[e+2])/3;s>180?o++:s<70?r++:l++,a++}let s=o/a,n=r/a,i=l/a,c=s>.05&&s<.4&&n>.1&&n<.5&&i>.3;return{isIndoorLighting:c,confidence:c?.8:.2,brightRatio:s,darkRatio:n,mediumRatio:i}},eR=e=>{let{data:t,width:o,height:r}=e,l=0,a=0,s=0;for(let e=10;e<r-10;e+=10)for(let r=10;r<o-10;r+=10){let n=(e*o+r)*4,i=(t[n]+t[n+1]+t[n+2])/3;if(i<60){l++;let s=(e*o+(r+10))*4;s<t.length&&(t[s]+t[s+1]+t[s+2])/3>i+40&&a++}s++}let n=l/s,i=a/s,c=n>.05&&n<.4&&i>.02;return{hasIndoorShadows:c,confidence:c?.7:.3,shadowRatio:n,transitionRatio:i}},eC=e=>{let{data:t,width:o,height:r}=e,l=0,a=0,s=0;for(let e=.3*r;e<r-20;e+=15)for(let n=20;n<o-20;n+=15){let i=(e*o+n)*4,c=t[i];eE(c,t[i+1],t[i+2])&&a++,eJ(t,o,r,n,e,25,20)&&l++,s++}let n=a/s*.6+l/s*.4;return{detected:n>.15,confidence:Math.min(3*n,1),furnitureColors:a,furnitureShapes:l}},eD=e=>{let{data:t,width:o,height:r}=e,l=0,a=0,s=0;for(let e=10;e<r-10;e+=12)for(let n=10;n<o-10;n+=12){let i=eF(t,o,r,n,e);"smooth"===i?l++:"patterned"===i&&a++,s++}let n=l/s,i=a/s,c=n>.2||i>.1;return{hasIndoorTextures:c,confidence:c?.6:.4,smoothRatio:n,patternedRatio:i}},eF=(e,t,o,r,l)=>{let a=0,s=0,n=[];for(let a=-3;a<=3;a+=3)for(let i=-3;i<=3;i+=3){let c=r+i,d=l+a;if(c>=0&&c<t&&d>=0&&d<o){let o=(d*t+c)*4,r=(e[o]+e[o+1]+e[o+2])/3;n.push(r),s++}}if(s>0){let e=n.reduce((e,t)=>e+t,0)/s;a=n.reduce((t,o)=>t+Math.pow(o-e,2),0)/s}return a<200?"smooth":a>800?"rough":"patterned"},eM=e=>{let{data:t}=e,o=0,r=0,l=0,a=0;for(let e=0;e<t.length;e+=16){let s=t[e],n=t[e+1],i=t[e+2];eO(s,n,i)?o++:eP(s,n,i)?r++:ez(s,n,i)&&l++,a++}let s=o/a,n=r/a,i=l/a,c=s>.3&&i<.3;return{hasIndoorColors:c,confidence:c?.7:.3,neutralRatio:s,warmRatio:n,vibrantRatio:i}},ek=e=>{let{data:t,width:o,height:r}=e,l=0;for(let e=.3*r;e<.7*r;e+=20){let r=0;for(let l=10;l<o-10;l+=10){let a=(e*o+l)*4,s=(e*o+(l+10))*4;s<t.length&&Math.abs((t[a]+t[a+1]+t[a+2])/3-(t[s]+t[s+1]+t[s+2])/3)>25&&r++}r>o/10*.3&&l++}let a=l>=2;return{hasIndoorPerspective:a,confidence:a?.6:.4,horizontalLines:l}},eI=e=>{let{data:t,width:o,height:r}=e,l=0;Math.abs(e_(t,o,r,0,.7*r,o,r)-e_(t,o,r,0,0,o,.3*r))>20&&l++;let a=0;for(let e=.2*r;e<.8*r;e+=25)for(let l=.2*o;l<.8*o;l+=25)eW(t,o,r,l,e)&&a++;a>2&&l++;let s=l>=1;return{hasIndoorDepth:s,confidence:s?.5:.3,depthCues:l}},eA=e=>{let{data:t,width:o,height:r}=e,l=0,a=0;for(let e=20;e<r-40;e+=30)for(let s=20;s<o-40;s+=30){let n=eB(t,o,r,s,e);n>10&&n<.3*o&&l++,a++}let s=l/a,n=s>.3;return{hasAppropriateScale:n,confidence:n?.5:.3,scaleRatio:s}},eU=(e,t,o)=>{let r=(e+t+o)/3,l=Math.max(e,t,o)-Math.min(e,t,o);return r>120&&r<240&&l<40},eT=(e,t,o)=>{let r=e>80&&e<180&&t>60&&t<140&&o>30&&o<100,l=30>Math.abs(e-t)&&30>Math.abs(t-o)&&(e+t+o)/3>100,a=Math.max(e,t,o)-Math.min(e,t,o)>20&&(e+t+o)/3>60;return r||l||a},eL=(e,t,o)=>{let r=Math.max(e,t,o)-Math.min(e,t,o);return(e+t+o)/3>180&&r<30},eE=(e,t,o)=>{let r=e>60&&e<160&&t>40&&t<120&&o>20&&o<80,l=Math.max(e,t,o)-Math.min(e,t,o)>15&&(e+t+o)/3>50,a=e>80&&e<140&&t>50&&t<100&&o>30&&o<70;return r||l||a},eO=(e,t,o)=>{let r=(e+t+o)/3;return 30>Math.max(Math.abs(e-r),Math.abs(t-r),Math.abs(o-r))&&r>60&&r<200},eP=(e,t,o)=>e>t&&e>o&&e>100,ez=(e,t,o)=>Math.max(e,t,o)-Math.min(e,t,o)>60,e_=(e,t,o,r,l,a,s)=>{let n=0,i=0;for(let c=l;c<s;c+=5)for(let l=r;l<a;l+=5)if(l>=0&&l<t&&c>=0&&c<o){let o=(c*t+l)*4;n+=(e[o]+e[o+1]+e[o+2])/3,i++}return i>0?n/i:0},eW=(e,t,o,r,l)=>{let a=0;for(let s=-8;s<=8;s+=4)for(let n=-8;n<=8;n+=4){let i=r+n,c=l+s;if(i>=0&&i<t&&c>=0&&c<o){let o=(c*t+i)*4,s=(l*t+r)*4;Math.abs((e[o]+e[o+1]+e[o+2])/3-(e[s]+e[s+1]+e[s+2])/3)>30&&a++}}return a>8},eB=(e,t,o,r,l)=>{let a=new Set,s=[[r,l]],n=(l*t+r)*4,i=(e[n]+e[n+1]+e[n+2])/3,c=0;for(;s.length>0&&c<100;){let[r,l]=s.pop(),n="".concat(r,",").concat(l);if(a.has(n)||r<0||r>=t||l<0||l>=o)continue;a.add(n);let d=(l*t+r)*4;25>Math.abs((e[d]+e[d+1]+e[d+2])/3-i)&&(c++,s.push([r+1,l],[r-1,l],[r,l+1],[r,l-1]))}return c},eJ=(e,t,o,r,l,a,s)=>{if(r+a>=t||l+s>=o)return!1;let n=0,i=0;for(let o=0;o<a;o+=3){let a=(l*t+(r+o))*4,c=((l+s)*t+(r+o))*4;c<e.length&&(20>Math.abs((e[a]+e[a+1]+e[a+2])/3-(e[c]+e[c+1]+e[c+2])/3)&&n++,i++)}for(let o=0;o<s;o+=3){let s=((l+o)*t+r)*4,c=((l+o)*t+(r+a))*4;c<e.length&&(20>Math.abs((e[s]+e[s+1]+e[s+2])/3-(e[c]+e[c+1]+e[c+2])/3)&&n++,i++)}return i>0&&n/i>.6},eV=async e=>{let t=e.target.files[0];if(t&&("image/jpeg"===t.type||"image/png"===t.type)&&t.size<=0xa00000){H(!0),K(null);try{let e=await eh(t),r=URL.createObjectURL(t);e?(w(t),N(r),et(t),ee(r),m.oR.success(o("roomDetected"))):(K(o("invalidRoomImage")),w(t),N(r),et(t),ee(r),m.oR.error(o("invalidRoomImage"))),await ei(t),console.log("File uploaded and saved:",t.name)}catch(o){console.error("Room validation error:",o);let e=URL.createObjectURL(t);w(t),N(e),et(t),ee(e),K(null),await ei(t)}H(!1)}else m.oR.error(o("invalidFileFormat"))},eq=async(e,t,o,r)=>{try{let o={roomType:e,direction:t,userInfo:{gender:C,birthDateTime:"".concat(F,"-").concat(k.padStart(2,"0"),"-").concat(A.padStart(2,"0"),"T").concat(T.padStart(2,"0"),":00")},hasUploadedImage:!!v,imageFileName:(null==v?void 0:v.name)||null,analysisResult:r,locale:pathname.split("/")[1]||"zh-TW",timeSpentOnPage:Math.round((Date.now()-(window.pageStartTime||Date.now()))/1e3),referrer:document.referrer,sessionId:sessionStorage.getItem("ga_session_id")},l=await fetch("/api/track-free-report-generation",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(l.ok){let e=await l.json();console.log("✅ Free report generation tracked:",e),e.totalGenerated>1?m.oR.success("報告生成成功！這是您的第 ".concat(e.totalGenerated," 份免費報告。")):m.oR.success("首份免費報告生成成功！")}}catch(e){console.error("Error tracking free report generation:",e)}};return(0,r.jsxs)("div",{className:"flex flex-col items-center justify-start w-full px-4 py-6 text-center mb-30 sm:px-6 md:px-8 lg:px-0",style:{fontFamily:'"Noto Serif TC", serif'},children:[(0,r.jsx)("h1",{className:"mb-4 text-xl font-normal mt-10 mb-30 text-[#004f44] sm:text-2xl md:text-3xl lg:text-4xl xl:text-5xl leading-tight sm:leading-normal",children:o("title")}),(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center w-full max-w-6xl gap-6 md:flex-row md:items-start lg:gap-8",children:[(0,r.jsxs)("div",{className:"w-full md:flex-1 md:max-w-5xl",children:[(0,r.jsxs)("div",{className:"h-48 sm:h-56 md:h-64 lg:h-80 rounded-lg bg-[#f7fffd] border-[#25826c] border-dashed border-2 box-border flex flex-col items-center justify-center p-4 sm:p-6 md:p-8",children:[G?(0,r.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,r.jsx)("div",{className:"w-8 h-8 border-2 border-[#318161] border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("p",{className:"text-sm text-[#004f44]",children:o("validatingImage")})]}):(0,r.jsx)("label",{className:"flex items-center justify-center w-full h-full cursor-pointer",htmlFor:"file-upload",children:(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center w-full gap-3 sm:gap-4 md:gap-6",children:[(0,r.jsx)(a.default,{className:"w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 lg:w-16 lg:h-16",loading:"lazy",width:66,height:66,alt:"",src:"/images/report/materialsymbolsupload.svg"}),(0,r.jsx)("h3",{className:"text-sm font-normal text-center sm:text-base md:text-lg lg:text-xl xl:text-2xl text-[#004f44] px-2",children:o("uploadAction")}),(0,r.jsx)("div",{className:"text-xs text-center sm:text-sm md:text-base lg:text-lg text-[#666] px-2",children:o("fileFormat")}),(0,r.jsx)("button",{type:"button",className:"px-4 py-2 text-sm font-medium text-white transition-all duration-200 bg-transparent border-none rounded-lg cursor-pointer sm:px-6 sm:py-3 md:text-base lg:text-lg bg-gradient-to-r from-[#318161] to-[#318177] hover:scale-105 active:scale-95",onClick:()=>{var e;return null===(e=Z.current)||void 0===e?void 0:e.click()},children:o("browseButton")})]})}),(0,r.jsx)("input",{className:"hidden",type:"file",id:"file-upload",accept:"image/jpeg,image/png",ref:Z,onChange:eV,disabled:G})]}),(0,r.jsx)("div",{className:"mt-3 text-xs text-left sm:text-sm md:text-base text-[#004f44] px-1",children:o("disclaimer")})]}),v&&(0,r.jsxs)("div",{className:"flex flex-col items-center w-full gap-4 mt-4 md:items-end md:w-auto md:mt-0",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3 p-3 border rounded-lg shadow-sm sm:gap-4 ".concat(Q?"bg-red-50 border-red-200":"bg-white border-gray-100"),children:[j&&(0,r.jsx)(a.default,{className:"object-cover w-12 h-12 rounded sm:w-14 sm:h-14 md:w-16 md:h-16",loading:"lazy",width:64,height:64,alt:"",src:j,onError:e=>{console.error("Image failed to load:",j),console.log("File object:",v)}}),(0,r.jsxs)("div",{className:"flex flex-col justify-center min-w-0",children:[(0,r.jsx)("div",{className:"text-sm font-medium truncate sm:text-base text-[#004f44] max-w-32 sm:max-w-40",children:v.name}),(0,r.jsxs)("div",{className:"text-xs text-gray-500 sm:text-sm",children:[(v.size/1024/1024).toFixed(2)," MB"]}),Q&&(0,r.jsxs)("div",{className:"flex items-center gap-1 mt-1",children:[(0,r.jsx)("svg",{className:"flex-shrink-0 w-3 h-3 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,r.jsx)("span",{className:"text-xs font-medium text-red-600 sm:text-sm",children:Q})]})]})]}),(0,r.jsx)("button",{onClick:()=>{j&&j.startsWith("blob:")&&URL.revokeObjectURL(j),w(null),N(null),et(null),ee(null),K(null),ed(),Z.current&&(Z.current.value="")},className:"flex items-center justify-center w-8 h-8 transition-colors rounded-full sm:w-10 sm:h-10 ".concat(Q?"bg-red-100 hover:bg-red-200":"bg-red-50 hover:bg-red-100"),children:(0,r.jsx)(a.default,{className:"w-4 h-4 sm:w-5 sm:h-5",loading:"lazy",width:20,height:20,alt:o("close"),src:"/images/linemdtrash.png"})})]})]}),v&&!Q&&(0,r.jsx)("div",{className:"flex justify-center w-full mt-8 sm:mt-10",children:(0,r.jsx)("button",{type:"button",className:"w-full max-w-xs px-6 py-3 text-base font-medium text-white transition-all duration-200 rounded-lg shadow-lg sm:w-auto sm:px-8 sm:py-4 sm:text-lg bg-gradient-to-r from-[#7BB8A9] to-[#318177] hover:scale-105 hover:shadow-xl active:scale-95",onClick:()=>R(!0),children:o("nextStep")})}),v&&Q&&(0,r.jsx)("div",{className:"flex justify-center w-full mt-8 sm:mt-10",children:(0,r.jsxs)("div",{className:"flex items-center max-w-md gap-3 px-4 py-3 text-sm text-red-700 border border-red-200 rounded-lg bg-red-50 sm:text-base",children:[(0,r.jsx)("svg",{className:"flex-shrink-0 w-5 h-5 text-red-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-medium",children:o("uploadDifferentImage")}),(0,r.jsx)("p",{className:"mt-1 text-xs text-red-600",children:o("roomImageRequired")})]})]})}),S&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"fixed inset-0 z-40 bg-opacity-30 backdrop-blur-sm",onClick:()=>R(!1)}),(0,r.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"relative w-full max-w-md max-h-[90vh] overflow-y-auto bg-white rounded-xl shadow-2xl",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-10 flex items-center justify-between p-4 bg-white border-b rounded-t-xl sm:p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-bold text-center text-[#004f44] sm:text-xl",children:o("modalTitle")}),(0,r.jsx)("button",{className:"text-2xl text-gray-400 transition-colors hover:text-gray-600",onClick:()=>R(!1),"aria-label":o("close"),children:"\xd7"})]}),(0,r.jsxs)("div",{className:"p-4 space-y-4 sm:p-6 sm:space-y-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-left text-[#004f44] sm:text-base",children:o("gender")}),(0,r.jsxs)("select",{className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-base",value:C,onChange:e=>D(e.target.value),children:[(0,r.jsx)("option",{value:"",children:o("genderSelect")}),(0,r.jsx)("option",{value:"male",children:o("male")}),(0,r.jsx)("option",{value:"female",children:o("female")})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-left text-[#004f44] sm:text-base",children:o("birthDateTime")}),(0,r.jsxs)("div",{className:"grid grid-cols-4 gap-2 sm:gap-3",children:[(0,r.jsxs)("select",{className:"px-2 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-sm",value:F,onChange:e=>M(e.target.value),children:[(0,r.jsx)("option",{value:"",children:o("year")}),h.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsxs)("select",{className:"px-2 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-sm",value:k,onChange:e=>I(e.target.value),children:[(0,r.jsx)("option",{value:"",children:o("month")}),f.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsxs)("select",{className:"px-2 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-sm",value:A,onChange:e=>U(e.target.value),children:[(0,r.jsx)("option",{value:"",children:o("day")}),x.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]}),(0,r.jsxs)("select",{className:"px-2 py-2 text-xs border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-sm",value:T,onChange:e=>L(e.target.value),children:[(0,r.jsx)("option",{value:"",children:o("hour")}),u.map(e=>(0,r.jsx)("option",{value:e,children:e},e))]})]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-left text-[#004f44] sm:text-base",children:o("roomType")}),(0,r.jsxs)("select",{className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-base",value:E,onChange:e=>O(e.target.value),children:[(0,r.jsx)("option",{value:"",children:o("roomTypeSelect")}),el.map(e=>(0,r.jsx)("option",{value:e,children:o("roomTypes.".concat(e))},e))]})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-left text-[#004f44] sm:text-base",children:o("direction")}),(0,r.jsxs)("select",{className:"w-full px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#318161] focus:border-transparent sm:text-base",value:P,onChange:e=>z(e.target.value),children:[(0,r.jsx)("option",{value:"",children:o("directionSelect")}),ea.map(e=>(0,r.jsx)("option",{value:e,children:o("directions.".concat(e))},e))]})]})]}),(0,r.jsxs)("div",{className:"sticky bottom-0 z-10 p-4 space-y-3 bg-white border-t rounded-b-xl sm:p-6",children:[(0,r.jsx)("button",{className:"w-full py-3 text-base font-bold text-white transition-all duration-200 rounded-lg shadow-lg sm:text-lg bg-gradient-to-r from-[#7BB8A9] to-[#318177] hover:scale-105 hover:shadow-xl active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed",onClick:em,disabled:V||"loading"===er,children:V?o("calculating"):"loading"===er?o("checkingAuth")||"Checking...":o("startAnalysis")}),(0,r.jsx)("button",{className:"w-full px-3 py-2 text-sm text-gray-500 transition-colors bg-transparent rounded hover:text-gray-700 hover:bg-gray-50",onClick:()=>{R(!1)},children:o("back")})]})]})})]}),B&&(0,r.jsx)("div",{className:"w-full max-w-2xl p-4 mt-6 text-sm text-gray-800 whitespace-pre-line bg-gray-100 rounded-lg sm:text-base",children:B}),V&&(0,r.jsx)("div",{className:"mt-6 text-sm text-blue-500 sm:text-base",children:o("processing")})]})}}}]);