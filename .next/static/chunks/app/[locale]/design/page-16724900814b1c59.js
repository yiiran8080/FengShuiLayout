(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{945:()=>{},3456:(e,t,a)=>{Promise.resolve().then(a.bind(a,7763))},7763:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>eC});var s=a(8081),i=a(4137),n=a(9651),r=a(2149);let o={ROOM:"room",FURNITURE:"furniture"},l={LIVING_ROOM:"living_room",DINING_ROOM:"dining_room",STORAGE_ROOM:"storage_room",STUDY_ROOM:"study_room",BEDROOM:"bedroom",BATHROOM:"bathroom",KITCHEN:"kitchen",BALCONY:"balcony",GARDEN:"garden",GARAGE:"garage",CORRIDOR:"corridor"},d={BED:"bed",SOFA:"sofa",TABLE:"table",CHAIR:"chair",TV:"tv",LAMP:"lamp",DOOR:"door",WINDOW:"window",BOOKSHELF:"bookshelf",WARDROBE:"wardrobe",PLANT:"plant",FRIDGE:"fridge",STOVE:"stove",SINK:"sink",WASHBASIN:"washbasin",TOILET:"toilet",SHOWER:"shower",BATHTUB:"bathtub"},c={[d.DOOR]:"门",[d.WINDOW]:"窗",[d.TABLE]:"枱",[d.CHAIR]:"椅子",[d.SOFA]:"沙发",[d.BED]:"床",[d.LAMP]:"儿童床",[d.TV]:"电视",[d.BOOKSHELF]:"茶几",[d.WARDROBE]:"柜",[d.PLANT]:"植物",[d.FRIDGE]:"冰箱",[d.STOVE]:"炉具",[d.SINK]:"锌盘",[d.WASHBASIN]:"洗手盘",[d.TOILET]:"马桶",[d.SHOWER]:"淋浴",[d.BATHTUB]:"浸浴"};var h=a(8598),p=a.n(h),u=a(9397),g=a(1887),x=a(4128),m=a(9834),f=a(5186),v=a(378),b=a(9156),y=a(2194);function j(e){let{history:t,historyIndex:a,handleUndo:i,handleRedo:n,className:r}=e;return(0,s.jsxs)("div",{className:(0,y.cn)("flex items-center gap-2",r),children:[(0,s.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 ".concat(a<=0?"text-gray-300":"text-gray-600"),onClick:i,disabled:a<=0,children:(0,s.jsx)(v.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 ".concat(a>=t.length-1?"text-gray-300":"text-gray-600"),onClick:n,disabled:a>=t.length-1,children:(0,s.jsx)(b.A,{className:"w-4 h-4"})})]})}var N=a(5381),w=a(6371);let R={[l.LIVING_ROOM]:"#F0DF9C",[l.DINING_ROOM]:"#F5D4BC",[l.STORAGE_ROOM]:"#ADC0BC",[l.STUDY_ROOM]:"#B0B8C9",[l.BEDROOM]:"#F5B8B8",[l.BATHROOM]:"#C1D7E2",[l.KITCHEN]:"#EDE0C6",[l.BALCONY]:"#D0DCAA",[l.GARDEN]:"#AACDBC",[l.GARAGE]:"#C7C7DD",[l.CORRIDOR]:"#CDCDCD"},O=(0,r.forwardRef)((e,t)=>{let{items:a,onShowTab:n,showTab:l,history:h,historyIndex:v,setHistory:b,setHistoryIndex:O,handleUndo:I,handleRedo:T,onGenReport:E}=e,C=(0,N.c3)("design"),U=(0,w.A)(),[S,A]=(0,r.useState)({x:0,y:0}),[z,k]=(0,r.useState)(!1),[F,M]=(0,r.useState)({x:0,y:0}),[D,B]=(0,r.useState)(null),[L,Y]=(0,r.useState)({width:5e3,height:5e3}),[_,G]=(0,r.useState)(!1),[H,X]=(0,r.useState)({x:0,y:0}),[P,V]=(0,r.useState)(null),[W,K]=(0,r.useState)([]),[q,J]=(0,r.useState)(!1),[Q,Z]=(0,r.useState)({x:0,y:0}),[$,ee]=(0,r.useState)(null),[et,ea]=(0,r.useState)(100),[es,ei]=(0,r.useState)({originScale:100,isMoving:!1,pageX:0,pageY:0,pageX2:0,pageY2:0}),[en,er]=(0,r.useState)(0);(0,r.useImperativeHandle)(t,()=>({getLocalItems:()=>W,setLocalItems:K,setActiveRoom:B,setIsRoomDragging:G,setDraggedRoom:V,setRoomDragStart:X,setPosition:A,setCompassRotation:er,position:S,compassRotation:en}),[W]);let eo=(0,r.useRef)(null),{setNodeRef:el}=(0,i.zM)({id:"canvas",data:{accepts:[o.ROOM,o.FURNITURE]}}),ed=(0,r.useCallback)(e=>{var t,a;if(!e.target.closest('[data-room-element="true"]')&&(0===e.button||e.touches)){if((null===(t=e.touches)||void 0===t?void 0:t.length)==2){let t={...es};t.isMoving=!0,t.pageX=e.touches[0].pageX,t.pageY=e.touches[0].pageY,t.pageX2=e.touches[1].pageX,t.pageY2=e.touches[2].pageY,ei(t);return}B(null),k(!0),(null===(a=e.touches)||void 0===a?void 0:a.length)==1?M({x:e.touches[0].clientX-S.x,y:e.touches[0].clientY-S.y}):M({x:e.clientX-S.x,y:e.clientY-S.y})}},[S,es]),ec=(e,t)=>!!e.position&&!!t.position&&e.position.x>=t.position.x&&e.position.x<=t.position.x+t.size.width&&e.position.x+e.size.width<=t.position.x+t.size.width&&e.position.y+20>=t.position.y&&e.position.y<=t.position.y+t.size.height&&e.position.y-20+e.size.height<=t.position.y+t.size.height,eh=(0,r.useCallback)((e,t)=>{var a;if(e.stopPropagation(),G(!0),V(t),(null===(a=e.touches)||void 0===a?void 0:a.length)==1?X({x:e.touches[0].clientX-t.position.x,y:e.touches[0].clientY-t.position.y}):X({x:e.clientX-t.position.x,y:e.clientY-t.position.y}),t.type===o.ROOM){let e=W.map(e=>e.type===o.FURNITURE&&ec(e,t)?{...e,parentId:t.id,offset:{x:e.position.x-t.position.x,y:e.position.y-t.position.y}}:{...e,parentId:null});K(W.map(t=>e.find(e=>e.id===t.id)||t))}},[W]),ep=(0,r.useCallback)((e,t,a)=>{var s;e.stopPropagation(),J(!0),ee(a),(null===(s=e.touches)||void 0===s?void 0:s.length)==1?Z({x:e.touches[0].clientX,y:e.touches[0].clientY}):Z({x:e.clientX,y:e.clientY})},[]),eu=function(e,t){return Math.hypot(t.x-e.x,t.y-e.y)},eg=(0,r.useCallback)(e=>{var t,a,s,i,n;let r={...es};if((null===(t=e.touches)||void 0===t?void 0:t.length)==2){if(!r.isMoving)return;let t=et*(eu({x:e.touches[0].pageX,y:e.touches[0].pageY},{x:e.touches[1].pageX,y:e.touches[1].pageY})/eu({x:r.pageX,y:r.pageY},{x:r.pageX2,y:r.pageY2}));t>200&&(t=200),t<50&&(t=50),ea(t);return}if(r.isMoving=!1,ei(r),q&&D&&$){let t,i;(null===(a=e.touches)||void 0===a?void 0:a.length)==1?(t=e.touches[0].clientX-Q.x,i=e.touches[0].clientY-Q.y):(t=e.clientX-Q.x,i=e.clientY-Q.y);let n=D.size.width/D.size.height;K(W.map(e=>{if(e.id===D.id){let a;let s={...e.size},r={...e.position};switch($){case"top-left":s.width=e.size.width-t,D.type===o.ROOM?s.height=e.size.height-i:s.height=s.width/n,r.x=e.position.x+t,r.y=e.position.y+i;break;case"top-right":s.width=e.size.width+t,D.type===o.ROOM?s.height=e.size.height-i:s.height=s.width/n,r.y=e.position.y+i;break;case"bottom-left":s.width=e.size.width-t,D.type===o.ROOM?s.height=e.size.height+i:s.height=s.width/n,r.x=e.position.x+t;break;case"bottom-right":s.width=e.size.width+t,D.type===o.ROOM?s.height=e.size.height+i:s.height=s.width/n}if(e.type===o.ROOM?s.width>=100&&s.height>=100:e.data.type===d.WINDOW?s.width>=8&&s.height>=8:s.width>=32&&s.height>=32)return{...e,size:s,position:r}}return e})),(null===(s=e.touches)||void 0===s?void 0:s.length)==1?Z({x:e.touches[0].clientX,y:e.touches[0].clientY}):Z({x:e.clientX,y:e.clientY})}else if(_&&P){let t,a;(null===(i=e.touches)||void 0===i?void 0:i.length)==1?(t=e.touches[0].clientX-H.x,a=e.touches[0].clientY-H.y):(t=e.clientX-H.x,a=e.clientY-H.y);let s=[];if(P.type===o.ROOM){let e=W.filter(e=>e.type===o.FURNITURE&&e.parentId===P.id).map(e=>e.id);s=W.map(s=>{if(s.id===P.id)return{...s,position:{x:t,y:a}};if(e.includes(s.id)){var i,n;return{...s,position:{x:t+(null===(i=s.offset)||void 0===i?void 0:i.x)||0,y:a+(null===(n=s.offset)||void 0===n?void 0:n.y)||0}}}return s})}else s=W.map(e=>e.id===P.id?{...e,position:{x:t,y:a}}:e);K(s)}else if(z){let t,a;(null===(n=e.touches)||void 0===n?void 0:n.length)==1?(t=e.touches[0].clientX-F.x,a=e.touches[0].clientY-F.y):(t=e.clientX-F.x,a=e.clientY-F.y),A({x:t,y:a})}},[z,F,_,P,H,W,q,D,$,Q,es,et]),ex=(0,r.useCallback)(e=>{var t,a;if((null===(t=e.touches)||void 0===t?void 0:t.length)<2&&ei(e=>({...e,isMoving:!1})),_||q){let t,s,i;if((null===(a=e.changedTouches)||void 0===a?void 0:a.length)==1?(t=e.changedTouches[0].clientX-H.x-S.x,s=e.changedTouches[0].clientY-H.y-S.y):(t=e.clientX-H.x-S.x,s=e.clientY-H.y-S.y),P&&!W.some(e=>e.id===P.id)){let e={...P,position:{x:t,y:s}};K(i=[...W,e]),em(e,i)}else i=[...W];let n=h.slice(0,v+1);n.push(i),b(n),O(n.length-1)}k(!1),G(!1),V(null),J(!1),ee(null)},[_,q,W,h,v,H,P,S,es]),em=(e,t)=>{if(e.type===o.FURNITURE){let a=t||W,s=a.find(t=>t.type===o.ROOM&&ec(e,t));if(s){let t=a.filter(t=>t.type===o.FURNITURE&&t.data.type===e.data.type&&ec(t,s)).sort((e,t)=>e.position.x-t.position.x).map((t,a)=>{let i="".concat(s.data.label,"-").concat(c[e.data.type]).concat(a+1);return t.id===e.id&&(e.data.label=i,e.data.parentRoom=s),{...t,data:{...t.data,label:i,parentRoom:s}}});K(a.map(e=>t.find(t=>t.id===e.id)||e))}else{console.log("选中家具，当前未匹配到房间");let t=p().cloneDeep(a),s=t.filter(t=>t.id===e.id)[0];s&&(s.data.label="未分配-".concat(c[s.data.type]),s.data.parentRoom=null,e.data.label="未分配-".concat(c[s.data.type]),e.data.parentRoom=null,K(t))}}setTimeout(()=>{B(e)})};(0,r.useEffect)(()=>{let e=eo.current;if(e)return e.addEventListener("mousedown",ed),window.addEventListener("mousemove",eg),window.addEventListener("mouseup",ex),e.addEventListener("touchstart",ed),window.addEventListener("touchmove",eg),window.addEventListener("touchend",ex),()=>{e.removeEventListener("mousedown",ed),window.removeEventListener("mousemove",eg),window.removeEventListener("mouseup",ex),e.removeEventListener("touchstart",ed),window.removeEventListener("touchmove",eg),window.removeEventListener("touchend",ex)}},[ed,eg,ex]);let ef=e=>{"in"===e&&et<200?ea(e=>Math.min(200,e+10)):"out"===e&&et>50?ea(e=>Math.max(50,e-10)):"reset"===e&&ea(100)},ev=(0,r.useCallback)(()=>{D&&K(W.map(e=>{if(e.id===D.id){let t=((e.rotation||0)-90)%360;return{...e,rotation:t}}return e}))},[D,W]),eb=e=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"absolute w-3 h-3 bg-white border border-red-500 cursor-nw-resize rounded-full",style:{top:-6,left:-6},onMouseDown:t=>ep(t,e,"top-left"),onTouchStart:t=>ep(t,e,"top-left")}),(0,s.jsx)("div",{className:"absolute w-3 h-3 bg-white border border-red-500 cursor-ne-resize rounded-full",style:{top:-6,right:-6},onMouseDown:t=>ep(t,e,"top-right"),onTouchStart:t=>ep(t,e,"top-right")}),(0,s.jsx)("div",{className:"absolute w-3 h-3 bg-white border border-red-500 cursor-sw-resize rounded-full",style:{bottom:-6,left:-6},onMouseDown:t=>ep(t,e,"bottom-left"),onTouchStart:t=>ep(t,e,"bottom-left")}),(0,s.jsx)("div",{className:"absolute w-3 h-3 bg-white border border-red-500 cursor-se-resize rounded-full",style:{bottom:-6,right:-6},onMouseDown:t=>ep(t,e,"bottom-right"),onTouchStart:t=>ep(t,e,"bottom-right")})]});return(0,s.jsxs)("div",{className:"relative w-full min-h-[calc(100vh-64px)] overflow-hidden bg-background",children:[(0,s.jsxs)("div",{className:"fixed top-20 right-6 flex items-center gap-4 z-9",children:[!U&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j,{history:h,historyIndex:v,handleUndo:I,handleRedo:T,className:" bg-white rounded-full shadow-lg  px-3 py-2"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 bg-white rounded-full shadow-lg px-3 py-2",children:[(0,s.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 text-gray-600",onClick:()=>ef("out"),disabled:et<=50,children:(0,s.jsx)(u.A,{className:"w-4 h-4"})}),(0,s.jsxs)("span",{className:"text-sm font-medium text-gray-600 min-w-[48px] text-center",children:[et,"%"]}),(0,s.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 text-gray-600",onClick:()=>ef("in"),disabled:et>=200,children:(0,s.jsx)(g.A,{className:"w-4 h-4"})})]})]}),(0,s.jsxs)("div",{style:{transform:"rotate(".concat(en,"deg)"),transition:"transform 0.3s ease-out"},onClick:()=>{console.log("compass");let e=en+45;e>=360&&(e-=360),er(e)},className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"text-sm text-gray-600",children:"N"}),(0,s.jsx)(f.default,{src:"/images/compass.png",alt:"方向",width:40,height:40,className:"cursor-pointer"})]})]}),(0,s.jsx)("div",{ref:e=>{eo.current=e,el(e)},className:"absolute cursor-move",style:{width:"".concat(L.width,"px"),height:"".concat(L.height,"px"),transform:"translate(".concat(S.x,"px, ").concat(S.y,"px) scale(").concat(et/100,")"),transformOrigin:"center",backgroundImage:"radial-gradient(circle, #ddd 1px, transparent 1px)",backgroundSize:"40px 40px"},children:(0,s.jsx)("div",{className:"relative",children:W.map(e=>e.type===o.ROOM?(0,s.jsxs)("div",{"data-room-element":"true",className:"absolute ".concat((null==D?void 0:D.id)===e.id?"ring-2 ring-red-500":""," cursor-move z-100"),style:{left:e.position.x,top:e.position.y,width:e.size.width,height:e.size.height},onClick:t=>{t.stopPropagation(),em(e)},onMouseDown:t=>eh(t,e),onTouchStart:t=>eh(t,e),children:[D&&D.id===e.id&&(0,s.jsxs)("div",{style:{left:"50%",top:"-64px",transform:"translateX(-50%)"},className:"min-w-fit whitespace-nowrap  absolute h-[40px] rounded-4xl bg-white shadow-lg  items-center px-3 gap-2 md:flex hidden",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"已选中："}),(0,s.jsxs)("div",{className:"flex flex-grow items-center gap-1",children:[(0,s.jsx)("div",{style:{width:"12px",height:"12px",backgroundColor:R[D.data.type],borderRadius:"2px"}}),(0,s.jsx)("span",{className:"text-sm text-gray-600 font-bold",children:D.data.label})]}),(0,s.jsx)("button",{className:"flex-shrink-0 text-red-500",onClick:e=>{e.stopPropagation(),K(W.filter(e=>e.id!==D.id)),B(null)},children:(0,s.jsx)(x.A,{className:"w-4 h-4 text-red-500"})})]}),(0,s.jsx)("div",{className:"w-full h-full",style:{border:e.type===o.ROOM?"8px solid":"none",borderColor:e.type===o.ROOM?R[e.data.type]:"transparent",borderRadius:e.type===o.ROOM?"8px":"0",backgroundColor:e.type===o.ROOM?R[e.data.type]+"80":"transparent"},children:(0,s.jsx)("div",{className:"absolute top-2 left-2 text-[14px] text-[#888888]",style:{zIndex:1},children:e.data.label})}),(null==D?void 0:D.id)===e.id&&eb(e)]},e.id):e.type===o.FURNITURE?(0,s.jsxs)("div",{"data-room-element":"true",className:"absolute cursor-move z-200",style:{left:e.position.x,top:e.position.y,width:e.size.width,height:e.size.height},onClick:t=>{t.stopPropagation(),em(e)},onMouseDown:t=>{t.stopPropagation(),eh(t,e)},onTouchStart:t=>{t.stopPropagation(),eh(t,e)},children:[D&&D.id===e.id&&(0,s.jsxs)("div",{style:{left:"50%",top:"-64px",transform:"translateX(-50%)"},className:"min-w-fit whitespace-nowrap absolute h-[40px] rounded-4xl bg-white shadow-lg  items-center px-3 gap-2 md:flex hidden",children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"已选中："}),(0,s.jsxs)("div",{className:"flex flex-grow items-center gap-1",children:[D.data.parentRoom&&(0,s.jsx)("div",{style:{width:"12px",height:"12px",backgroundColor:R[D.data.parentRoom.data.type],borderRadius:"2px"}}),(0,s.jsx)("span",{className:"text-sm text-gray-600 font-bold",children:D.data.label})]}),(0,s.jsx)("button",{className:"flex-shrink-0",onClick:e=>{e.stopPropagation(),ev()},children:(0,s.jsx)(m.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{className:"flex-shrink-0 text-red-500 hover:text-red-600 transition-colors",onClick:e=>{e.stopPropagation(),K(W.filter(e=>e.id!==D.id)),B(null)},children:(0,s.jsx)(x.A,{className:"w-4 h-4 text-red-500"})})]}),(null==D?void 0:D.id)===e.id&&eb(e),(0,s.jsx)(f.default,{className:(null==D?void 0:D.id)===e.id?"ring-2 ring-red-500":"",style:{transform:e.rotation?"rotate(".concat(e.rotation,"deg)"):"none",transformOrigin:"center"},src:e.activeIcon,alt:"Furniture",width:e.size.width,height:e.size.height})]},e.id):void 0)})}),D&&(0,s.jsxs)("div",{className:(0,y.cn)("min-w-fit whitespace-nowrap fixed left-1/2 -translate-x-1/2 h-10 rounded-4xl bg-white shadow-lg flex items-center px-3 gap-2 md:hidden",l?"bottom-85":"bottom-22.5 "),children:[(0,s.jsx)("span",{className:"text-sm text-gray-600",children:"已选中："}),(0,s.jsxs)("div",{className:"flex flex-grow items-center gap-1",children:[(0,s.jsx)("div",{style:{width:"12px",height:"12px",backgroundColor:R[D.data.parentRoom?D.data.parentRoom.data.type:D.data.type],borderRadius:"2px"}}),(0,s.jsx)("span",{className:"text-sm text-gray-600 font-bold",children:D.data.label})]}),D.type===o.FURNITURE&&(0,s.jsxs)("button",{className:"flex-shrink-0",onClick:e=>{e.stopPropagation(),ev()},children:[" ",(0,s.jsx)(m.A,{className:"w-4 h-4"})]}),(0,s.jsx)("button",{className:"flex-shrink-0 text-red-500 hover:text-red-600 transition-colors",onClick:e=>{K(W.filter(e=>e.id!==D.id)),B(null)},children:(0,s.jsx)(x.A,{className:"w-4 h-4 text-red-500"})})]}),(0,s.jsxs)("div",{className:"fixed z-50 bottom-6 left-0 px-2 gap-4 w-full bg-transparent flex items-center justify-between  md:hidden",children:[!l&&(0,s.jsx)("button",{onClick:n,className:"border-primary border-1 font-bold w-4/5 py-3 bg-white text-foreground rounded-[100px] text-sm",children:C("showTab")}),(0,s.jsxs)("button",{onClick:E,className:(0,y.cn)("inline-flex font-bold py-3 bg-button-gradient text-white rounded-[100px] text-sm items-center justify-center gap-0",l?"w-full ":"w-4/5"),children:[C("cta"),(0,s.jsx)(f.default,{src:"/images/hero/star.png",alt:"arrow",width:15,height:16})]})]})]})});var I=a(7950),T=a.n(I),E=a(9128),C=a(1742);function U(e){let{onSaveProject:t,onUserOpen:a}=e,{isMobile:i}=(0,w.A)();return(0,s.jsx)("nav",{className:"bg-white h-16 border-b-gray-100 border-b-2 fixed top-0 left-0 right-0 z-50",children:(0,s.jsx)("div",{className:"mx-auto px-4 h-full",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-full",children:[(0,s.jsx)(T(),{href:"/",className:"text-2xl font-bold text-primary",children:"HarmoniQ"}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 text-foreground  gap-3",children:[(0,s.jsx)(E.A,{className:"text-foreground"}),(0,s.jsxs)("span",{className:"flex items-center gap-1 cursor-pointer",onClick:t,children:[(0,s.jsx)(C.A,{className:"w-4 h-4"}),"保存 "]}),(0,s.jsxs)("span",{className:"flex items-center gap-1 cursor-pointer",onClick:()=>a(!0),children:[(0,s.jsx)(C.A,{className:"w-4 h-4"}),"个人资料 "]}),(0,s.jsxs)(T(),{href:"/design",className:"inline-flex px-4 py-1 bg-button-gradient text-white rounded-full hover:bg-primary/90 transition-colors items-center gap-2",children:["开始测算",(0,s.jsx)("span",{className:"text-lg",children:"✨"})]})]})]})})})}var S=a(4581),A=a(9886),z=a(9197),k=a(4333);function F(e){let{onSaveProject:t,history:a,historyIndex:i,handleUndo:n,handleRedo:o,onUserOpen:l}=e,[d,c]=(0,r.useState)(!1);return(0,s.jsxs)("div",{className:"fixed top-0 left-0 right-0 z-50",children:[(0,s.jsx)("nav",{className:"bg-white h-16 border-b-gray-100 border-b-2 ",children:(0,s.jsx)("div",{className:"mx-auto px-4 h-full",children:(0,s.jsxs)("div",{className:"flex items-center justify-between h-full",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 text-foreground  gap-3",children:[(0,s.jsx)(j,{history:a,historyIndex:i,handleUndo:n,handleRedo:o}),(0,s.jsxs)("span",{className:"flex items-center gap-1 cursor-pointer",onClick:t,children:[(0,s.jsx)(C.A,{className:"w-4 h-4"})," "]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-4 text-foreground  gap-3",children:[(0,s.jsx)("span",{className:"flex items-center gap-1 cursor-pointer",children:(0,s.jsx)(S.A,{className:"w-4 h-4",onClick:()=>c(!0)})}),(0,s.jsxs)("span",{className:"flex items-center gap-1 cursor-pointer",children:[(0,s.jsx)(A.A,{className:"w-4 h-4",onClick:()=>l(!0)})," "]}),(0,s.jsx)(k.A,{className:"text-foreground"})]})]})})}),d&&(0,s.jsxs)("div",{className:"h-8 w-full bg-[#E5F4FF] px-6 py-3 flex justify-between items-center",children:[(0,s.jsxs)("span",{className:"text-[12px] text-foreground flex items-center gap-1",children:[(0,s.jsx)(S.A,{className:"w-4 h-4 text-[#888]"}),"至少需要设置1个房间、1扇门和1扇窗才可测算"]}),(0,s.jsx)(z.A,{className:"w-4 h-4 text-[#888]",onClick:()=>c(!1)})]})]})}function M(e){let{id:t,type:a,data:n,children:r,isOverCanvas:o}=e,{attributes:l,listeners:d,setNodeRef:c,transform:h,isDragging:p}=(0,i.PM)({id:t,data:{type:a,...n}}),u=h?{transform:"translate3d(".concat(h.x,"px, ").concat(h.y,"px, 0)"),opacity:p&&!o?.5:p&&o?0:1,position:"relative",zIndex:p?1e3:1,visibility:p&&o?"hidden":"visible"}:void 0;return(0,s.jsx)("div",{ref:c,style:u,...d,...l,className:"cursor-move",children:r})}function D(e){let{sidebarRef:t,roomItems:a,furnitureItems:i,isOverCanvas:n,draggingItemSize:r}=e;return(0,s.jsxs)("div",{ref:t,className:"md:block hidden overflow-auto overflow-x-hidden w-1/6 bg-white p-4 shadow border-r-gray-100 border-r-2",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:"房间"}),(0,s.jsx)("div",{className:"grid 2xl:grid-cols-3 xl:grid-cols-2 gap-2",children:a.map(e=>(0,s.jsx)(M,{id:e.id,type:e.type,data:e.data,isOverCanvas:n,children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,s.jsx)(f.default,{className:"p-3 bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:r,height:r})}),(0,s.jsx)("span",{className:"mt-1 text-sm text-gray-600",children:e.data.label})]})},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:"家具"}),(0,s.jsx)("div",{className:"grid 2xl:grid-cols-3 xl:grid-cols-2 gap-2",children:i.map(e=>(0,s.jsx)(M,{id:e.id,type:e.type,data:e.data,isOverCanvas:n,children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,s.jsx)(f.default,{className:"bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:r,height:r})}),(0,s.jsx)("span",{className:"mt-1 text-sm text-gray-600",children:e.data.label})]})},e.id))})]})]})}var B=a(4684),L=a(3121);function Y(e){let{className:t,...a}=e;return(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(B.bL,{"data-slot":"tabs",className:(0,y.cn)("flex flex-col gap-2",t),...a}),(0,s.jsx)(L.A,{className:"w-4 h-4 absolute top-2.5 right-5",onClick:()=>a.setShowTab(!1)})]})}function _(e){let{className:t,...a}=e;return(0,s.jsx)(B.B8,{"data-slot":"tabs-list",className:(0,y.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...a})}function G(e){let{className:t,...a}=e;return(0,s.jsx)(B.l9,{"data-slot":"tabs-trigger",className:(0,y.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}function H(e){let{className:t,...a}=e;return(0,s.jsx)(B.UC,{"data-slot":"tabs-content",className:(0,y.cn)("flex-1 outline-none",t),...a})}function X(e){let{showTab:t,setShowTab:a,roomItems:i,furnitureItems:n,isOverCanvas:o,draggingItemSize:l}=e,[d,c]=(0,r.useState)("");return(0,r.useEffect)(()=>{c("room")},[]),(0,s.jsx)("div",{style:{boxShadow:"0 -1px 5px 0px rgba(0, 0, 0, 0.2)"},className:(0,y.cn)("fixed bottom-0 left-0 z-10 w-full pb-20  pl-4 bg-white md:hidden rounded-t-2xl transition-transform duration-300 ease-in-out",t?"translate-y-0":"translate-y-full"),children:(0,s.jsxs)(Y,{value:d,className:"w-full gap-4",setShowTab:a,onValueChange:e=>c(e),children:[(0,s.jsxs)(_,{className:"mx-auto bg-white gap-8",children:[(0,s.jsx)(G,{defaultValue:!0,value:"room",className:"rounded-[3px] text-[12px] font-bold data-[state=active]:shadow-none data-[state=active]:border-b-4 data-[state=active]:border-b-primary",children:"房间"}),(0,s.jsx)(G,{value:"furniture",className:"rounded-[3px] text-[12px] font-bold data-[state=active]:shadow-none data-[state=active]:border-b-4 data-[state=active]:border-b-primary",children:"家具"})]}),(0,s.jsx)(H,{value:"room",className:"overflow-x-auto pb-7",children:(0,s.jsx)("div",{className:"grid grid-cols-6 gap-x-2 gap-y-4  min-w-110 w-auto",children:i.map(e=>(0,s.jsx)(M,{id:e.id,type:e.type,data:e.data,isOverCanvas:o,children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,s.jsx)(f.default,{className:"p-3 bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:l,height:l})}),(0,s.jsx)("span",{className:"mt-1 text-[12px] text-gray-600",children:e.data.label})]})},e.id))})}),(0,s.jsx)(H,{value:"furniture",className:"overflow-x-auto  pb-7",children:(0,s.jsx)("div",{className:"grid grid-rows-2 grid-cols-9 gap-x-2 gap-y-4  min-w-150 w-auto",children:n.map(e=>(0,s.jsx)(M,{id:e.id,type:e.type,data:e.data,isOverCanvas:o,children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,s.jsx)(f.default,{className:"bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:l,height:l})}),(0,s.jsx)("span",{className:"mt-1 text-sm text-gray-600",children:e.data.label})]})},e.id))})})]})})}async function P(e){let{url:t,method:a,headers:s={},body:i}=e;try{let e=await fetch(t,{method:a.toUpperCase(),headers:{"Content-Type":"application/json",...s},body:i?JSON.stringify(i):void 0});return await e.json()}catch(e){throw Error("ajax error ",e.message)}}async function V(e){return await P({url:e,method:"GET"})}async function W(e,t){return await P({url:e,method:"POST",body:t})}var K=a(2986),q=a(9571);function J(e){let{...t}=e;return(0,s.jsx)(q.bL,{"data-slot":"dialog",...t})}function Q(e){let{...t}=e;return(0,s.jsx)(q.ZL,{"data-slot":"dialog-portal",...t})}function Z(e){let{className:t,...a}=e;return(0,s.jsx)(q.hJ,{"data-slot":"dialog-overlay",className:(0,y.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function $(e){let{className:t,children:a,...i}=e;return(0,s.jsxs)(Q,{"data-slot":"dialog-portal",children:[(0,s.jsx)(Z,{}),(0,s.jsxs)(q.UC,{"data-slot":"dialog-content",className:(0,y.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...i,children:[a,(0,s.jsxs)(q.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,s.jsx)(z.A,{}),(0,s.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function ee(e){let{className:t,...a}=e;return(0,s.jsx)("div",{"data-slot":"dialog-header",className:(0,y.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function et(e){let{className:t,...a}=e;return(0,s.jsx)(q.hE,{"data-slot":"dialog-title",className:(0,y.cn)("text-lg leading-none font-semibold",t),...a})}var ea=a(830);function es(e){let{className:t,orientation:a="horizontal",decorative:i=!0,...n}=e;return(0,s.jsx)(ea.b,{"data-slot":"separator-root",decorative:i,orientation:a,className:(0,y.cn)("bg-border shrink-0 data-[orientation=horizontal]:h-px data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-px",t),...n})}var ei=a(5945),en=a(9929);let er=(0,a(3484).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function eo(e){let{className:t,variant:a,size:i,asChild:n=!1,...r}=e,o=n?en.DX:"button";return(0,s.jsx)(o,{"data-slot":"button",className:(0,y.cn)(er({variant:a,size:i,className:t})),...r})}var el=a(9777),ed=a(1659);function ec(e){let{className:t,...a}=e;return(0,s.jsx)(el.bL,{"data-slot":"radio-group",className:(0,y.cn)("grid gap-3",t),...a})}function eh(e){let{className:t,...a}=e;return(0,s.jsx)(el.q7,{"data-slot":"radio-group-item",className:(0,y.cn)("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,s.jsx)(el.C1,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,s.jsx)(ed.A,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var ep=a(5586);function eu(e){let{className:t,...a}=e;return(0,s.jsx)(ep.b,{"data-slot":"label",className:(0,y.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}a(889),a(945);var eg=a(1606),ex=a(9013);let em=Array.from({length:100},(e,t)=>(2025-t).toString()),ef=Array.from({length:12},(e,t)=>(t+1).toString().padStart(2,"0")),ev=Array.from({length:31},(e,t)=>(t+1).toString().padStart(2,"0")),eb=Array.from({length:24},(e,t)=>t.toString().padStart(2,"0"));class ey extends r.Component{componentDidMount(){this.props.value&&this.setState({value:this.props.value})}componentDidUpdate(e,t){this.props.value&&this.props.value!==e.value&&this.setState({value:this.props.value})}render(){return(0,s.jsx)("div",{style:{background:"#f5f5f9",padding:0},children:(0,s.jsxs)(eg.A,{selectedValue:this.state.value,onValueChange:this.onChange,children:[(0,s.jsx)(ex.A,{indicatorClassName:"my-picker-indicator",children:this.renderItems(em,"年")}),(0,s.jsx)(ex.A,{indicatorClassName:"my-picker-indicator",children:this.renderItems(ef,"月")}),(0,s.jsx)(ex.A,{indicatorClassName:"my-picker-indicator",children:this.renderItems(ev,"日")}),(0,s.jsx)(ex.A,{indicatorClassName:"my-picker-indicator",children:this.renderItems(eb,"时")})]})})}constructor(...e){super(...e),this.state={value:[]},this.onChange=e=>{this.setState({value:e}),this.props.onChange&&this.props.onChange(e)},this.renderItems=(e,t)=>e.map(e=>(0,s.jsx)(ex.A.Item,{className:"my-picker-view-item",value:e,children:e+t}))}}function ej(e){let{open:t,onUserOpen:a,onSubmit:i,userInfo:n}=e,o=(0,w.A)(),[l,d]=(0,r.useState)("男"),[c,h]=(0,r.useState)("1996"),[p,u]=(0,r.useState)("03"),[g,x]=(0,r.useState)("12"),[m,f]=(0,r.useState)("22");(0,r.useEffect)(()=>{if(n&&(d(n.gender||"male"),n.birthDateTime)){let e=new Date(n.birthDateTime);h(e.getFullYear().toString()),u((e.getMonth()+1).toString().padStart(2,"0")),x(e.getDate().toString().padStart(2,"0")),f(e.getHours().toString().padStart(2,"0"))}},[n]);let v=()=>{i({gender:l,birthDateTime:new Date(parseInt(c),parseInt(p)-1,parseInt(g),parseInt(m))})},b=e=>{e&&(h(e[0]),u(e[1]),x(e[2]),f(e[3]))};return(0,s.jsx)(J,{open:t,onOpenChange:a,children:(0,s.jsxs)($,{className:"sm:max-w-[432px]",children:[(0,s.jsxs)(ee,{children:[(0,s.jsx)(et,{className:"text-lg md:text-xl font-bold md:text-left text-center",children:"个人资料"}),(0,s.jsx)("div",{className:"py-4 text-sm md:text-base  text-left",children:"您的个人资料仅用于此次测算"})]}),(0,s.jsx)(es,{className:"md:hidden"}),(0,s.jsxs)("div",{className:"grid gap-4 pb-4",children:[o?(0,s.jsx)(()=>(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(eu,{className:"text-base",children:"性别"}),(0,s.jsxs)("div",{className:"flex bg-gray-200 p-1 rounded-[6px]  ",children:[(0,s.jsx)("button",{style:{boxShadow:"0 1px 5px 0px rgba(0, 0, 0, 0.3)"},className:"rounded-[6px] px-4 py-1 ".concat("male"===l?"bg-white":"transparent"),onClick:()=>d("male"),children:"男"}),(0,s.jsx)("button",{className:"rounded-[6px] px-4 py-1 ".concat("female"===l?"bg-white":"transparent"),onClick:()=>d("female"),children:"女"})]})]}),{}):(0,s.jsx)(()=>(0,s.jsxs)("div",{className:"space-y-2 pb-4",children:[(0,s.jsx)(eu,{className:"font-bold pb-2 text-base",children:"性别"}),(0,s.jsxs)(ec,{value:l,onValueChange:d,className:"flex space-x-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eh,{value:"male",id:"male"}),(0,s.jsx)(eu,{htmlFor:"male",children:"男"})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(eh,{value:"female",id:"female"}),(0,s.jsx)(eu,{htmlFor:"female",children:"女"})]})]})]}),{}),(0,s.jsx)(es,{className:"md:hidden"}),o?(0,s.jsx)(()=>(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex justify-between pb-4",children:[(0,s.jsx)(eu,{className:"text-base",children:"出生日期"}),(0,s.jsx)("span",{children:"".concat(c,"年").concat(p,"月").concat(g,"日").concat(m,"时")})]}),(0,s.jsx)(es,{}),(0,s.jsx)(ey,{onChange:b,value:[c,p,g,m]}),(0,s.jsx)(es,{})]}),{}):(0,s.jsx)(()=>(0,s.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(eu,{className:"font-bold pb-4 text-base",children:"年"}),(0,s.jsxs)(ei.l6,{value:c,onValueChange:h,children:[(0,s.jsx)(ei.bq,{className:"w-24",children:(0,s.jsx)(ei.yv,{placeholder:"年"})}),(0,s.jsx)(ei.gC,{children:em.map(e=>(0,s.jsxs)(ei.eb,{value:e,children:[e,"年"]},e))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(eu,{className:"font-bold pb-4 text-base",children:"月"}),(0,s.jsxs)(ei.l6,{value:p,onValueChange:u,children:[(0,s.jsx)(ei.bq,{className:"w-24",children:(0,s.jsx)(ei.yv,{placeholder:"月"})}),(0,s.jsx)(ei.gC,{children:ef.map(e=>(0,s.jsxs)(ei.eb,{value:e,children:[e,"月"]},e))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(eu,{className:"font-bold pb-4 text-base",children:"日"}),(0,s.jsxs)(ei.l6,{value:g,onValueChange:x,children:[(0,s.jsx)(ei.bq,{className:"w-20",children:(0,s.jsx)(ei.yv,{placeholder:"日"})}),(0,s.jsx)(ei.gC,{children:ev.map(e=>(0,s.jsxs)(ei.eb,{value:e,children:[e,"日"]},e))})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(eu,{className:"font-bold pb-4 text-base",children:"小时"}),(0,s.jsxs)(ei.l6,{value:m,onValueChange:f,children:[(0,s.jsx)(ei.bq,{className:"w-20",children:(0,s.jsx)(ei.yv,{placeholder:"时"})}),(0,s.jsx)(ei.gC,{children:eb.map(e=>(0,s.jsxs)(ei.eb,{value:e,children:[e,"时"]},e))})]})]})]}),{}),o?(0,s.jsxs)("div",{className:"flex justify-around",children:[(0,s.jsx)(eo,{onClick:()=>{a(!1)},className:"px-10 border-1 border-[#ccc] text-foreground rounded-[100px] bg-white font-bold mt-10",children:"取消"}),(0,s.jsx)(eo,{onClick:v,className:"px-10 bg-[#13ab87] font-bold mt-10 rounded-[100px]",children:"保存"})]}):(0,s.jsx)(eo,{onClick:v,className:"w-full bg-[#13ab87] font-bold mt-10 rounded-[100px]",children:"保存"})]})]})})}var eN=a(3852),ew=a(7386),eR=a.n(ew);let eO={[l.LIVING_ROOM]:"#F0DF9C",[l.DINING_ROOM]:"#F5D4BC",[l.STORAGE_ROOM]:"#ADC0BC",[l.STUDY_ROOM]:"#B0B8C9",[l.BEDROOM]:"#F5B8B8",[l.BATHROOM]:"#C1D7E2",[l.KITCHEN]:"#EDE0C6",[l.BALCONY]:"#D0DCAA",[l.GARDEN]:"#AACDBC",[l.GARAGE]:"#C7C7DD",[l.CORRIDOR]:"#CDCDCD"},eI={width:324,height:324},eT=[{id:"living-room",type:o.ROOM,data:{cateType:o.ROOM,type:l.LIVING_ROOM,label:"客厅",icon:"/images/room-icon/room.png",size:eI}},{id:"dining-room",type:o.ROOM,data:{cateType:o.ROOM,type:l.DINING_ROOM,label:"饭厅",icon:"/images/room-icon/room.png",size:eI}},{id:"storage-room",type:o.ROOM,data:{cateType:o.ROOM,type:l.STORAGE_ROOM,label:"储物室",icon:"/images/room-icon/room.png",size:eI}},{id:"study-room",type:o.ROOM,data:{cateType:o.ROOM,type:l.STUDY_ROOM,label:"书房",icon:"/images/room-icon/room.png",size:eI}},{id:"bedroom",type:o.ROOM,data:{cateType:o.ROOM,type:l.BEDROOM,label:"睡房",icon:"/images/room-icon/room.png",size:eI}},{id:"bathroom",type:o.ROOM,data:{cateType:o.ROOM,type:l.BATHROOM,label:"浴室",icon:"/images/room-icon/room.png",size:eI}},{id:"kitchen",type:o.ROOM,data:{cateType:o.ROOM,type:l.KITCHEN,label:"厨房",icon:"/images/room-icon/room.png",size:eI}},{id:"balcony",type:o.ROOM,data:{cateType:o.ROOM,type:l.BALCONY,label:"阳台",icon:"/images/room-icon/room.png",size:eI}},{id:"garden",type:o.ROOM,data:{cateType:o.ROOM,type:l.GARDEN,label:"花园",icon:"/images/room-icon/room.png",size:eI}},{id:"garage",type:o.ROOM,data:{cateType:o.ROOM,type:l.GARAGE,label:"车库",icon:"/images/room-icon/room.png",size:eI}},{id:"corridor",type:o.ROOM,data:{cateType:o.ROOM,type:l.CORRIDOR,label:"走廊",icon:"/images/room-icon/room.png",size:eI}}],eE=[{id:"door-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.DOOR,label:"门",icon:"/images/fur-icon/door.png",activeIcon:"/images/fur-icon/door-gr.png",size:{width:40,height:40}}},{id:"window-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.WINDOW,label:"窗",icon:"/images/fur-icon/window.png",activeIcon:"/images/fur-icon/window-gr.png",size:{width:8,height:56}}},{id:"table-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.TABLE,label:"枱",icon:"/images/fur-icon/table.png",activeIcon:"/images/fur-icon/table-gr.png",size:{width:44,height:120}}},{id:"chair-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.CHAIR,label:"椅子",icon:"/images/fur-icon/chair.png",activeIcon:"/images/fur-icon/chair-gr.png",size:{width:28,height:35}}},{id:"sofa-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.SOFA,label:"沙发",icon:"/images/fur-icon/sofa.png",activeIcon:"/images/fur-icon/sofa-gr.png",size:{width:67,height:123}}},{id:"bed-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.BED,label:"床",icon:"/images/fur-icon/bed.png",activeIcon:"/images/fur-icon/bed-gr.png",size:{width:89,height:128}}},{id:"lamp-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.LAMP,label:"儿童床",icon:"/images/fur-icon/lamp.png",activeIcon:"/images/fur-icon/lamp-gr.png",size:{width:70,height:128}}},{id:"tv-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.TV,label:"电视",icon:"/images/fur-icon/tv.png",activeIcon:"/images/fur-icon/tv-gr.png",size:{width:134,height:32}}},{id:"bookshelf-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.BOOKSHELF,label:"茶几",icon:"/images/fur-icon/bookshelf.png",activeIcon:"/images/fur-icon/bookshelf-gr.png",size:{width:44,height:44}}},{id:"wardrobe-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.WARDROBE,label:"柜",icon:"/images/fur-icon/wardrobe.png",activeIcon:"/images/fur-icon/wardrobe-gr.png",size:{width:40,height:129}}},{id:"plant-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.PLANT,label:"植物",icon:"/images/fur-icon/plant.png",activeIcon:"/images/fur-icon/plant-gr.png",size:{width:36,height:36}}},{id:"fridge-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.FRIDGE,label:"冰箱",icon:"/images/fur-icon/fridge.png",activeIcon:"/images/fur-icon/fridge-gr.png",size:{width:40,height:43}}},{id:"stove-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.STOVE,label:"炉具",icon:"/images/fur-icon/stove.png",activeIcon:"/images/fur-icon/stove-gr.png",size:{width:62,height:32}}},{id:"sink-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.SINK,label:"锌盘",icon:"/images/fur-icon/sink.png",activeIcon:"/images/fur-icon/sink-gr.png",size:{width:60,height:40}}},{id:"washbasin-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.WASHBASIN,label:"洗手盘",icon:"/images/fur-icon/washbasin.png",activeIcon:"/images/fur-icon/washbasin-gr.png",size:{width:50,height:50}}},{id:"toilet-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.TOILET,label:"马桶",icon:"/images/fur-icon/toilet.png",activeIcon:"/images/fur-icon/toilet-gr.png",size:{width:40,height:60}}},{id:"shower-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.SHOWER,label:"淋浴",icon:"/images/fur-icon/shower.png",activeIcon:"/images/fur-icon/shower-gr.png",size:{width:80,height:80}}},{id:"bathtub-template",type:o.FURNITURE,data:{cateType:o.FURNITURE,type:d.BATHTUB,label:"浸浴",icon:"/images/fur-icon/bathtub.png",activeIcon:"/images/fur-icon/bathtub-gr.png",size:{width:120,height:60}}}];function eC(){var e,t;let a=(0,i.FR)((0,i.MS)(i.IG,{tolerance:50}),(0,i.MS)(i.cA,{activationConstraint:{distance:10}})),[l,d]=(0,r.useState)(null),[c,h]=(0,r.useState)(!1),[p,u]=(0,r.useState)(0),[g,x]=(0,r.useState)(!1),[m,v]=(0,r.useState)([[]]),[b,y]=(0,r.useState)(0),[j,N]=(0,r.useState)(!1),[R,I]=(0,r.useState)({}),[T,E]=(0,r.useState)(!1),C=(0,r.useRef)(null),S=(0,r.useRef)(null),A=(0,w.A)(),z=A?48:56,{data:k}=(0,K.wV)();(0,r.useEffect)(()=>{eN.oR.success("用户信息保存成功！");let e=()=>{S.current&&u(S.current.offsetWidth)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,r.useEffect)(()=>{(async()=>{var e,t,a,s;let i=null==k?void 0:null===(e=k.user)||void 0===e?void 0:e.userId;if(i)try{let{status:e,data:n}=await V("/api/users/".concat(i)),{data:r}=await V("/api/design/".concat(i));I(n),N(!0);let{localItems:o=[],canvasPosition:l={x:0,y:0},compassRotation:d=0}=r,c=o.map(e=>({...e,type:e._type,data:{...e.data,type:e.data._type}}));null===(t=C.current)||void 0===t||t.setLocalItems(c),null===(a=C.current)||void 0===a||a.setPosition(l),null===(s=C.current)||void 0===s||s.setCompassRotation(d)}catch(e){console.error("Error loading design:",e)}})()},[null==k?void 0:null===(e=k.user)||void 0===e?void 0:e.userId]);let M=(e,t)=>{let{over:a}=e,s=(null==a?void 0:a.id)==="canvas";if(h(s),s){let e=C.current.getLocalItems(),a="".concat(l.data.current.label).concat(e.filter(e=>e.data.type===l.data.current.type).length+1),s={id:"".concat(l.data.current.type,"-").concat(e.filter(e=>e.data.type===l.data.current.type).length+1),type:l.data.current.cateType,data:{...l.data.current,label:l.data.current.cateType===o.ROOM?a:""},size:l.data.current.size,activeIcon:l.data.current.activeIcon};C.current.setIsRoomDragging(!0),C.current.setRoomDragStart(t),C.current.setDraggedRoom(s)}else C.current.setIsRoomDragging(!1)},B=async()=>{var e;(null==k?void 0:null===(e=k.user)||void 0===e?void 0:e.userId)||(0,n.redirect)("/auth/login");try{E(!0);let{status:e}=await W("/api/design/".concat(k.user.userId),{localItems:C.current.getLocalItems(),canvasPosition:C.current.position,compassRotation:C.current.compassRotation});0==e&&eN.oR.success("保存成功！")}catch(e){console.error("Error saving design:",e)}finally{E(!1)}},L=async()=>{await B()},Y=()=>{if(b>0){var e,t;null===(e=C.current)||void 0===e||e.setActiveRoom(null),y(e=>e-1),null===(t=C.current)||void 0===t||t.setLocalItems(m[b-1])}},_=()=>{if(b<m.length-1){var e,t;null===(e=C.current)||void 0===e||e.setActiveRoom(null),y(e=>e+1),null===(t=C.current)||void 0===t||t.setLocalItems(m[b+1])}},G=async e=>{var t;(null==k?void 0:null===(t=k.user)||void 0===t?void 0:t.userId)||(0,n.redirect)("/auth/login"),E(!0),I(e);try{let{status:t}=await W("/api/users/".concat(k.user.userId),{gender:e.gender,birthDateTime:e.birthDateTime.toISOString()});0==t&&(eN.oR.success("用户信息保存成功！"),N(!1))}catch(e){eN.oR.error("用户信息保存失败："+e.message),console.error("Error saving user info:",e)}finally{E(!1)}};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eR(),{color:"#666",loading:T,cssOverride:{position:"fixed",left:"50%",top:"50%",zIndex:60},size:30,"aria-label":"loading...","data-testid":"loader"}),(0,s.jsx)(ej,{open:j,onUserOpen:N,onSubmit:G,userInfo:R}),A?(0,s.jsx)(F,{onSaveProject:B,history:m,historyIndex:b,handleUndo:Y,handleRedo:_,onUserOpen:N}):(0,s.jsx)(U,{onSaveProject:B,onUserOpen:N}),(0,s.jsx)("div",{className:"pt-16",children:(0,s.jsxs)(i.Mp,{sensors:a,onDragStart:e=>{let{active:t}=e;d(t),h(!1)},onDragOver:e=>{A||M(e,{x:p,y:z})},onDragMove:e=>{A&&e.delta.y<-120&&M(e,{x:0,y:78})},children:[(0,s.jsx)("div",{className:"min-h-[calc(100vh-64px)] bg-gray-50",children:(0,s.jsx)("div",{className:"container p-0",style:{maxWidth:"100%"},children:(0,s.jsxs)("div",{className:"flex h-[calc(100vh-64px)]",children:[A?(0,s.jsx)(X,{showTab:g,setShowTab:x,roomItems:eT,furnitureItems:eE,isOverCanvas:c,draggingItemSize:z}):(0,s.jsx)(D,{sidebarRef:S,roomItems:eT,furnitureItems:eE,isOverCanvas:c,draggingItemSize:z}),(0,s.jsx)("div",{className:"flex-1 overflow-auto",id:"canvas-drop-area",children:(0,s.jsx)(O,{ref:C,history:m,historyIndex:b,setHistory:v,setHistoryIndex:y,handleUndo:Y,handleRedo:_,onGenReport:L,showTab:g,onShowTab:()=>{x(!0)}})})]})})}),(0,s.jsx)(i.Hd,{children:(null==l?void 0:l.id)&&c&&(l.data.current.cateType===o.ROOM?(0,s.jsx)("div",{className:"flex flex-col items-center justify-center bg-white/80 rounded-lg",style:{transform:A?"translateY(78px)":"translateY(0)",width:eI.width,height:eI.height,border:"8px solid",borderColor:eO[null===(t=eT.find(e=>e.id===l.id))||void 0===t?void 0:t.data.type],borderRadius:"8px"},children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(f.default,{className:"bg-[#EFF7F4] rounded-lg",src:l.data.current.icon,alt:"Room",width:z,height:z}),(0,s.jsx)("span",{className:"mt-1 text-sm text-gray-600",children:l.data.current.label+(C.current.getLocalItems().filter(e=>e.data.type===l.data.current.type).length+1)})]})}):(0,s.jsx)(f.default,{src:l.data.current.activeIcon,alt:"Furniture",width:l.data.current.size.width,height:l.data.current.size.height}))})]})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[837,265,149,673,186,522,644,497,954,358],()=>t(3456)),_N_E=e.O()}]);