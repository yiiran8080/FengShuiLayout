(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{2387:(e,t,a)=>{"use strict";async function s(e){let{url:t,method:a,headers:s={},body:i,isCached:n}=e;try{let e=await fetch(t,{method:a.toUpperCase(),headers:{"Content-Type":"application/json",...s},body:i?JSON.stringify(i):void 0,cache:n?"force-cache":"no-store"});return await e.json()}catch(e){throw console.log("ajax error",e),Error("ajax error ",e.message)}}async function i(e,t){return await s({url:e,method:"GET",...t})}async function n(e,t){return await s({url:e,method:"POST",body:t})}async function r(e,t){return await s({url:e,method:"PATCH",body:t})}a.d(t,{F6:()=>r,Jt:()=>i,bE:()=>n})},4075:(e,t,a)=>{"use strict";let s;a.r(t),a.d(t,{default:()=>eP});var i=a(3243),n=a(6249),r=a(5323),l=a(7416),o=a(4318),d=a(7843);let c=(0,a(3944).F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function h(e){let{className:t,variant:a,size:s,asChild:n=!1,...r}=e,l=n?d.DX:"button";return(0,i.jsx)(l,{"data-slot":"button",className:(0,o.cn)(c({variant:a,size:s,className:t})),...r})}function u(e){let{...t}=e;return(0,i.jsx)(l.bL,{"data-slot":"alert-dialog",...t})}function p(e){let{...t}=e;return(0,i.jsx)(l.l9,{"data-slot":"alert-dialog-trigger",...t})}function x(e){let{...t}=e;return(0,i.jsx)(l.ZL,{"data-slot":"alert-dialog-portal",...t})}function g(e){let{className:t,...a}=e;return(0,i.jsx)(l.hJ,{"data-slot":"alert-dialog-overlay",className:(0,o.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function m(e){let{className:t,...a}=e;return(0,i.jsxs)(x,{children:[(0,i.jsx)(g,{}),(0,i.jsx)(l.UC,{"data-slot":"alert-dialog-content",className:(0,o.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function b(e){let{className:t,...a}=e;return(0,i.jsx)("div",{"data-slot":"alert-dialog-header",className:(0,o.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function f(e){let{className:t,...a}=e;return(0,i.jsx)("div",{"data-slot":"alert-dialog-footer",className:(0,o.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function v(e){let{className:t,...a}=e;return(0,i.jsx)(l.hE,{"data-slot":"alert-dialog-title",className:(0,o.cn)("text-lg font-semibold",t),...a})}function y(e){let{className:t,...a}=e;return(0,i.jsx)(l.VY,{"data-slot":"alert-dialog-description",className:(0,o.cn)("text-muted-foreground text-sm",t),...a})}function w(e){let{className:t,...a}=e;return(0,i.jsx)(l.rc,{className:(0,o.cn)(c(),t,"text-white"),...a})}function j(e){let{className:t,...a}=e;return(0,i.jsx)(l.ZD,{className:(0,o.cn)(c({variant:"outline"}),t),...a})}var N=a(4041),R=a(9126),O=a(2378),I=a.n(O),T=a(2751),E=a(4449),C=a(1238),S=a(3224),A=a(8204),D=a(6420),z=a(2326);function U(e){let{history:t,historyIndex:a,handleUndo:s,handleRedo:n,className:r}=e;return(0,i.jsxs)("div",{className:(0,o.cn)("flex items-center gap-2",r),children:[(0,i.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 ".concat(a<=0?"text-gray-300":"text-gray-600"),onClick:s,disabled:a<=0,children:(0,i.jsx)(D.A,{className:"w-4 h-4"})}),(0,i.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 ".concat(a>=t.length-1?"text-gray-300":"text-gray-600"),onClick:n,disabled:a>=t.length-1,children:(0,i.jsx)(z.A,{className:"w-4 h-4"})})]})}var M=a(217),F=a(5919),k=a(1400);let $=(0,r.forwardRef)((e,t)=>{let{items:a,onShowTab:l,showTab:d,history:c,historyIndex:h,setHistory:x,setHistoryIndex:g,handleUndo:y,handleRedo:N,onGenReport:O,locale:D}=e,z="zh-TW"===D?R.Gx:R.Qc,$=(0,M.c3)("design"),B=(0,F.A)(),[L,G]=(0,r.useState)({x:0,y:0}),[_,H]=(0,r.useState)(!1),[Y,P]=(0,r.useState)({x:0,y:0}),[W,X]=(0,r.useState)(null),[V,K]=(0,r.useState)({width:2e3,height:2e3}),[q,J]=(0,r.useState)(!1),[Q,Z]=(0,r.useState)({x:0,y:0}),[ee,et]=(0,r.useState)(null),[ea,es]=(0,r.useState)([]),[ei,en]=(0,r.useState)(!1),[er,el]=(0,r.useState)({x:0,y:0}),[eo,ed]=(0,r.useState)(null),[ec,eh]=(0,r.useState)(100),[eu,ep]=(0,r.useState)({originScale:100,isMoving:!1,pageX:0,pageY:0,pageX2:0,pageY2:0,initialDistance:0}),[ex,eg]=(0,r.useState)(0);(0,r.useImperativeHandle)(t,()=>({getLocalItems:()=>ea,setLocalItems:es,setActiveRoom:X,setIsRoomDragging:J,setDraggedRoom:et,setRoomDragStart:Z,setPosition:G,setCompassRotation:eg,getPosition:()=>L,getCompassRotation:()=>ex,getScale:()=>ec,setScale:eh}),[ea,L,ex,ec]);let em=(0,r.useRef)(null),{setNodeRef:eb}=(0,n.zM)({id:"canvas",data:{accepts:[R.w$.ROOM,R.w$.FURNITURE]}});(0,r.useEffect)(()=>{var e;s=null===(e=document.getElementById("canvas-drop-area"))||void 0===e?void 0:e.getBoundingClientRect()},[]);let ef=(e,t,a,s)=>Math.sqrt(Math.pow(a-e,2)+Math.pow(s-t,2)),ev=(0,r.useCallback)(e=>{var t,a;if(!e.target.closest('[data-room-element="true"]')&&"canvas"===e.target.id&&(0===e.button||e.touches)){if((null===(t=e.touches)||void 0===t?void 0:t.length)===2){let t=e.touches[0],a=e.touches[1],s=ef(t.pageX,t.pageY,a.pageX,a.pageY);ep(e=>({...e,isMoving:!0,pageX:t.pageX,pageY:t.pageY,pageX2:a.pageX,pageY2:a.pageY,initialDistance:s,originScale:ec}));return}X(null),H(!0),(null===(a=e.touches)||void 0===a?void 0:a.length)===1?P({x:e.touches[0].clientX-L.x,y:e.touches[0].clientY-L.y}):P({x:e.clientX-L.x,y:e.clientY-L.y})}},[L,ec]),ey=(e,t)=>{if(!e.position||!t.position)return!1;let a=20;return console.log("家具在里面",e.rotation),(-90===e.rotation||-270===e.rotation)&&(console.log("ss",e.size.width,e.size.height),a=Math.abs(e.size.width-e.size.height)/2+a),e.position.x+a>=t.position.x&&e.position.x<=t.position.x+t.size.width&&e.position.x-a+e.size.width<=t.position.x+t.size.width&&e.position.y+a>=t.position.y&&e.position.y<=t.position.y+t.size.height&&e.position.y-a+e.size.height<=t.position.y+t.size.height},ew=(0,r.useCallback)((e,t)=>{var a;if(e.stopPropagation(),J(!0),et(t),(null===(a=e.touches)||void 0===a?void 0:a.length)==1?Z({x:e.touches[0].clientX-t.position.x,y:e.touches[0].clientY-t.position.y}):Z({x:e.clientX-t.position.x,y:e.clientY-t.position.y}),t.type===R.w$.ROOM){let e=ea.map(e=>e.type===R.w$.FURNITURE&&ey(e,t)?{...e,parentId:t.id,offset:{x:e.position.x-t.position.x,y:e.position.y-t.position.y}}:{...e,parentId:null});es(ea.map(t=>e.find(e=>e.id===t.id)||t))}},[ea]),ej=(0,r.useCallback)((e,t,a)=>{var s;e.stopPropagation(),en(!0),ed(a),(null===(s=e.touches)||void 0===s?void 0:s.length)==1?el({x:e.touches[0].clientX,y:e.touches[0].clientY}):el({x:e.clientX,y:e.clientY})},[]);I().throttle(k.oR.info,3e3);let eN=e=>{var t,a,i,n,r;if(e.preventDefault(),(null===(t=e.touches)||void 0===t?void 0:t.length)===2){let t=e.touches[0],a=e.touches[1],s=ef(t.pageX,t.pageY,a.pageX,a.pageY);eu.initialDistance?s>eu.initialDistance?eI("in",1):eI("out",1):ep(e=>({...e,initialDistance:s,originScale:ec}))}else if(ei&&W&&eo){let t,s;(null===(a=e.touches)||void 0===a?void 0:a.length)==1?(t=e.touches[0].clientX-er.x,s=e.touches[0].clientY-er.y):(t=e.clientX-er.x,s=e.clientY-er.y);let n=W.size.width/W.size.height;es(ea.map(e=>{if(e.id===W.id){let a;let i={...e.size},r={...e.position};switch(eo){case"top-left":i.width=e.size.width-t,W.type===R.w$.ROOM?i.height=e.size.height-s:i.height=i.width/n,r.x=e.position.x+t,r.y=e.position.y+s;break;case"top-right":i.width=e.size.width+t,W.type===R.w$.ROOM?i.height=e.size.height-s:i.height=i.width/n,r.y=e.position.y+s;break;case"bottom-left":i.width=e.size.width-t,W.type===R.w$.ROOM?i.height=e.size.height+s:i.height=i.width/n,r.x=e.position.x+t;break;case"bottom-right":i.width=e.size.width+t,W.type===R.w$.ROOM?i.height=e.size.height+s:i.height=i.width/n}if(e.type===R.w$.ROOM?i.width>=100&&i.height>=100:e.data.type===R.x9.WINDOW?i.width>=8&&i.height>=8:i.width>=20&&i.height>=20)return{...e,size:i,position:r}}return e})),(null===(i=e.touches)||void 0===i?void 0:i.length)==1?el({x:e.touches[0].clientX,y:e.touches[0].clientY}):el({x:e.clientX,y:e.clientY})}else if(q&&ee){let t,a;(null===(n=e.touches)||void 0===n?void 0:n.length)==1?(t=e.touches[0].clientX-Q.x,a=e.touches[0].clientY-Q.y):(t=e.clientX-Q.x,a=e.clientY-Q.y),t=Math.max(0,t),a=Math.max(0,a);let s=[];if(ee.type===R.w$.ROOM){let e=ea.filter(e=>e.type===R.w$.FURNITURE&&e.parentId===ee.id).map(e=>e.id);s=ea.map(s=>{if(s.id===ee.id)return{...s,position:{x:t,y:a}};if(e.includes(s.id)){var i,n;return{...s,position:{x:t+(null===(i=s.offset)||void 0===i?void 0:i.x)||0,y:a+(null===(n=s.offset)||void 0===n?void 0:n.y)||0}}}return s})}else s=ea.map(e=>e.id===ee.id?{...e,position:{x:t,y:a}}:e);es(s)}else if(_){let t,a,i,n;(null===(r=e.touches)||void 0===r?void 0:r.length)===1?(t=e.touches[0].clientX-Y.x,a=e.touches[0].clientY-Y.y):(t=e.clientX-Y.x,a=e.clientY-Y.y),t>0&&(t=0),a>0&&(a=0),t<-1e3&&(t=-1e3),a<-1e3&&(a=-1e3),2e3+t<s.width/(ec/100)&&(i=(2e3-t)/(ec/100)),2e3+a<s.height/(ec/100)&&(n=(2e3-a)/(ec/100)),G({x:t,y:a}),K({width:i||V.width,height:n||V.height})}},eR=(0,r.useCallback)(e=>{var t,a;if((null===(t=e.touches)||void 0===t?void 0:t.length)<2&&ep(e=>({...e,isMoving:!1,initialDistance:0})),q||ei){let t,s,i;if((null===(a=e.changedTouches)||void 0===a?void 0:a.length)==1?(t=e.changedTouches[0].clientX-Q.x-L.x,s=e.changedTouches[0].clientY-Q.y-L.y):(t=e.clientX-Q.x-L.x,s=e.clientY-Q.y-L.y),ee&&!ea.some(e=>e.id===ee.id)){let e={...ee,position:{x:t/(ec/100),y:s/(ec/100)},data:{...ee.data,label:"".concat(ee.data.label)}};es(i=[...ea,e]),eO(e,i)}else i=ea;let n=c.slice(0,h+1);n.push(i),x(n),g(n.length-1)}H(!1),J(!1),et(null),en(!1),ed(null)},[q,ei,ea,c,h,Q,ee,L,eu]),eO=(e,t)=>{if(e.type===R.w$.FURNITURE){let a=t||ea,s=a.find(t=>t.type===R.w$.ROOM&&ey(e,t));if(s){let t=a.filter(t=>t.type===R.w$.FURNITURE&&t.data.type===e.data.type&&ey(t,s)).sort((e,t)=>e.position.x-t.position.x).map((t,a)=>{let i="".concat(s.data.label,"-").concat(z[e.data.type]).concat(a+1);return t.id===e.id&&(e.data.label=i,e.data.parentRoom=s),{...t,data:{...t.data,label:i,parentRoom:s}}});es(a.map(e=>t.find(t=>t.id===e.id)||e))}else{console.log("选中家具，当前未匹配到房间");let t=I().cloneDeep(a),s=t.filter(t=>t.id===e.id)[0];s&&(s.data.label="未分配-".concat(z[s.data.type]),s.data.parentRoom=null,e.data.label="未分配-".concat(z[s.data.type]),e.data.parentRoom=null,es(t))}}setTimeout(()=>{X(e)})};function eI(e){let t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;if("in"===e&&ec<120)t=ec+a;else if("out"===e&&ec>50)t=ec-a;else{if("reset"!==e)return;t=100}"out"===e&&K({width:(V.width-(L.x<0?L.x:0))*(1+(ec-t)/100),height:(V.height-(L.y<0?L.y:0))*(1+(ec-t)/100)}),eh(t)}(0,r.useEffect)(()=>{let e=em.current;if(e)return e.addEventListener("mousedown",ev),window.addEventListener("mousemove",eN),window.addEventListener("mouseup",eR),e.addEventListener("touchstart",ev),window.addEventListener("touchmove",eN,{passive:!1}),window.addEventListener("touchend",eR),()=>{e.removeEventListener("mousedown",ev),window.removeEventListener("mousemove",eN),window.removeEventListener("mouseup",eR),e.removeEventListener("touchstart",ev),window.removeEventListener("touchmove",eN),window.removeEventListener("touchend",eR)}},[ev,eN,eR]);let eT=(0,r.useCallback)(()=>{W&&es(ea.map(e=>{if(e.id===W.id){let t=((e.rotation||0)-45)%360;return{...e,rotation:t}}return e}))},[W,ea]),eE=e=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("div",{className:"absolute w-3 h-3 bg-white border border-red-500 cursor-nw-resize rounded-full",style:{top:-6,left:-6},onMouseDown:t=>ej(t,e,"top-left"),onTouchStart:t=>ej(t,e,"top-left")}),(0,i.jsx)("div",{className:"absolute w-3 h-3 bg-white border border-red-500 cursor-ne-resize rounded-full",style:{top:-6,right:-6},onMouseDown:t=>ej(t,e,"top-right"),onTouchStart:t=>ej(t,e,"top-right")}),(0,i.jsx)("div",{className:"absolute w-3 h-3 bg-white border border-red-500 cursor-sw-resize rounded-full",style:{bottom:-6,left:-6},onMouseDown:t=>ej(t,e,"bottom-left"),onTouchStart:t=>ej(t,e,"bottom-left")}),(0,i.jsx)("div",{className:"absolute w-3 h-3 bg-white border border-red-500 cursor-se-resize rounded-full",style:{bottom:-6,right:-6},onMouseDown:t=>ej(t,e,"bottom-right"),onTouchStart:t=>ej(t,e,"bottom-right")})]});return(0,i.jsxs)("div",{ref:e=>{em.current=e,eb(e)},className:"relative w-full min-h-[calc(100vh-64px)] overflow-hidden bg-background",children:[(0,i.jsxs)("div",{className:"fixed top-20 right-6 flex items-center gap-4 z-9",children:[!B&&(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(U,{history:c,historyIndex:h,handleUndo:y,handleRedo:N,className:" bg-white rounded-full shadow-lg  px-3 py-2"})}),(0,i.jsxs)("div",{className:"flex items-center gap-2 bg-white rounded-full shadow-lg px-3 py-2",children:[(0,i.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 text-gray-600",onClick:e=>eI("out"),disabled:ec<=50,children:(0,i.jsx)(T.A,{className:"w-4 h-4"})}),(0,i.jsxs)("span",{className:"text-sm font-medium text-gray-600 min-w-[48px] text-center",children:[ec,"%"]}),(0,i.jsx)("button",{className:"p-1 rounded hover:bg-gray-100 text-gray-600",onClick:e=>eI("in"),disabled:ec>=120,children:(0,i.jsx)(E.A,{className:"w-4 h-4"})})]}),(0,i.jsxs)("div",{style:{transform:"rotate(".concat(ex,"deg)"),transition:"transform 0.3s ease-out"},onClick:()=>{eg(ex+45)},className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"text-sm text-gray-600",children:"N"}),(0,i.jsx)(A.default,{src:"/images/compass.png",alt:"方向",width:40,height:40,className:"cursor-pointer"})]})]}),(0,i.jsx)("div",{id:"canvas",className:"absolute cursor-move",style:{width:"".concat(V.width,"px"),height:"".concat(V.height,"px"),transform:"translate(".concat(L.x,"px, ").concat(L.y,"px)  scale(").concat(ec/100,")"),transformOrigin:"top left",backgroundImage:"radial-gradient(circle, #ddd 1px, transparent 1px)",backgroundSize:"10px 10px"},children:(0,i.jsx)("div",{className:"relative",children:ea.map(e=>e.type===R.w$.ROOM?(0,i.jsxs)("div",{"data-room-element":"true",className:"absolute ".concat((null==W?void 0:W.id)===e.id?"ring-2 ring-red-500":""," cursor-move z-100"),style:{left:e.position.x,top:e.position.y,width:e.size.width,height:e.size.height},onClick:t=>{t.stopPropagation(),eO(e)},onMouseDown:t=>ew(t,e),onTouchStart:t=>ew(t,e),children:[W&&W.id===e.id&&(0,i.jsxs)("div",{style:{left:"50%",top:"-64px",transform:"translateX(-50%)"},className:"min-w-fit whitespace-nowrap  absolute z-1 h-[40px] rounded-4xl bg-white shadow-lg  items-center px-3 gap-2 md:flex hidden",children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:[$("chosed"),"："]}),(0,i.jsxs)("div",{className:"flex flex-grow items-center gap-1",children:[(0,i.jsx)("div",{style:{width:"12px",height:"12px",backgroundColor:R.$q[W.data.type],borderRadius:"2px"}}),(0,i.jsx)("span",{className:"text-sm text-gray-600 font-bold",children:W.data.label})]}),(0,i.jsx)("button",{className:"flex-shrink-0 text-red-500",onClick:e=>{e.stopPropagation(),es(ea.filter(e=>e.id!==W.id)),X(null)},children:(0,i.jsx)(C.A,{className:"w-4 h-4 text-red-500"})})]}),(0,i.jsx)("div",{className:"w-full h-full",style:{border:e.type===R.w$.ROOM?"8px solid":"none",borderColor:e.type===R.w$.ROOM?R.$q[e.data.type]:"transparent",borderRadius:e.type===R.w$.ROOM?"8px":"0",backgroundColor:e.type===R.w$.ROOM?R.$q[e.data.type]+"80":"transparent"},children:(0,i.jsx)("div",{className:"absolute top-2 left-2 text-[14px] text-[#888888]",style:{zIndex:1},children:e.data.label})}),(null==W?void 0:W.id)===e.id&&eE(e)]},e.id):e.type===R.w$.FURNITURE?(0,i.jsxs)("div",{"data-room-element":"true",className:"absolute cursor-move z-200",style:{left:e.position.x,top:e.position.y,width:e.size.width,height:e.size.height},onClick:t=>{t.stopPropagation(),eO(e)},onMouseDown:t=>{t.stopPropagation(),ew(t,e)},onTouchStart:t=>{t.stopPropagation(),ew(t,e)},children:[W&&W.id===e.id&&(0,i.jsxs)("div",{style:{left:"50%",top:"-64px",transform:"translateX(-50%)"},className:"min-w-fit whitespace-nowrap absolute z-1 h-[40px] rounded-4xl bg-white shadow-lg  items-center px-3 gap-2 md:flex hidden",children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:[$("chosed"),"："]}),(0,i.jsxs)("div",{className:"flex flex-grow items-center gap-1",children:[W.data.parentRoom&&(0,i.jsx)("div",{style:{width:"12px",height:"12px",backgroundColor:R.$q[W.data.parentRoom.data.type],borderRadius:"2px"}}),(0,i.jsx)("span",{className:"text-sm text-gray-600 font-bold",children:W.data.label})]}),(0,i.jsx)("button",{className:"flex-shrink-0",onClick:e=>{e.stopPropagation(),eT()},children:(0,i.jsx)(S.A,{className:"w-4 h-4"})}),(0,i.jsx)("button",{className:"flex-shrink-0 text-red-500 hover:text-red-600 transition-colors",onClick:e=>{e.stopPropagation(),es(ea.filter(e=>e.id!==W.id)),X(null)},children:(0,i.jsx)(C.A,{className:"w-4 h-4 text-red-500"})})]}),(null==W?void 0:W.id)===e.id&&eE(e),(0,i.jsx)(A.default,{draggable:"false",className:(null==W?void 0:W.id)===e.id?"ring-2 ring-red-500":"",style:{transform:e.rotation?"rotate(".concat(e.rotation,"deg)"):"none",transformOrigin:"center"},src:e.activeIcon,alt:"Furniture",width:e.size.width,height:e.size.height})]},e.id):void 0)})}),W&&(0,i.jsxs)("div",{className:(0,o.cn)("min-w-fit whitespace-nowrap fixed  left-1/2 -translate-x-1/2 h-10 rounded-4xl bg-white shadow-lg flex items-center px-3 gap-2 md:hidden",d?"bottom-85":"bottom-22.5 "),children:[(0,i.jsxs)("span",{className:"text-sm text-gray-600",children:[$("chosed"),"："]}),(0,i.jsxs)("div",{className:"flex flex-grow items-center gap-1",children:[(0,i.jsx)("div",{style:{width:"12px",height:"12px",backgroundColor:R.$q[W.data.parentRoom?W.data.parentRoom.data.type:W.data.type],borderRadius:"2px"}}),(0,i.jsx)("span",{className:"text-sm text-gray-600 font-bold",children:W.data.label})]}),W.type===R.w$.FURNITURE&&(0,i.jsxs)("button",{className:"flex-shrink-0",onClick:e=>{e.stopPropagation(),eT()},children:[" ",(0,i.jsx)(S.A,{className:"w-4 h-4"})]}),(0,i.jsx)("button",{className:"flex-shrink-0 text-red-500 hover:text-red-600 transition-colors",onClick:e=>{e.stopPropagation(),es(ea.filter(e=>e.id!==W.id)),X(null)},children:(0,i.jsx)(C.A,{className:"w-4 h-4 text-red-500"})})]}),(0,i.jsxs)("div",{className:"fixed z-50 bottom-6 left-0 px-2 gap-4 w-full bg-transparent flex items-center justify-between  md:hidden",children:[!d&&(0,i.jsx)("button",{onClick:l,className:"border-primary border-1 font-bold w-4/5 py-3 bg-white text-foreground rounded-[100px] text-sm",children:$("showTab")}),(0,i.jsxs)(u,{children:[(0,i.jsxs)(p,{className:(0,o.cn)("inline-flex font-bold py-3 bg-button-gradient text-white rounded-[100px] text-sm items-center justify-center gap-0",d?"w-full ":"w-4/5"),children:[$("cta"),(0,i.jsx)(A.default,{src:"/images/hero/star.png",alt:"arrow",width:15,height:16})]}),(0,i.jsxs)(m,{children:[(0,i.jsx)(b,{children:(0,i.jsx)(v,{children:$("alert")})}),(0,i.jsxs)(f,{children:[(0,i.jsx)(j,{children:$("cancel")}),(0,i.jsx)(w,{onClick:O,children:$("ok")})]})]})]})]})]})});var B=a(84),L=a(2249),G=a(8052),_=a(9536),H=a(3379),Y=a(6205);function P(){var e,t;let{data:a}=(0,H.wV)(),[s,n]=(0,r.useState)(!1);return(null==a?void 0:null===(e=a.user)||void 0===e?void 0:e.name)&&(0,i.jsxs)("div",{children:[(0,i.jsx)("div",{className:"w-8 h-8 bg-[#6a84f8] rounded-full text-center cursor-pointer",onClick:()=>{n(!0)},children:(0,i.jsx)("span",{className:"text-white font-bold text-xl",children:null==a?void 0:null===(t=a.user)||void 0===t?void 0:t.name.slice(0,1).toUpperCase()})}),(0,i.jsx)(Y.A,{isOpen:s,setIsOpen:n})]})}function W(e){let{onSaveProject:t,onGenReport:a,onUserOpen:s}=e,{isMobile:n}=(0,F.A)(),r=(0,M.c3)("design");return(0,i.jsx)("nav",{className:"bg-white h-16 border-b-gray-100 border-b-2 fixed top-0 left-0 right-0 z-10",children:(0,i.jsx)("div",{className:"mx-auto px-4 h-full",children:(0,i.jsxs)("div",{className:"flex items-center justify-between h-full",children:[(0,i.jsx)(B.N_,{href:"/",className:"text-2xl font-bold text-primary",children:"HarmoniQ"}),(0,i.jsxs)("div",{className:"flex items-center space-x-4 text-foreground  gap-3",children:[(0,i.jsx)(L.A,{className:"text-foreground"}),(0,i.jsxs)("span",{className:"flex items-center gap-1 cursor-pointer",onClick:t,children:[(0,i.jsx)(G.A,{className:"w-4 h-4"}),"保存 "]}),(0,i.jsxs)("span",{className:"flex items-center gap-1 cursor-pointer",onClick:()=>s(!0),children:[(0,i.jsx)(_.A,{className:"w-4 h-4"}),r("profile")," "]}),(0,i.jsxs)(u,{children:[(0,i.jsxs)(p,{className:"inline-flex px-4 py-1 bg-button-gradient text-white rounded-full hover:bg-primary/90 transition-colors items-center gap-2",children:[r("cta"),(0,i.jsx)("span",{className:"text-lg",children:"✨"})]}),(0,i.jsxs)(m,{children:[(0,i.jsx)(b,{children:(0,i.jsx)(v,{children:r("alert")})}),(0,i.jsxs)(f,{children:[(0,i.jsx)(j,{children:r("cancel")}),(0,i.jsx)(w,{onClick:a,children:r("ok")})]})]})]}),(0,i.jsx)(P,{})]})]})})})}var X=a(643),V=a(7311);function K(e){let{onSaveProject:t,history:a,historyIndex:s,handleUndo:n,handleRedo:l,onUserOpen:o}=e,[d,c]=(0,r.useState)(!1),h=(0,M.c3)("design");return(0,i.jsxs)("div",{className:"fixed top-0 left-0 right-0 z-50",children:[(0,i.jsx)("nav",{className:"bg-white h-16 border-b-gray-100 border-b-2 ",children:(0,i.jsx)("div",{className:"mx-auto px-4 h-full",children:(0,i.jsxs)("div",{className:"flex items-center justify-between h-full",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-4 text-foreground  gap-3",children:[(0,i.jsx)(U,{history:a,historyIndex:s,handleUndo:n,handleRedo:l}),(0,i.jsxs)("span",{className:"flex items-center gap-1 cursor-pointer",onClick:t,children:[(0,i.jsx)(G.A,{className:"w-4 h-4"})," "]})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-4 text-foreground  gap-3",children:[(0,i.jsx)("span",{className:"flex items-center gap-1 cursor-pointer",children:(0,i.jsx)(X.A,{className:"w-4 h-4",onClick:()=>c(!0)})}),(0,i.jsxs)("span",{className:"flex items-center gap-1 cursor-pointer",children:[(0,i.jsx)(_.A,{className:"w-4 h-4",onClick:()=>o(!0)})," "]}),(0,i.jsx)(P,{})]})]})})}),d&&(0,i.jsxs)("div",{className:"h-8 w-full bg-[#E5F4FF] px-6 py-3 flex justify-between items-center",children:[(0,i.jsxs)("span",{className:"text-[12px] text-foreground flex items-center gap-1",children:[(0,i.jsx)(X.A,{className:"w-4 h-4 text-[#888]"}),h("warning")]}),(0,i.jsx)(V.A,{className:"w-4 h-4 text-[#888]",onClick:()=>c(!1)})]})]})}function q(e){let{id:t,type:a,data:s,children:r,isOverCanvas:l}=e,{attributes:o,listeners:d,setNodeRef:c,transform:h,isDragging:u}=(0,n.PM)({id:t,data:{type:a,...s}}),p=h?{transform:"translate3d(".concat(h.x,"px, ").concat(h.y,"px, 0)"),opacity:u&&!l?.5:u&&l?0:1,position:"relative",zIndex:u?1e3:1,visibility:"visible"}:{};return(0,i.jsxs)("div",{className:"relative z-0 w-22.5",children:[(0,i.jsx)("div",{className:"absolute  -z-1 w-22.5 top-0 left-0",children:r}),(0,i.jsx)("div",{ref:c,...d,...o,className:"cursor-move",style:{...p},children:r})]})}a(5574);var J=a(8999);function Q(e){let{className:t,children:a,...s}=e;return(0,i.jsxs)(J.bL,{"data-slot":"scroll-area",className:(0,o.cn)("relative",t),...s,children:[(0,i.jsx)(J.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:a}),(0,i.jsx)(Z,{}),(0,i.jsx)(J.OK,{})]})}function Z(e){let{className:t,orientation:a="vertical",...s}=e;return(0,i.jsx)(J.VM,{"data-slot":"scroll-area-scrollbar",orientation:a,className:(0,o.cn)("flex touch-none p-px transition-colors select-none visible","vertical"===a&&"h-full w-2.5 border-l border-l-transparent","horizontal"===a&&"h-2.5 flex-col border-t border-t-transparent",t),...s,children:(0,i.jsx)(J.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function ee(e){let{sidebarRef:t,roomItems:a,furnitureItems:s,isOverCanvas:n,draggingItemSize:r}=e,l=(0,M.c3)("design");return(0,i.jsx)(Q,{className:"h-[calc(100vh-64px)] w-1/6",children:(0,i.jsxs)("div",{ref:t,className:"md:block hidden  bg-white p-4 shadow border-r-gray-100 border-r-2",children:[(0,i.jsxs)("div",{className:"mb-8",children:[(0,i.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:l("room")}),(0,i.jsx)("div",{className:"grid 2xl:grid-cols-3 xl:grid-cols-2 gap-2",children:a.map(e=>(0,i.jsx)(q,{id:e.id,type:e.type,data:e.data,isOverCanvas:n,children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,i.jsx)(A.default,{className:" bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:r,height:r,priority:!0})}),(0,i.jsx)("span",{className:"mt-1 text-sm text-gray-600",children:e.data.label})]})},e.id))})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-2xl font-semibold mb-4",children:l("furniture")}),(0,i.jsx)("div",{className:"grid 2xl:grid-cols-3 xl:grid-cols-2 gap-2",children:s.map(e=>(0,i.jsx)(q,{id:e.id,type:e.type,data:e.data,isOverCanvas:n,children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,i.jsx)(A.default,{className:"bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:r,height:r,priority:!0})}),(0,i.jsx)("span",{className:"mt-1 text-sm text-gray-600",children:e.data.label})]})},e.id))})]})]})})}var et=a(9282),ea=a(2247);function es(e){let{className:t,...a}=e;return(0,i.jsxs)("div",{className:"relative",children:[(0,i.jsx)(et.bL,{"data-slot":"tabs",className:(0,o.cn)("flex flex-col gap-2",t),...a}),(0,i.jsx)(ea.A,{className:"w-4 h-4 absolute top-2.5 right-5",onClick:()=>a.setShowTab(!1)})]})}function ei(e){let{className:t,...a}=e;return(0,i.jsx)(et.B8,{"data-slot":"tabs-list",className:(0,o.cn)("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-lg p-[3px]",t),...a})}function en(e){let{className:t,...a}=e;return(0,i.jsx)(et.l9,{"data-slot":"tabs-trigger",className:(0,o.cn)("data-[state=active]:bg-background dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-md border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:shadow-sm [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...a})}function er(e){let{className:t,...a}=e;return(0,i.jsx)(et.UC,{"data-slot":"tabs-content",className:(0,o.cn)("flex-1 outline-none",t),...a})}var el=a(9920),eo=a(772),ed=a(2893);let ec=r.createContext(null);function eh(){let e=r.useContext(ec);if(!e)throw Error("useCarousel must be used within a <Carousel />");return e}let eu=r.forwardRef((e,t)=>{let{orientation:a="horizontal",opts:s,setApi:n,plugins:l,className:d,children:c,...h}=e,[u,p]=(0,el.A)({...s,axis:"horizontal"===a?"x":"y"},l),[x,g]=r.useState(!1),[m,b]=r.useState(!1),f=r.useCallback(e=>{e&&(g(e.canScrollPrev()),b(e.canScrollNext()))},[]),v=r.useCallback(()=>{null==p||p.scrollPrev()},[p]),y=r.useCallback(()=>{null==p||p.scrollNext()},[p]),w=r.useCallback(e=>{"ArrowLeft"===e.key?(e.preventDefault(),v()):"ArrowRight"===e.key&&(e.preventDefault(),y())},[v,y]);return r.useEffect(()=>{p&&n&&n(p)},[p,n]),r.useEffect(()=>{if(p)return f(p),p.on("reInit",f),p.on("select",f),()=>{null==p||p.off("select",f)}},[p,f]),(0,i.jsx)(ec.Provider,{value:{carouselRef:u,api:p,opts:s,orientation:a||((null==s?void 0:s.axis)==="y"?"vertical":"horizontal"),scrollPrev:v,scrollNext:y,canScrollPrev:x,canScrollNext:m},children:(0,i.jsx)("div",{ref:t,onKeyDownCapture:w,className:(0,o.cn)("relative",d),role:"region","aria-roledescription":"carousel",...h,children:c})})});eu.displayName="Carousel";let ep=r.forwardRef((e,t)=>{let{className:a,...s}=e,{carouselRef:n,orientation:r}=eh();return(0,i.jsx)("div",{ref:n,className:"overflow-hidden",children:(0,i.jsx)("div",{ref:t,className:(0,o.cn)("flex","horizontal"===r?"-ml-4":"-mt-4 flex-col",a),...s})})});ep.displayName="CarouselContent";let ex=r.forwardRef((e,t)=>{let{className:a,...s}=e,{orientation:n}=eh();return(0,i.jsx)("div",{ref:t,role:"group","aria-roledescription":"slide",className:(0,o.cn)("min-w-0 shrink-0 grow-0 basis-full","horizontal"===n?"pl-4":"pt-4",a),...s})});ex.displayName="CarouselItem";let eg=r.forwardRef((e,t)=>{let{className:a,variant:s="outline",size:n="icon",...r}=e,{orientation:l,scrollPrev:d,canScrollPrev:c}=eh();return(0,i.jsxs)(h,{ref:t,variant:s,size:n,className:(0,o.cn)("absolute  h-8 w-8 rounded-full","horizontal"===l?"-left-12 top-1/2 -translate-y-1/2":"-top-12 left-1/2 -translate-x-1/2 rotate-90",a),disabled:!c,onClick:d,...r,children:[(0,i.jsx)(eo.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"sr-only",children:"Previous slide"})]})});eg.displayName="CarouselPrevious";let em=r.forwardRef((e,t)=>{let{className:a,variant:s="outline",size:n="icon",...r}=e,{orientation:l,scrollNext:d,canScrollNext:c}=eh();return(0,i.jsxs)(h,{ref:t,variant:s,size:n,className:(0,o.cn)("absolute h-8 w-8 rounded-full","horizontal"===l?"-right-12 top-1/2 -translate-y-1/2":"-bottom-12 left-1/2 -translate-x-1/2 rotate-90",a),disabled:!c,onClick:d,...r,children:[(0,i.jsx)(ed.A,{className:"h-4 w-4"}),(0,i.jsx)("span",{className:"sr-only",children:"Next slide"})]})});function eb(e){let{showTab:t,setShowTab:a,roomItems:s,furnitureItems:n,isOverCanvas:l,draggingItemSize:d}=e,[c,h]=(0,r.useState)(""),u=(0,M.c3)("design");return(0,r.useEffect)(()=>{h("room")},[]),(0,i.jsx)("div",{style:{boxShadow:"0 -1px 5px 0px rgba(0, 0, 0, 0.2)"},className:(0,o.cn)("fixed bottom-0 left-0 z-10 w-full pb-20 pl-0 pr-2 bg-white md:hidden rounded-t-2xl transition-transform duration-300 ease-in-out",t?"translate-y-0":"translate-y-full"),children:(0,i.jsxs)(es,{value:c,className:"w-full gap-4",setShowTab:a,onValueChange:e=>h(e),children:[(0,i.jsxs)(ei,{className:"mx-auto bg-white gap-8",children:[(0,i.jsx)(en,{defaultValue:!0,value:"room",className:"rounded-[3px] text-[12px] font-bold data-[state=active]:shadow-none data-[state=active]:border-b-4 data-[state=active]:border-b-primary",children:u("room")}),(0,i.jsx)(en,{value:"furniture",className:"rounded-[3px] text-[12px] font-bold data-[state=active]:shadow-none data-[state=active]:border-b-4 data-[state=active]:border-b-primary",children:u("furniture")})]}),(0,i.jsx)(er,{value:"room",className:"w-full pb-3 overflow-hidden",children:(0,i.jsxs)(eu,{children:[(0,i.jsxs)(ep,{children:[(0,i.jsx)(ex,{children:(0,i.jsx)("div",{className:"grid grid-cols-4 gap-x-8 gap-y-6",children:s.slice(0,8).map(e=>(0,i.jsx)(q,{id:e.id,type:e.type,data:e.data,isOverCanvas:l,children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,i.jsx)(A.default,{className:"bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:d,height:d,priority:!0})}),(0,i.jsx)("span",{className:"mt-1 text-[12px] text-gray-600",children:e.data.label})]})},e.id))})}),(0,i.jsx)(ex,{children:(0,i.jsx)("div",{className:"grid grid-cols-4 gap-x-8 gap-y-6",children:s.slice(8).map(e=>(0,i.jsx)(q,{id:e.id,type:e.type,data:e.data,isOverCanvas:l,children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,i.jsx)(A.default,{className:"bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:d,height:d,priority:!0})}),(0,i.jsx)("span",{className:"mt-1 text-[12px] text-gray-600",children:e.data.label})]})},e.id))})})]}),(0,i.jsx)(eg,{className:"left-0 "}),(0,i.jsx)(em,{className:"right-0"})]})}),(0,i.jsx)(er,{value:"furniture",className:"w-full pb-3 overflow-hidden",children:(0,i.jsxs)(eu,{children:[(0,i.jsxs)(ep,{children:[(0,i.jsx)(ex,{children:(0,i.jsx)("div",{className:"grid grid-cols-4 gap-x-8 gap-y-6",children:n.slice(0,8).map(e=>(0,i.jsx)(q,{id:e.id,type:e.type,data:e.data,isOverCanvas:l,children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,i.jsx)(A.default,{className:"bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:d,height:d})}),(0,i.jsx)("span",{className:"mt-1 text-[12px] text-gray-600",children:e.data.label})]})},e.id))})}),(0,i.jsx)(ex,{children:(0,i.jsx)("div",{className:"grid grid-cols-4 gap-x-8 gap-y-6",children:n.slice(8,16).map(e=>(0,i.jsx)(q,{id:e.id,type:e.type,data:e.data,isOverCanvas:l,children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,i.jsx)(A.default,{className:"bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:d,height:d})}),(0,i.jsx)("span",{className:"mt-1 text-[12px] text-gray-600",children:e.data.label})]})},e.id))})}),(0,i.jsx)(ex,{children:(0,i.jsx)("div",{className:"grid grid-cols-4 gap-x-8 gap-y-6",children:n.slice(16).map(e=>(0,i.jsx)(q,{id:e.id,type:e.type,data:e.data,isOverCanvas:l,children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)("div",{className:"w-14 h-14 bg-gray-100 rounded-lg flex items-center justify-center hover:bg-gray-200 transition-colors",children:(0,i.jsx)(A.default,{className:"bg-[#EFF7F4] rounded-lg",src:e.data.icon,alt:e.data.label,width:d,height:d})}),(0,i.jsx)("span",{className:"mt-1 text-[12px] text-gray-600",children:e.data.label})]})},e.id))})})]}),(0,i.jsx)(eg,{className:"left-0 "}),(0,i.jsx)(em,{className:"right-0"})]})})]})})}em.displayName="CarouselNext";var ef=a(2387),ev=a(6900);function ey(e){let{...t}=e;return(0,i.jsx)(ev.bL,{"data-slot":"dialog",...t})}function ew(e){let{...t}=e;return(0,i.jsx)(ev.ZL,{"data-slot":"dialog-portal",...t})}function ej(e){let{className:t,...a}=e;return(0,i.jsx)(ev.hJ,{"data-slot":"dialog-overlay",className:(0,o.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function eN(e){let{className:t,children:a,...s}=e;return(0,i.jsxs)(ew,{"data-slot":"dialog-portal",children:[(0,i.jsx)(ej,{}),(0,i.jsxs)(ev.UC,{"data-slot":"dialog-content",className:(0,o.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...s,children:[a,(0,i.jsxs)(ev.bm,{className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,i.jsx)(V.A,{}),(0,i.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function eR(e){let{className:t,...a}=e;return(0,i.jsx)("div",{"data-slot":"dialog-header",className:(0,o.cn)("flex flex-col gap-2 text-center sm:text-left",t),...a})}function eO(e){let{className:t,...a}=e;return(0,i.jsx)(ev.hE,{"data-slot":"dialog-title",className:(0,o.cn)("text-lg leading-none font-semibold",t),...a})}var eI=a(3286),eT=a(4013),eE=a(3386),eC=a(1293);function eS(e){let{className:t,...a}=e;return(0,i.jsx)(eE.bL,{"data-slot":"radio-group",className:(0,o.cn)("grid gap-3",t),...a})}function eA(e){let{className:t,...a}=e;return(0,i.jsx)(eE.q7,{"data-slot":"radio-group-item",className:(0,o.cn)("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...a,children:(0,i.jsx)(eE.C1,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:(0,i.jsx)(eC.A,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}var eD=a(2945);function ez(e){let{className:t,...a}=e;return(0,i.jsx)(eD.b,{"data-slot":"label",className:(0,o.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...a})}var eU=a(4307);let eM=Array.from({length:100},(e,t)=>(2025-t).toString()),eF=Array.from({length:12},(e,t)=>(t+1).toString().padStart(2,"0")),ek=Array.from({length:31},(e,t)=>(t+1).toString().padStart(2,"0")),e$=Array.from({length:24},(e,t)=>t.toString().padStart(2,"0")),eB={years:eM,months:eF,days:ek,hours:e$};function eL(e){let{tHour:t,onChange:a}=e,[s,n]=(0,r.useState)({years:"1996",months:"04",days:"15",hours:"12"});(0,r.useEffect)(()=>{e.value&&n({years:e.value[0],months:e.value[1],days:e.value[2],hours:e.value[3]})},[e.value]);let l=(e,a)=>{switch(a){case"years":return e+"年";case"months":return e+"月";case"days":return e+"日";case"hours":return e+t}};return(0,i.jsx)(eU.A,{value:s,onChange:e=>{n(e),a&&a([e.years,e.months,e.days,e.hours])},children:Object.keys(eB).map(e=>(0,i.jsx)(eU.A.Column,{name:e,children:eB[e].map(t=>(0,i.jsx)(eU.A.Item,{value:t,children:l(t,e)},t))},e))})}function eG(e){let{open:t,onUserOpen:a,onSubmit:s,userInfo:n}=e,l=(0,M.c3)("design"),o=(0,F.A)(),[d,c]=(0,r.useState)("男"),[u,p]=(0,r.useState)("1996"),[x,g]=(0,r.useState)("03"),[m,b]=(0,r.useState)("12"),[f,v]=(0,r.useState)("22");(0,r.useEffect)(()=>{if(n&&(c(n.gender||"male"),n.birthDateTime)){let e=new Date(n.birthDateTime);p(e.getFullYear().toString()),g((e.getMonth()+1).toString().padStart(2,"0")),b(e.getDate().toString().padStart(2,"0")),v(e.getHours().toString().padStart(2,"0"))}},[n]);let y=()=>{s({gender:d,birthDateTime:new Date(parseInt(u),parseInt(x)-1,parseInt(m),parseInt(f))})},w=e=>{e&&(p(e[0]),g(e[1]),b(e[2]),v(e[3]))};return(0,i.jsx)(ey,{open:t,onOpenChange:a,children:(0,i.jsxs)(eN,{className:"sm:max-w-[432px]",children:[(0,i.jsxs)(eR,{children:[(0,i.jsxs)(eO,{className:"text-lg md:text-xl font-bold md:text-left text-center",children:[" ",l("profile")," "]}),(0,i.jsx)("div",{className:"py-4 text-sm md:text-base  text-left",children:l("tip")})]}),(0,i.jsx)(eI.Separator,{className:"md:hidden"}),(0,i.jsxs)("div",{className:"grid gap-4 pb-4",children:[o?(0,i.jsx)(()=>(0,i.jsxs)("div",{className:"flex justify-between",children:[(0,i.jsx)(ez,{className:"text-base",children:"性别"}),(0,i.jsxs)("div",{className:"flex bg-gray-200 p-1 rounded-[6px]  ",children:[(0,i.jsx)("button",{style:{boxShadow:"0 1px 5px 0px rgba(0, 0, 0, 0.3)"},className:"rounded-[6px] px-4 py-1 ".concat("male"===d?"bg-white":"transparent"),onClick:()=>c("male"),children:"男"}),(0,i.jsx)("button",{className:"rounded-[6px] px-4 py-1 ".concat("female"===d?"bg-white":"transparent"),onClick:()=>c("female"),children:"女"})]})]}),{}):(0,i.jsx)(()=>(0,i.jsxs)("div",{className:"space-y-2 pb-4",children:[(0,i.jsx)(ez,{className:"font-bold pb-2 text-base",children:"性别"}),(0,i.jsxs)(eS,{value:d,onValueChange:c,className:"flex space-x-4",children:[(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(eA,{value:"male",id:"male"}),(0,i.jsx)(ez,{htmlFor:"male",children:"男"})]}),(0,i.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,i.jsx)(eA,{value:"female",id:"female"}),(0,i.jsx)(ez,{htmlFor:"female",children:"女"})]})]})]}),{}),(0,i.jsx)(eI.Separator,{className:"md:hidden"}),o?(0,i.jsx)(()=>(0,i.jsxs)("div",{children:[(0,i.jsxs)("div",{className:"flex justify-between pb-4",children:[(0,i.jsx)(ez,{className:"text-base",children:"出生日期"}),(0,i.jsx)("span",{children:"".concat(u,"年").concat(x,"月").concat(m,"日").concat(f).concat(l("hour"))})]}),(0,i.jsx)(eI.Separator,{}),(0,i.jsx)(eL,{tHour:l("hour"),onChange:w,value:[u,x,m,f]}),(0,i.jsx)(eI.Separator,{})]}),{}):(0,i.jsx)(()=>(0,i.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)(ez,{className:"font-bold pb-4 text-base",children:"年"}),(0,i.jsxs)(eT.l6,{value:u,onValueChange:p,children:[(0,i.jsx)(eT.bq,{className:"w-24",children:(0,i.jsx)(eT.yv,{placeholder:"年"})}),(0,i.jsx)(eT.gC,{children:eM.map(e=>(0,i.jsxs)(eT.eb,{value:e,children:[e,"年"]},e))})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ez,{className:"font-bold pb-4 text-base",children:"月"}),(0,i.jsxs)(eT.l6,{value:x,onValueChange:g,children:[(0,i.jsx)(eT.bq,{className:"w-24",children:(0,i.jsx)(eT.yv,{placeholder:"月"})}),(0,i.jsx)(eT.gC,{children:eF.map(e=>(0,i.jsxs)(eT.eb,{value:e,children:[e,"月"]},e))})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)(ez,{className:"font-bold pb-4 text-base",children:"日"}),(0,i.jsxs)(eT.l6,{value:m,onValueChange:b,children:[(0,i.jsx)(eT.bq,{className:"w-20",children:(0,i.jsx)(eT.yv,{placeholder:"日"})}),(0,i.jsx)(eT.gC,{children:ek.map(e=>(0,i.jsxs)(eT.eb,{value:e,children:[e,"日"]},e))})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsxs)(ez,{className:"font-bold pb-4 text-base",children:["小",l("hour")]}),(0,i.jsxs)(eT.l6,{value:f,onValueChange:v,children:[(0,i.jsx)(eT.bq,{className:"w-20",children:(0,i.jsx)(eT.yv,{placeholder:l("hour")})}),(0,i.jsx)(eT.gC,{children:e$.map(e=>(0,i.jsxs)(eT.eb,{value:e,children:[e,l("hour")]},e))})]})]})]}),{}),o?(0,i.jsxs)("div",{className:"flex justify-around",children:[(0,i.jsx)(h,{onClick:()=>{a(!1)},className:"px-10 border-1 border-[#ccc] text-foreground rounded-[100px] bg-white font-bold mt-10",children:"取消"}),(0,i.jsx)(h,{onClick:y,className:"px-10 bg-[#13ab87] font-bold mt-10 rounded-[100px]",children:"保存"})]}):(0,i.jsx)(h,{onClick:y,className:"w-full bg-[#13ab87] font-bold mt-10 rounded-[100px]",children:"保存"})]})]})})}var e_=a(304),eH=a.n(e_);let eY={[R.sR.LIVING_ROOM]:"#F0DF9C",[R.sR.DINING_ROOM]:"#F5D4BC",[R.sR.STORAGE_ROOM]:"#ADC0BC",[R.sR.STUDY_ROOM]:"#B0B8C9",[R.sR.BEDROOM]:"#F5B8B8",[R.sR.BATHROOM]:"#C1D7E2",[R.sR.KITCHEN]:"#EDE0C6",[R.sR.BALCONY]:"#D0DCAA",[R.sR.GARDEN]:"#AACDBC",[R.sR.GARAGE]:"#C7C7DD",[R.sR.CORRIDOR]:"#CDCDCD"};function eP(e){var t,a;let{params:s}=e,l=(0,r.use)(s).locale,o=(0,M.c3)("design"),d="zh-TW"===l?R.t7:R.Xs,c="zh-TW"===l?R.Gx:R.Qc,h=[{id:"door-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.DOOR,label:c[R.x9.DOOR],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/door.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/door-gr.png",size:{width:40,height:40}}},{id:"window-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.WINDOW,label:c[R.x9.WINDOW],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/window.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/window-gr.png",size:{width:8,height:56}}},{id:"table-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.TABLE,label:c[R.x9.TABLE],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/table.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/table-gr.png",size:{width:44,height:120}}},{id:"chair-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.CHAIR,label:c[R.x9.CHAIR],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/chair.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/chair-gr.png",size:{width:28,height:35}}},{id:"sofa-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.SOFA,label:c[R.x9.SOFA],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/sofa.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/sofa-gr.png",size:{width:67,height:123}}},{id:"bed-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.BED,label:c[R.x9.BED],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/bed.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/bed-gr.png",size:{width:89,height:128}}},{id:"lamp-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.LAMP,label:c[R.x9.LAMP],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/lamp.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/lamp-gr.png",size:{width:70,height:128}}},{id:"tv-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.TV,label:c[R.x9.TV],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/tv.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/tv-gr.png",size:{width:134,height:32}}},{id:"bookshelf-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.BOOKSHELF,label:c[R.x9.BOOKSHELF],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/bookshelf.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/bookshelf-gr.png",size:{width:44,height:44}}},{id:"wardrobe-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.WARDROBE,label:c[R.x9.WARDROBE],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/wardrobe.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/wardrobe-gr.png",size:{width:40,height:129}}},{id:"plant-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.PLANT,label:c[R.x9.PLANT],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/plant.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/plant-gr.png",size:{width:36,height:36}}},{id:"fridge-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.FRIDGE,label:c[R.x9.FRIDGE],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/fridge.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/fridge-gr.png",size:{width:40,height:43}}},{id:"stove-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.STOVE,label:c[R.x9.STOVE],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/stove.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/stove-gr.png",size:{width:62,height:32}}},{id:"sink-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.SINK,label:c[R.x9.SINK],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/sink.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/sink-gr.png",size:{width:60,height:40}}},{id:"washbasin-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.WASHBASIN,label:c[R.x9.WASHBASIN],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/washbasin.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/washbasin-gr.png",size:{width:50,height:50}}},{id:"toilet-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.TOILET,label:c[R.x9.TOILET],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/toilet.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/toilet-gr.png",size:{width:40,height:60}}},{id:"shower-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.SHOWER,label:c[R.x9.SHOWER],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/shower.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/shower-gr.png",size:{width:80,height:80}}},{id:"bathtub-template",type:R.w$.FURNITURE,data:{cateType:R.w$.FURNITURE,type:R.x9.BATHTUB,label:c[R.x9.BATHTUB],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/bathtub.png",activeIcon:"https://d3cbeloe0vn1bb.cloudfront.net/images/fur-icon/bathtub-gr.png",size:{width:120,height:60}}}],p=(0,n.FR)((0,n.MS)(n.IG,{tolerance:50}),(0,n.MS)(n.cA,{activationConstraint:{distance:10}})),x=(0,N.useRouter)(),[g,O]=(0,r.useState)(null),[I,T]=(0,r.useState)(!1),[E,C]=(0,r.useState)(0),[S,D]=(0,r.useState)(!1),[z,U]=(0,r.useState)([[]]),[B,L]=(0,r.useState)(0),[G,_]=(0,r.useState)(!1),[Y,P]=(0,r.useState)({}),[X,V]=(0,r.useState)(!1),q=(0,r.useRef)(null),J=(0,r.useRef)(null),Q=(0,F.A)(),Z=Q?48:56,et=Q?{width:200,height:200}:{width:300,height:300},[ea,es]=(0,r.useState)(!1),[ei,en]=(0,r.useState)(""),er=[{id:"living-room",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.LIVING_ROOM,label:d[R.sR.LIVING_ROOM],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/living_room.png",size:et}},{id:"dining-room",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.DINING_ROOM,label:d[R.sR.DINING_ROOM],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/dining_room.png",size:et}},{id:"storage-room",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.STORAGE_ROOM,label:d[R.sR.STORAGE_ROOM],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/storage_room.png",size:et}},{id:"study-room",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.STUDY_ROOM,label:d[R.sR.STUDY_ROOM],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/study_room.png",size:et}},{id:"bedroom",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.BEDROOM,label:d[R.sR.BEDROOM],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/bedroom.png",size:et}},{id:"bathroom",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.BATHROOM,label:d[R.sR.BATHROOM],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/bathroom.png",size:et}},{id:"kitchen",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.KITCHEN,label:d[R.sR.KITCHEN],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/kitchen.png",size:et}},{id:"balcony",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.BALCONY,label:d[R.sR.BALCONY],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/balcony.png",size:et}},{id:"garden",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.GARDEN,label:d[R.sR.GARDEN],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/garden.png",size:et}},{id:"garage",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.GARAGE,label:d[R.sR.GARAGE],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/garage.png",size:et}},{id:"corridor",type:R.w$.ROOM,data:{cateType:R.w$.ROOM,type:R.sR.CORRIDOR,label:d[R.sR.CORRIDOR],icon:"https://d3cbeloe0vn1bb.cloudfront.net/images/room-icon/corridor.png",size:et}}],{data:el}=(0,H.wV)();(0,r.useEffect)(()=>{let e=()=>{J.current&&C(J.current.offsetWidth)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),(0,r.useEffect)(()=>{(async()=>{var e,t,a,s,i;let n=null==el?void 0:null===(e=el.user)||void 0===e?void 0:e.userId;if(n)try{V(!0);let{status:e,message:r,data:l}=await (0,ef.Jt)("/api/users/".concat(n)),{status:o,message:d,data:c}=await (0,ef.Jt)("/api/design/".concat(n));if(0!==e){k.oR.error("查询用户错误:"+r);return}if(0!==o){k.oR.error("查询布局错误:"+d);return}P(l),_(!0);let{localItems:h=[],scale:u=100,canvasPosition:p={x:0,y:0},compassRotation:x=0}=c,g=h.map(e=>({...e,type:e._type,data:{...e.data,type:e.data._type}}));null===(t=q.current)||void 0===t||t.setLocalItems(g),null===(a=q.current)||void 0===a||a.setPosition(p),null===(s=q.current)||void 0===s||s.setCompassRotation(x),null===(i=q.current)||void 0===i||i.setScale(u),V(!1)}catch(e){V(!1),k.oR.error("加载布局错误:"+e),console.error("Error loading design:",e)}})()},[null==el?void 0:null===(t=el.user)||void 0===t?void 0:t.userId]);let eo=(e,t)=>{let{over:a}=e,s=(null==a?void 0:a.id)==="canvas";if(T(s),s){let e=q.current.getLocalItems(),a="".concat(g.data.current.label).concat(e.filter(e=>e.data.type===g.data.current.type).length+1),s={id:"".concat(g.data.current.type,"-").concat(e.filter(e=>e.data.type===g.data.current.type).length+1),type:g.data.current.cateType,data:{...g.data.current,label:g.data.current.cateType===R.w$.ROOM?a:""},size:g.data.current.size,activeIcon:g.data.current.activeIcon};q.current.setIsRoomDragging(!0),q.current.setRoomDragStart(t),q.current.setDraggedRoom(s)}else q.current.setIsRoomDragging(!1)},ed=async()=>{var e;(null==el?void 0:null===(e=el.user)||void 0===e?void 0:e.userId)||(0,N.redirect)("/auth/login");try{V(!0);let{status:e}=await (0,ef.bE)("/api/design/".concat(el.user.userId),{localItems:q.current.getLocalItems(),canvasPosition:q.current.getPosition(),compassRotation:q.current.getCompassRotation(),scale:q.current.getScale()});0==e&&k.oR.success("保存成功！")}catch(e){k.oR.error("保存失败："+e),console.error("Error saving design:",e)}finally{V(!1)}},ec=async()=>{var e;(null==el?void 0:null===(e=el.user)||void 0===e?void 0:e.userId)||(0,N.redirect)("/auth/login");let t=el.user.userId,a=q.current.getLocalItems(),s=!1,i=!1;if(a.forEach(e=>{"door"===e.data.type&&(s=!0),"window"===e.data.type&&(i=!0)}),!s||!i){k.oR.error(o("warning"),{autoClose:!1,style:{width:400}});return}try{let{status:e,data:a}=await (0,ef.Jt)("/api/reportUserDoc/".concat(t,"/").concat("zh-CN"==l?"zh":"tw"));a?es(!0):(await ed(),x.push("/report?birthDateTime=".concat(new Date(Y.birthDateTime).toISOString())))}catch(e){}},eh=async()=>{var e;(null==el?void 0:null===(e=el.user)||void 0===e?void 0:e.userId)||(0,N.redirect)("/auth/login");let t=el.user.userId;await ed();try{es(!1),V(!0);let{status:e}=await (0,ef.F6)("/api/reportUserDoc/".concat(t),{isDelete:1});V(!1),0==e&&x.push("/report?birthDateTime=".concat(new Date(Y.birthDateTime).toISOString()))}catch(e){}},eu=()=>{if(B>0){var e,t;null===(e=q.current)||void 0===e||e.setActiveRoom(null),L(e=>e-1),null===(t=q.current)||void 0===t||t.setLocalItems(z[B-1])}},ep=()=>{if(B<z.length-1){var e,t;null===(e=q.current)||void 0===e||e.setActiveRoom(null),L(e=>e+1),null===(t=q.current)||void 0===t||t.setLocalItems(z[B+1])}},ex=async e=>{var t;(null==el?void 0:null===(t=el.user)||void 0===t?void 0:t.userId)||(0,N.redirect)("/auth/login"),V(!0),P(e);try{let{status:t}=await (0,ef.bE)("/api/users/".concat(el.user.userId),{gender:e.gender,birthDateTime:e.birthDateTime.toISOString()});0==t&&(k.oR.success("保存成功！"),_(!1))}catch(e){k.oR.error("保存失败："+e),console.error("Error saving user info:",e)}finally{V(!1)}};return(0,i.jsx)(r.Suspense,{fallback:(0,i.jsx)("div",{children:"loading..."}),children:(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eH(),{color:"#666",loading:X,cssOverride:{position:"fixed",left:"50%",top:"50%",zIndex:60},size:30,"aria-label":"loading...","data-testid":"loader"}),(0,i.jsx)(eG,{open:G,onUserOpen:_,onSubmit:ex,userInfo:Y}),Q?(0,i.jsx)(K,{onSaveProject:ed,history:z,historyIndex:B,handleUndo:eu,handleRedo:ep,onUserOpen:_}):(0,i.jsx)(W,{onSaveProject:ed,onGenReport:ec,onUserOpen:_}),(0,i.jsx)("div",{className:"pt-16",children:(0,i.jsxs)(n.Mp,{sensors:p,onDragStart:e=>{let{active:t}=e;O(t),T(!1)},onDragOver:e=>{Q||eo(e,{x:E,y:Z})},onDragMove:e=>{Q&&e.delta.y<-120&&eo(e,{x:0,y:50})},children:[(0,i.jsx)("div",{className:"min-h-[calc(100vh-64px)] bg-gray-50",children:(0,i.jsx)("div",{className:"container p-0",style:{maxWidth:"100%"},children:(0,i.jsxs)("div",{className:"flex h-[calc(100vh-64px)]",children:[Q?(0,i.jsx)(eb,{showTab:S,setShowTab:D,roomItems:er,furnitureItems:h,isOverCanvas:I,draggingItemSize:Z}):(0,i.jsx)(ee,{sidebarRef:J,roomItems:er,furnitureItems:h,isOverCanvas:I,draggingItemSize:Z}),(0,i.jsx)("div",{className:"flex-1 overflow-auto",id:"canvas-drop-area",children:(0,i.jsx)($,{ref:q,locale:l,history:z,historyIndex:B,setHistory:U,setHistoryIndex:L,handleUndo:eu,handleRedo:ep,onGenReport:ec,showTab:S,onShowTab:()=>{D(!0)}})})]})})}),(0,i.jsx)(n.Hd,{children:(null==g?void 0:g.id)&&I&&(g.data.current.cateType===R.w$.ROOM?(0,i.jsx)("div",{className:"flex flex-col items-center justify-center bg-white/80 rounded-lg",style:{transform:Q?"translateY(78px)":"translateY(0)",width:et.width,height:et.height,border:"8px solid",borderColor:eY[null===(a=er.find(e=>e.id===g.id))||void 0===a?void 0:a.data.type],borderRadius:"8px"},children:(0,i.jsxs)("div",{className:"flex flex-col items-center",children:[(0,i.jsx)(A.default,{className:"bg-[#EFF7F4] rounded-lg",src:g.data.current.icon,alt:"Room",width:Z,height:Z}),(0,i.jsx)("span",{className:"mt-1 text-sm text-gray-600",children:g.data.current.label+(q.current.getLocalItems().filter(e=>e.data.type===g.data.current.type).length+1)})]})}):(0,i.jsx)(A.default,{src:g.data.current.activeIcon,alt:"Furniture",width:g.data.current.size.width,height:g.data.current.size.height}))})]})}),(0,i.jsx)(u,{open:ea,onOpenChange:es,children:(0,i.jsxs)(m,{children:[(0,i.jsxs)(b,{children:[(0,i.jsx)(v,{children:o("hasReportAlert")}),(0,i.jsx)(y,{children:o("description")})]}),(0,i.jsxs)(f,{children:[(0,i.jsx)(j,{children:o("cancel")}),(0,i.jsx)(w,{onClick:()=>{es(!1),x.push("/report")},children:o("readReport")}),(0,i.jsx)(w,{onClick:eh,children:o("coverReport")})]})]})})]})})}},6034:(e,t,a)=>{Promise.resolve().then(a.bind(a,4075))},9126:(e,t,a)=>{"use strict";a.d(t,{$q:()=>c,Gx:()=>l,Qc:()=>r,Xs:()=>o,sR:()=>i,t7:()=>d,w$:()=>s,x9:()=>n});let s={ROOM:"room",FURNITURE:"furniture"},i={LIVING_ROOM:"living_room",DINING_ROOM:"dining_room",STORAGE_ROOM:"storage_room",STUDY_ROOM:"study_room",BEDROOM:"bedroom",BATHROOM:"bathroom",KITCHEN:"kitchen",BALCONY:"balcony",GARDEN:"garden",GARAGE:"garage",CORRIDOR:"corridor"},n={BED:"bed",SOFA:"sofa",TABLE:"table",CHAIR:"chair",CABINET:"cabinet",TV:"tv",LAMP:"lamp",DOOR:"door",WINDOW:"window",BOOKSHELF:"bookshelf",WARDROBE:"wardrobe",PLANT:"plant",FRIDGE:"fridge",STOVE:"stove",SINK:"sink",WASHBASIN:"washbasin",TOILET:"toilet",SHOWER:"shower",BATHTUB:"bathtub"},r={[n.DOOR]:"门",[n.WINDOW]:"窗",[n.TABLE]:"枱",[n.CHAIR]:"椅子",[n.SOFA]:"沙发",[n.BED]:"床",[n.LAMP]:"儿童床",[n.TV]:"电视",[n.BOOKSHELF]:"茶几",[n.WARDROBE]:"柜",[n.PLANT]:"植物",[n.FRIDGE]:"冰箱",[n.STOVE]:"炉具",[n.SINK]:"锌盘",[n.WASHBASIN]:"洗手盘",[n.TOILET]:"马桶",[n.SHOWER]:"淋浴",[n.BATHTUB]:"浸浴"},l={[n.DOOR]:"門",[n.WINDOW]:"窗",[n.TABLE]:"枱",[n.CHAIR]:"椅子",[n.SOFA]:"沙發",[n.BED]:"床",[n.LAMP]:"兒童床",[n.TV]:"電視",[n.BOOKSHELF]:"茶几",[n.WARDROBE]:"櫃",[n.PLANT]:"植物",[n.FRIDGE]:"冰箱",[n.STOVE]:"爐具",[n.SINK]:"锌盘",[n.WASHBASIN]:"洗手盤",[n.TOILET]:"馬桶",[n.SHOWER]:"淋浴",[n.BATHTUB]:"浸浴"},o={[i.LIVING_ROOM]:"客厅",[i.DINING_ROOM]:"饭厅",[i.STORAGE_ROOM]:"杂物房",[i.STUDY_ROOM]:"书房",[i.BEDROOM]:"睡房",[i.BATHROOM]:"浴室",[i.KITCHEN]:"厨房",[i.BALCONY]:"阳台",[i.GARDEN]:"花园",[i.GARAGE]:"车库",[i.CORRIDOR]:"走廊"},d={[i.LIVING_ROOM]:"客廳",[i.DINING_ROOM]:"飯廳",[i.STORAGE_ROOM]:"雜物房",[i.STUDY_ROOM]:"書房",[i.BEDROOM]:"睡房",[i.BATHROOM]:"浴室",[i.KITCHEN]:"廚房",[i.BALCONY]:"陽台",[i.GARDEN]:"花園",[i.GARAGE]:"車庫",[i.CORRIDOR]:"走廊"},c={[i.LIVING_ROOM]:"#F0DF9C",[i.DINING_ROOM]:"#F5D4BC",[i.STORAGE_ROOM]:"#ADC0BC",[i.STUDY_ROOM]:"#B0B8C9",[i.BEDROOM]:"#F5B8B8",[i.BATHROOM]:"#C1D7E2",[i.KITCHEN]:"#EDE0C6",[i.BALCONY]:"#D0DCAA",[i.GARDEN]:"#AACDBC",[i.GARAGE]:"#C7C7DD",[i.CORRIDOR]:"#CDCDCD"}}},e=>{var t=t=>e(e.s=t);e.O(0,[265,376,400,379,601,204,801,778,357,638,72,358],()=>t(6034)),_N_E=e.O()}]);