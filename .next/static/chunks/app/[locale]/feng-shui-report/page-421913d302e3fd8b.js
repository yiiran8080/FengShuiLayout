(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5787],{27475:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>N});var s=n(95155),a=n(12115),o=n(35695);class i{static generatePersonalAnalysis(e,t,n){let s=e.getFullYear(),a=e.getMonth()+1,o=e.getDate(),i=["金","木","水","火","土"][s%5];return({感情:{basic:"根據你".concat(s,"年").concat(a,"月").concat(o,"日的八字，你屬於").concat(i,"命。").concat(i,"命的人在感情上").concat(this.getElementLoveTraits(i)),concern:"你的感情運勢顯示".concat(this.getLoveForcast(i,t)),specific:'針對你提到的"'.concat(n,'"，建議你').concat(this.getSpecificAdvice(i,"感情",n)),fengshui:"感情風水建議：".concat(this.getFengShuiAdvice(i,"感情"))},工作:{basic:"根據你".concat(s,"年").concat(a,"月").concat(o,"日的八字，你屬於").concat(i,"命。").concat(i,"命的人在事業上").concat(this.getElementCareerTraits(i)),concern:"你的事業運勢顯示".concat(this.getCareerForcast(i)),specific:'針對你的工作困擾"'.concat(n,'"，建議').concat(this.getSpecificAdvice(i,"工作",n)),fengshui:"事業風水建議：".concat(this.getFengShuiAdvice(i,"工作"))},財運:{basic:"根據你的八字分析，你屬於".concat(i,"命，").concat(i,"命人的財運特質是").concat(this.getElementWealthTraits(i)),concern:"你的財運分析顯示".concat(this.getWealthForcast(i)),specific:'對於你的財務問題"'.concat(n,'"，建議').concat(this.getSpecificAdvice(i,"財運",n)),fengshui:"招財風水佈局：".concat(this.getFengShuiAdvice(i,"財運"))}})[t]||{basic:"你屬於".concat(i,"命，具有").concat(i,"的特質"),concern:"你的運勢整體良好",specific:"建議你保持積極態度",fengshui:"建議調整居住環境的氣場"}}static async generatePersonalAnalysisV2(e,t,n){let s=e.getFullYear(),a=e.getMonth()+1,o=e.getDate(),i=["金","木","水","火","土"][s%5],r={personality:"根據你".concat(s,"年").concat(a,"月").concat(o,"日的八字，你屬於").concat(i,"命。").concat(i,"命的人").concat(this.getElementCareerTraits(i)),currentSituation:"你的".concat(t,"運勢顯示").concat(this.getCareerForcast(i)),futureOutlook:"未來".concat(t,"發展前景良好，適合積極規劃"),specificAdvice:'針對"'.concat(n,'"這個問題，建議你').concat(this.getSpecificAdvice(i,t,n)),fengShuiSolutions:"".concat(t,"風水建議：").concat(this.getFengShuiAdvice(i,t)),timingAdvice:"最佳行動時機在接下來的3-6個月內，".concat(i,"命人此期間運勢上升")};try{let s=await this.enhanceWithAI(e,t,n,i);return{...r,...s}}catch(e){return console.log("AI enhancement failed, using basic analysis:",e.message),r}}static async enhanceWithAI(e,t,n,s){let a=n||"整體運勢分析",o=t||"全面",i=n&&(n.includes("復合")||n.includes("分手")||n.includes("挽回"));return("作為專業風水師，請為以下用戶提供詳細分析：\n生日: ".concat(e.toDateString(),"\n五行: ").concat(s,"命\n關注領域: ").concat(o,"\n具體問題: ").concat(a,"\n\n請提供以下內容（用繁體中文回答）：\n1. 個人性格特質分析（基於五行和生辰）\n2. ").concat(o,'運勢現況分析\n3. 未來發展展望\n4. 針對"').concat(a,'"的具體建議\n5. 相關風水佈局建議\n6. 最佳行動時機建議\n\n請以專業但親切的語調回答，每個部分約50-80字。'),i)?{personality:"".concat(s,"命的你在感情中").concat(this.getElementLoveTraits(s),"。你對愛情有著深刻的理解，雖然目前面臨分手的痛苦，但你的").concat(s,"特質讓你具備重新獲得愛情的能力。"),currentSituation:"從八字來看，你們的分手並非偶然，而是感情發展中的一個考驗期。".concat(s,"命人在感情方面容易").concat(this.getElementLoveChallenges(s),"，但同時也具有化解情感危機的智慧。"),futureOutlook:"接下來的3-6個月是感情重建的關鍵期。".concat(s,"命人的感情運勢將在").concat(this.getBestMonth(s),"月達到高峰，這是復合的最佳時機窗口。"),specificAdvice:"復合不能急於一時，需要從內心開始調整。建議你先提升自己的".concat(s,"能量，通過風水調整增強個人魅力，讓對方重新看到你的改變和成長。"),fengShuiSolutions:"立即調整臥室桃花位（".concat(this.getElementDirection(s),"），擺放粉色水晶或鮮花。同時清理所有與前任相關的負能量物品，為新的感情能量騰出空間。"),timingAdvice:"復合的最佳時機在農曆".concat(this.getBestMonth(s),"月的").concat(s,"日。在此之前，專注於自我提升和能量調整，切勿急躁行事。")}:"感情"===o?{personality:"".concat(s,"命的你在感情中").concat(this.getElementLoveTraits(s),"。你有著獨特的愛情觀，能夠深度理解伴侶的需求，但有時也需要學會表達自己的感受。"),currentSituation:"目前你的感情運勢正處於穩定上升期。".concat(s,"命人在感情方面具有天然的優勢，你的魅力正在逐漸顯現，適合主動爭取心儀的對象。"),futureOutlook:"接下來的感情發展非常樂觀。特別是在".concat(this.getBestMonth(s),"月，你的桃花運將達到頂峰，有機會遇到真正適合的伴侶。"),specificAdvice:"在感情方面要發揮".concat(s,"命人的特長，保持自然真誠的態度。同時要注意避免").concat(s,"命人在感情中的常見誤區，學會適當的進退。"),fengShuiSolutions:"加強臥室和客廳的桃花位布局，在".concat(this.getElementDirection(s),"擺放成對的裝飾品，使用").concat(this.getElementColors(s),"來增強你的感情能量場。"),timingAdvice:"感情行動的最佳時機在".concat(s,"旺的日子，建議在農曆").concat(this.getBestMonth(s),"月主動出擊，成功率會大大提升。")}:{personality:"".concat(s,"命的你天生具有").concat(s,"的特質，在處理人生各個方面都展現出獨特的智慧。你的直覺敏銳，決策能力強，只是有時需要更多耐心等待時機成熟。"),currentSituation:"從整體八字來看，你目前正經歷一個重要的人生轉折期。雖然面臨各種挑戰，但這正是你成長蛻變的黃金時期，".concat(s,"命人特別適合在逆境中發光發熱。"),futureOutlook:"未來6-12個月對你來說充滿機遇。".concat(s,"命人在這段時間內各方面運勢都會穩步提升，特別適合制定長遠計劃並付諸行動。"),specificAdvice:"建議你充分發揮".concat(s,"命人的天賦優勢，在面對選擇時相信自己的直覺。同時要學會平衡").concat(s,"的特質，避免過於極端的決定。"),fengShuiSolutions:"整體運勢提升需要從居住環境開始調整。建議在".concat(this.getElementDirection(s),"加強布局，使用").concat(this.getElementColors(s),"的裝飾，營造有利於").concat(s,"能量的環境。"),timingAdvice:"重要決定和行動的最佳時機在農曆".concat(this.getBestMonth(s),"月。平時可選擇").concat(s,"旺的日子處理重要事務，會事半功倍。")}}static getElementDirection(e){return({金:"西方或西北方",木:"東方或東南方",水:"北方",火:"南方",土:"中央或西南方"})[e]||"適合的方位"}static getElementColors(e){return({金:"白色、金色、銀色",木:"綠色、青色",水:"藍色、黑色",火:"紅色、橙色",土:"黃色、棕色"})[e]||"相應顏色"}static getBestMonth(e){return({金:"七、八",木:"三、四",水:"十一、十二",火:"五、六",土:"六、九"})[e]||"適當"}static generateCoupleAnalysis(e,t){let n=["金","木","水","火","土"],s=n[e.getFullYear()%5],a=n[t.getFullYear()%5],o=this.calculateCompatibility(s,a);return{userElement:s,partnerElement:a,compatibility:o,advice:this.getCoupleAdvice(s,a,o)}}static calculateCompatibility(e,t){var n;return(null===(n=({金:{金:75,木:45,水:85,火:35,土:80},木:{金:45,木:70,水:80,火:85,土:40},水:{金:85,木:80,水:75,火:40,土:50},火:{金:35,木:85,水:40,火:70,土:75},土:{金:80,木:40,水:50,火:75,土:75}})[e])||void 0===n?void 0:n[t])||60}static getCoupleAdvice(e,t,n){return n>=80?"你們是".concat(e,"命和").concat(t,"命的組合，相性很好！建議多溝通，保持互相理解和支持。"):n>=60?"你們的八字配對中等，需要多包容和理解。".concat(e,"命要學會配合").concat(t,"命的節奏。"):"你們的五行有些相沖，但可以通過風水調整和互相理解來改善關係。建議在感情方面多用心經營。"}static getElementLoveTraits(e){return({金:"性格堅毅，對感情專一，但有時過於理性，需要學會表達情感",木:"充滿生命力，容易吸引異性，但要注意不要太過依賴對方",水:"感情豐富，直覺敏銳，但情緒波動較大，需要穩定的伴侶",火:"熱情如火，愛憎分明，但要控制脾氣，學會包容",土:"踏實可靠，值得信賴，但要主動一些，不要太被動"})[e]||"具有獨特的感情特質"}static getLoveForcast(e,t){return"".concat(e,"命人近期感情運勢上升，適合主動出擊或改善現有關係")}static getElementCareerTraits(e){return({金:"堅毅果決，適合管理職位，但要學會與人合作",木:"創意豐富，適合創新工作，但要注意堅持到底",水:"適應性強，善於溝通，但要避免過於被動",火:"充滿活力，領導能力強，但要控制急躁情緒",土:"踏實穩重，執行力佳，但要主動爭取機會"})[e]||"具有獨特的事業特質"}static getCareerForcast(e){return"".concat(e,"命人事業運勢穩步上升，適合在現有基礎上求發展")}static getElementWealthTraits(e){return({金:"理財觀念強，適合穩健投資，但要避免過於保守",木:"賺錢能力強，但花錢也快，需要學會儲蓄",水:"財運起伏較大，適合多元化投資",火:"賺錢機會多，但要避免衝動消費",土:"財運穩定，適合長期投資和置業"})[e]||"具有獨特的財運特質"}static getWealthForcast(e){return"".concat(e,"命人財運逐漸好轉，適合謹慎理財和長期規劃")}static getSpecificAdvice(e,t,n){return"感情"===t?"多溝通，理解對方想法，同時保持自己的獨立性":"工作"===t?"發揮".concat(e,"命的優勢，保持積極態度，機會即將出現"):"根據你的情況，建議保持耐心，時機成熟時自然會有改善"}static getFengShuiAdvice(e,t){var n;return(null===(n=({感情:{金:"在床頭放置粉色水晶，增強桃花運",木:"在東方位置擺放綠色植物，提升感情能量",水:"保持臥室整潔，使用藍色或黑色裝飾",火:"在南方放置紅色物品，但要適度",土:"使用黃色或棕色系裝飾，增加穩定感"},工作:{金:"辦公桌放置金屬製品，增強事業運",木:"辦公環境多用綠色，擺放小盆栽",水:"保持工作區域清潔，適度使用藍色元素",火:"辦公桌朝南，使用溫暖色調裝飾",土:"使用穩重色彩，辦公桌要整齊有序"},財運:{金:"在辦公室西方或西北方放置金屬聚寶盆",木:"東方或東南方擺放招財樹或竹子",水:"北方放置水晶球或魚缸（但要定期清潔）",火:"南方使用紅色裝飾，但避免過度",土:"中央或西南方放置黃色水晶或陶瓷製品"}})[t])||void 0===n?void 0:n[e])||"調整居住環境，增強正能量"}static generateCoupleAnalysis(e,t){let n=this.getElement(e),s=this.getElement(t),a=this.calculateCompatibility(n,s);return{userElement:n,partnerElement:s,compatibility:a,advice:this.getRelationshipAdvice(n,s,a)}}static getElement(e){return["金","木","水","火","土"][e.getFullYear()%5]}static calculateCompatibility(e,t){var n;return(null===(n=({金:{金:75,木:45,水:85,火:35,土:80},木:{金:45,木:70,水:80,火:85,土:50},水:{金:85,木:80,水:75,火:40,土:60},火:{金:35,木:85,水:40,火:70,土:75},土:{金:80,木:50,水:60,火:75,土:80}})[e])||void 0===n?void 0:n[t])||65}static getRelationshipAdvice(e,t,n){return n>=80?"你們的八字非常相配！五行相生，感情會越來越好。建議多溝通，珍惜這段緣分。":n>=60?"你們的八字配對不錯，需要互相理解和包容。建議在溝通上多花心思，關係會更穩定。":"你們的八字存在一些衝突，但這不代表不能在一起。建議通過風水調整和心態調節來改善關係。"}static generateCoupleAnalysisExplanation(){return"**\uD83D\uDC95 合婚配對分析係點樣運作嘅？**\n\n我嘅專業合婚分析會幫你了解兩個人嘅感情配對度，包括：\n\n**\uD83D\uDD2E 八字五行分析**\n• 根據雙方出生年月日，計算各自嘅五行屬性\n• 分析兩人五行係相生、相剋還係相和\n• 評估整體合配度百分比\n\n**\uD83D\uDC96 感情運勢預測**\n• 分析感情發展嘅最佳時機\n• 預測可能遇到嘅感情挑戰\n• 提供增進感情嘅具體建議\n\n**\uD83C\uDFE0 風水調整方案**\n• 為你們嘅居住環境提供風水建議\n• 推薦適合嘅風水擺設和顏色搭配\n• 化解感情障礙嘅風水方法\n\n**\uD83D\uDCCA 詳細分析報告**\n基本分析免費提供，詳細報告會包含：\n• 完整八字合婚圖表\n• 個人化感情建議\n• 未來一年感情運勢\n• 專業風水調整方案\n\n想開始合婚分析嗎？我需要你同伴侶嘅出生年月日。"}static getElementLoveTraits(e){return({金:"堅定專一，對愛情有著明確的標準。一旦認定對方，會全心全意付出，但有時過於理性，需要學會表達溫柔",木:"溫柔體貼，富有包容心。在愛情中善於照顧對方，但有時會因為太過遷就而失去自我，需要保持適當的堅持",水:"感情豐富，直覺敏銳。能夠深度理解伴侶的內心世界，但情緒變化較大，需要學會穩定自己的情感狀態",火:"熱情奔放，愛憎分明。在感情中充滿激情和活力，但有時過於衝動，需要學會冷靜思考和耐心等待",土:"忠誠可靠，重視承諾。在愛情中能給予對方強烈的安全感，但有時過於固執，需要學會變通和適應"})[e]||"在感情中有著獨特的魅力"}static getElementLoveChallenges(e){return({金:"過於理性而忽略感性需求",木:"太過遷就而失去個人立場",水:"情緒波動影響關係穩定",火:"衝動行事而忽略後果",土:"固執己見而缺乏變通"})[e]||"在感情表達上需要改進"}static detectDeepInterest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=["所有","全部","詳細","更多","完整","深入","具體","詳細一點","詳細啲","更詳細","全面","徹底","完全","every","all","detail","more","complete"].some(t=>e.includes(t)),s=["需要","想要","必須","一定要","馬上","立即","急需","迫切","想知道","想了解","希望"].some(t=>e.includes(t)),a=["還有呢","仲有咩","然後呢","跟住呢","接下來","下一步","that's it","what else","anything else","more tips"].some(t=>e.includes(t)),o=t.length>=3;return{hasDeepInterest:n,hasUrgency:s,hasContinuousInterest:a,hasMultipleQuestions:o,shouldPromotePersonalAnalysis:n||s&&a||o}}static generatePersonalAnalysisPromotion(e,t){let n={財運:{intro:"我了解你對財運改善很有興趣！\uD83D\uDCB0",explanation:"不過每個人的財運格局都不同，同樣的風水布局對不同八字的人效果會差很多。",value:"如果你提供出生日期，我可以根據你的個人八字進行精準分析：\n• 你的天生財運格局和特質\n• 最適合你的催財風水方案\n• 你的財運高峰期和注意時機\n• 個人化的招財建議和方法",cta:"這樣的個人化分析會比一般建議更有效果。你想試試嗎？"},工作:{intro:"我感受到你對工作發展很重視！\uD83D\uDCBC",explanation:"每個人的事業運走向都不同，需要根據個人八字來看最適合的發展方向。",value:"如果你提供出生日期，我可以為你分析：\n• 你的事業運勢和職場性格\n• 最適合你的工作方向和發展時機\n• 提升工作運的風水布局\n• 化解職場困難的具體方法",cta:"這樣的分析能幫你找到最適合的事業發展路徑。想了解嗎？"},感情:{intro:"看得出你對感情很用心！\uD83D\uDC95",explanation:"感情運勢跟個人八字和桃花運密切相關，需要個人化分析才能給出精準建議。",value:"如果你提供出生日期，我可以為你分析：\n• 你的桃花運勢和感情特質\n• 最佳的脫單時機和感情發展期\n• 提升桃花運的風水方法\n• 適合你的伴侶類型和相處模式",cta:"個人化的感情分析會比一般建議更有針對性。你有興趣嗎？"},健康:{intro:"健康確實是最重要的財富！\uD83C\uDFE5",explanation:"每個人的體質和健康運勢都不同，需要根據個人八字來制定養生方案。",value:"如果你提供出生日期，我可以為你分析：\n• 你的體質特點和健康運勢\n• 最適合你的養生方法和注意事項\n• 促進健康的風水布局\n• 預防疾病的個人化建議",cta:"個人化的健康分析能幫你制定最適合的養生計劃。想試試嗎？"}}[e]||{intro:"我看得出你對".concat(e,"很關心！"),explanation:"每個人的運勢格局都不同，需要根據個人八字來提供精準建議。",value:"如果你提供出生日期，我可以為你進行個人化的".concat(e,"分析，包括運勢走向、改善方法和最佳時機。"),cta:"個人化分析會比一般建議更有效果。你有興趣嗎？"};return"".concat(n.intro,"\n\n").concat(n.explanation,"\n\n").concat(n.value,"\n\n").concat(n.cta)}}var r=n(85339),l=n(43562),c=n(16218),d=n(31623),u=n(76970);n(47571);var g=n(37895),h=n(98066),m=n(71097),p=n(88903),y=n(91534),f=n(54149);function x(e){let{userInfo:t}=e,[n,o]=(0,a.useState)(null),[i,r]=(0,a.useState)(!0),[l,c]=(0,a.useState)(null);if(!t||!t.problem)return null;let d=(0,f.y_)(t);return(console.log("\uD83C\uDFA8 QuestionFocus Color Debug:",{userInfo:t,concern:null==t?void 0:t.concern,themeColor:d,colorMapping:{財運:"#D09900",财运:"#D09900",感情:"#C74772",健康:"#389D7D",事業:"#3263C4",事业:"#3263C4"}}),(0,a.useEffect)(()=>{(async()=>{try{r(!0),c(null);let e=await fetch("/api/question-focus-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInfo:t})}),n=await e.json();if(n.success)o(n.solution);else throw Error(n.error||"分析失敗")}catch(e){console.error("Failed to generate AI solution:",e),c(e.message),o({健康:{title:"健康管理要點",content:"建議定期健康檢查，保持規律作息與適度運動。注重飲食均衡，避免過度勞累。如有身體不適應及時就醫，以專業醫療建議為主。"},財運:{title:"理財策略重點",content:"建議採取穩健投資策略，避免高風險投機。重視現金流管理，建立緊急基金。投資前需充分了解風險，分散投資組合。"},感情:{title:"情感經營要點",content:"注重溝通技巧的提升，學會換位思考與包容。建立健康的相處模式，給彼此適當空間。遇到衝突時保持冷靜，尋求雙贏解決方案。"},事業:{title:"職涯發展建議",content:"專注提升核心競爭力，持續學習新技能。建立良好人際關係網絡，把握合適機會但避免過度冒進。制定明確職涯規劃。"}}[t.concern]||{title:"綜合指導原則",content:"建議採取務實穩健的態度面對問題，充分收集資訊後再做決策。保持積極心態，但也要有合理預期。"})}finally{r(!1)}})()},[t]),i)?(0,s.jsx)("section",{className:"w-full sm:w-[95%] lg:w-[95%] mx-auto bg-white rounded-[45px] p-6 sm:p-8 lg:p-10 mb-6 sm:mb-10 shadow-[0_4px_5.3px_rgba(0,0,0,0.25)]",children:(0,s.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"inline-block w-8 h-8 mb-4 border-b-2 rounded-full animate-spin",style:{borderColor:d}}),(0,s.jsx)("p",{className:"text-gray-600",children:"AI正在分析您的問題..."})]})})}):l&&!n?(0,s.jsx)("section",{className:"w-full sm:w-[95%] lg:w-[95%] mx-auto bg-white rounded-[45px] p-6 sm:p-8 lg:p-10 mb-6 sm:mb-10 shadow-[0_4px_5.3px_rgba(0,0,0,0.25)]",children:(0,s.jsx)("div",{className:"py-10 text-center",children:(0,s.jsx)("p",{className:"text-red-600",children:"分析服務暫時不可用，請稍後再試"})})}):(0,s.jsxs)("section",{className:"w-full sm:w-[95%] lg:w-[95%] mx-auto p-6 sm:p-8 lg:p-10 mb-6 sm:mb-10 ",children:[(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsxs)("div",{className:"border-4 rounded-[30px] bg-white p-6 mb-6",style:{borderColor:d},children:[(0,s.jsx)("h2",{className:"text-center text-[32px] font-bold mb-4",style:{fontFamily:"Noto Serif TC, serif",color:d},children:"疑問重點"}),(0,s.jsx)("div",{className:"text-center text-[18px] leading-relaxed px-4",style:{fontFamily:"Noto Sans HK, sans-serif",color:"#333"},children:t.problem})]})}),(0,s.jsxs)("div",{className:"border-4 rounded-[30px] bg-white p-8",style:{borderColor:d},children:[(0,s.jsx)("h3",{className:"text-center text-[32px] font-bold mb-6",style:{fontFamily:"Noto Serif TC, serif",color:d},children:n.title}),(0,s.jsx)("div",{className:"text-[16px] leading-relaxed text-center px-4",style:{fontFamily:"Noto Sans HK, sans-serif",color:"#333",lineHeight:"1.8"},children:n.content})]})]})}let b=e=>{let{savedContent:t,userInputs:n}=e;if(!t)return(0,s.jsx)("div",{children:"No saved content available"});let a=(e,t)=>t?(0,s.jsxs)("div",{className:"mb-6 p-6 bg-white rounded-lg shadow-md",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4 text-gray-800",children:e}),(0,s.jsx)("div",{className:"text-gray-700 whitespace-pre-wrap",children:"string"==typeof t?t:JSON.stringify(t,null,2)})]}):null;return(0,s.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:"已保存的風水報告"}),(0,s.jsxs)("div",{className:"bg-blue-50 p-4 rounded-lg",children:[(0,s.jsx)("h2",{className:"font-semibold text-blue-800 mb-2",children:"報告基本信息："}),(0,s.jsxs)("div",{className:"text-blue-700",children:[(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"生日："}),null==n?void 0:n.birthday]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"性別："}),null==n?void 0:n.gender]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"關注領域："}),null==n?void 0:n.concern]}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"具體問題："}),null==n?void 0:n.problem]}),(null==n?void 0:n.partnerBirthday)&&(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"伴侶生日："}),n.partnerBirthday]})]})]})]}),((e,t)=>t?(0,s.jsxs)("div",{className:"mb-6 p-6 bg-white rounded-lg shadow-md",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4 text-gray-800",children:e}),(0,s.jsx)("div",{className:"space-y-4",children:Object.entries(t).map(e=>{let[t,n]=e;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("h4",{className:"font-medium text-gray-800 mb-2",children:[t,":"]}),(0,s.jsx)("div",{className:"text-gray-700 whitespace-pre-wrap ml-4",children:"string"==typeof n?n:JSON.stringify(n,null,2)})]},t)})})]}):null)("基礎分析",t.basicAnalysis),a("五行分析",t.fiveElementAnalysis),a("生肖分析",t.zodiacAnalysis),a("流年關鍵詞分析",t.liuNianKeyWordAnalysis),a("命局分析",t.mingJuAnalysis),a("干支分析",t.ganZhiAnalysis),a("吉凶分析",t.jiXiongAnalysis),a("季節分析",t.seasonAnalysis),a("核心建議",t.coreSuggestionAnalysis),a("具體建議",t.specificSuggestionAnalysis),t.coupleAnalysis&&a("配對分析",t.coupleAnalysis)]})};var v=n(60470),A=n(85495),j=n(35226),S=n(40003);function N(){let[e,t]=(0,a.useState)(null),[n,N]=(0,a.useState)(!0),[w,C]=(0,a.useState)(null),T=(0,o.useSearchParams)(),D=(0,o.useRouter)(),E=e=>{if(!(null==e?void 0:e.birthDateTime))return null;let t=(0,v.Ay)(e.birthDateTime,e.gender||"male");if(!t)return null;let n={金:0,木:0,水:0,火:0,土:0};t.yearStemWuxing&&n[t.yearStemWuxing]++,t.yearBranchWuxing&&n[t.yearBranchWuxing]++,t.monthStemWuxing&&n[t.monthStemWuxing]++,t.monthBranchWuxing&&n[t.monthBranchWuxing]++,t.dayStemWuxing&&n[t.dayStemWuxing]++,t.dayBranchWuxing&&n[t.dayBranchWuxing]++,t.hourStemWuxing&&n[t.hourStemWuxing]++,t.hourBranchWuxing&&n[t.hourBranchWuxing]++;let s=Object.entries(n).filter(e=>{let[t,n]=e;return 0===n}).map(e=>{let[t,n]=e;return t});return{wuxingData:t,elementCounts:n,missingElements:s}},I=e=>{let t=Object.values(e).reduce((e,t)=>e+t,0),n=[],s=[];Object.entries(e).forEach(e=>{let[a,o]=e;o/t*100>=25?n.push(a):0===o&&s.push(a)});let a="";if(1===n.length)a="".concat(n[0],"旺");else if(2===n.length)a="".concat(n.join(""),"兩旺");else if(n.length>=3)a="".concat(n.slice(0,2).join(""),"等多旺");else{var o;let t=Math.max(...Object.values(e)),n=null===(o=Object.entries(e).find(e=>{let[n,s]=e;return s===t}))||void 0===o?void 0:o[0];a=n?"".concat(n,"為主"):"五行平衡"}return{strongElements:n,weakElements:s,strengthDesc:a,elementCounts:e}},O=e=>{let{strongElements:t,weakElements:n,elementCounts:s}=e,a=["木","火","土","金","水"],o="",i="",r="";if(n.length>0){if(o=n[0],n.length>1)i=n[1];else{let e=a.indexOf(o);i=a[(e-1+5)%5]}r="補缺"}else if(0===t.length){let e=Math.min(...Object.values(s));o=Object.entries(s).filter(t=>{let[n,s]=t;return s===e}).map(e=>{let[t,n]=e;return t})[0];let t=a.indexOf(o);i=a[(t-1+5)%5],r="扶弱"}else if(t.length>=2){let e=t[0],n=(a.indexOf(e)+1)%5;o=a[n],i=a[(n+1)%5],r="抑強"}else if(1===t.length){let e=t[0],n=a.indexOf(e);o=a[(n+1)%5],i=a[(n+2)%5],r="瀉強"}return{primaryGod:o,auxiliaryGod:i,strategy:r}};(0,a.useEffect)(()=>{F()},[]);let F=async()=>{try{var e,t,n;let s=T.get("session_id");if(!s){C("缺少支付會話ID，請重新進行支付"),N(!1);return}console.log("Checking report for session:",s);let a=T.get("birthday"),o=T.get("gender"),i=T.get("concern"),r=T.get("problem"),l=T.get("partnerBirthday"),c=new URL("/api/fortune-report",window.location.origin);a&&c.searchParams.set("birthday",a),o&&c.searchParams.set("gender",o),i&&c.searchParams.set("concern",i),r&&c.searchParams.set("problem",r),l&&c.searchParams.set("partnerBirthday",l);let d=await fetch(c.toString(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:s})}),u=await d.json();if(console.log("API Response received:"),console.log("- status:",u.status),console.log("- reportExists:",u.reportExists),console.log("- reportGenerated:",u.reportGenerated),console.log("- canGenerateNew:",null===(e=u.data)||void 0===e?void 0:e.canGenerateNew),console.log("- sessionId:",s),console.log("- Full response:",JSON.stringify(u,null,2)),0!==u.status){u.paymentRequired?C("支付未完成，請完成支付後再試"):C("檢查報告狀態失敗："+u.error),N(!1);return}let g="true"===T.get("showHistorical");u.reportExists&&u.reportGenerated&&(null===(t=u.data)||void 0===t?void 0:t.reportContent)&&g?(console.log("✅ Displaying saved historical report content"),await P(u.data)):(null===(n=u.data)||void 0===n?void 0:n.canGenerateNew)?(console.log("✅ Generating fresh content for this session"),await W(s,u.data.userInputs)):(console.error("❌ Cannot generate report!"),console.error("- Full checkData:",JSON.stringify(u,null,2)),C("報告生成失敗，請聯繫客服"),N(!1))}catch(e){console.error("Report check error:",e),C("檢查報告時出現錯誤"),N(!1)}},P=async e=>{try{console.log("\uD83D\uDCD6 Displaying saved report content:",e);let n={birthday:e.userInputs.birthday,gender:e.userInputs.gender,concern:e.userInputs.concern,problem:e.userInputs.problem,partnerBirthday:e.userInputs.partnerBirthday,savedReportContent:e.reportContent,isHistoricalReport:!0};t(n),N(!1)}catch(e){console.error("Error displaying saved report:",e),C("顯示已儲存報告時出現錯誤"),N(!1)}},W=async(e,n)=>{try{let s=T.get("birthday")||n.birthday,a=T.get("gender")||n.gender,o=T.get("concern")||n.concern,r=T.get("problem")||n.problem,l=T.get("partnerBirthday")||n.partnerBirthday;if(console.log("Generating new report with params:"),console.log("- birthday:",s),console.log("- gender:",a),console.log("- concern:",o),console.log("- problem:",r),console.log("- partnerBirthday:",l),!s||!o||!r){C("缺少必要的分析參數"),N(!1);return}let c=new Date(s);console.log("\uD83D\uDD0D Calling BaziAnalysisSystem.generatePersonalAnalysisV2...");let d=await i.generatePersonalAnalysisV2(c,o,r);console.log("\uD83D\uDCCA Analysis result:"),console.log("- analysis:",d),console.log("- analysis keys:",d?Object.keys(d):"null"),d&&Object.keys(d).forEach(e=>{console.log("- analysis.".concat(e,":"),d[e])});let u=null;if(l&&"感情"===o){let e=new Date(l);u=i.generateCoupleAnalysis(c,e),console.log("\uD83D\uDC91 Couple analysis result:",u)}let g={birthday:s,gender:a,concern:o,problem:r,partnerBirthday:l,analysis:d,coupleAnalysis:u},h={basicAnalysis:d,coupleAnalysis:u,initialSaveTime:new Date().toISOString(),fiveElementAnalysis:null,zodiacAnalysis:null,liuNianKeyWordAnalysis:null,mingJuAnalysis:null,ganZhiAnalysis:null,jiXiongAnalysis:null,seasonAnalysis:null,coreSuggestionAnalysis:null,specificSuggestionAnalysis:null};console.log("\uD83D\uDCBE Saving report content to database:"),console.log("- reportContentToSave:",JSON.stringify(h,null,2));let m=await fetch("/api/fortune-report",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,reportContent:h})}),p=await m.json();console.log("\uD83D\uDCBE Save response:",p),0===p.status?console.log("✅ Report saved successfully to database"):console.warn("❌ Failed to save report to database:",p.error),t(g),N(!1),setTimeout(()=>{L(e,c,o,r,l,a)},2e4)}catch(e){console.error("Report generation error:",e),C("生成報告時出現錯誤"),N(!1)}},L=async(e,t,n,s,a,o)=>{try{console.log("\uD83D\uDD04 Starting background save of complete report content..."),console.log("\uD83D\uDCCB Session ID for background save:",e),await new Promise(e=>setTimeout(e,5e3));let a=await B(t,n,s,o);console.log("\uD83D\uDCBE Saving complete report content:",a);let i=await fetch("/api/fortune-report",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:e,reportContent:a})}),r=await i.json();0===r.status?console.log("✅ Complete report content saved successfully!"):console.warn("❌ Failed to save complete content:",r.error)}catch(e){console.error("❌ Error saving complete report content:",e)}},B=async(e,t,n,s)=>{let a={fiveElementAnalysis:null,zodiacAnalysis:null,liuNianKeyWordAnalysis:null,mingJuAnalysis:null,ganZhiAnalysis:null,jiXiongAnalysis:null,seasonAnalysis:null,coreSuggestionAnalysis:null,specificSuggestionAnalysis:null,reportGeneratedAt:new Date().toISOString()};try{let o=e instanceof Date?e.toISOString().split("T")[0]:e;console.log("\uD83D\uDD04 Collecting component data with userInfo:",{birthDateTime:o,birthday:o,gender:s||"male",concern:t,problem:n,time:"00:00:00"});let i=[fetch("/api/wuxing-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInfo:{birthDateTime:o,gender:s||"male",concern:t,problem:n}})}).then(async e=>{let t=await e.json();return console.log("\uD83D\uDD0D Five Element API response:",t),{type:"fiveElementAnalysis",data:t.success?t.data:null}}).catch(e=>(console.error("❌ Five Element API failed:",e),{type:"fiveElementAnalysis",data:null})),fetch("/api/ai-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({concern:t,userBirthday:o,gender:s||"male"})}).then(async e=>{let t=await e.json();return console.log("\uD83D\uDD0D LiuNianKeyWord API response:",t),{type:"liuNianKeyWordAnalysis",data:t.success?t.data||t.content:null}}).catch(e=>(console.error("❌ LiuNianKeyWord API failed:",e),{type:"liuNianKeyWordAnalysis",data:null})),fetch("/api/ganzhi-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInfo:{birthDateTime:o,gender:s||"male",concern:t,problem:n}})}).then(async e=>{let t=await e.json();return console.log("\uD83D\uDD0D GanZhi API response:",t),{type:"ganZhiAnalysis",data:t.success?t.data||t.analysis:null}}).catch(e=>(console.error("❌ GanZhi API failed:",e),{type:"ganZhiAnalysis",data:null})),fetch("/api/jixiong-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInfo:{birthday:o,gender:s||"male",time:"00:00:00",concern:t}})}).then(async e=>{let t=await e.json();return console.log("\uD83D\uDD0D JiXiong API response:",t),{type:"jiXiongAnalysis",data:t.success?t.analysis:null}}).catch(e=>(console.error("❌ JiXiong API failed:",e),{type:"jiXiongAnalysis",data:null})),fetch("/api/season-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInfo:{birthday:o,gender:s||"male",time:"00:00:00",concern:t}})}).then(async e=>{let t=await e.json();return console.log("\uD83D\uDD0D Season API response:",t),{type:"seasonAnalysis",data:t.success?t.analysis:null}}).catch(e=>(console.error("❌ Season API failed:",e),{type:"seasonAnalysis",data:null})),fetch("/api/core-suggestion-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInfo:{birthday:o,gender:s||"male",concern:t,time:"00:00:00"}})}).then(async e=>{let t=await e.json();return console.log("\uD83D\uDD0D Core Suggestion API response:",t),{type:"coreSuggestionAnalysis",data:t.success?t.data||t.analysis:null}}).catch(e=>(console.error("❌ CoreSuggestion API failed:",e),{type:"coreSuggestionAnalysis",data:null})),fetch("/api/specific-suggestion-analysis",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userInfo:{birthDateTime:o,gender:s||"male",concern:t,problem:n}})}).then(async e=>{let t=await e.json();return console.log("\uD83D\uDD0D Specific Suggestion API response:",t),{type:"specificSuggestionAnalysis",data:t.success?t.data:null}}).catch(e=>(console.error("❌ SpecificSuggestion API failed:",e),{type:"specificSuggestionAnalysis",data:null}))];(await Promise.all(i)).forEach(e=>{e.data&&(a[e.type]=e.data,console.log("✅ Collected ".concat(e.type,":"),e.data?"SUCCESS":"NULL"))}),console.log("� Complete component data collection results:",{liuNianKeyWordAnalysis:a.liuNianKeyWordAnalysis?"HAS_DATA":"NULL",ganZhiAnalysis:a.ganZhiAnalysis?"HAS_DATA":"NULL",jiXiongAnalysis:a.jiXiongAnalysis?"HAS_DATA":"NULL",seasonAnalysis:a.seasonAnalysis?"HAS_DATA":"NULL",coreSuggestionAnalysis:a.coreSuggestionAnalysis?"HAS_DATA":"NULL",specificSuggestionAnalysis:a.specificSuggestionAnalysis?"HAS_DATA":"NULL"})}catch(e){console.error("❌ Error collecting loaded component data:",e)}return a};return n?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-indigo-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-12 h-12 mx-auto mb-4 border-b-2 border-purple-600 rounded-full animate-spin"}),(0,s.jsx)("p",{className:"text-gray-600",children:"正在檢查你的專屬風水分析報告..."}),(0,s.jsx)("p",{className:"mt-2 text-sm text-gray-500",children:"如果報告已存在，將直接顯示"})]})}):w?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-indigo-50",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)(r.A,{className:"w-12 h-12 mx-auto mb-4 text-red-500"}),(0,s.jsx)("p",{className:"mb-4 text-red-600",children:w}),(0,s.jsx)("button",{onClick:()=>D.back(),className:"px-6 py-2 text-white bg-purple-600 rounded-lg hover:bg-purple-700",children:"返回"})]})}):(null==e?void 0:e.isHistoricalReport)?(0,s.jsxs)("div",{className:"min-h-screen bg-[#EFEFEF]",children:[(0,s.jsx)(j.default,{from:"report"}),(0,s.jsxs)("div",{className:"container w-full px-4 py-8 mx-auto",style:{paddingTop:"80px"},children:[(0,s.jsx)("div",{className:"mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,s.jsxs)("p",{className:"text-yellow-800",children:[(0,s.jsx)("strong",{children:"注意："}),"您正在查看已保存的歷史報告內容。",(0,s.jsx)("a",{href:"".concat(window.location.pathname).concat(window.location.search.replace("showHistorical=true","").replace("&showHistorical=true","").replace("?showHistorical=true&","?")),className:"ml-2 text-blue-600 hover:text-blue-800 underline",children:"點擊這裡生成新的報告"})]})}),(0,s.jsx)(b,{savedContent:e.savedReportContent,userInputs:{birthday:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem,partnerBirthday:e.partnerBirthday}})]}),(0,s.jsx)(S.A,{})]}):(0,s.jsxs)("div",{className:"min-h-screen bg-[#EFEFEF]",children:[(0,s.jsx)(j.default,{from:"report"}),(0,s.jsx)(A.oo,{children:(0,s.jsxs)("div",{className:"container w-full px-4 py-8 mx-auto",style:{paddingTop:"80px"},children:[(0,s.jsx)("div",{className:"mb-8",style:{marginLeft:"5%"},children:(0,s.jsx)("h1",{className:"mb-2 font-extrabold",style:{fontFamily:"Noto Serif TC, Serif",fontWeight:800,fontSize:"60px",color:(0,f.y_)({concern:null==e?void 0:e.concern})},children:"命主基礎分析"})}),e&&(0,s.jsx)("div",{className:"mb-6",style:{width:"100%"},children:(0,s.jsx)(l.A,{userInfo:{birthDateTime:e.birthday,gender:e.gender},calculateWuxingAnalysis:E,analyzeWuxingStrength:I,determineUsefulGods:O})}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(c.A,{userInfo:{birthDateTime:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem},calculateWuxingAnalysis:E,analyzeWuxingStrength:I,determineUsefulGods:O})}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(x,{userInfo:{birthDateTime:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem}})}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(d.A,{userInfo:{birthDateTime:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem},currentYear:new Date().getFullYear()})}),(0,s.jsx)("div",{className:"mb-8",style:{marginLeft:"5%"},children:(0,s.jsx)("h1",{className:"mb-2 font-extrabold",style:{fontFamily:"Noto Serif TC, Serif",fontWeight:800,fontSize:"60px",color:(0,f.y_)({concern:null==e?void 0:e.concern})},children:"命局核心解析詳解"})}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(u.V,{userInfo:{birthDateTime:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem},currentYear:new Date().getFullYear()})}),(0,s.jsx)("div",{className:"mb-8",style:{marginLeft:"5%"},children:(0,s.jsx)("h1",{className:"mb-2 font-extrabold",style:{fontFamily:"Noto Serif TC, Serif",fontWeight:800,fontSize:"60px",color:(0,f.y_)({concern:null==e?void 0:e.concern})},children:"2025乙巳流年詳解"})}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(g.A,{userInfo:{birthDateTime:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem},currentYear:new Date().getFullYear()})}),(0,s.jsx)("div",{className:"mb-8",style:{marginLeft:"5%"},children:(0,s.jsx)("h1",{className:"mb-2 font-extrabold",style:{fontFamily:"Noto Serif TC, Serif",fontWeight:800,fontSize:"60px",color:(0,f.y_)({concern:null==e?void 0:e.concern})},children:{財運:"流年財運總結",财运:"流年財運總結",感情:"流年感情總結",健康:"流年健康總結",事業:"流年事業總結",事业:"流年事業總結"}[null==e?void 0:e.concern]||"流年運勢總結"})}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(h.A,{userInfo:{birthDateTime:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem},calculateWuxingAnalysis:E,analyzeWuxingStrength:I,determineUsefulGods:O})}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(m.A,{userInfo:{birthDateTime:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem},currentYear:new Date().getFullYear()})}),(0,s.jsx)("div",{className:"mb-8",style:{marginLeft:"5%"},children:(0,s.jsx)("h1",{className:"mb-2 font-extrabold",style:{fontFamily:"Noto Serif TC, Serif",fontWeight:800,fontSize:"60px",color:(0,f.y_)({concern:null==e?void 0:e.concern})},children:"開運建議"})}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(p.A,{userInfo:{birthDateTime:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem},currentYear:new Date().getFullYear()})}),e&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)(y.A,{userInfo:{birthDateTime:e.birthday,gender:e.gender,concern:e.concern,problem:e.problem},currentYear:new Date().getFullYear()})})]})}),(0,s.jsx)(S.A,{})]})}},81747:(e,t,n)=>{Promise.resolve().then(n.bind(n,27475))}},e=>{var t=t=>e(e.s=t);e.O(0,[8057,586,6453,7215,8543,6874,6491,3519,9855,5226,5617,8441,1684,7358],()=>t(81747)),_N_E=e.O()}]);