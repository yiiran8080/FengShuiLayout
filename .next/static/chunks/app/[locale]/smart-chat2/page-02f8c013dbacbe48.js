(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3546],{12486:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]])},17444:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>g});var r=s(95155),o=s(12115),a=s(45493),n=s(35695),l=s(60388),i=s(54416),c=s(74783);let d=(0,s(19946).A)("mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]);var m=s(12486),p=s(49376);s(26126);var u=s(85828),h=s(35226);function g(){var e;let{data:t}=(0,a.wV)(),g=(0,n.usePathname)(),[x,y]=(0,o.useState)("hongkong");(0,o.useEffect)(()=>{console.log("\uD83D\uDD04 Region detection useEffect running...");{let e=localStorage.getItem("userRegion");console.log("\uD83D\uDCF1 Retrieved from localStorage - userRegion:",e),e&&["china","hongkong"].includes(e)?(y(e),console.log("\uD83D\uDCBE Using stored region preference:",e)):console.log("❌ No valid stored region found, using default:","hongkong")}},[]);let b={china:"zh-CN",hongkong:"zh-TW",taiwan:"zh-TW"},f=(null==g?void 0:g.split("/"))||[],v="zh-CN"===f[1]||"zh-TW"===f[1]?f[1]:"zh-TW",[w,j]=(0,o.useState)(v);(0,o.useEffect)(()=>{let e=b[x]||v;j(e),console.log("\uD83C\uDF0D Smart-chat2 region-based locale:",{userRegion:x,currentLocale:e,urlLocale:v})},[x,v]);let[N,k]=(0,o.useState)([]),[C,S]=(0,o.useState)(""),[E,T]=(0,o.useState)(!1),[D,I]=(0,o.useState)(""),[A,P]=(0,o.useState)(!1),B=(0,o.useRef)(null),[R,U]=(0,o.useState)(!1),[z,M]=(0,o.useState)(!1),[O,F]=(0,o.useState)(""),[L,W]=(0,o.useState)(!1),[_,V]=(0,o.useState)(""),[q,Z]=(0,o.useState)(""),[G,Q]=(0,o.useState)(""),[$,H]=(0,o.useState)([]),[J,K]=(0,o.useState)(""),[Y,X]=(0,o.useState)(!1),[ee,et]=(0,o.useState)(!1),[es,er]=(0,o.useState)(!0),[eo,ea]=(0,o.useState)(!1);(0,o.useEffect)(()=>{var e;let s;if(ee){console.log("⏭️ Smart-Chat2 已初始化，跳過重複初始化");return}if(P(!0),(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.email)?s=t.user.email:(s=localStorage.getItem("feng-shui-user-id"))||(s="user-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),localStorage.setItem("feng-shui-user-id",s)),J===s&&N.length>1){console.log("\uD83D\uDC64 用戶未變化，跳過重新初始化");return}console.log("\uD83D\uDD04 初始化 Smart-Chat2，用戶:",s),K(s),I("smart-chat2-".concat(Date.now())),k([]),er(!0),ed(s),et(!0)},[null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.email,ee,J,N.length]),(0,o.useEffect)(()=>{var e;null===(e=B.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[N]);let en=async()=>{if(!C.trim()||E)return;if(es&&er(!1),console.log("\uD83D\uDD0D Before checking couple analysis - isCoupleAnalysis:",L,"inputMessage:",C.trim()),L&&"1"===C.trim()){console.log("\uD83C\uDFAF Couple analysis option 1 selected - redirecting directly to couple payment");let e={role:"user",content:C.trim(),timestamp:new Date};k(t=>[...t,e]),S("");let t={role:"assistant",content:"太好了！正在為您處理情侶合盤分析付款...",timestamp:new Date};k(e=>[...e,t]);let r=G||q||O||"感情關係和諧改善建議";try{T(!0);let e=localStorage.getItem("userRegion"),t={china:"zh-CN",hongkong:"zh-TW",taiwan:"zh-TW"}[e]||w;console.log("\uD83D\uDCB3 Couple payment - Using fresh locale:",t,"from stored region:",e);let o=await fetch("/api/payment-couple",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({locale:t,specificProblem:r,concern:O,fromChat:!0,sessionId:D})});if(o.ok){let e=await o.json();if(console.log("\uD83D\uDCB3 Couple Payment Response:",e),e.sessionId){let t="pk_test_51RTB0lECl1ZAgMvGTBBmWjK7BWeZBVkBEVVvUj4P14T67Z0WTHI9y0k6ZUDZQtOnQbBhd0B21CaXML5b5q4dN7q800qwxStuQU";if(!t)throw Error("Stripe public key not configured");let r=await s.e(7368).then(s.bind(s,7368)).then(e=>e.loadStripe(t));if(r)console.log("\uD83D\uDE80 Redirecting to Stripe checkout for couple payment"),await r.redirectToCheckout({sessionId:e.sessionId});else throw Error("Failed to load Stripe")}else throw Error("No session ID received from couple payment")}else throw Error("Payment API error: ".concat(o.status))}catch(t){console.error("\uD83D\uDCB3 Couple payment error:",t),T(!1);let e={role:"assistant",content:"抱歉，付款處理時發生錯誤，請稍後再試。",timestamp:new Date};k(t=>[...t,e])}return}let e={role:"user",content:C.trim(),timestamp:new Date};k(t=>[...t,e]),S(""),T(!0);try{let r=await fetch("/api/smart-chat2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e.content,sessionId:D,userId:J})}),o=await r.json();if(console.log("\uD83D\uDD0D 完整 API 回應:",o),console.log("\uD83D\uDD0D data.specificProblem:",o.specificProblem),console.log("\uD83D\uDD0D data.concern:",o.concern),r.ok){let e={role:"assistant",content:o.response,timestamp:new Date,aiAnalysis:o.aiAnalysis,systemType:o.systemType};if(k(t=>[...t,e]),console.log("\uD83D\uDD0D 檢查 Payment 觸發條件:",o.needsBirthdayInfo,o.shouldTriggerModal,"isCoupleAnalysis:",o.isCoupleAnalysis),(o.hasCouplesBirthdays||o.isCoupleAnalysis)&&(console.log("\uD83C\uDFAF Setting couple analysis to true due to couple birthdays detected"),W(!0)),o.needsBirthdayInfo||o.shouldTriggerModal){let e;M(!0),F(o.concern||""),V(o.reportType||""),console.log("\uD83D\uDD14 檢查 API 回應中的 specificProblem:",o.specificProblem);let r="";o.specificProblem&&(Q(o.specificProblem),console.log("\uD83D\uDCBE 更新最新具體問題:",o.specificProblem),q||(Z(o.specificProblem),console.log("\uD83D\uDCDD 設置原始問題:",o.specificProblem)),r=o.specificProblem),console.log("\uD83D\uDCB3 直接觸發付款 - concern:",o.concern,"problem:",r),console.log("\uD83D\uDCB3 檢查付款類型 - paymentType:",o.paymentType,"concern:",o.concern,"problem:",r);let a="comprehensive"===o.paymentType,n="premium"===o.paymentType;e=a?"/api/checkoutSessions/payment4":n?"/api/checkoutSessions/payment2":"/api/payment-fortune",console.log("\uD83D\uDCB3 使用付款端點: ".concat(e," (comprehensive: ").concat(a,", premium: ").concat(n,")"));try{let l;if(T(!0),a||n)l=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({quantity:1,directPayment:!0})});else{let t={財運:"financial",健康:"health",事業:"career",工作:"career",感情:"love"}[o.concern]||"financial",s=localStorage.getItem("userRegion"),a={china:"zh-CN",hongkong:"zh-TW",taiwan:"zh-TW"},n=a[s]||w;console.log("\uD83D\uDD25\uD83D\uDD25\uD83D\uDD25 INDIVIDUAL PAYMENT LOCALE DEBUG \uD83D\uDD25\uD83D\uDD25\uD83D\uDD25"),console.log("\uD83D\uDCB0 About to call fortune payment with locale:",n),console.log("\uD83D\uDD0D All locale variables:"),console.log("   - userRegion (state):",x),console.log("   - currentLocale (state):",w),console.log("   - storedRegion (localStorage):",s),console.log("   - freshLocale (calculated):",n),console.log("   - pathname:",g),console.log("   - regionToLocaleMap:",a),console.log("\uD83D\uDD25\uD83D\uDD25\uD83D\uDD25 END INDIVIDUAL PAYMENT DEBUG \uD83D\uDD25\uD83D\uDD25\uD83D\uDD25");let i={concern:t,specificProblem:r,fromChat:!0,locale:n};console.log("\uD83D\uDCE4 INDIVIDUAL PAYMENT REQUEST PAYLOAD:",i),l=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)})}if(l.ok){let e=await l.json();if(console.log("\uD83D\uDCB3 ".concat(a?"Expert88 ($88)":n?"Premium ($188)":"Fortune ($38)"," Payment Response:"),e),a||n){var t;if(null===(t=e.data)||void 0===t?void 0:t.url)window.location.href=e.data.url;else throw Error("No checkout URL received from ".concat(n?"Premium":"Expert88"," payment"))}else if(e.sessionId){let t="pk_test_51RTB0lECl1ZAgMvGTBBmWjK7BWeZBVkBEVVvUj4P14T67Z0WTHI9y0k6ZUDZQtOnQbBhd0B21CaXML5b5q4dN7q800qwxStuQU";if(!t)throw Error("Stripe public key not configured");let r=await s.e(7368).then(s.bind(s,7368)).then(e=>e.loadStripe(t));if(r)await r.redirectToCheckout({sessionId:e.sessionId});else throw Error("Failed to load Stripe")}else throw Error("No session ID received from Fortune payment")}else{let e=await l.json();throw Error(e.error||"Payment error")}}catch(e){console.error("\uD83D\uDCB3 ".concat(a?"Comprehensive ($88)":n?"Premium ($188)":"Fortune ($38)"," payment error:"),e),T(!1),k(e=>[...e,{role:"assistant",content:"抱歉，付款過程中出現錯誤。請稍後再試。",timestamp:new Date,isError:!0}])}}}else throw Error(o.error||"請求失敗")}catch(t){console.error("發送訊息失敗:",t);let e={role:"assistant",content:"抱歉，發送訊息時出現錯誤。請稍後再試。",timestamp:new Date,isError:!0};k(t=>[...t,e])}finally{T(!1)}},el=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),en())},ei=e=>{S(e),setTimeout(()=>{let e=document.querySelector("textarea");e&&e.focus()},100)},ec=async e=>{if(U(!1),T(!0),console.log("\uD83D\uDD25 Birthday submit received:",e),e.isCoupleAnalysis||L){console.log("\uD83D\uDCCA Couple analysis detected, generating report URL...");let t=G||q||O||"感情關係和諧改善建議";console.log("\uD83D\uDD0D DEBUG - URL生成時的狀態檢查:"),console.log("   latestSpecificProblem:",G),console.log("   originalUserQuestion:",q),console.log("   concern:",O),console.log("   problemToUse:",t);let s="/couple-report?"+"birthday=".concat(encodeURIComponent(e.userBirthday),"&")+"birthday2=".concat(encodeURIComponent(e.partnerBirthday),"&")+"gender=".concat(encodeURIComponent(e.userGender),"&")+"gender2=".concat(encodeURIComponent(e.partnerGender),"&")+"concern=".concat(encodeURIComponent(O),"&")+"originalProblem=".concat(encodeURIComponent(t),"&")+"reportType=".concat(encodeURIComponent(_));console.log("\uD83D\uDE80 Opening couple report:",s),window.open(s,"_blank"),T(!1);return}try{let t=await fetch("/api/smart-chat2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userBirthday:e.birthday,gender:e.gender,partnerBirthday:e.partnerBirthday,partnerGender:e.partnerGender,concern:O,isCoupleAnalysis:L||e.isCoupleAnalysis,reportType:_,messageType:"birthday_submission",sessionId:D,userId:J})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let s=await t.json(),r={role:"assistant",content:s.response||s.message,timestamp:new Date,aiAnalysis:s.aiAnalysis,systemType:s.systemType};k(e=>[...e,r]),s.reportUrl&&(console.log("Opening report:",s.reportUrl),window.open(s.reportUrl,"_blank"))}catch(e){console.error("生日提交錯誤:",e),k(e=>[...e,{role:"assistant",content:"抱歉，處理生日資料時發生錯誤。請稍後再試。",timestamp:new Date}])}finally{T(!1)}},ed=async e=>{try{X(!0);let t=e.includes("@")?"userEmail=".concat(encodeURIComponent(e)):"userId=".concat(encodeURIComponent(e)),s=await fetch("/api/conversation-history?".concat(t));if(s.ok){let e=await s.json();H(e.conversations||[])}else console.error("加載對話歷史失敗:",s.statusText)}catch(e){console.error("加載對話歷史錯誤:",e)}finally{X(!1)}},em=async e=>{try{T(!0);let o=await fetch("/api/load-conversation?conversationId=".concat(encodeURIComponent(e)));if(o.ok){var t,s,r;let a=await o.json();if(a.conversation&&Array.isArray(a.conversation)&&a.conversation.length>0){let e=a.conversation.map((e,t)=>({role:e.role,content:e.content||"",timestamp:new Date(e.timestamp),aiAnalysis:e.aiAnalysis||null,systemType:e.systemType||"smart-chat2",id:e.id||"loaded-".concat(t)}));e.some(e=>"assistant"===e.role&&e.content.includes("歡迎來到智能風水顧問"))||e.unshift({role:"assistant",content:"你好呀～我是風水妹！✨ 歡迎回到智能風水顧問 Smart-Chat2 (AI版)！\n\n繼續您之前的對話...",timestamp:new Date((null===(s=a.metadata)||void 0===s?void 0:s.createdAt)||Date.now()),aiAnalysis:null,systemType:"smart-chat2"}),k(e),er(!1)}else k([{role:"assistant",content:"你好呀～我是風水妹！✨ 歡迎來到智能風水顧問 Smart-Chat2 (AI版)！\n\n這是您之前的對話，請繼續...",timestamp:new Date,aiAnalysis:null,systemType:"smart-chat2"}]),er(!1);if(a.metadata){let e=a.metadata;I(e.sessionId||"smart-chat2-".concat(Date.now())),F(e.primaryConcern||""),W((null===(r=e.userData)||void 0===r?void 0:r.relationshipType)==="couple"),V("")}console.log("對話加載成功:",(null===(t=a.metadata)||void 0===t?void 0:t.title)||e)}else console.error("加載對話失敗:",o.statusText),k([{role:"assistant",content:"抱歉，無法加載該對話記錄。請嘗試創建新對話。",timestamp:new Date,isError:!0}])}catch(e){console.error("加載對話錯誤:",e),k([{role:"assistant",content:"載入對話時發生錯誤，請稍後再試。",timestamp:new Date,isError:!0}])}finally{T(!1)}},ep=e=>{if(!e)return"";let t=new Date(e),s=(new Date-t)/36e5;if(s<24)return t.toLocaleTimeString("zh-TW",{hour:"2-digit",minute:"2-digit"});if(!(s<168))return t.toLocaleDateString("zh-TW",{month:"short",day:"numeric"});{let e=Math.floor(s/24);return"".concat(e,"天前")}};return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-indigo-50",children:[(0,r.jsx)(h.default,{backgroundColor:"EFEFEF"}),(0,r.jsxs)("div",{className:"relative flex h-screen mt-16",children:[(0,r.jsx)("button",{className:"fixed z-50 p-2 bg-white rounded-lg shadow-lg md:hidden top-4 left-4",onClick:()=>ea(!eo),children:eo?(0,r.jsx)(i.A,{className:"w-6 h-6 text-gray-600"}):(0,r.jsx)(c.A,{className:"w-6 h-6 text-gray-600"})}),(0,r.jsxs)("div",{className:"\n					".concat(eo?"translate-x-0":"-translate-x-full","\n					md:translate-x-0 transition-transform duration-300 ease-in-out\n					fixed md:relative z-40 w-80 md:w-80 bg-[#EFEFEF] flex flex-col h-full\n				"),children:[(0,r.jsx)("div",{className:"bg-[#E0E0E0] rounded-lg m-4 p-4 cursor-pointer hover:bg-[#d0d0d0] transition-colors",onClick:()=>{k([]),S(""),F(""),W(!1),V(""),I("smart-chat2-".concat(Date.now())),er(!0)},children:(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("img",{src:"/images/風水妹/風水妹.png",alt:"風水妹",className:"w-10 h-10 rounded-full",onError:e=>{e.target.style.display="none"}}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("span",{className:"font-medium text-gray-800",children:"建立新的對話"})}),(0,r.jsx)("div",{className:"text-xl text-gray-800",children:"+"})]})}),(0,r.jsxs)("div",{className:"bg-[#E0E0E0] rounded-lg mx-4 mb-4",children:[(0,r.jsx)("div",{className:"p-4 border-b border-[#d0d0d0]",children:(0,r.jsxs)("h3",{className:"flex items-center justify-between font-medium text-gray-800",children:["歷史對話",Y&&(0,r.jsx)("div",{className:"w-4 h-4 border-b-2 border-gray-800 rounded-full animate-spin"})]})}),(0,r.jsx)("div",{className:"p-2 overflow-y-auto max-h-48",children:0===$.length?(0,r.jsx)("div",{className:"p-3 text-sm text-center text-gray-600",children:Y?"載入中...":"尚無歷史對話"}):$.map(e=>(0,r.jsxs)("div",{className:"p-3 hover:bg-[#d0d0d0] rounded cursor-pointer transition-colors mb-1",onClick:()=>em(e.conversationId),children:[(0,r.jsx)("div",{className:"text-sm font-medium text-gray-800 truncate",children:e.title||"未命名對話"}),(0,r.jsxs)("div",{className:"flex items-center justify-between mt-1 text-xs text-gray-600",children:[(0,r.jsx)("span",{children:ep(e.lastUpdated)}),(0,r.jsx)("span",{className:"bg-[#d0d0d0] text-gray-800 px-2 py-0.5 rounded-full text-xs",children:e.messageCount||0})]}),e.topics&&e.topics.length>0&&(0,r.jsxs)("div",{className:"flex flex-wrap gap-1 mt-2",children:[e.topics.slice(0,2).map((e,t)=>(0,r.jsx)("span",{className:"text-xs bg-[#c0c0c0] text-gray-800 px-2 py-0.5 rounded",children:e},t)),e.topics.length>2&&(0,r.jsxs)("span",{className:"text-xs text-gray-600",children:["+",e.topics.length-2]})]})]},e.conversationId))})]}),(0,r.jsx)("div",{className:"px-4 mb-4",children:(0,r.jsx)("div",{className:"p-4 transition-colors bg-white border border-gray-200 rounded-full shadow-sm cursor-pointer hover:bg-gray-50",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-medium text-gray-800",children:"付費報告預覽"}),(0,r.jsx)("div",{className:"flex items-center justify-center w-8 h-8 bg-gray-100 rounded-full",children:(0,r.jsxs)("svg",{className:"w-5 h-5 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})})}),(0,r.jsxs)("div",{className:"flex-1 px-4 pb-4 space-y-3 overflow-y-auto",children:[(0,r.jsx)(l.N_,{href:"/demo?category=fengshui",children:(0,r.jsx)("div",{className:"bg-[#768976] rounded-lg py-7 mb-3 cursor-pointer hover:bg-[#6b7d6b] transition-colors relative overflow-hidden",style:{backgroundImage:"url(/images/chatbox/house.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}})}),(0,r.jsx)(l.N_,{href:"/demo?category=life",children:(0,r.jsx)("div",{className:"bg-[#768976] rounded-lg py-7 mb-3 cursor-pointer hover:bg-[#6b7d6b] transition-colors relative overflow-hidden",style:{backgroundImage:"url(/images/chatbox/life.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}})}),(0,r.jsx)(l.N_,{href:"/demo?category=relationship",children:(0,r.jsx)("div",{className:"bg-[#768976] rounded-lg py-7 mb-3 cursor-pointer hover:bg-[#6b7d6b] transition-colors relative overflow-hidden",style:{backgroundImage:"url(/images/chatbox/relationship.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}})}),(0,r.jsx)(l.N_,{href:"/demo?category=career",children:(0,r.jsx)("div",{className:"bg-[#768976] rounded-lg py-7 mb-3 cursor-pointer hover:bg-[#6b7d6b] transition-colors relative overflow-hidden",style:{backgroundImage:"url(/images/chatbox/career.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}})}),(0,r.jsx)(l.N_,{href:"/demo?category=wealth",children:(0,r.jsx)("div",{className:"bg-[#768976] rounded-lg py-7 mb-3 cursor-pointer hover:bg-[#6b7d6b] transition-colors relative overflow-hidden",style:{backgroundImage:"url(/images/chatbox/wealth.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}})}),(0,r.jsx)(l.N_,{href:"/demo?category=health",children:(0,r.jsx)("div",{className:"bg-[#768976] rounded-lg py-7 mb-3 cursor-pointer hover:bg-[#6b7d6b] transition-colors relative overflow-hidden",style:{backgroundImage:"url(/images/chatbox/health.png)",backgroundSize:"cover",backgroundPosition:"center",backgroundRepeat:"no-repeat"}})})]})]}),eo&&(0,r.jsx)("div",{className:"fixed inset-0 z-30 bg-black bg-opacity-50 md:hidden",onClick:()=>ea(!1)}),(0,r.jsx)("div",{className:"flex flex-col flex-1 md:ml-0",style:{backgroundColor:"#EFEFEF",backgroundImage:"url(/images/report/housing-report-bg.png)",backgroundSize:"60%",backgroundPosition:"bottom right",backgroundRepeat:"no-repeat",boxShadow:"4px 4px 4px rgba(0, 0, 0, 0.25)",border:"3px solid #E0E0E0"},children:(0,r.jsxs)("div",{className:"flex flex-col flex-1 h-full",children:[(0,r.jsxs)("div",{className:"flex-1 p-4 md:p-6 space-y-4 overflow-y-auto max-h-[calc(100vh-8rem)] pt-16 md:pt-6",children:[es?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,r.jsxs)("div",{className:"flex flex-row items-center ",children:[(0,r.jsx)("img",{src:"/images/風水妹/風水妹.png",alt:"風水妹",className:" w-50 h-50 md:w-50 md:h-50",onError:e=>{e.target.style.display="none"}}),(0,r.jsx)("div",{className:"text-6xl font-bold md:text-6xl",style:{width:"280px",height:"60px",background:"linear-gradient(45deg, #A3B116, #374A37)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"serif"},children:"HarmoniQ"})]}),(0,r.jsx)("div",{className:"w-full max-w-2xl px-4 md:px-0",children:(0,r.jsxs)("div",{className:"flex items-center bg-white border border-gray-300 rounded-full shadow-lg",children:[(0,r.jsx)("textarea",{value:C,onChange:e=>S(e.target.value),onKeyPress:el,placeholder:"請輸入訊息",className:"flex-1 px-4 py-3 text-sm text-black placeholder-gray-500 bg-transparent resize-none md:px-6 md:py-4 md:text-base focus:outline-none",rows:1,disabled:E}),(0,r.jsxs)("div",{className:"flex items-center px-3 space-x-1 md:px-4 md:space-x-2",children:[(0,r.jsx)("button",{className:"p-1.5 md:p-2 text-gray-400 transition-colors hover:text-gray-600",children:(0,r.jsx)(d,{className:"w-4 h-4 md:w-5 md:h-5"})}),(0,r.jsx)("button",{onClick:en,disabled:!C.trim()||E,className:"p-1.5 md:p-2 text-purple-600 transition-colors hover:text-purple-700 disabled:text-gray-300 disabled:cursor-not-allowed",children:(0,r.jsx)(m.A,{className:"w-4 h-4 md:w-5 md:h-5"})})]})]})}),(0,r.jsxs)("div",{className:"flex flex-wrap justify-center gap-2 px-4 mt-5 md:gap-3 md:px-0",children:[(0,r.jsxs)("button",{onClick:()=>ei("健康運勢"),className:"flex items-center px-4 py-2 space-x-2 text-xs font-medium text-gray-700 transition-shadow bg-white border border-gray-200 rounded-full shadow-md md:px-6 md:py-3 md:text-sm hover:shadow-lg hover:text-gray-900",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-6 h-6 bg-green-100 rounded-full",children:(0,r.jsx)("span",{className:"text-sm text-green-600",children:"\uD83C\uDF43"})}),(0,r.jsx)("span",{children:"健康運勢"})]}),(0,r.jsxs)("button",{onClick:()=>ei("感情運勢"),className:"flex items-center px-4 py-2 space-x-2 text-xs font-medium text-gray-700 transition-shadow bg-white border border-gray-200 rounded-full shadow-md md:px-6 md:py-3 md:text-sm hover:shadow-lg hover:text-gray-900",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-6 h-6 bg-pink-100 rounded-full",children:(0,r.jsx)("span",{className:"text-sm text-pink-600",children:"\uD83C\uDF38"})}),(0,r.jsx)("span",{children:"感情運勢"})]}),(0,r.jsxs)("button",{onClick:()=>ei("財運運勢"),className:"flex items-center px-4 py-2 space-x-2 text-xs font-medium text-gray-700 transition-shadow bg-white border border-gray-200 rounded-full shadow-md md:px-6 md:py-3 md:text-sm hover:shadow-lg hover:text-gray-900",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-6 h-6 bg-yellow-100 rounded-full",children:(0,r.jsx)("span",{className:"text-sm text-yellow-600",children:"\uD83D\uDCB0"})}),(0,r.jsx)("span",{children:"財運運勢"})]}),(0,r.jsxs)("button",{onClick:()=>ei("事業運勢"),className:"flex items-center px-4 py-2 space-x-2 text-xs font-medium text-gray-700 transition-shadow bg-white border border-gray-200 rounded-full shadow-md md:px-6 md:py-3 md:text-sm hover:shadow-lg hover:text-gray-900",children:[(0,r.jsx)("div",{className:"flex items-center justify-center w-6 h-6 bg-blue-100 rounded-full",children:(0,r.jsx)("span",{className:"text-sm text-blue-600",children:"\uD83D\uDCBC"})}),(0,r.jsx)("span",{children:"事業運勢"})]})]})]}):N.map((e,t)=>(0,r.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:"user"===e.role?(0,r.jsx)("div",{className:"max-w-[85%] md:max-w-[70%] p-3 md:p-4 rounded-2xl shadow-md",style:{backgroundColor:"#CFE117"},children:(0,r.jsx)("div",{className:"text-sm font-medium text-black",children:e.content||""})}):(0,r.jsxs)("div",{className:"max-w-[95%] md:max-w-[90%] bg-white rounded-2xl shadow-md border border-gray-200",children:[(0,r.jsxs)("div",{className:"flex items-center p-3 md:p-4",children:[(0,r.jsx)("img",{src:"/images/風水妹/風水妹.png",alt:"風水妹",className:"w-10 h-10 mr-2 rounded-full md:w-12 md:h-12 md:mr-3",onError:e=>{e.target.style.display="none"}}),(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"text-sm font-medium text-black md:text-base",children:"風水妹"})})]}),(0,r.jsx)("div",{className:"px-3 pb-2 md:px-4",children:(0,r.jsx)("div",{className:"text-sm leading-relaxed text-black whitespace-pre-wrap",children:e.content||""})}),(0,r.jsx)("div",{className:"px-3 pb-2 md:px-4 md:pb-3",children:(0,r.jsx)("div",{className:"text-xs text-gray-500",children:A?(()=>{let t=new Date(e.timestamp),s=t.getHours().toString().padStart(2,"0"),r=t.getMinutes().toString().padStart(2,"0"),o=t.getSeconds().toString().padStart(2,"0");return"".concat(s,":").concat(r,":").concat(o)})():"--:--:--"})})]})},t)),E&&(0,r.jsx)("div",{className:"flex justify-start",children:(0,r.jsxs)("div",{className:"bg-white border border-gray-200 shadow-md rounded-2xl",children:[(0,r.jsxs)("div",{className:"flex items-center p-3 md:p-4",children:[(0,r.jsx)("img",{src:"/images/風水妹/風水妹.png",alt:"風水妹",className:"w-10 h-10 mr-2 rounded-full md:w-12 md:h-12 md:mr-3",onError:e=>{e.target.style.display="none"}}),(0,r.jsx)("div",{children:(0,r.jsx)("div",{className:"font-medium text-black",children:"風水妹"})})]}),(0,r.jsx)("div",{className:"px-3 pb-3 md:px-4 md:pb-4",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{className:"text-sm text-black",children:"風水妹費神運算中"}),(0,r.jsx)(p.A,{className:"w-4 h-4 text-purple-600 animate-pulse"}),(0,r.jsxs)("div",{className:"flex space-x-1",children:[(0,r.jsx)("div",{className:"w-2 h-2 bg-purple-400 rounded-full animate-bounce"}),(0,r.jsx)("div",{className:"w-2 h-2 bg-blue-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,r.jsx)("div",{className:"w-2 h-2 bg-pink-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})]})})]})}),(0,r.jsx)("div",{ref:B})]}),!es&&(0,r.jsx)("div",{className:"flex-shrink-0 p-3 border-t border-gray-200 md:p-4 ",children:(0,r.jsxs)("div",{className:"flex items-center bg-white border border-gray-200 rounded-full shadow-lg",children:[(0,r.jsx)("textarea",{value:C,onChange:e=>S(e.target.value),onKeyPress:el,placeholder:"輸入任何問題，風水妹會分析並引導你...",className:"flex-1 px-4 py-2 text-sm text-black placeholder-gray-500 bg-transparent resize-none md:px-6 md:py-3 md:text-base focus:outline-none",rows:1,disabled:E}),(0,r.jsx)("div",{className:"flex items-center px-3 space-x-1 md:px-4 md:space-x-2",children:(0,r.jsx)("button",{onClick:en,disabled:!C.trim()||E,className:"p-1.5 md:p-2 text-purple-600 transition-colors hover:text-purple-700 disabled:text-gray-300 disabled:cursor-not-allowed",children:(0,r.jsx)(m.A,{className:"w-4 h-4 md:w-5 md:h-5"})})})]})})]})})]}),R&&(0,r.jsx)(u.A,{isOpen:R,onClose:()=>U(!1),onSubmit:ec,concern:O,isCoupleAnalysis:L,reportType:_})]})}},26126:(e,t,s)=>{"use strict";s(95155),s(12115);var r=s(74466);s(59434),(0,r.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground",success:"border-transparent bg-green-100 text-green-800 hover:bg-green-200",warning:"border-transparent bg-yellow-100 text-yellow-800 hover:bg-yellow-200",info:"border-transparent bg-blue-100 text-blue-800 hover:bg-blue-200"}},defaultVariants:{variant:"default"}})},49376:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("brain",[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]])},74466:(e,t,s)=>{"use strict";s.d(t,{F:()=>n});var r=s(52596);let o=e=>"boolean"==typeof e?`${e}`:0===e?"0":e,a=r.$,n=(e,t)=>s=>{var r;if((null==t?void 0:t.variants)==null)return a(e,null==s?void 0:s.class,null==s?void 0:s.className);let{variants:n,defaultVariants:l}=t,i=Object.keys(n).map(e=>{let t=null==s?void 0:s[e],r=null==l?void 0:l[e];if(null===t)return null;let a=o(t)||o(r);return n[e][a]}),c=s&&Object.entries(s).reduce((e,t)=>{let[s,r]=t;return void 0===r||(e[s]=r),e},{});return a(e,i,null==t?void 0:null===(r=t.compoundVariants)||void 0===r?void 0:r.reduce((e,t)=>{let{class:s,className:r,...o}=t;return Object.entries(o).every(e=>{let[t,s]=e;return Array.isArray(s)?s.includes({...l,...c}[t]):({...l,...c})[t]===s})?[...e,s,r]:e},[]),null==s?void 0:s.class,null==s?void 0:s.className)}},74783:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});let r=(0,s(19946).A)("menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]])},94812:(e,t,s)=>{Promise.resolve().then(s.bind(s,17444))}},e=>{var t=t=>e(e.s=t);e.O(0,[6453,7215,8543,6874,6491,9855,5226,5828,8441,1684,7358],()=>t(94812)),_N_E=e.O()}]);