// æ”¹é€²çš„å°è©±æµç¨‹ç³»çµ± - è‡ªç„¶å°è©±å¼å¼•å°
export class ImprovedConversationFlow {
	// ğŸ†• æ–°å¢ï¼šåˆ†æéæ ¸å¿ƒé ˜åŸŸçš„ç”¨æˆ¶è¼¸å…¥
	static async analyzeNonCoreUserInput(message) {
		// æ ¸å¿ƒæœå‹™é ˜åŸŸ
		const coreAreas = [
			"å·¥ä½œ",
			"æ„Ÿæƒ…",
			"è²¡é‹",
			"å­å¥³",
			"äººéš›é—œä¿‚",
			"å¥åº·",
			"å› ç·£",
		];

		// æª¢æŸ¥æ˜¯å¦ç‚ºæ ¸å¿ƒé ˜åŸŸ
		const detectedConcern = this.detectPrimaryConcern(message);
		if (detectedConcern) {
			return {
				isCoreArea: true,
				concern: detectedConcern,
			};
		}

		// éæ ¸å¿ƒé ˜åŸŸè™•ç†
		return await this.handleNonCoreInput(message);
	}

	// ğŸ†• è™•ç†éæ ¸å¿ƒç”¨æˆ¶è¼¸å…¥
	static async handleNonCoreInput(message) {
		// å¸¸è¦‹éŒ¯å­—æª¢æ¸¬æ¨¡å¼
		const typoPatterns = [
			{ pattern: /[å·¥]ä½œ/, suggestion: "å·¥ä½œ", typo: true },
			{ pattern: /[æ„Ÿæ„›æˆ€æƒ…]æƒ…/, suggestion: "æ„Ÿæƒ…", typo: true },
			{ pattern: /[è²¡éŒ¢è²¡é‹]/, suggestion: "è²¡é‹", typo: true },
			{ pattern: /[å­å¥³å°å­©]/, suggestion: "å­å¥³", typo: true },
			{ pattern: /[äººéš›å…³ç³»é—œä¿‚]/, suggestion: "äººéš›é—œä¿‚", typo: true },
			{ pattern: /[å¥åº·èº«é«”]/, suggestion: "å¥åº·", typo: true },
			{ pattern: /[å› ç·£æ©Ÿä¼šæ©Ÿæœƒ]/, suggestion: "å› ç·£", typo: true },
		];

		// æª¢æŸ¥æ˜¯å¦ç‚ºéŒ¯å­—
		for (const { pattern, suggestion, typo } of typoPatterns) {
			if (pattern.test(message)) {
				return {
					isCoreArea: false,
					isTypo: typo,
					suggestedCoreArea: suggestion,
					aiResponse: `ğŸ˜Š é¢¨éˆ´è¦ºå¾—ä½ å¯èƒ½æƒ³å•çš„æ˜¯ã€Œ${suggestion}ã€çš„å•é¡Œå‘¢ï¼å¦‚æœä¸æ˜¯çš„è©±ï¼Œè«‹å†èªªå¾—æ¸…æ¥šä¸€é»å“¦ï½

æˆ‘å€‘çš„å°ˆæ¥­é¢¨æ°´æœå‹™åŒ…æ‹¬ï¼š
ğŸ’¼ **å·¥ä½œ** - äº‹æ¥­ç™¼å±•ã€è·å ´é—œä¿‚
ğŸ’• **æ„Ÿæƒ…** - æ¡ƒèŠ±é‹ã€å©šå§»é…å°  
ğŸ’° **è²¡é‹** - è²¡å¯Œå¢é•·ã€æŠ•è³‡é‹å‹¢
ğŸ‘¶ **å­å¥³** - å­å¥³é‹ã€æ•™è‚²ç™¼å±•
ğŸ¤ **äººéš›é—œä¿‚** - ç¤¾äº¤é‹ã€äººç·£æ”¹å–„
ğŸ¥ **å¥åº·** - èº«å¿ƒéˆèª¿ç†ã€é¤Šç”Ÿé¢¨æ°´
âœ¨ **å› ç·£** - æ©ŸæœƒæŠŠæ¡ã€å‘½é‹æ”¹å–„

ä½ æƒ³äº†è§£å“ªå€‹æ–¹é¢å‘¢ï¼Ÿ`,
				};
			}
		}

		// åˆ†æç”¨æˆ¶æ„åœ–ä¸¦å¼•å°åˆ°æ ¸å¿ƒé ˜åŸŸ
		return await this.analyzeAndGuideToCore(message);
	}

	// ğŸ†• æª¢æŸ¥æ˜¯å¦ç‚ºè©±é¡Œåé›¢ï¼ˆç”¨æˆ¶å·²æœ‰æ ¸å¿ƒé—œæ³¨ä½†çªç„¶å•ç„¡é—œå•é¡Œï¼‰
	static async checkTopicDeviation(message, currentConcern) {
		// å¦‚æœæ²’æœ‰ç•¶å‰é—œæ³¨é ˜åŸŸï¼Œä¸ç®—åé›¢
		if (!currentConcern) return null;

		// æª¢æŸ¥æ˜¯å¦ç‚ºæ ¸å¿ƒé ˜åŸŸç›¸é—œ
		const detectedConcern = this.detectPrimaryConcern(message);

		// å¦‚æœæª¢æ¸¬åˆ°çš„é—œæ³¨èˆ‡ç•¶å‰é—œæ³¨ç›¸åŒï¼Œä¸ç®—åé›¢
		if (detectedConcern === currentConcern) return null;

		// å¦‚æœæª¢æ¸¬åˆ°ä¸åŒçš„æ ¸å¿ƒé—œæ³¨ï¼Œç®—æ˜¯è©±é¡Œè½‰æ›ï¼Œä¸æ˜¯åé›¢
		if (detectedConcern && detectedConcern !== currentConcern) return null;

		// æª¢æŸ¥æ˜¯å¦ç‚ºä¸€èˆ¬æ€§å•å€™æˆ–ç¢ºèª
		const generalResponses = [
			"å¥½çš„",
			"å¥½å•Š",
			"å¯ä»¥",
			"æƒ³è¦",
			"è¦",
			"è¡Œ",
			"ok",
			"OK",
			"æ˜¯çš„",
			"å—¯",
			"å°",
			"æœ‰èˆˆè¶£",
			"æƒ³çŸ¥é“",
			"æƒ³äº†è§£",
			"å‘Šè¨´æˆ‘",
			"æ•™æˆ‘",
			"è¬è¬",
			"å¤šè¬",
		];

		if (generalResponses.some((response) => message.includes(response))) {
			return null; // ä¸ç®—åé›¢
		}

		// æª¢æŸ¥æ˜¯å¦ç‚ºæ“ä½œæ€§å•é¡Œ
		const operationalQuestions = [
			"å¦‚ä½•",
			"æ€æ¨£",
			"é»æ¨£",
			"æ€éº¼",
			"ä»€éº¼æ™‚å€™",
			"å¹¾æ™‚",
			"åœ¨å“ª",
			"é‚Šåº¦",
			"å¤šå°‘éŒ¢",
			"å¹¾å¤šéŒ¢",
			"è²»ç”¨",
			"æ”¶è²»",
			"åƒ¹æ ¼",
			"ä»˜æ¬¾",
		];

		if (operationalQuestions.some((op) => message.includes(op))) {
			return null; // æ“ä½œæ€§å•é¡Œä¸ç®—åé›¢
		}

		// å¦‚æœæ˜¯èˆ‡ç•¶å‰é—œæ³¨å®Œå…¨ç„¡é—œçš„å…§å®¹ï¼Œé€²è¡Œåé›¢åˆ†æ
		return await this.handleTopicDeviation(message, currentConcern);
	}

	// ğŸ†• è™•ç†è©±é¡Œåé›¢
	static async handleTopicDeviation(message, currentConcern) {
		// å˜—è©¦å°‡åé›¢è©±é¡Œå¼•å°å›æ ¸å¿ƒé ˜åŸŸ
		const coreAreaNames = {
			å·¥ä½œ: "äº‹æ¥­ç™¼å±•",
			æ„Ÿæƒ…: "æ„›æƒ…é‹å‹¢",
			è²¡é‹: "è²¡å¯Œé‹å‹¢",
			å­å¥³: "å­å¥³æ•™è‚²",
			äººéš›é—œä¿‚: "äººéš›ç¤¾äº¤",
			å¥åº·: "èº«å¿ƒå¥åº·",
			å› ç·£: "æ©Ÿæœƒé‹å‹¢",
		};

		const currentAreaName = coreAreaNames[currentConcern] || currentConcern;

		return {
			isDeviation: true,
			currentConcern: currentConcern,
			aiResponse: `å“‡ï½é¢¨éˆ´è¦ºå¾—ä½ å‰›å‰›å•çš„æ±è¥¿å¥½æœ‰è¶£å‘¢ï¼ğŸ˜Š

ä¸éæˆ‘å€‘å‰›æ‰ä¸æ˜¯åœ¨èŠã€Œ${currentAreaName}ã€çš„å•é¡Œå—ï¼Ÿé¢¨éˆ´æƒ³å…ˆå¹«ä½ æŠŠé€™å€‹è™•ç†å¥½å‘¢ï½

è®“æˆ‘å€‘ç¹¼çºŒèŠã€Œ${currentAreaName}ã€çš„äº‹æƒ…å¥½å—ï¼Ÿé€™æ¨£æˆ‘æ‰èƒ½çµ¦ä½ æœ€å°ˆæ¥­çš„é¢¨æ°´å»ºè­°å“¦ï¼âœ¨

å¦‚æœä½ æƒ³æ›è©±é¡Œåˆ°å…¶ä»–é¢¨æ°´é ˜åŸŸï¼Œä¹Ÿå¯ä»¥å‘Šè¨´é¢¨éˆ´ï¼š
ğŸ’¼ **å·¥ä½œ** - äº‹æ¥­ç™¼å±•ã€è·å ´é—œä¿‚
ğŸ’• **æ„Ÿæƒ…** - æ¡ƒèŠ±é‹ã€å©šå§»é…å°  
ğŸ’° **è²¡é‹** - è²¡å¯Œå¢é•·ã€æŠ•è³‡é‹å‹¢
ğŸ‘¶ **å­å¥³** - å­å¥³é‹ã€æ•™è‚²ç™¼å±•
ğŸ¤ **äººéš›é—œä¿‚** - ç¤¾äº¤é‹ã€äººç·£æ”¹å–„
ğŸ¥ **å¥åº·** - èº«å¿ƒéˆèª¿ç†ã€é¤Šç”Ÿé¢¨æ°´
âœ¨ **å› ç·£** - æ©ŸæœƒæŠŠæ¡ã€å‘½é‹æ”¹å–„

ä½ æƒ³ç¹¼çºŒèŠã€Œ${currentAreaName}ã€é‚„æ˜¯æ›åˆ°å…¶ä»–æ–¹é¢å‘¢ï¼ŸğŸ’•`,
		};
	}

	// ğŸ†• åˆ†æç”¨æˆ¶æ„åœ–ä¸¦å¼•å°åˆ°æ ¸å¿ƒé ˜åŸŸ
	static async analyzeAndGuideToCore(message) {
		// é€šç”¨é—œéµè©æ˜ å°„åˆ°æ ¸å¿ƒé ˜åŸŸ
		const semanticMapping = {
			å­¸ç¿’: { core: "å­å¥³", reason: "å­¸ç¿’æˆé•·èˆ‡å­å¥³é‹å‹¢ç›¸é—œ" },
			æ•™è‚²: { core: "å­å¥³", reason: "æ•™è‚²ç™¼å±•èˆ‡å­å¥³é‹å‹¢ç›¸é—œ" },
			è€ƒè©¦: { core: "å­å¥³", reason: "è€ƒè©¦é‹èˆ‡å­å¥³å­¸æ¥­ç›¸é—œ" },
			å‡å­¸: { core: "å­å¥³", reason: "å‡å­¸æ©Ÿæœƒèˆ‡å­å¥³æ•™è‚²é‹ç›¸é—œ" },
			ç”Ÿæ„: { core: "å·¥ä½œ", reason: "ç”Ÿæ„ç™¼å±•å±¬æ–¼äº‹æ¥­å·¥ä½œç¯„ç–‡" },
			å‰µæ¥­: { core: "å·¥ä½œ", reason: "å‰µæ¥­å±¬æ–¼äº‹æ¥­ç™¼å±•" },
			æŠ•è³‡: { core: "è²¡é‹", reason: "æŠ•è³‡ç†è²¡èˆ‡è²¡é‹æ¯æ¯ç›¸é—œ" },
			ç†è²¡: { core: "è²¡é‹", reason: "ç†è²¡è¦åŠƒé—œä¹è²¡é‹ç®¡ç†" },
			å®¶åº­: { core: "äººéš›é—œä¿‚", reason: "å®¶åº­å’Œè«§æ¶‰åŠäººéš›é—œä¿‚" },
			æœ‹å‹: { core: "äººéš›é—œä¿‚", reason: "æœ‹å‹é—œä¿‚å±¬æ–¼äººéš›ç¤¾äº¤" },
			å£“åŠ›: { core: "å¥åº·", reason: "å£“åŠ›ç®¡ç†é—œä¹èº«å¿ƒå¥åº·" },
			é‹æ°£: { core: "å› ç·£", reason: "é‹æ°£æ©Ÿæœƒèˆ‡å› ç·£ç¦ä»½ç›¸é—œ" },
			æ©Ÿæœƒ: { core: "å› ç·£", reason: "æ©ŸæœƒæŠŠæ¡èˆ‡å› ç·£æ™‚æ©Ÿç›¸é—œ" },
			å‘½é‹: { core: "å› ç·£", reason: "å‘½é‹æ”¹è®Šèˆ‡å› ç·£èª¿æ•´ç›¸é—œ" },
			ä½å®…: { core: "å¥åº·", reason: "å±…ä½ç’°å¢ƒå½±éŸ¿å¥åº·é‹å‹¢" },
			æ¬å®¶: { core: "å› ç·£", reason: "æ¬é·æ™‚æ©Ÿé—œä¹å› ç·£è½‰æ›" },
			è£ä¿®: { core: "å› ç·£", reason: "è£ä¿®ä½ˆå±€å½±éŸ¿æ•´é«”é‹å‹¢" },
		};

		// æª¢æŸ¥èªç¾©æ˜ å°„
		for (const [keyword, mapping] of Object.entries(semanticMapping)) {
			if (message.includes(keyword)) {
				return {
					isCoreArea: false,
					isTypo: false,
					suggestedCoreArea: mapping.core,
					aiResponse: `å“‡ï½ä½ å•çš„ã€Œ${keyword}ã€å¾ˆæœ‰æ„æ€å‘¢ï¼âœ¨

é¢¨éˆ´è¦ºå¾—é€™å€‹è·Ÿæˆ‘å€‘çš„ã€Œ${mapping.core}ã€æœå‹™å¾ˆç›¸é—œå“¦ï¼Œå› ç‚º${mapping.reason}ï¼

æˆ‘å€‘çš„å°ˆæ¥­é¢¨æ°´æœå‹™åŒ…æ‹¬ï¼š
ğŸ’¼ **å·¥ä½œ** - äº‹æ¥­ç™¼å±•ã€è·å ´é—œä¿‚ã€ç”Ÿæ„å‰µæ¥­
ğŸ’• **æ„Ÿæƒ…** - æ¡ƒèŠ±é‹ã€å©šå§»é…å°ã€äººç·£æå‡
ğŸ’° **è²¡é‹** - è²¡å¯Œå¢é•·ã€æŠ•è³‡é‹å‹¢ã€ç†è²¡è¦åŠƒ
ğŸ‘¶ **å­å¥³** - å­å¥³é‹ã€æ•™è‚²ç™¼å±•ã€å­¸ç¿’è€ƒè©¦
ğŸ¤ **äººéš›é—œä¿‚** - ç¤¾äº¤é‹ã€å®¶åº­å’Œè«§ã€æœ‹å‹é—œä¿‚
ğŸ¥ **å¥åº·** - èº«å¿ƒéˆèª¿ç†ã€é¤Šç”Ÿé¢¨æ°´ã€å£“åŠ›èˆ’ç·©
âœ¨ **å› ç·£** - æ©ŸæœƒæŠŠæ¡ã€å‘½é‹æ”¹å–„ã€é‹æ°£æå‡

ä½ æƒ³äº†è§£ã€Œ${mapping.core}ã€æ–¹é¢çš„é¢¨æ°´æŒ‡å°å—ï¼ŸğŸ’•`,
				};
			}
		}

		// å¦‚æœæ²’æœ‰æ˜ç¢ºæ˜ å°„ï¼Œæä¾›é€šç”¨å¼•å°
		return {
			isCoreArea: false,
			isTypo: false,
			suggestedCoreArea: null,
			aiResponse: `å’¦ï½é¢¨éˆ´ä¸å¤ªæ˜ç™½ä½ çš„æ„æ€å‘¢ ğŸ˜…

ä¸éæ²’é—œä¿‚ï¼é¢¨éˆ´æœ€æ“…é•·çš„æ˜¯é€™äº›å°ˆæ¥­é¢¨æ°´æœå‹™ï¼š

ğŸ’¼ **å·¥ä½œ** - äº‹æ¥­ç™¼å±•ã€è·å ´é—œä¿‚ã€å‡è·åŠ è–ª
ğŸ’• **æ„Ÿæƒ…** - æ¡ƒèŠ±é‹ã€å©šå§»é…å°ã€æ„Ÿæƒ…å•é¡Œ
ğŸ’° **è²¡é‹** - è²¡å¯Œå¢é•·ã€æŠ•è³‡é‹å‹¢ã€æ‹›è²¡èšè²¡
ğŸ‘¶ **å­å¥³** - å­å¥³é‹ã€æ•™è‚²ç™¼å±•ã€è¦ªå­é—œä¿‚
ğŸ¤ **äººéš›é—œä¿‚** - ç¤¾äº¤é‹ã€äººç·£æ”¹å–„ã€åŒ–è§£å°äºº
ğŸ¥ **å¥åº·** - èº«å¿ƒèª¿ç†ã€é¤Šç”Ÿé¢¨æ°´ã€å¥åº·é‹å‹¢
âœ¨ **å› ç·£** - æ©ŸæœƒæŠŠæ¡ã€å‘½é‹æ”¹å–„ã€æ™‚æ©Ÿé¸æ“‡

ä½ æœ€æƒ³äº†è§£å“ªå€‹æ–¹é¢å‘¢ï¼Ÿé¢¨éˆ´æœƒç”¨æœ€å¯æ„›çš„æ–¹å¼å¹«ä½ åˆ†æå“¦ï½ğŸ’•`,
		};
	}

	static detectPrimaryConcern(message) {
		const concernPatterns = {
			æ„Ÿæƒ…: [
				"æ„Ÿæƒ…",
				"æ„›æƒ…",
				"æ¡ƒèŠ±",
				"æ¡ƒèŠ±é‹",
				"å§»ç·£",
				"äººç·£",
				"å¦ä¸€åŠ",
				"ç”·æœ‹å‹",
				"å¥³æœ‹å‹",
				"è€å…¬",
				"è€å©†",
				"çµå©š",
				"åˆ†æ‰‹",
				"å¾©åˆ",
				"æˆ€æ„›",
				"æƒ…ä¾¶",
				"å–®èº«",
				"æ‹æ‹–",
				"bf",
				"gf",
				"å–œæ­¡",
				"æš—æˆ€",
			],
			å·¥ä½œ: [
				"å·¥ä½œ",
				"äº‹æ¥­",
				"è·å ´",
				"è€é—†",
				"ä¸Šå¸",
				"åŒäº‹",
				"å‡è·",
				"è½‰å·¥",
				"è¾­è·",
				"é¢è©¦",
				"è–ªæ°´",
				"äººå·¥",
				"åŠ äººå·¥",
				"åŠ è–ª",
				"æ¸›è–ª",
				"å¾…é‡",
				"ç¦åˆ©",
				"å…¬å¸",
				"è¿”å·¥",
				"job",
				"å‰µæ¥­",
				"ç”Ÿæ„",
			],
			è²¡é‹: [
				"éŒ¢",
				"è²¡é‹",
				"æŠ•è³‡",
				"ç†è²¡",
				"æ”¶å…¥",
				"è–ªæ°´",
				"å‚µå‹™",
				"ç ´è²¡",
				"è³ºéŒ¢",
				"è²¡å¯Œ",
				"é‡‘éŒ¢",
				"è‚¡ç¥¨",
				"è²·æ¨“",
				"å„²éŒ¢",
				"ç¶“æ¿Ÿ",
				"æ©«è²¡",
				"åè²¡",
				"æ­£è²¡",
				"ç™¼è²¡",
				"ä¸­ç",
				"å½©ç¥¨",
				"é‹è²¡",
				"æ‹›è²¡",
				"èšè²¡",
				"è²¡æ°£",
				"è²¡æº",
				"è²¡æ˜Ÿ",
			],
			å¥åº·: [
				"å¥åº·",
				"ç—…",
				"èº«é«”",
				"ç¡çœ ",
				"å¤±çœ ",
				"é ­ç—›",
				"ç–²ç´¯",
				"å£“åŠ›",
				"ç„¦æ…®",
				"æŠ‘é¬±",
				"ç—›",
				"å””èˆ’æœ",
				"ç”Ÿç—…",
			],
			äººéš›é—œä¿‚: [
				"äººéš›",
				"æœ‹å‹",
				"é—œä¿‚",
				"ç›¸è™•",
				"ç¤¾äº¤",
				"äººç·£",
				"å°äºº",
				"è²´äºº",
				"è¡çª",
				"åˆä½œ",
				"åŒæœ‹å‹",
				"å®¶äºº",
			],
			å­å¥³: [
				"å­å¥³",
				"å°æœ‹å‹",
				"å­©å­",
				"æ‡·å­•",
				"ç”Ÿè‚²",
				"æ•™è‚²",
				"å­¸ç¿’",
				"è€ƒè©¦",
				"å‡å­¸",
				"å›å›",
				"å¥³å¥³",
				"æ¹Šä»”",
			],
			å› ç·£: [
				"å› ç·£",
				"æ©Ÿæœƒ",
				"é‹æ°£",
				"å‘½é‹",
				"ç·£åˆ†",
				"æ™‚æ©Ÿ",
				"é¸æ“‡",
				"æ±ºå®š",
				"é‹å‹¢",
				"é¢¨æ°´",
			],
			å±…å®¶ä½ˆå±€: [
				"å±…å®¶",
				"å®¶å±…",
				"ä½ˆå±€",
				"å¸ƒå±€",
				"æˆ¿é–“",
				"è‡¥å®¤",
				"å®¢å»³",
				"å»šæˆ¿",
				"æµ´å®¤",
				"é™½å°",
				"è£ä¿®",
				"å‚¢ä¿±",
				"æ“ºè¨­",
				"æ–¹ä½",
				"ä½ç½®",
				"ç©ºé–“",
				"å®¶å…·",
				"åºŠä½",
				"æ›¸æ¡Œ",
				"æ²™ç™¼",
				"é¡å­",
				"æ¤ç‰©",
				"é¡è‰²",
				"ç‡ˆå…‰",
				"æ ¼å±€",
				"åº§å‘",
				"æ“ºæ”¾",
				"è£é£¾",
				"çª—æˆ¶",
				"é–€",
				"ç‰†å£",
			],
		};

		for (const [concern, keywords] of Object.entries(concernPatterns)) {
			if (keywords.some((keyword) => message.includes(keyword))) {
				return concern;
			}
		}
		return null;
	}

	// æª¢æ¸¬æƒ…ç·’ç‹€æ…‹
	static detectEmotion(message) {
		const emotionPatterns = {
			å›°æ“¾: [
				"å›°æ“¾",
				"ç…©æƒ±",
				"ä¸çŸ¥é“",
				"å””çŸ¥",
				"è¿·èŒ«",
				"å›°æƒ‘",
				"æ“”å¿ƒ",
				"ç„¦æ…®",
				"å•é¡Œ",
				"æœ‰å•é¡Œ",
				"éº»ç…©",
				"é ­ç—›",
				"å””æ˜",
				"ç…©",
			],
			æ²®å–ª: [
				"æ²®å–ª",
				"å¤±è½",
				"é›£é",
				"å‚·å¿ƒ",
				"çµ•æœ›",
				"ç„¡åŠ©",
				"ç—›è‹¦",
				"å””é–‹å¿ƒ",
				"ä¸é–‹å¿ƒ",
				"å¤±æœ›",
			],
			æ†¤æ€’: [
				"ç”Ÿæ°£",
				"æ†¤æ€’",
				"ä¸çˆ½",
				"ç«å¤§",
				"å¬²",
				"æ¿€å¬²",
				"è¨å­",
				"å¿¿",
				"æ°£",
			],
			å£“åŠ›: [
				"å£“åŠ›",
				"ç·Šå¼µ",
				"ç´¯",
				"æ”°",
				"æ’ä¸ä½",
				"å—ä¸äº†",
				"å¥½ç´¯",
				"è¾›è‹¦",
				"å£“åŠ›å¤§",
			],
			å¸Œæœ›: [
				"å¸Œæœ›",
				"æƒ³è¦",
				"æœŸå¾…",
				"æ¸´æœ›",
				"æ”¹å–„",
				"æå‡",
				"è®Šå¥½",
				"æƒ³",
				"æƒ³çŸ¥é“",
				"å¹«åˆ°",
			],
		};

		for (const [emotion, keywords] of Object.entries(emotionPatterns)) {
			if (keywords.some((keyword) => message.includes(keyword))) {
				return emotion;
			}
		}
		return "å¹³éœ";
	}

	// æª¢æ¸¬æ˜¯å¦æ˜¯ç”Ÿæ—¥ä¿¡æ¯
	static detectBirthdayInfo(message) {
		// æª¢æ¸¬å¹´æœˆæ—¥æ ¼å¼
		const datePatterns = [
			/(\d{4})[å¹´\-\/](\d{1,2})[æœˆ\-\/](\d{1,2})[æ—¥]?/,
			/(\d{1,2})[æœˆ\-\/](\d{1,2})[æ—¥\-\/](\d{4})/,
			/(\d{4})\-(\d{1,2})\-(\d{1,2})/,
			/(\d{1,2})\/(\d{1,2})\/(\d{4})/,
		];

		for (const pattern of datePatterns) {
			const match = message.match(pattern);
			if (match) {
				return {
					hasBirthday: true,
					rawText: match[0],
				};
			}
		}
		return { hasBirthday: false };
	}

	// ç”Ÿæˆè‡ªç„¶å°è©±å›æ‡‰
	static generateNaturalResponse(
		userState,
		message,
		concern,
		emotion,
		messageLength = 0
	) {
		// console.log("ğŸ¯ generateNaturalResponseè¢«èª¿ç”¨ï¼Œmessage:", message);

		// ğŸ¯ å„ªå…ˆæª¢æŸ¥æ·±å…¥èˆˆè¶£é—œéµè© - æœ€é«˜å„ªå…ˆç´š
		const deepInterestKeywords = [
			"æ‰€æœ‰",
			"å…¨éƒ¨",
			"è©³ç´°",
			"æ›´å¤š",
			"å®Œæ•´",
			"æ·±å…¥",
			"å…·é«”",
		];
		const hasDeepInterest = deepInterestKeywords.some((keyword) =>
			message.includes(keyword)
		);

		console.log(
			"ğŸ¯ æ·±å…¥èˆˆè¶£æª¢æ¸¬çµæœ:",
			hasDeepInterest,
			"é—œéµè©:",
			deepInterestKeywords.find((k) => message.includes(k))
		);

		if (hasDeepInterest) {
			console.log(
				"ğŸ¯ åœ¨generateNaturalResponseä¸­æª¢æ¸¬åˆ°æ·±å…¥èˆˆè¶£:",
				message
			);
			// æ ¹æ“šå·²çŸ¥çš„é—œæ³¨é ˜åŸŸç”Ÿæˆå€‹äººåŒ–æ¨è–¦ï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨é€šç”¨ç‰ˆæœ¬
			const concernToUse = userState.primaryConcern || concern || "é‹å‹¢";
			console.log("ğŸ¯ ä½¿ç”¨é—œæ³¨é ˜åŸŸ:", concernToUse);
			return this.generatePersonalAnalysisPromotion(
				concernToUse,
				message
			);
		}

		const {
			conversationState,
			primaryConcern,
			hasBirthday,
			hasPartnerBirthday,
			hasSpecificProblem,
			relationshipAnalysisType,
		} = userState;

		console.log(
			"Flow Debug - State:",
			conversationState,
			"Concern:",
			primaryConcern,
			"HasBirthday:",
			hasBirthday,
			"HasSpecific:",
			hasSpecificProblem
		);

		// éšæ®µ1ï¼šåˆå§‹å°è©±ï¼Œå»ºç«‹é—œä¿‚
		if (conversationState === "initial" || !conversationState) {
			if (emotion === "å¹³éœ" && !concern) {
				return "ä½ å¥½å‘€ï½æˆ‘ä¿‚é¢¨éˆ´ï¼âœ¨ æœ‰å’©ç”Ÿæ´»ä¸Šå˜…å›°æ“¾æƒ³æµæˆ‘å‚¾å‚¾å‘¢ï¼Ÿç„¡è«–ä¿‚å·¥ä½œã€æ„Ÿæƒ…ã€è²¡é‹å®šä¿‚å¥åº·ï¼Œæˆ‘éƒ½å¯ä»¥å¹«ä½ åˆ†æé¢¨æ°´é‹å‹¢æ¶ï½";
			} else if (concern) {
				return this.generateConcernIntroResponse(concern, emotion);
			} else {
				return (
					this.generateEmotionalComfort(emotion) +
					"å¯ä»¥è©±ä¿¾æˆ‘çŸ¥ç™¼ç”Ÿå’©äº‹å—ï¼Ÿæˆ‘æœƒç”¨å¿ƒè†è½ã€‚"
				);
			}
		}

		// éšæ®µ2ï¼šå·²è­˜åˆ¥é—œæ³¨é ˜åŸŸï¼Œæ·±å…¥äº†è§£å…·é«”å•é¡Œ
		if (
			conversationState === "concern_detected" &&
			primaryConcern &&
			!hasSpecificProblem
		) {
			return this.generateSpecificQuestionProbe(primaryConcern, emotion);
		}

		// éšæ®µ2.1ï¼šç­‰å¾…å…·é«”å•é¡Œè©³è¿° (asking_specific state)
		if (conversationState === "asking_specific" && primaryConcern) {
			// ç‰¹åˆ¥è™•ç†æ„Ÿæƒ…åˆ†æé¸æ“‡ - ç”¨æˆ¶é¸æ“‡äº†åˆ†æé¡å‹ä½†é‚„æ²’æœ‰ç”Ÿæ—¥
			if (
				primaryConcern === "æ„Ÿæƒ…" &&
				relationshipAnalysisType &&
				!hasBirthday
			) {
				if (relationshipAnalysisType === "individual") {
					return (
						"å¥½ï¼æˆ‘æœƒç‚ºä½ é€²è¡Œå€‹äººæ„Ÿæƒ…åˆ†æ ğŸŒ¸\n\n" +
						"ç‚ºå’—æ›´æº–ç¢ºåˆ†æä½ å˜…æ„Ÿæƒ…é‹å‹¢ï¼Œæˆ‘éœ€è¦ä½ å˜…å‡ºç”Ÿæ—¥æœŸã€‚\n" +
						"è«‹æä¾›ï¼šå‡ºç”Ÿå¹´æœˆæ—¥ï¼ˆä¾‹å¦‚ï¼š1990å¹´5æœˆ15æ—¥ï¼‰"
					);
				} else if (relationshipAnalysisType === "couple") {
					return (
						"å¥½ï¼æˆ‘æœƒç‚ºä½ å“‹é€²è¡Œåˆå©šé…å°åˆ†æ ğŸ’•\n\n" +
						"ç‚ºå’—åˆ†æä½ å“‹å˜…å…«å­—åˆé…åº¦ï¼Œæˆ‘éœ€è¦å…©å€‹äººå˜…å‡ºç”Ÿè³‡æ–™ï¼š\n" +
						"1ï¸âƒ£ é¦–å…ˆè«‹æä¾›ä½ å˜…å‡ºç”Ÿå¹´æœˆæ—¥ï¼ˆä¾‹å¦‚ï¼š1990å¹´5æœˆ15æ—¥ï¼‰\n" +
						"2ï¸âƒ£ ä¹‹å¾Œæœƒè«‹ä½ æä¾›ä¼´ä¾¶å˜…å‡ºç”Ÿè³‡æ–™"
					);
				}
			}

			// ç‰¹åˆ¥è™•ç†åˆå©šåˆ†æ - å·²æœ‰å…©å€‹ç”Ÿæ—¥ä½†éœ€è¦å…·é«”å•é¡Œ
			if (
				primaryConcern === "æ„Ÿæƒ…" &&
				relationshipAnalysisType === "couple" &&
				hasBirthday &&
				hasPartnerBirthday &&
				!hasSpecificProblem
			) {
				return (
					"å¥½ï¼æˆ‘å·²ç¶“æ”¶é›†å’—ä½ å“‹å…©å€‹äººå˜…å‡ºç”Ÿè³‡æ–™ ğŸ’•\n\n" +
					"ç¾åœ¨è«‹å‘Šè¨´æˆ‘ä½ å“‹å˜…å…·é«”æ„Ÿæƒ…å•é¡Œï¼Œæ¯”å¦‚ï¼š\n" +
					"â€¢ ä½ å“‹å˜…é—œä¿‚é‡åˆ°å’©å›°é›£ï¼Ÿ\n" +
					"â€¢ æƒ³äº†è§£ä½ å“‹å˜…åˆé…åº¦ï¼Ÿ\n" +
					"â€¢ æœ‰å’©ç‰¹åˆ¥æƒ³æ”¹å–„å˜…åœ°æ–¹ï¼Ÿ\n\n" +
					"æˆ‘æœƒæ ¹æ“šä½ å“‹å˜…å…«å­—é€²è¡Œåˆå©šåˆ†æã€‚"
				);
			}

			// ç‰¹åˆ¥è™•ç†åˆå©šåˆ†æ - å·²æœ‰å…©å€‹ç”Ÿæ—¥å’Œå…·é«”å•é¡Œï¼Œæä¾›åˆå©šåˆ†æå ±å‘Š
			if (
				primaryConcern === "æ„Ÿæƒ…" &&
				relationshipAnalysisType === "couple" &&
				hasBirthday &&
				hasPartnerBirthday &&
				hasSpecificProblem
			) {
				return this.generateOfferDetailedAnalysis(
					primaryConcern,
					emotion,
					"couple" // æŒ‡ç¤ºé€™æ˜¯åˆå©šåˆ†æ
				);
			}

			if (hasSpecificProblem && hasBirthday) {
				// å·²æœ‰å•é¡Œå’Œç”Ÿæ—¥ï¼Œæä¾›åˆæ­¥å»ºè­°ä¸¦è©¢å•æ˜¯å¦éœ€è¦è©³ç´°å ±å‘Š
				return this.generateOfferDetailedAnalysis(
					primaryConcern,
					emotion
				);
			} else if (hasSpecificProblem && !hasBirthday) {
				// æœ‰å•é¡Œä½†ç„¡ç”Ÿæ—¥ï¼Œæä¾›å®‰æ…°ä¸¦å»ºè­°ç²å–ç”Ÿæ—¥é€²è¡Œåˆ†æ
				return this.generateComfortAndBirthdayRequest(
					primaryConcern,
					emotion
				);
			} else {
				// éœ€è¦æ›´å¤šå…·é«”å•é¡Œ
				return this.generateSpecificQuestionProbe(
					primaryConcern,
					emotion
				);
			}
		}

		// éšæ®µ2.5ï¼šå·²æ”¶é›†ç”Ÿæ—¥ä½†é‚„éœ€è¦å…·é«”å•é¡Œ
		if (
			conversationState === "birthday_collected" &&
			hasBirthday &&
			!hasSpecificProblem
		) {
			// ç‰¹åˆ¥è™•ç†æ„Ÿæƒ…åˆ†æ - æä¾›ç›¸æ‡‰çš„å•é¡Œæç¤º
			if (primaryConcern === "æ„Ÿæƒ…" && relationshipAnalysisType) {
				const analysisType =
					relationshipAnalysisType === "individual"
						? "å€‹äººæ„Ÿæƒ…åˆ†æ"
						: "åˆå©šé…å°åˆ†æ";
				return (
					`å¥½ï¼æˆ‘å·²ç¶“è¨˜éŒ„å’—ä½ å˜…ç”Ÿæ—¥è³‡æ–™ï¼Œæœƒé€²è¡Œ${analysisType}ã€‚\n\n` +
					`ç¾åœ¨è«‹è©³ç´°å‘Šè¨´æˆ‘ä½ å˜…æ„Ÿæƒ…å•é¡Œï¼Œæ¯”å¦‚ï¼š\n` +
					`â€¢ é‡åˆ°å’©æ„Ÿæƒ…å›°é›£ï¼Ÿ\n` +
					`â€¢ æœ‰å’©ç‰¹åˆ¥æƒ³äº†è§£å˜…ï¼Ÿ\n` +
					`æˆ‘éœ€è¦äº†è§£è©³æƒ…æ‰èƒ½ç‚ºä½ æä¾›ç²¾æº–å˜…åˆ†æã€‚`
				);
			}
			return `å¥½ï¼æˆ‘å·²ç¶“è¨˜éŒ„å’—ä½ å˜…ç”Ÿæ—¥è³‡æ–™ã€‚ç¾åœ¨è«‹è©³ç´°å‘Šè¨´æˆ‘ä½ å˜…${primaryConcern}å•é¡Œï¼Œæ¯”å¦‚å…·é«”é‡åˆ°å’©å›°é›£ï¼Ÿæˆ‘éœ€è¦äº†è§£è©³æƒ…æ‰èƒ½ç‚ºä½ æä¾›ç²¾æº–å˜…åˆ†æã€‚`;
		}

		// éšæ®µ2.6ï¼šç”Ÿæ—¥æ”¶é›†ç‹€æ…‹ - å°ˆé–€è™•ç†é—œä¿‚åˆ†æé¸æ“‡å¾Œçš„ç”Ÿæ—¥æ”¶é›†
		if (conversationState === "birthday_collection") {
			if (primaryConcern === "æ„Ÿæƒ…" && relationshipAnalysisType) {
				if (relationshipAnalysisType === "individual") {
					return (
						"ç‚ºå’—é€²è¡Œå€‹äººæ„Ÿæƒ…åˆ†æ ğŸŒ¸ï¼Œæˆ‘éœ€è¦ä½ å˜…å‡ºç”Ÿè³‡æ–™ã€‚\n\n" +
						"è«‹æä¾›ä½ å˜…å‡ºç”Ÿå¹´æœˆæ—¥ï¼ˆä¾‹å¦‚ï¼š1990å¹´5æœˆ15æ—¥ï¼‰"
					);
				} else if (relationshipAnalysisType === "couple") {
					return (
						"ç‚ºå’—é€²è¡Œåˆå©šé…å°åˆ†æ ğŸ’•ï¼Œæˆ‘éœ€è¦å…©å€‹äººå˜…å‡ºç”Ÿè³‡æ–™ã€‚\n\n" +
						"è«‹å…ˆæä¾›ä½ å˜…å‡ºç”Ÿå¹´æœˆæ—¥ï¼ˆä¾‹å¦‚ï¼š1990å¹´5æœˆ15æ—¥ï¼‰\n" +
						"ä¹‹å¾Œæœƒè«‹ä½ æä¾›ä¼´ä¾¶å˜…å‡ºç”Ÿè³‡æ–™ã€‚"
					);
				}
			}
			// å…¶ä»–æƒ…æ³çš„é€šç”¨ç”Ÿæ—¥æ”¶é›†ä¿¡æ¯
			return "ç‚ºå’—æä¾›æº–ç¢ºå˜…åˆ†æï¼Œæˆ‘éœ€è¦ä½ å˜…å‡ºç”Ÿå¹´æœˆæ—¥ã€‚è«‹æä¾›ï¼šå‡ºç”Ÿå¹´æœˆæ—¥ï¼ˆä¾‹å¦‚ï¼š1990å¹´5æœˆ15æ—¥ï¼‰";
		}

		// éšæ®µ2.7ï¼šç­‰å¾…ä¼´ä¾¶ç”Ÿæ—¥ä¿¡æ¯ - åˆå©šåˆ†æå°ˆç”¨
		if (conversationState === "asking_partner_birthday") {
			return (
				"å¥½ï¼æˆ‘å·²ç¶“è¨˜éŒ„å’—ä½ å˜…ç”Ÿæ—¥è³‡æ–™ã€‚\n\n" +
				"ç¾åœ¨è«‹æä¾›ä½ ä¼´ä¾¶å˜…å‡ºç”Ÿå¹´æœˆæ—¥ï¼ˆä¾‹å¦‚ï¼š1992å¹´8æœˆ20æ—¥ï¼‰\n" +
				"æœ‰å’—å…©å€‹äººå˜…å…«å­—è³‡æ–™ï¼Œæˆ‘å°±å¯ä»¥é€²è¡Œåˆå©šé…å°åˆ†æ ğŸ’•"
			);
		}

		// éšæ®µ3ï¼šå·²æœ‰å…·é«”å•é¡Œï¼Œæä¾›æƒ…æ„Ÿæ”¯æŒå’Œåˆæ­¥å»ºè­°
		if (
			conversationState === "problem_identified" &&
			hasSpecificProblem &&
			!hasBirthday
		) {
			return this.generateComfortAndPreAnalysis(
				primaryConcern,
				userState.specificProblem || "unspecified"
			);
		}

		// éšæ®µ4ï¼šç”¨æˆ¶åŒæ„é¢¨æ°´åˆ†æï¼Œè§¸ç™¼æ¨¡æ…‹æ¡†
		if (
			conversationState === "ready_for_modal" &&
			hasSpecificProblem &&
			!hasBirthday
		) {
			return this.generateModalTriggerResponse(primaryConcern);
		}

		// éšæ®µ5ï¼šç”Ÿæ—¥ä¿¡æ¯æäº¤å¾Œï¼Œæº–å‚™ç”Ÿæˆå ±å‘Š
		if (
			conversationState === "ready_for_report" &&
			hasBirthday &&
			hasSpecificProblem
		) {
			return this.generateReportGenerationResponse(primaryConcern);
		}

		// å¦‚æœåœ¨ä»»ä½•éšæ®µæ”¶åˆ°ç”Ÿæ—¥ä¿¡æ¯
		if (this.detectBirthdayInfo(message).hasBirthday && !hasBirthday) {
			return this.generateBirthdayReceivedResponse(primaryConcern);
		}

		// æ›´ä¸»å‹•çš„é»˜èªå›æ‡‰
		if (primaryConcern) {
			return `æˆ‘æ˜ç™½ä½ é—œå¿ƒ${primaryConcern}æ–¹é¢å˜…å•é¡Œã€‚å¯ä»¥è©³ç´°è¬›ä¸‹ä½ é‡åˆ°å˜…å…·é«”æƒ…æ³å—ï¼Ÿæ¯”å¦‚æœ€è¿‘ç™¼ç”Ÿå’—å’©äº‹ä»¤ä½ å›°æ“¾ï¼Ÿ`;
		} else {
			return "æˆ‘æƒ³å¹«ä½ åˆ†æä¸‹ï¼Œè«‹å‘Šè¨´æˆ‘ä½ æœ€é—œå¿ƒé‚Šæ–¹é¢ï¼Ÿæ¯”å¦‚å·¥ä½œã€æ„Ÿæƒ…ã€å¥åº·å®šä¿‚å…¶ä»–å›°æ“¾ï¼Ÿ";
		}
	}

	// ç”Ÿæˆé—œæ³¨é ˜åŸŸä»‹ç´¹å›æ‡‰
	static generateConcernIntroResponse(concern, emotion) {
		const responses = {
			å·¥ä½œ: [
				"å·¥ä½œç¢ºå¯¦ä¿‚äººç”Ÿå¥½é‡è¦å˜…ä¸€éƒ¨åˆ†ï¼Œæˆ‘æ˜ç™½ä½ å˜…å›°æ“¾ã€‚",
				"è·å ´ä¸Šå˜…äº‹æƒ…æœ‰æ™‚çœŸä¿‚å¥½è¤‡é›œï¼Œæˆ‘ç†è§£ä½ å˜…æ„Ÿå—ã€‚",
			],
			æ„Ÿæƒ…: [
				"æ„Ÿæƒ…å•é¡Œæœ€å½±éŸ¿å¿ƒæƒ…ï¼Œæˆ‘æ˜ç™½ä½ è€Œå®¶å˜…æ„Ÿå—ã€‚",
				"æ„›æƒ…è·¯ä¸Šç¸½æœ‰èµ·ä¼ï¼Œä½ é¡˜æ„åˆ†äº«å¤šå•²ä½ å˜…æƒ…æ³å—ï¼Ÿ",
			],
			è²¡é‹: [
				"éŒ¢å˜…å•é¡Œç¢ºå¯¦ä»¤äººæ“”å¿ƒï¼Œæˆ‘æ˜ç™½ä½ å˜…ç„¦æ…®ã€‚",
				"è²¡é‹ä¿‚å¥½å¤šäººé—œå¿ƒå˜…å•é¡Œï¼Œæˆ‘å¯ä»¥å¹«ä½ åˆ†æã€‚",
			],
			å¥åº·: [
				"å¥åº·ä¿‚æœ€å¯¶è²´å˜…è²¡å¯Œï¼Œæˆ‘æ˜ç™½ä½ å˜…æ“”å¿ƒã€‚",
				"èº«é«”å¥åº·ç¢ºå¯¦å¥½é‡è¦ï¼Œä½ è€Œå®¶æœ‰å’©å…·é«”å˜…å›°æ“¾ï¼Ÿ",
			],
			äººéš›é—œä¿‚: [
				"äººéš›é—œä¿‚æœ‰æ™‚çœŸä¿‚å¥½é›£è™•ç†ï¼Œæˆ‘ç†è§£ä½ å˜…å›°é›£ã€‚",
				"åŒäººç›¸è™•ç¢ºå¯¦éœ€è¦æ™ºæ…§ï¼Œä½ é‡åˆ°å’©å›°é›£ï¼Ÿ",
			],
			å­å¥³: [
				"é¤Šè‚²å­å¥³çœŸä¿‚å””å®¹æ˜“ï¼Œæˆ‘æ˜ç™½ä½ å˜…é—œå¿ƒã€‚",
				"ç‚ºäººçˆ¶æ¯ç¸½ä¿‚ç‚ºå­å¥³æ“å¿ƒï¼Œæœ‰å’©å…·é«”ä»¤ä½ æ“”å¿ƒï¼Ÿ",
			],
			å› ç·£: [
				"äººç”Ÿæ©Ÿæœƒç¢ºå¯¦å¥½é‡è¦ï¼Œæˆ‘æ˜ç™½ä½ æƒ³æŠŠæ¡æ™‚æ©Ÿã€‚",
				"å‘½é‹åŒæ©Ÿé‡æœ‰æ™‚é›£ä»¥æŒæ¡ï¼Œä½ æƒ³æ”¹å–„é‚Šæ–¹é¢ï¼Ÿ",
			],
			å±…å®¶ä½ˆå±€: [
				"å®¶å±…é¢¨æ°´ç¢ºå¯¦å¥½é‡è¦ï¼Œæˆ‘æ˜ç™½ä½ æƒ³æ”¹å–„å±…ä½ç’°å¢ƒã€‚",
				"å¥½å˜…å®¶å±…ä½ˆå±€å¯ä»¥æå‡é‹å‹¢ï¼Œä½ æƒ³èª¿æ•´é‚Šå€‹ç©ºé–“ï¼Ÿ",
			],
		};

		const concernResponses = responses[concern] || ["æˆ‘æ˜ç™½ä½ å˜…é—œå¿ƒã€‚"];
		const base =
			concernResponses[
				Math.floor(Math.random() * concernResponses.length)
			];

		return (
			base +
			"å¯ä»¥è©±ä¿¾æˆ‘çŸ¥å…·é«”ä¿‚å’©æƒ…æ³å—ï¼Ÿæ¯”å¦‚è€Œå®¶é‡åˆ°å’©å›°é›£ï¼Œæˆ–è€…æƒ³æ”¹å–„å’©å•é¡Œï¼Ÿ"
		);
	}

	// ç”Ÿæˆæƒ…æ„Ÿå®‰æ…°
	static generateEmotionalComfort(emotion) {
		const comfortMessages = {
			å›°æ“¾: "æˆ‘æ„Ÿå—åˆ°ä½ å˜…å›°æ“¾ï¼Œå‘¢ç¨®æ„Ÿè¦ºå¥½çœŸå¯¦ã€‚",
			æ²®å–ª: "æˆ‘æ˜ç™½ä½ è€Œå®¶å˜…æ²®å–ªï¼Œä½ ä¸¦å””å­¤å–®ã€‚",
			æ†¤æ€’: "æˆ‘ç†è§£ä½ å˜…æ†¤æ€’ï¼Œæœ‰å‘¢å•²æƒ…ç·’ä¿‚æ­£å¸¸å˜…ã€‚",
			å£“åŠ›: "æˆ‘æ„Ÿå—åˆ°ä½ æ‰¿å—å˜…å£“åŠ›ï¼Œæ·±å‘¼å¸ä¸€ä¸‹ã€‚",
			å¸Œæœ›: "æˆ‘æ„Ÿå—åˆ°ä½ æƒ³æ”¹å–„å˜…æ±ºå¿ƒï¼Œå‘¢å€‹æ…‹åº¦å¥½å¥½ã€‚",
		};

		return comfortMessages[emotion] || "æˆ‘æœƒé™ªä¼´ä½ä½ ï¼Œ";
	}

	// æ·±å…¥æ¢è¨å…·é«”å•é¡Œ
	static generateSpecificQuestionProbe(concern, emotion) {
		const probes = {
			å·¥ä½œ: [
				"æˆ‘ç†è§£å·¥ä½œä¸Šæœ‰å›°é›£ç¢ºå¯¦å””å®¹æ˜“ã€‚å¯ä»¥è¬›å¾—è©³ç´°å•²å—ï¼Ÿæ¯”å¦‚ï¼š",
				"â€¢ ä¿‚åŒäº‹æˆ–ä¸Šå¸é—œä¿‚æœ‰å•é¡Œï¼Ÿ",
				"â€¢ å·¥ä½œé‡å¤ªå¤§æˆ–è€…å£“åŠ›å¤ªé‡ï¼Ÿ",
				"â€¢ æƒ³è½‰å·¥ä½†å””çŸ¥é»åšï¼Ÿ",
				"â€¢ å®šä¿‚è–ªé‡‘æˆ–è€…ç™¼å±•å‰æ™¯å•é¡Œï¼Ÿ",
				"",
				"è¬›å¤šå•²å…·é«”æƒ…æ³ï¼Œæˆ‘å…ˆèƒ½å¤ ä¿¾åˆ°æœ€é©åˆä½ å˜…å»ºè­°ã€‚",
			].join("\n"),
			æ„Ÿæƒ…: [
				"æ„Ÿæƒ…å˜…äº‹ç¢ºå¯¦ä»¤äººå›°æ“¾ã€‚æˆ‘æ˜ç™½ä½ å˜…æ„Ÿå—ã€‚",
				"",
				"æˆ‘å¯ä»¥ç‚ºä½ æä¾›å…©ç¨®åˆ†æé¸æ“‡ï¼š",
				"",
				"ğŸŒ¸ **å€‹äººæ„Ÿæƒ…åˆ†æ** - åˆ†æä½ å€‹äººå˜…æ„Ÿæƒ…é‹å‹¢ã€æ¡ƒèŠ±é‹ã€æ„Ÿæƒ…éšœç¤™ç­‰",
				"ğŸ’• **åˆå©šé…å°åˆ†æ** - å¦‚æœä½ æœ‰ä¼´ä¾¶ï¼Œæˆ‘å¯ä»¥åˆ†æä½ å“‹å˜…å…«å­—åˆé…åº¦ã€æ„Ÿæƒ…ç›¸å®¹æ€§",
				"",
				"ä½ æƒ³è¦é‚Šç¨®åˆ†æï¼Ÿ",
			].join("\n"),
			è²¡é‹: [
				"éŒ¢å˜…å•é¡Œç¢ºå¯¦ä»¤äººæ“”å¿ƒã€‚å¯ä»¥è¬›å¾—è©³ç´°å•²å—ï¼Ÿ",
				"â€¢ ä¿‚æ”¶å…¥å””å¤ æˆ–è€…æƒ³å¢åŠ æ”¶å…¥ï¼Ÿ",
				"â€¢ æŠ•è³‡è™§ææˆ–è€…ç†è²¡å›°é›£ï¼Ÿ",
				"â€¢ å®šä¿‚æœ‰å‚µå‹™æˆ–è€…å…¶ä»–è²¡å‹™å£“åŠ›ï¼Ÿ",
				"",
				"çŸ¥é“å…·é«”æƒ…æ³ï¼Œæˆ‘å…ˆå¯ä»¥ä¿¾åˆ°é‡å°æ€§å˜…é¢¨æ°´å»ºè­°ã€‚",
			].join("\n"),
			å¥åº·: "ä½ è€Œå®¶èº«é«”æœ‰å’©å””èˆ’æœï¼Ÿå®šä¿‚æƒ³é é˜²æŸå•²å¥åº·å•é¡Œï¼Ÿå¯ä»¥è¬›å¾—å…·é«”å•²ã€‚",
			äººéš›é—œä¿‚:
				"ä½ åŒé‚Šå•²äººå˜…é—œä¿‚æœ‰å•é¡Œï¼Ÿä¿‚æœ‹å‹ã€å®¶äººï¼Œå®šä¿‚åŒäº‹ï¼Ÿå¯ä»¥è©³ç´°è¬›ä¸‹ç™¼ç”Ÿå’—å’©äº‹ã€‚",
			å­å¥³: "é—œæ–¼å­å¥³ï¼Œä½ æœ€æ“”å¿ƒä¿‚å’©ï¼Ÿä¿‚å­¸ç¿’ã€å¥åº·ï¼Œå®šä¿‚è¡Œç‚ºå•é¡Œï¼Ÿè¬›å¤šå•²å…·é«”æƒ…æ³ã€‚",
			å› ç·£: "ä½ æƒ³æŠŠæ¡å’©æ©Ÿæœƒï¼Ÿå®šä¿‚æƒ³æ”¹å–„é‹å‹¢ï¼Ÿå¯ä»¥è¬›å¾—è©³ç´°å•²ä½ å˜…æœŸæœ›ã€‚",
		};

		return (
			probes[concern] ||
			"å¯ä»¥è©³ç´°è¬›ä¸‹ä½ å˜…æƒ…æ³å—ï¼Ÿè¬›å¤šå•²å…·é«”å˜…å•é¡Œï¼Œæˆ‘å…ˆå¯ä»¥å¹«åˆ°ä½ ã€‚"
		);
	}

	// æƒ…æ„Ÿæ”¯æŒå’Œåˆæ­¥åˆ†æ
	static generateComfortAndPreAnalysis(concern, specificProblem) {
		const comfortMap = {
			å·¥ä½œ: {
				comfort:
					"æˆ‘å®Œå…¨ç†è§£ä½ å˜…å·¥ä½œå£“åŠ›ï¼Œè·å ´ä¸Šå˜…å›°é›£ç¢ºå¯¦ä»¤äººæ„Ÿåˆ°ç–²æ†Šã€‚ä½ æåˆ°å·¥ä½œä¸åˆé©åŒå£“åŠ›å¤§ï¼Œå‘¢å•²éƒ½ä¿‚å¥½å¤šäººé¢å°å˜…å•é¡Œã€‚",
				suggestion:
					"æ ¹æ“šé¢¨æ°´å­¸ï¼Œå·¥ä½œé‹å‹¢åŒä½ å˜…å€‹äººèƒ½é‡å ´æœ‰å¯†åˆ‡é—œä¿‚ã€‚é€éèª¿æ•´ä½ å˜…æ°£å ´åŒç’°å¢ƒï¼Œå¯ä»¥æœ‰æ•ˆæ”¹å–„å·¥ä½œç‹€æ³ï¼Œæ¸›è¼•å£“åŠ›ï¼Œç”šè‡³å¹«ä½ æµåˆ°æ›´é©åˆå˜…å·¥ä½œæ©Ÿæœƒã€‚",
				question:
					"æˆ‘å¯ä»¥ç‚ºä½ åšå€‹è©³ç´°å˜…å…«å­—åˆ†æï¼Œæä¾›é‡å°æ€§å˜…é¢¨æ°´å»ºè­°ï¼ŒåŒ…æ‹¬å€‹äººèƒ½é‡æå‡ã€è¾¦å…¬ç’°å¢ƒèª¿æ•´ã€åŒåŸ‹åŠ©ä½ æ”¹å–„å·¥ä½œé‹å˜…å…·é«”æ–¹æ³•ã€‚ä½ é¡˜æ„è©¦ä¸‹å—ï¼Ÿ",
			},
			æ„Ÿæƒ…: {
				comfort:
					"æ„Ÿæƒ…å•é¡Œç¢ºå¯¦æœ€ä»¤äººå¿ƒç—›ï¼Œæˆ‘æ˜ç™½ä½ è€Œå®¶å˜…æ„Ÿå—ã€‚æ„Ÿæƒ…è·¯ä¸Šæœ‰èµ·æœ‰è·Œä¿‚æ­£å¸¸å˜…ã€‚",
				suggestion:
					"é¢¨æ°´å­¸å¯ä»¥å¹«åŠ©èª¿å’Œæ„Ÿæƒ…èƒ½é‡ï¼Œæ”¹å–„äººéš›é—œä¿‚ï¼Œç”šè‡³å¢å¼·ä½ å˜…æ¡ƒèŠ±é‹æˆ–è€…ä¿®å¾©ç¾æœ‰é—œä¿‚ã€‚",
				question:
					"æˆ‘å¯ä»¥ç‚ºä½ æä¾›å…©ç¨®åˆ†æé¸æ“‡ï¼š\n\n" +
					"ğŸŒ¸ **å€‹äººæ„Ÿæƒ…åˆ†æ** - åˆ†æä½ å€‹äººå˜…æ„Ÿæƒ…é‹å‹¢ã€æ¡ƒèŠ±é‹ã€æ„Ÿæƒ…éšœç¤™ç­‰\n" +
					"ğŸ’• **åˆå©šé…å°åˆ†æ** - å¦‚æœä½ æœ‰ä¼´ä¾¶ï¼Œæˆ‘å¯ä»¥åˆ†æä½ å“‹å˜…å…«å­—åˆé…åº¦ã€æ„Ÿæƒ…ç›¸å®¹æ€§\n\n" +
					"ä½ æƒ³è¦é‚Šç¨®åˆ†æï¼Ÿè«‹å›è¦†ã€Œå€‹äººåˆ†æã€æˆ–è€…ã€Œåˆå©šåˆ†æã€",
			},
			è²¡é‹: {
				comfort:
					"éŒ¢å˜…å•é¡Œç¢ºå¯¦ä»¤äººæ“”å¿ƒï¼Œæˆ‘ç†è§£ä½ å˜…ç„¦æ…®ã€‚è²¡é‹æœ‰æ™‚èµ·ä¼ä¸å®šä¿‚å¥½æ­£å¸¸å˜…ã€‚",
				suggestion:
					"é¢¨æ°´å­¸èªç‚ºè²¡é‹åŒå€‹äººæ°£å ´åŒç’°å¢ƒä½ˆå±€æœ‰å¥½å¤§é—œä¿‚ï¼Œé€éèª¿æ•´å¯ä»¥æ”¹å–„è²¡é‹æµå‹•ã€‚",
				question:
					"æˆ‘å¯ä»¥ç‚ºä½ åˆ†æè²¡é‹èµ°å‹¢ï¼Œæä¾›æ‹›è²¡èšè²¡å˜…é¢¨æ°´å»ºè­°ã€‚ä½ é¡˜æ„äº†è§£ä¸‹å—ï¼Ÿ",
			},
			å¥åº·: {
				comfort:
					"å¥åº·å•é¡Œæœ€ä»¤äººæ“”å¿ƒï¼Œæˆ‘æ˜ç™½ä½ å˜…æ†‚æ…®ã€‚èº«å¿ƒå¥åº·ç¢ºå¯¦ä¿‚æœ€é‡è¦å˜…ã€‚",
				suggestion:
					"é¢¨æ°´å­¸å¯ä»¥å¹«åŠ©èª¿å’Œèº«å¿ƒèƒ½é‡ï¼Œæ”¹å–„å±…ä½ç’°å¢ƒå˜…å¥åº·æ°£å ´ï¼Œä¿ƒé€²èº«å¿ƒå¹³è¡¡ã€‚",
				question:
					"æˆ‘å¯ä»¥ç‚ºä½ åˆ†æå¥åº·é‹å‹¢ï¼Œæä¾›æ”¹å–„èº«å¿ƒèƒ½é‡å˜…é¢¨æ°´æ–¹æ³•ã€‚ä½ æƒ³è©¦ä¸‹å—ï¼Ÿ",
			},
		};

		const response = comfortMap[concern] || {
			comfort: "æˆ‘æ˜ç™½ä½ è€Œå®¶é¢å°å˜…å›°é›£ï¼Œå‘¢å•²æŒ‘æˆ°ç¢ºå¯¦å””å®¹æ˜“è™•ç†ã€‚",
			suggestion: "é¢¨æ°´å­¸å¯ä»¥å¹«åŠ©èª¿æ•´å€‹äººèƒ½é‡å ´ï¼Œæ”¹å–„ç”Ÿæ´»å„æ–¹é¢å˜…é‹å‹¢ã€‚",
			question:
				"æˆ‘å¯ä»¥ç‚ºä½ åšå€‹è©³ç´°åˆ†æï¼Œæä¾›æ”¹å–„é‹å‹¢å˜…å…·é«”å»ºè­°ã€‚ä½ é¡˜æ„è©¦ä¸‹å—ï¼Ÿ",
		};

		return `${response.comfort}\n\n${response.suggestion}\n\n${response.question}`;
	}

	// è«‹æ±‚ç”Ÿæ—¥ä¿¡æ¯ï¼ˆè§¸ç™¼æ¨¡æ…‹æ¡†ï¼‰
	static generateModalTriggerResponse(concern) {
		return `å¥½ï¼æˆ‘å·²ç¶“äº†è§£ä½ å˜…${concern}å•é¡Œã€‚ç¾åœ¨æˆ‘éœ€è¦ä½ å˜…å‡ºç”Ÿè³‡æ–™ä¾†ç‚ºä½ åšè©³ç´°åˆ†æã€‚

è«‹æä¾›ä½ å˜…ï¼š
â€¢ å‡ºç”Ÿæ—¥æœŸï¼ˆå¹´æœˆæ—¥ï¼‰
â€¢ æ€§åˆ¥

æœ‰å’—å‘¢å•²è³‡æ–™ï¼Œæˆ‘å¯ä»¥æ ¹æ“šä½ å˜…å…«å­—äº”è¡Œï¼Œç‚ºä½ æä¾›ç²¾æº–å˜…${concern}åˆ†æåŒæ”¹å–„å»ºè­°ã€‚`;
	}

	// æ”¶åˆ°ç”Ÿæ—¥å¾Œçš„å›æ‡‰
	static generateBirthdayReceivedResponse(concern) {
		return `æ”¶åˆ°ï¼æˆ‘å·²ç¶“è¨˜éŒ„å’—ä½ å˜…ç”Ÿæ—¥è³‡æ–™ã€‚ä¾å®¶æˆ‘æœƒç‚ºä½ æº–å‚™ä¸€ä»½è©³ç´°å˜…${concern}åˆ†æå ±å‘Šã€‚

å‘¢ä»½å ±å‘ŠæœƒåŒ…æ‹¬ï¼š
â€¢ ä½ å˜…å…«å­—äº”è¡Œåˆ†æ
â€¢ ${concern}é‹å‹¢è©•ä¼°
â€¢ é‡å°ä½ å…·é«”å•é¡Œå˜…å»ºè­°
â€¢ é¢¨æ°´æ”¹å–„æ–¹æ¡ˆ

æˆ‘è€Œå®¶é–‹å§‹ç‚ºä½ åˆ†æ...`;
	}

	// å ±å‘Šç”Ÿæˆå›æ‡‰
	static generateReportGenerationResponse(concern) {
		return `ä½ å˜…${concern}åˆ†æå ±å‘Šå·²ç¶“æº–å‚™å¥½ï¼å ±å‘ŠåŒ…æ‹¬å’—æ ¹æ“šä½ å˜…å…«å­—åˆ†æåŒå…·é«”å»ºè­°ã€‚æ­£åœ¨ç‚ºä½ ç”Ÿæˆè©³ç´°åˆ†æ...`;
	}

	// æä¾›è©³ç´°åˆ†æé¸é …
	static generateOfferDetailedAnalysis(
		concern,
		emotion,
		analysisType = null
	) {
		// ç‰¹åˆ¥è™•ç†æ„Ÿæƒ…é—œæ³¨çš„åˆå©šåˆ†æ
		if (concern === "æ„Ÿæƒ…" && analysisType === "couple") {
			return (
				"æˆ‘å·²ç¶“ç‚ºä½ å“‹é€²è¡Œå’—åŸºæœ¬å˜…åˆå©šé…å°åˆ†æ ğŸ’•\n\n" +
				"æƒ³è¦æ›´è©³ç´°å˜…åˆå©šå ±å‘Šå—ï¼ŸåŒ…æ‹¬ï¼š\n" +
				"â€¢ è©³ç´°å˜…å…«å­—åˆé…åº¦åˆ†æ\n" +
				"â€¢ æ„Ÿæƒ…ç™¼å±•æ™‚æ©Ÿå»ºè­°\n" +
				"â€¢ åŒ–è§£æ„Ÿæƒ…éšœç¤™å˜…é¢¨æ°´æ–¹æ³•\n" +
				"â€¢ å¢é€²æ„Ÿæƒ…å˜…å…·é«”å»ºè­°\n\n" +
				"å¦‚æœéœ€è¦è©³ç´°å ±å‘Šï¼Œè«‹å›è¦†ã€Œè¦ã€æˆ–ã€Œæƒ³ã€"
			);
		}

		const responses = {
			å·¥ä½œ: "æˆ‘æ˜ç™½å·¥ä½œå£“åŠ›ç¢ºå¯¦å¥½å½±éŸ¿ç”Ÿæ´»è³ªé‡ã€‚æ ¹æ“šä½ å˜…æƒ…æ³ï¼Œæˆ‘å¯ä»¥ç‚ºä½ æä¾›è©³ç´°å˜…å…«å­—åˆ†æåŒåŸ‹å…·é«”å˜…æ”¹å–„å»ºè­°ã€‚ä½ æƒ³è¦è©³ç´°å˜…è·å ´é¢¨æ°´åˆ†æå ±å‘Šå—ï¼Ÿ",
			æ„Ÿæƒ…:
				"æ„Ÿæƒ…å•é¡Œæœ€éœ€è¦ç´°å¿ƒè™•ç†ã€‚æˆ‘å¯ä»¥ç‚ºä½ æä¾›å…©ç¨®è©³ç´°åˆ†æï¼š\n\n" +
				"ğŸŒ¸ **å€‹äººæ„Ÿæƒ…åˆ†æ** - æ·±å…¥åˆ†æä½ å€‹äººå˜…æ„Ÿæƒ…é‹å‹¢ã€æ¡ƒèŠ±é‹ã€æœ€ä½³è„«å–®æ™‚æ©Ÿç­‰\n" +
				"ğŸ’• **åˆå©šé…å°åˆ†æ** - å¦‚æœä½ æœ‰ä¼´ä¾¶ï¼Œå¯ä»¥åˆ†æä½ å“‹å˜…å…«å­—åˆé…åº¦ã€æ„Ÿæƒ…ç™¼å±•å»ºè­°ç­‰\n\n" +
				"ä½ æƒ³è¦é‚Šç¨®è©³ç´°åˆ†æï¼Ÿè«‹å›è¦†ã€Œå€‹äººåˆ†æã€æˆ–è€…ã€Œåˆå©šåˆ†æã€",
			è²¡é‹: "è²¡é‹åˆ†æéœ€è¦è©³ç´°å˜…å…«å­—è¨ˆç®—ã€‚æˆ‘å¯ä»¥ç‚ºä½ åˆ†æè²¡é‹èµ°å‹¢åŒåŸ‹æä¾›å‚¬è²¡é¢¨æ°´å»ºè­°ã€‚ä½ æƒ³è¦å®Œæ•´å˜…è²¡é‹åˆ†æå ±å‘Šå—ï¼Ÿ",
			å¥åº·: "å¥åº·ä¿‚æœ€é‡è¦å˜…ã€‚æˆ‘å¯ä»¥æ ¹æ“šä½ å˜…å…«å­—åˆ†æå¥åº·é‹å‹¢åŒåŸ‹æä¾›é¤Šç”Ÿé¢¨æ°´å»ºè­°ã€‚ä½ æƒ³è¦è©³ç´°å˜…å¥åº·åˆ†æå ±å‘Šå—ï¼Ÿ",
		};

		return (
			responses[concern] ||
			`æˆ‘å¯ä»¥ç‚ºä½ æä¾›è©³ç´°å˜…${concern}åˆ†æå ±å‘Šï¼ŒåŒ…æ‹¬å…·é«”å˜…æ”¹å–„å»ºè­°ã€‚ä½ æƒ³è¦å—ï¼Ÿ`
		);
	}

	// æä¾›å®‰æ…°ä¸¦è«‹æ±‚ç”Ÿæ—¥ä¿¡æ¯é€²è¡Œåˆ†æ
	static generateComfortAndBirthdayRequest(concern, emotion) {
		const comfort = this.generateEmotionalComfort(emotion);
		const responses = {
			å·¥ä½œ: "å·¥ä½œå•é¡Œç¢ºå¯¦ä»¤äººå›°æ“¾ã€‚å¦‚æœä½ é¡˜æ„æä¾›ç”Ÿæ—¥è³‡æ–™ï¼Œæˆ‘å¯ä»¥æ ¹æ“šä½ å˜…å…«å­—ç‚ºä½ åˆ†æè·å ´é‹å‹¢ï¼Œæä¾›å…·é«”å˜…æ”¹å–„æ–¹å‘ã€‚",
			æ„Ÿæƒ…: "æ„Ÿæƒ…è·¯ä¸Šç¸½æœ‰èµ·ä¼ï¼Œæˆ‘æ˜ç™½ä½ å˜…æ„Ÿå—ã€‚å¦‚æœä½ æä¾›ç”Ÿæ—¥è³‡æ–™ï¼Œæˆ‘å¯ä»¥ç‚ºä½ åšè©³ç´°å˜…æ„Ÿæƒ…åˆ†æï¼Œç”šè‡³åˆå©šå»ºè­°ã€‚",
			è²¡é‹: "è²¡å‹™å£“åŠ›ç¢ºå¯¦å½±éŸ¿å¿ƒæƒ…ã€‚æä¾›ç”Ÿæ—¥è³‡æ–™å¾Œï¼Œæˆ‘å¯ä»¥ç‚ºä½ åˆ†æè²¡é‹èµ°å‘åŒåŸ‹æä¾›å‚¬è²¡å»ºè­°ã€‚",
			å¥åº·: "å¥åº·å•é¡Œæœ€éœ€è¦é‡è¦–ã€‚å¦‚æœä½ æä¾›ç”Ÿæ—¥è³‡æ–™ï¼Œæˆ‘å¯ä»¥æ ¹æ“šå…«å­—ç‚ºä½ åˆ†æå¥åº·é‹å‹¢åŒé¤Šç”Ÿå»ºè­°ã€‚",
		};

		return (
			comfort + responses[concern] ||
			`${comfort}å¦‚æœä½ æä¾›ç”Ÿæ—¥è³‡æ–™ï¼Œæˆ‘å¯ä»¥ç‚ºä½ åšæ›´ç²¾æº–å˜…${concern}åˆ†æã€‚`
		);
	}

	// æª¢æ¸¬æ˜¯å¦æœ‰å…·é«”å•é¡Œæè¿°
	static hasSpecificProblemDescription(message, previousMessages = []) {
		// é¦–å…ˆæª¢æŸ¥æ˜¯å¦æ˜¯ç”Ÿæ—¥ä¿¡æ¯ - å¦‚æœæ˜¯ç”Ÿæ—¥ä¿¡æ¯ï¼Œä¸æ‡‰è¦–ç‚ºå•é¡Œæè¿°
		const birthdayInfo = this.detectBirthdayInfo(message);
		if (birthdayInfo.hasBirthday) {
			return false; // ç”Ÿæ—¥ä¿¡æ¯ä¸æ˜¯å•é¡Œæè¿°
		}

		// æª¢æŸ¥æ˜¯å¦åŒ…å«æ€§åˆ¥ä¿¡æ¯ï¼ˆé€šå¸¸èˆ‡ç”Ÿæ—¥ä¸€èµ·å‡ºç¾ï¼‰
		if (
			message.includes("æ€§åˆ¥ï¼š") ||
			message.includes("æ€§åˆ¥:") ||
			message.includes("æ€§åˆ¥ ") ||
			/æ€§åˆ¥.{0,2}[ç”·å¥³]/.test(message) ||
			/[ç”·å¥³]$/.test(message.trim()) // åªæœ‰å–®ç¨çš„ç”·/å¥³åœ¨æœ«å°¾
		) {
			return false; // æ€§åˆ¥ä¿¡æ¯ä¸æ˜¯å•é¡Œæè¿°
		}

		// ğŸ”§ æª¢æŸ¥æ˜¯å¦æ˜¯æ“ä½œæ€§å•é¡Œ - é€™äº›ä¸æ˜¯å…·é«”çš„é¢¨æ°´å•é¡Œ
		const operationalQuestions = [
			"å¦‚ä½•æä¾›ç”Ÿæ—¥",
			"æ€æ¨£æä¾›ç”Ÿæ—¥",
			"æ€éº¼æä¾›ç”Ÿæ—¥",
			"é»æ¨£æä¾›ç”Ÿæ—¥",
			"å¦‚ä½•çµ¦ç”Ÿæ—¥",
			"ç”Ÿæ—¥æ€éº¼çµ¦",
			"å¦‚ä½•å ±å‘Šç”Ÿæ—¥",
			"å¦‚ä½•è¼¸å…¥ç”Ÿæ—¥",
			"é»æ¨£ä¿¾ç”Ÿæ—¥",
			"å¦‚ä½•é–‹å§‹",
			"æ€æ¨£é–‹å§‹",
			"å¦‚ä½•ä»˜æ¬¾",
			"æ€æ¨£ä»˜è²»",
			"è²»ç”¨å¤šå°‘",
			"æ€éº¼æ”¶è²»",
		];

		if (operationalQuestions.some((phrase) => message.includes(phrase))) {
			return false; // æ“ä½œæ€§å•é¡Œä¸æ˜¯å…·é«”é¢¨æ°´å•é¡Œ
		}

		// ğŸš¨ é‡è¦ï¼šé¦–å…ˆæª¢æŸ¥æ˜¯å¦æ˜¯åˆ†æé¡å‹é¸æ“‡ï¼Œå¦‚æœæ˜¯å‰‡ä¸è¦–ç‚ºå…·é«”å•é¡Œ
		const analysisTypeChoices = [
			"åˆå©šåˆ†æ",
			"å€‹äººåˆ†æ",
			"å€‹äººæ„Ÿæƒ…åˆ†æ",
			"åˆå©š",
			"å€‹äºº",
			"å–®äººåˆ†æ",
			"é›™äººåˆ†æ",
			"æƒ…ä¾¶åˆ†æ",
			"å¤«å¦»åˆ†æ",
			"é…å°åˆ†æ",
			"å…«å­—åˆå©š",
			"å©šé…åˆ†æ",
		];

		if (analysisTypeChoices.some((choice) => message.includes(choice))) {
			return false; // åˆ†æé¡å‹é¸æ“‡ä¸æ˜¯å…·é«”å•é¡Œ
		}

		// æª¢æŸ¥ç‰¹å®šçš„çŸ­èªï¼ˆå³ä½¿é•·åº¦è¼ƒçŸ­ä¹Ÿç®—å…·é«”å•é¡Œï¼‰
		const specificShortPhrases = [
			"åŠ äººå·¥",
			"åŠ è–ª",
			"æ¸›è–ª",
			"å‡è·",
			"è¾­è·",
			"è½‰å·¥",
			"åˆ†æ‰‹",
			"åˆ†æ‰‹äº†",
			"é›¢å©š",
			"é›¢å©šäº†",
			"çµå©š",
			"è²·æ¨“",
			"æœªä¾†æ„Ÿæƒ…ç™¼å±•",
			"æ„Ÿæƒ…æœªä¾†",
			"æœªä¾†ç™¼å±•",
			"æ„Ÿæƒ…èµ°å‘",
			"æœªä¾†æ¡ƒèŠ±",
			"å¾©åˆå¯èƒ½",
			"æ¡ƒèŠ±é‹",
			"æ¡ƒèŠ±",
			"è„«å–®",
		];

		// ğŸ¯ æª¢æŸ¥è©³ç´°åˆ†æè«‹æ±‚ - é€™äº›è¡¨æ˜ç”¨æˆ¶è¦æ·±åº¦åˆ†æ
		const detailedAnalysisRequests = [
			"æµå¹´åˆå©š",
			"æµå¹´åˆå©šè©³è§£",
			"åˆå©šåˆ†æ",
			"å…«å­—åˆå©š",
			"å©šé…åˆ†æ",
			"è©³ç´°åˆ†æ",
			"æ·±å…¥åˆ†æ",
			"å®Œæ•´åˆ†æ",
			"å°ˆæ¥­åˆ†æ",
			"æµå¹´é‹å‹¢",
			"å¹´é‹åˆ†æ",
			"é‹å‹¢è©³è§£",
			"å…«å­—åˆ†æ",
			"å‘½ç›¤åˆ†æ",
			"å‘½ç†åˆ†æ",
			"é¢¨æ°´è©³è§£",
			"é¢¨æ°´åˆ†æ",
			"é¢¨æ°´å»ºè­°",
			"å©šå«å‰æ—¥",
			"çµå©šå‰æ—¥",
			"æ“‡æ—¥åˆ†æ",
			"è²¡é‹åˆ†æ",
			"äº‹æ¥­åˆ†æ",
			"æ„Ÿæƒ…åˆ†æ",
		];

		// ğŸ¯ å…ˆæª¢æŸ¥å…·é«”çŸ­èªï¼Œå„ªå…ˆç´šæœ€é«˜
		if (specificShortPhrases.some((phrase) => message.includes(phrase))) {
			return true; // é€™äº›çŸ­èªå³ä½¿è¼ƒçŸ­ä¹Ÿç®—å…·é«”å•é¡Œ
		}

		if (
			detailedAnalysisRequests.some((phrase) => message.includes(phrase))
		) {
			return "detailed_analysis_request"; // ç‰¹æ®Šæ¨™è¨˜ï¼šè©³ç´°åˆ†æè«‹æ±‚
		}

		// æª¢æŸ¥æ¶ˆæ¯é•·åº¦ï¼ˆä¸­æ–‡å­—ç¬¦è¼ƒå°‘ï¼Œèª¿æ•´æœ€å°é•·åº¦è¦æ±‚ï¼‰
		if (message.length < 6) return false;

		// ğŸš¨ æª¢æŸ¥æ˜¯å¦æ˜¯éæ–¼ç°¡å–®çš„é™³è¿°ï¼ˆä¸å¤ å…·é«”ï¼‰- åœ¨å…·é«”çŸ­èªæª¢æŸ¥ä¹‹å¾Œ
		const vaguePatterns = [
			/^(.{0,5})(å·¥ä½œ|æ„Ÿæƒ…|è²¡é‹).{0,5}(æœ‰|æœ‰é»|å­˜åœ¨).{0,5}(å•é¡Œ|å›°é›£|éº»ç…©)(.{0,5})$/,
			/^(.{0,5})(å·¥ä½œ|æ„Ÿæƒ…|è²¡é‹).{0,5}(å””|ä¸|å†‡).{0,5}(å¥½|é †åˆ©|é †)(.{0,5})$/,
			/^(.{0,5})(æœ€è¿‘|è€Œå®¶).{0,5}(å·¥ä½œ|æ„Ÿæƒ…|è²¡é‹).{0,5}(å””|ä¸).{0,5}(é †|å¥½)(.{0,5})$/,
			// æ·»åŠ æ›´å¤šæ¨¡ç³ŠæŸ¥è©¢æ¨¡å¼
			/^(.{0,5})(æˆ‘æƒ³å•|æƒ³å•|æƒ³çŸ¥é“|è«‹å•).{0,5}(æœ‰é—œ|é—œæ–¼).{0,5}(å·¥ä½œ|æ„Ÿæƒ…|è²¡é‹|å¥åº·|äººéš›)(.{0,5})$/,
			/^(.{0,5})(å·¥ä½œ|æ„Ÿæƒ…|è²¡é‹|å¥åº·|äººéš›).{0,5}(æ–¹é¢|å•é¡Œ|æƒ…æ³)(.{0,5})$/,
			/^(.{0,5})(æƒ³äº†è§£|äº†è§£).{0,5}(å·¥ä½œ|æ„Ÿæƒ…|è²¡é‹|å¥åº·|äººéš›)(.{0,5})$/,
			// ğŸ¯ ä¿®æ”¹ï¼šåªåŒ¹é…æ²’æœ‰å…·é«”å‹•ä½œçš„ä¸€èˆ¬æ€§è©¢å•
			/^(.{0,5})(æˆ‘æƒ³å•|æƒ³å•|æƒ³çŸ¥é“|è«‹å•).{0,5}(å·¥ä½œ|æ„Ÿæƒ…|è²¡é‹|å¥åº·|äººéš›)$/, // ç§»é™¤å¾Œç¶´åŒ¹é…ï¼Œé¿å…å½±éŸ¿å…·é«”å•é¡Œ
		];

		// å¦‚æœåŒ¹é…åˆ°æ¨¡ç³Šæ¨¡å¼ï¼Œèªç‚ºä¸å¤ å…·é«”
		if (vaguePatterns.some((pattern) => pattern.test(message))) {
			return false;
		}

		// æª¢æŸ¥æ˜¯å¦åŒ…å«å…·é«”æè¿°è©åŒ¯ï¼ˆéœ€è¦æ›´å…·é«”çš„æè¿°ï¼‰
		const specificDescriptors = [
			// æ™‚é–“å…·é«”æ€§
			"æœ€è¿‘å¹¾å€‹æœˆ",
			"å‘¢å€‹æ˜ŸæœŸ",
			"ä¸Šå€‹æœˆ",
			"ä»Šå¹´",
			"å»å¹´",
			"å·²ç¶“å¥½è€",
			"æŒçºŒ",
			"ç¶“å¸¸ç™¼ç”Ÿ",
			// å…·é«”å•é¡Œæè¿°
			"è€é—†",
			"åŒäº‹",
			"å®¢æˆ¶",
			"ä¸Šå¸",
			"ä¸‹å±¬",
			"å·¥ä½œé‡",
			"åŠ ç­",
			"è½‰å·¥",
			"è¾­è·",
			"å‡è·",
			"æ¸›è–ª",
			"åŠ è–ª",
			"äººå·¥",
			"åŠ äººå·¥",
			"è–ªæ°´",
			"å¾…é‡",
			"ç¦åˆ©",
			"ç”·æœ‹å‹",
			"å¥³æœ‹å‹",
			"è€å…¬",
			"è€å©†",
			"åˆ†æ‰‹",
			"çµå©š",
			"é›¢å©š",
			"å‡ºè»Œ",
			"çˆ­åŸ·",
			"å†·æˆ°",
			"å‚µå‹™",
			"æŠ•è³‡",
			"è™§æ",
			"å€ŸéŒ¢",
			"ç ´ç”¢",
			"è²·æ¨“",
			"æŒ‰æ­",
			"è‚¡ç¥¨",
			"åŸºé‡‘",
			"æ©«è²¡",
			"åè²¡",
			"æ­£è²¡",
			"ç™¼è²¡",
			"ä¸­ç",
			"å½©ç¥¨",
			"é‹è²¡",
			"æ‹›è²¡",
			"èšè²¡",
			"å¢åŠ è²¡é‹",
			// æƒ…ç·’å’Œèº«é«”å…·é«”ç—‡ç‹€
			"å¤±çœ ",
			"é ­ç—›",
			"ç–²ç´¯åˆ°",
			"æ”°åˆ°",
			"é£Ÿå””è½",
			"ç“å””è‘—",
			"å¿ƒæƒ…ä½è½",
			"å£“åŠ›å¤§åˆ°",
			// å…·é«”è¡Œç‚ºæˆ–äº‹ä»¶
			"ç™¼ç”Ÿå’—",
			"é‡åˆ°",
			"é¢å°",
			"è™•ç†ç·Š",
			"å˜—è©¦é",
			"å·²ç¶“è©¦é",
			"æƒ³è§£æ±º",
			"å¸Œæœ›æ”¹å–„",
			// æ„Ÿæƒ…ç›¸é—œå…·é«”å•é¡Œ - ä¸­æ–‡å­—ç¬¦åŒ¹é…
			"äº¤ä¸åˆ°",
			"æ‰¾ä¸åˆ°",
			"æµå””åˆ°",
			"å–®èº«",
			"å­¤å–®",
			"å§»ç·£",
			"æ¡ƒèŠ±",
			"æ¡ƒèŠ±é‹",
			"è„«å–®",
			"ç›¸è¦ª",
			"ç´„æœƒ",
			"å¢å¼·",
			"æå‡",
			"æ”¹å–„",
			"æ‹›æ¡ƒèŠ±",
			"æˆ€æ„›é‹",
			"æ„Ÿæƒ…é‹",
			"äººç·£",
			"åˆ†æ‰‹äº†",
			"é›¢å©šäº†",
			// ç¹é«”å’Œç°¡é«”æ··åˆ
			"ä»€éº¼",
			"ç”šéº¼",
			"æ€éº¼",
			"é»æ¨£",
			"å¦‚ä½•",
			"èƒ½å¦",
			"å¯å¦",
			"å¯ä»¥",
			"æƒ³çœ‹çœ‹",
			"æƒ³å•",
			"æƒ³çŸ¥é“",
		];

		// éœ€è¦è‡³å°‘åŒ…å«ä¸€å€‹å…·é«”æè¿°è©åŒ¯ï¼Œä¸”æ¶ˆæ¯é•·åº¦è¶³å¤ 
		const hasSpecificContent = specificDescriptors.some((desc) =>
			message.includes(desc)
		);

		// æˆ–è€…æ¶ˆæ¯é•·åº¦å¾ˆé•·ï¼ˆé€šå¸¸è¡¨ç¤ºè©³ç´°æè¿°ï¼‰
		const isDetailedDescription = message.length > 15;

		return hasSpecificContent || isDetailedDescription;
	}

	// æª¢æ¸¬ç¢ºèªå›æ‡‰ï¼ˆ"å¥½"ã€"æ˜¯"ã€"å¯ä»¥"ç­‰ï¼‰
	static detectConfirmation(message) {
		const confirmationPatterns = [
			/^å¥½$/,
			/^å¥½çš„$/,
			/^å¯ä»¥$/,
			/^æ˜¯$/,
			/^æ˜¯çš„$/,
			/^OK$/,
			/^ok$/,
			/^æƒ³è¦$/,
			/^æƒ³$/,
			/^è¦$/,
			/^åŒæ„$/,
			/^é¡˜æ„$/,
		];

		return confirmationPatterns.some((pattern) =>
			pattern.test(message?.trim() || "")
		);
	}

	// æª¢æ¸¬æ„Ÿæƒ…åˆ†æé¡å‹é¸æ“‡
	static detectRelationshipAnalysisChoice(message) {
		const individualPatterns = [
			"å€‹äººåˆ†æ",
			"ä¸ªäººåˆ†æ",
			"å€‹äºº",
			"å•äººåˆ†æ",
			"å–®äººåˆ†æ",
			"æˆ‘è‡ªå·±",
			"å€‹äººæ„Ÿæƒ…",
			"å€‹äººå˜…",
			"å€‹äººçš„",
			"è‡ªå·±çš„",
			"åªè¦æˆ‘",
			"é¸æ“‡1",
			"1ï¸âƒ£",
			"1", // æ·»åŠ å–®ç´”æ•¸å­—1
			"æ¡ƒèŠ±é¢¨æ°´", // ğŸ”§ æ–°å¢ï¼šæ¡ƒèŠ±é¢¨æ°´æ‡‰è©²æ˜¯å€‹äººåˆ†æ
			"æ¡ƒèŠ±é‹", // ğŸ”§ æ–°å¢ï¼šæ¡ƒèŠ±é‹ä¹Ÿæ˜¯å€‹äººåˆ†æ
			"å–®èº«", // ğŸ”§ æ–°å¢ï¼šå–®èº«ç›¸é—œä¹Ÿæ˜¯å€‹äººåˆ†æ
			"è„«å–®", // ğŸ”§ æ–°å¢ï¼šè„«å–®ä¹Ÿæ˜¯å€‹äººåˆ†æ
			"é—œä¿‚", // ğŸ¯ æ–°å¢ï¼šé—œä¿‚åˆ†ææ˜¯å€‹äººåˆ†æ
			"å…³ç³»",
			"é—œä¿‚åˆ†æ",
		];

		const couplePatterns = [
			"åˆå©šåˆ†æ",
			"åˆå©š",
			"åˆå©šé…å°åˆ†æ",
			"åˆå©šæ·±åº¦åˆ†æ",
			"é›™æ–¹åˆå©šæ·±åº¦åˆ†æ",
			"é…å°",
			"é…å¯¹",
			"å…©äºº",
			"ä¸¤äºº",
			"é›™äºº",
			"åŒäºº",
			"æƒ…ä¾¶",
			"æƒ…ä¾£",
			"å¤«å¦»",
			"ä¼´ä¾¶",
			"ä¼´ä¾£",
			"å°è±¡",
			"å¯¹è±¡",
			"é¸æ“‡2",
			"2ï¸âƒ£",
			"2", // æ·»åŠ å–®ç´”æ•¸å­—2
			"å¾©åˆ", // ğŸ¯ æ–°å¢ï¼šå¾©åˆç›¸é—œ
			"å¤åˆ",
			"å¾©åˆåˆ†æ",
			"å¾©åˆå¯èƒ½æ€§",
		];

		// ğŸ¯ æ–°å¢ï¼šå…·é«”å•é¡Œé—œéµè© - å¦‚æœåŒ…å«é€™äº›ï¼Œä¸æ‡‰è©²è¢«è­˜åˆ¥ç‚ºåˆ†æé¡å‹é¸æ“‡
		const specificProblemPatterns = [
			"åˆ†æ‰‹",
			"åˆ†æ‰‹äº†",
			"åˆ†å¼€äº†",
			"åˆ†é–‹äº†",
			"é›¢å©š",
			"ç¦»å©š",
			"åµæ¶",
			"å†·æˆ°",
			"å†·æˆ˜",
			"å‡ºè»Œ",
			"å‡ºè½¨",
			"èƒŒå›",
			"æ¬ºé¨™",
			"æ¬ºéª—",
			"ä¸æ„›",
			"ä¸çˆ±",
			"è®Šå¿ƒ",
			"å˜å¿ƒ",
		];

		// æª¢æŸ¥æ˜¯å¦æ˜¯ç”Ÿæ—¥æ ¼å¼ï¼Œå¦‚æœæ˜¯å‰‡ä¸é€²è¡Œé—œä¿‚é¸æ“‡æª¢æ¸¬
		const birthdayPattern =
			/\d{4}[-\/å¹´]\d{1,2}[-\/æœˆ]\d{1,2}æ—¥?|\d{1,2}[-\/]\d{1,2}[-\/]\d{4}/;
		if (birthdayPattern.test(message.trim())) {
			return null;
		}

		// ğŸ¯ å„ªå…ˆæª¢æŸ¥ï¼šå¦‚æœåŒ…å«å…·é«”å•é¡Œé—œéµè©ï¼Œä¸è­˜åˆ¥ç‚ºåˆ†æé¡å‹é¸æ“‡
		if (
			specificProblemPatterns.some((pattern) => message.includes(pattern))
		) {
			return null; // é€™æ˜¯å…·é«”å•é¡Œï¼Œä¸æ˜¯åˆ†æé¡å‹é¸æ“‡
		}

		// ğŸ¯ ä¿®æ”¹ï¼šåªåœ¨æ˜ç¢ºè¡¨é”é¸æ“‡æ„åœ–æ™‚æ‰è­˜åˆ¥ç‚ºåˆ†æé¡å‹é¸æ“‡
		const coupleChoicePatterns = [
			"åˆå©šåˆ†æ",
			"åˆå©š",
			"é…å°",
			"é…å¯¹",
			"å…©äºº",
			"ä¸¤äºº",
			"é›™äºº",
			"åŒäºº",
			"æƒ…ä¾¶",
			"æƒ…ä¾£",
			"å¤«å¦»",
			"ä¼´ä¾¶",
			"ä¼´ä¾£",
			"å°è±¡",
			"å¯¹è±¡",
			"é¸æ“‡2",
			"2ï¸âƒ£",
			"2", // æ·»åŠ å–®ç´”æ•¸å­—2
			"æˆ‘å’Œ",
			"æˆ‘èˆ‡",
			"æˆ‘è·Ÿ.*ä¸€èµ·",
			"æˆ‘å€‘å…©å€‹",
			"æˆ‘ä»¬ä¸¤ä¸ª",
			"å¾©åˆ", // ğŸ¯ æ–°å¢ï¼šå¾©åˆç›¸é—œ
			"å¤åˆ",
			"å¾©åˆåˆ†æ",
			"å¾©åˆå¯èƒ½æ€§",
		];

		// æ£€æŸ¥å®Œæ•´åŒ¹é…ä¼˜å…ˆ
		if (individualPatterns.some((pattern) => message.includes(pattern))) {
			return "individual";
		}

		if (coupleChoicePatterns.some((pattern) => message.includes(pattern))) {
			return "couple";
		}

		return null;
	}

	// æ–°å¢ï¼šæª¢æ¸¬å ±å‘Šé¡å‹é¸æ“‡
	static detectReportTypeChoice(message) {
		const trimmedMessage = message.trim();

		// æª¢æŸ¥æ˜¯å¦æ˜¯ç´”æ•¸å­—é¸æ“‡
		if (trimmedMessage === "1") {
			return "detailed_concern"; // è©³ç´°é—œæ³¨é ˜åŸŸå ±å‘Š
		} else if (trimmedMessage === "2") {
			return "comprehensive"; // ç¶œåˆå‘½ç†å ±å‘Š
		} else if (trimmedMessage === "3") {
			return "layout"; // å±…å®¶ä½ˆå±€å ±å‘Š
		}

		// æª¢æŸ¥æ–‡å­—é¸æ“‡
		if (
			message.includes("è©³ç´°å ±å‘Š") ||
			message.includes("æ„Ÿæƒ…çš„è©³ç´°") ||
			message.includes("åˆå©šçš„è©³ç´°")
		) {
			return "detailed_concern";
		} else if (
			message.includes("ç¶œåˆå‘½ç†") ||
			message.includes("å…«å­—å‘½ç›¤") ||
			message.includes("å…¨é¢åˆ†æ")
		) {
			return "comprehensive";
		} else if (
			message.includes("å±…å®¶ä½ˆå±€") ||
			message.includes("é¢¨æ°´ç©ºé–“") ||
			message.includes("ä½ˆå±€å ±å‘Š")
		) {
			return "layout";
		}

		return null;
	}

	// æª¢æ¸¬æ¶ˆæ¯ä¸­æ˜¯å¦åŒæ™‚åŒ…å«é—œæ³¨é ˜åŸŸå’Œå…·é«”å•é¡Œ
	static detectConcernAndProblem(message) {
		const concern = this.detectPrimaryConcern(message);
		const hasSpecificProblem = this.hasSpecificProblemDescription(message);

		// åªæœ‰ç•¶çœŸæ­£å…·é«”çš„å•é¡Œæè¿°æ™‚ï¼Œæ‰èªç‚ºæ˜¯çµ„åˆæ¶ˆæ¯
		// ç§»é™¤äº†éæ–¼å¯¬æ³›çš„çµ„åˆæ¨¡å¼ï¼Œå®Œå…¨ä¾è³´hasSpecificProblemDescriptionçš„åˆ¤æ–·
		const isCombinedMessage = concern && hasSpecificProblem;

		return {
			concern: concern,
			hasSpecificProblem: hasSpecificProblem,
			isCombinedMessage: isCombinedMessage,
		};
	}

	// æ–°å¢ï¼šæª¢æ¸¬è©±é¡Œè½‰æ›
	static detectTopicChange(message, previousConcern) {
		const currentConcern = this.detectPrimaryConcern(message);

		// å¦‚æœæª¢æ¸¬åˆ°æ–°çš„é—œæ³¨é ˜åŸŸï¼Œä¸”èˆ‡ä¹‹å‰ä¸åŒ
		if (
			currentConcern &&
			previousConcern &&
			currentConcern !== previousConcern
		) {
			return {
				hasTopicChange: true,
				previousTopic: previousConcern,
				newTopic: currentConcern,
				hasNewProblem: this.hasSpecificProblemDescription(message),
			};
		}

		return {
			hasTopicChange: false,
			previousTopic: previousConcern,
			newTopic: currentConcern,
			hasNewProblem: false,
		};
	}
}

// å…«å­—åˆ†æç³»çµ±
export class BaziAnalysisSystem {
	static generatePersonalAnalysis(birthday, concern, specificProblem) {
		const year = birthday.getFullYear();
		const month = birthday.getMonth() + 1;
		const day = birthday.getDate();

		// ç°¡åŒ–çš„äº”è¡Œåˆ†æ
		const elements = ["é‡‘", "æœ¨", "æ°´", "ç«", "åœŸ"];
		const primaryElement = elements[year % 5];

		const analysisMap = {
			æ„Ÿæƒ…: {
				basic: `æ ¹æ“šä½ ${year}å¹´${month}æœˆ${day}æ—¥çš„å…«å­—ï¼Œä½ å±¬æ–¼${primaryElement}å‘½ã€‚${primaryElement}å‘½çš„äººåœ¨æ„Ÿæƒ…ä¸Š${this.getElementLoveTraits(primaryElement)}`,
				concern: `ä½ çš„æ„Ÿæƒ…é‹å‹¢é¡¯ç¤º${this.getLoveForcast(primaryElement, concern)}`,
				specific: `é‡å°ä½ æåˆ°çš„"${specificProblem}"ï¼Œå»ºè­°ä½ ${this.getSpecificAdvice(primaryElement, "æ„Ÿæƒ…", specificProblem)}`,
				fengshui: `æ„Ÿæƒ…é¢¨æ°´å»ºè­°ï¼š${this.getFengShuiAdvice(primaryElement, "æ„Ÿæƒ…")}`,
			},
			å·¥ä½œ: {
				basic: `æ ¹æ“šä½ ${year}å¹´${month}æœˆ${day}æ—¥çš„å…«å­—ï¼Œä½ å±¬æ–¼${primaryElement}å‘½ã€‚${primaryElement}å‘½çš„äººåœ¨äº‹æ¥­ä¸Š${this.getElementCareerTraits(primaryElement)}`,
				concern: `ä½ çš„äº‹æ¥­é‹å‹¢é¡¯ç¤º${this.getCareerForcast(primaryElement)}`,
				specific: `é‡å°ä½ çš„å·¥ä½œå›°æ“¾"${specificProblem}"ï¼Œå»ºè­°${this.getSpecificAdvice(primaryElement, "å·¥ä½œ", specificProblem)}`,
				fengshui: `äº‹æ¥­é¢¨æ°´å»ºè­°ï¼š${this.getFengShuiAdvice(primaryElement, "å·¥ä½œ")}`,
			},
			è²¡é‹: {
				basic: `æ ¹æ“šä½ çš„å…«å­—åˆ†æï¼Œä½ å±¬æ–¼${primaryElement}å‘½ï¼Œ${primaryElement}å‘½äººçš„è²¡é‹ç‰¹è³ªæ˜¯${this.getElementWealthTraits(primaryElement)}`,
				concern: `ä½ çš„è²¡é‹åˆ†æé¡¯ç¤º${this.getWealthForcast(primaryElement)}`,
				specific: `å°æ–¼ä½ çš„è²¡å‹™å•é¡Œ"${specificProblem}"ï¼Œå»ºè­°${this.getSpecificAdvice(primaryElement, "è²¡é‹", specificProblem)}`,
				fengshui: `æ‹›è²¡é¢¨æ°´ä½ˆå±€ï¼š${this.getFengShuiAdvice(primaryElement, "è²¡é‹")}`,
			},
		};

		return (
			analysisMap[concern] || {
				basic: `ä½ å±¬æ–¼${primaryElement}å‘½ï¼Œå…·æœ‰${primaryElement}çš„ç‰¹è³ª`,
				concern: `ä½ çš„é‹å‹¢æ•´é«”è‰¯å¥½`,
				specific: `å»ºè­°ä½ ä¿æŒç©æ¥µæ…‹åº¦`,
				fengshui: `å»ºè­°èª¿æ•´å±…ä½ç’°å¢ƒçš„æ°£å ´`,
			}
		);
	}

	// æ–°ç‰ˆæœ¬æ–¹æ³•ï¼Œè¿”å›æ­£ç¢ºçš„å±¬æ€§åç¨±ï¼Œé›†æˆAIç”Ÿæˆ
	static async generatePersonalAnalysisV2(
		birthday,
		concern,
		specificProblem
	) {
		const year = birthday.getFullYear();
		const month = birthday.getMonth() + 1;
		const day = birthday.getDate();

		// ç°¡åŒ–çš„äº”è¡Œåˆ†æ
		const elements = ["é‡‘", "æœ¨", "æ°´", "ç«", "åœŸ"];
		const primaryElement = elements[year % 5];

		// åŸºæœ¬åˆ†æï¼ˆå¦‚æœAIä¸å¯ç”¨æ™‚çš„å¾Œå‚™ï¼‰
		const basicAnalysis = {
			personality: `æ ¹æ“šä½ ${year}å¹´${month}æœˆ${day}æ—¥çš„å…«å­—ï¼Œä½ å±¬æ–¼${primaryElement}å‘½ã€‚${primaryElement}å‘½çš„äºº${this.getElementCareerTraits(primaryElement)}`,
			currentSituation: `ä½ çš„${concern}é‹å‹¢é¡¯ç¤º${this.getCareerForcast(primaryElement)}`,
			futureOutlook: `æœªä¾†${concern}ç™¼å±•å‰æ™¯è‰¯å¥½ï¼Œé©åˆç©æ¥µè¦åŠƒ`,
			specificAdvice: `é‡å°"${specificProblem}"é€™å€‹å•é¡Œï¼Œå»ºè­°ä½ ${this.getSpecificAdvice(primaryElement, concern, specificProblem)}`,
			fengShuiSolutions: `${concern}é¢¨æ°´å»ºè­°ï¼š${this.getFengShuiAdvice(primaryElement, concern)}`,
			timingAdvice: `æœ€ä½³è¡Œå‹•æ™‚æ©Ÿåœ¨æ¥ä¸‹ä¾†çš„3-6å€‹æœˆå…§ï¼Œ${primaryElement}å‘½äººæ­¤æœŸé–“é‹å‹¢ä¸Šå‡`,
		};

		// å˜—è©¦ä½¿ç”¨AIå¢å¼·å…§å®¹
		try {
			const enhancedAnalysis = await this.enhanceWithAI(
				birthday,
				concern,
				specificProblem,
				primaryElement
			);
			return { ...basicAnalysis, ...enhancedAnalysis };
		} catch (error) {
			console.log(
				"AI enhancement failed, using basic analysis:",
				error.message
			);
			return basicAnalysis;
		}
	}

	// AIå¢å¼·æ–¹æ³•
	static async enhanceWithAI(birthday, concern, specificProblem, element) {
		// è™•ç†æ²’æœ‰å…·é«”å•é¡Œçš„æƒ…æ³
		const actualProblem = specificProblem || "æ•´é«”é‹å‹¢åˆ†æ";
		const actualConcern = concern || "å…¨é¢";

		// ç‰¹åˆ¥è™•ç†æ„Ÿæƒ…å¾©åˆå•é¡Œ
		const isReconciliation =
			specificProblem &&
			(specificProblem.includes("å¾©åˆ") ||
				specificProblem.includes("åˆ†æ‰‹") ||
				specificProblem.includes("æŒ½å›"));

		const prompt = `ä½œç‚ºå°ˆæ¥­é¢¨æ°´å¸«ï¼Œè«‹ç‚ºä»¥ä¸‹ç”¨æˆ¶æä¾›è©³ç´°åˆ†æï¼š
ç”Ÿæ—¥: ${birthday.toDateString()}
äº”è¡Œ: ${element}å‘½
é—œæ³¨é ˜åŸŸ: ${actualConcern}
å…·é«”å•é¡Œ: ${actualProblem}

è«‹æä¾›ä»¥ä¸‹å…§å®¹ï¼ˆç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼‰ï¼š
1. å€‹äººæ€§æ ¼ç‰¹è³ªåˆ†æï¼ˆåŸºæ–¼äº”è¡Œå’Œç”Ÿè¾°ï¼‰
2. ${actualConcern}é‹å‹¢ç¾æ³åˆ†æ
3. æœªä¾†ç™¼å±•å±•æœ›
4. é‡å°"${actualProblem}"çš„å…·é«”å»ºè­°
5. ç›¸é—œé¢¨æ°´ä½ˆå±€å»ºè­°
6. æœ€ä½³è¡Œå‹•æ™‚æ©Ÿå»ºè­°

è«‹ä»¥å°ˆæ¥­ä½†è¦ªåˆ‡çš„èªèª¿å›ç­”ï¼Œæ¯å€‹éƒ¨åˆ†ç´„50-80å­—ã€‚`;

		// æ ¹æ“šå•é¡Œé¡å‹æä¾›ä¸åŒçš„å¢å¼·å…§å®¹
		if (isReconciliation) {
			return {
				personality: `${element}å‘½çš„ä½ åœ¨æ„Ÿæƒ…ä¸­${this.getElementLoveTraits(element)}ã€‚ä½ å°æ„›æƒ…æœ‰è‘—æ·±åˆ»çš„ç†è§£ï¼Œé›–ç„¶ç›®å‰é¢è‡¨åˆ†æ‰‹çš„ç—›è‹¦ï¼Œä½†ä½ çš„${element}ç‰¹è³ªè®“ä½ å…·å‚™é‡æ–°ç²å¾—æ„›æƒ…çš„èƒ½åŠ›ã€‚`,
				currentSituation: `å¾å…«å­—ä¾†çœ‹ï¼Œä½ å€‘çš„åˆ†æ‰‹ä¸¦éå¶ç„¶ï¼Œè€Œæ˜¯æ„Ÿæƒ…ç™¼å±•ä¸­çš„ä¸€å€‹è€ƒé©—æœŸã€‚${element}å‘½äººåœ¨æ„Ÿæƒ…æ–¹é¢å®¹æ˜“${this.getElementLoveChallenges(element)}ï¼Œä½†åŒæ™‚ä¹Ÿå…·æœ‰åŒ–è§£æƒ…æ„Ÿå±æ©Ÿçš„æ™ºæ…§ã€‚`,
				futureOutlook: `æ¥ä¸‹ä¾†çš„3-6å€‹æœˆæ˜¯æ„Ÿæƒ…é‡å»ºçš„é—œéµæœŸã€‚${element}å‘½äººçš„æ„Ÿæƒ…é‹å‹¢å°‡åœ¨${this.getBestMonth(element)}æœˆé”åˆ°é«˜å³°ï¼Œé€™æ˜¯å¾©åˆçš„æœ€ä½³æ™‚æ©Ÿçª—å£ã€‚`,
				specificAdvice: `å¾©åˆä¸èƒ½æ€¥æ–¼ä¸€æ™‚ï¼Œéœ€è¦å¾å…§å¿ƒé–‹å§‹èª¿æ•´ã€‚å»ºè­°ä½ å…ˆæå‡è‡ªå·±çš„${element}èƒ½é‡ï¼Œé€šéé¢¨æ°´èª¿æ•´å¢å¼·å€‹äººé­…åŠ›ï¼Œè®“å°æ–¹é‡æ–°çœ‹åˆ°ä½ çš„æ”¹è®Šå’Œæˆé•·ã€‚`,
				fengShuiSolutions: `ç«‹å³èª¿æ•´è‡¥å®¤æ¡ƒèŠ±ä½ï¼ˆ${this.getElementDirection(element)}ï¼‰ï¼Œæ“ºæ”¾ç²‰è‰²æ°´æ™¶æˆ–é®®èŠ±ã€‚åŒæ™‚æ¸…ç†æ‰€æœ‰èˆ‡å‰ä»»ç›¸é—œçš„è² èƒ½é‡ç‰©å“ï¼Œç‚ºæ–°çš„æ„Ÿæƒ…èƒ½é‡é¨°å‡ºç©ºé–“ã€‚`,
				timingAdvice: `å¾©åˆçš„æœ€ä½³æ™‚æ©Ÿåœ¨è¾²æ›†${this.getBestMonth(element)}æœˆçš„${element}æ—¥ã€‚åœ¨æ­¤ä¹‹å‰ï¼Œå°ˆæ³¨æ–¼è‡ªæˆ‘æå‡å’Œèƒ½é‡èª¿æ•´ï¼Œåˆ‡å‹¿æ€¥èºè¡Œäº‹ã€‚`,
			};
		} else if (actualConcern === "æ„Ÿæƒ…") {
			return {
				personality: `${element}å‘½çš„ä½ åœ¨æ„Ÿæƒ…ä¸­${this.getElementLoveTraits(element)}ã€‚ä½ æœ‰è‘—ç¨ç‰¹çš„æ„›æƒ…è§€ï¼Œèƒ½å¤ æ·±åº¦ç†è§£ä¼´ä¾¶çš„éœ€æ±‚ï¼Œä½†æœ‰æ™‚ä¹Ÿéœ€è¦å­¸æœƒè¡¨é”è‡ªå·±çš„æ„Ÿå—ã€‚`,
				currentSituation: `ç›®å‰ä½ çš„æ„Ÿæƒ…é‹å‹¢æ­£è™•æ–¼ç©©å®šä¸Šå‡æœŸã€‚${element}å‘½äººåœ¨æ„Ÿæƒ…æ–¹é¢å…·æœ‰å¤©ç„¶çš„å„ªå‹¢ï¼Œä½ çš„é­…åŠ›æ­£åœ¨é€æ¼¸é¡¯ç¾ï¼Œé©åˆä¸»å‹•çˆ­å–å¿ƒå„€çš„å°è±¡ã€‚`,
				futureOutlook: `æ¥ä¸‹ä¾†çš„æ„Ÿæƒ…ç™¼å±•éå¸¸æ¨‚è§€ã€‚ç‰¹åˆ¥æ˜¯åœ¨${this.getBestMonth(element)}æœˆï¼Œä½ çš„æ¡ƒèŠ±é‹å°‡é”åˆ°é ‚å³°ï¼Œæœ‰æ©Ÿæœƒé‡åˆ°çœŸæ­£é©åˆçš„ä¼´ä¾¶ã€‚`,
				specificAdvice: `åœ¨æ„Ÿæƒ…æ–¹é¢è¦ç™¼æ®${element}å‘½äººçš„ç‰¹é•·ï¼Œä¿æŒè‡ªç„¶çœŸèª çš„æ…‹åº¦ã€‚åŒæ™‚è¦æ³¨æ„é¿å…${element}å‘½äººåœ¨æ„Ÿæƒ…ä¸­çš„å¸¸è¦‹èª¤å€ï¼Œå­¸æœƒé©ç•¶çš„é€²é€€ã€‚`,
				fengShuiSolutions: `åŠ å¼·è‡¥å®¤å’Œå®¢å»³çš„æ¡ƒèŠ±ä½å¸ƒå±€ï¼Œåœ¨${this.getElementDirection(element)}æ“ºæ”¾æˆå°çš„è£é£¾å“ï¼Œä½¿ç”¨${this.getElementColors(element)}ä¾†å¢å¼·ä½ çš„æ„Ÿæƒ…èƒ½é‡å ´ã€‚`,
				timingAdvice: `æ„Ÿæƒ…è¡Œå‹•çš„æœ€ä½³æ™‚æ©Ÿåœ¨${element}æ—ºçš„æ—¥å­ï¼Œå»ºè­°åœ¨è¾²æ›†${this.getBestMonth(element)}æœˆä¸»å‹•å‡ºæ“Šï¼ŒæˆåŠŸç‡æœƒå¤§å¤§æå‡ã€‚`,
			};
		} else {
			// é€šç”¨å¢å¼·å…§å®¹
			return {
				personality: `${element}å‘½çš„ä½ å¤©ç”Ÿå…·æœ‰${element}çš„ç‰¹è³ªï¼Œåœ¨è™•ç†äººç”Ÿå„å€‹æ–¹é¢éƒ½å±•ç¾å‡ºç¨ç‰¹çš„æ™ºæ…§ã€‚ä½ çš„ç›´è¦ºæ•éŠ³ï¼Œæ±ºç­–èƒ½åŠ›å¼·ï¼Œåªæ˜¯æœ‰æ™‚éœ€è¦æ›´å¤šè€å¿ƒç­‰å¾…æ™‚æ©Ÿæˆç†Ÿã€‚`,
				currentSituation: `å¾æ•´é«”å…«å­—ä¾†çœ‹ï¼Œä½ ç›®å‰æ­£ç¶“æ­·ä¸€å€‹é‡è¦çš„äººç”Ÿè½‰æŠ˜æœŸã€‚é›–ç„¶é¢è‡¨å„ç¨®æŒ‘æˆ°ï¼Œä½†é€™æ­£æ˜¯ä½ æˆé•·è›»è®Šçš„é»ƒé‡‘æ™‚æœŸï¼Œ${element}å‘½äººç‰¹åˆ¥é©åˆåœ¨é€†å¢ƒä¸­ç™¼å…‰ç™¼ç†±ã€‚`,
				futureOutlook: `æœªä¾†6-12å€‹æœˆå°ä½ ä¾†èªªå……æ»¿æ©Ÿé‡ã€‚${element}å‘½äººåœ¨é€™æ®µæ™‚é–“å…§å„æ–¹é¢é‹å‹¢éƒ½æœƒç©©æ­¥æå‡ï¼Œç‰¹åˆ¥é©åˆåˆ¶å®šé•·é è¨ˆåŠƒä¸¦ä»˜è«¸è¡Œå‹•ã€‚`,
				specificAdvice: `å»ºè­°ä½ å……åˆ†ç™¼æ®${element}å‘½äººçš„å¤©è³¦å„ªå‹¢ï¼Œåœ¨é¢å°é¸æ“‡æ™‚ç›¸ä¿¡è‡ªå·±çš„ç›´è¦ºã€‚åŒæ™‚è¦å­¸æœƒå¹³è¡¡${element}çš„ç‰¹è³ªï¼Œé¿å…éæ–¼æ¥µç«¯çš„æ±ºå®šã€‚`,
				fengShuiSolutions: `æ•´é«”é‹å‹¢æå‡éœ€è¦å¾å±…ä½ç’°å¢ƒé–‹å§‹èª¿æ•´ã€‚å»ºè­°åœ¨${this.getElementDirection(element)}åŠ å¼·å¸ƒå±€ï¼Œä½¿ç”¨${this.getElementColors(element)}çš„è£é£¾ï¼Œç‡Ÿé€ æœ‰åˆ©æ–¼${element}èƒ½é‡çš„ç’°å¢ƒã€‚`,
				timingAdvice: `é‡è¦æ±ºå®šå’Œè¡Œå‹•çš„æœ€ä½³æ™‚æ©Ÿåœ¨è¾²æ›†${this.getBestMonth(element)}æœˆã€‚å¹³æ™‚å¯é¸æ“‡${element}æ—ºçš„æ—¥å­è™•ç†é‡è¦äº‹å‹™ï¼Œæœƒäº‹åŠåŠŸå€ã€‚`,
			};
		}
	}

	static getElementDirection(element) {
		const directions = {
			é‡‘: "è¥¿æ–¹æˆ–è¥¿åŒ—æ–¹",
			æœ¨: "æ±æ–¹æˆ–æ±å—æ–¹",
			æ°´: "åŒ—æ–¹",
			ç«: "å—æ–¹",
			åœŸ: "ä¸­å¤®æˆ–è¥¿å—æ–¹",
		};
		return directions[element] || "é©åˆçš„æ–¹ä½";
	}

	static getElementColors(element) {
		const colors = {
			é‡‘: "ç™½è‰²ã€é‡‘è‰²ã€éŠ€è‰²",
			æœ¨: "ç¶ è‰²ã€é’è‰²",
			æ°´: "è—è‰²ã€é»‘è‰²",
			ç«: "ç´…è‰²ã€æ©™è‰²",
			åœŸ: "é»ƒè‰²ã€æ£•è‰²",
		};
		return colors[element] || "ç›¸æ‡‰é¡è‰²";
	}

	static getBestMonth(element) {
		const months = {
			é‡‘: "ä¸ƒã€å…«",
			æœ¨: "ä¸‰ã€å››",
			æ°´: "åä¸€ã€åäºŒ",
			ç«: "äº”ã€å…­",
			åœŸ: "å…­ã€ä¹",
		};
		return months[element] || "é©ç•¶";
	}

	// åˆå©šåˆ†æ
	static generateCoupleAnalysis(userBirthday, partnerBirthday) {
		const elements = ["é‡‘", "æœ¨", "æ°´", "ç«", "åœŸ"];
		const userElement = elements[userBirthday.getFullYear() % 5];
		const partnerElement = elements[partnerBirthday.getFullYear() % 5];

		// äº”è¡Œç›¸ç”Ÿç›¸å…‹é—œä¿‚
		const compatibility = this.calculateCompatibility(
			userElement,
			partnerElement
		);

		return {
			userElement,
			partnerElement,
			compatibility,
			advice: this.getCoupleAdvice(
				userElement,
				partnerElement,
				compatibility
			),
		};
	}

	static calculateCompatibility(element1, element2) {
		const compatibilityMap = {
			é‡‘: { é‡‘: 75, æœ¨: 45, æ°´: 85, ç«: 35, åœŸ: 80 },
			æœ¨: { é‡‘: 45, æœ¨: 70, æ°´: 80, ç«: 85, åœŸ: 40 },
			æ°´: { é‡‘: 85, æœ¨: 80, æ°´: 75, ç«: 40, åœŸ: 50 },
			ç«: { é‡‘: 35, æœ¨: 85, æ°´: 40, ç«: 70, åœŸ: 75 },
			åœŸ: { é‡‘: 80, æœ¨: 40, æ°´: 50, ç«: 75, åœŸ: 75 },
		};

		return compatibilityMap[element1]?.[element2] || 60;
	}

	static getCoupleAdvice(userElement, partnerElement, compatibility) {
		if (compatibility >= 80) {
			return `ä½ å€‘æ˜¯${userElement}å‘½å’Œ${partnerElement}å‘½çš„çµ„åˆï¼Œç›¸æ€§å¾ˆå¥½ï¼å»ºè­°å¤šæºé€šï¼Œä¿æŒäº’ç›¸ç†è§£å’Œæ”¯æŒã€‚`;
		} else if (compatibility >= 60) {
			return `ä½ å€‘çš„å…«å­—é…å°ä¸­ç­‰ï¼Œéœ€è¦å¤šåŒ…å®¹å’Œç†è§£ã€‚${userElement}å‘½è¦å­¸æœƒé…åˆ${partnerElement}å‘½çš„ç¯€å¥ã€‚`;
		} else {
			return `ä½ å€‘çš„äº”è¡Œæœ‰äº›ç›¸æ²–ï¼Œä½†å¯ä»¥é€šéé¢¨æ°´èª¿æ•´å’Œäº’ç›¸ç†è§£ä¾†æ”¹å–„é—œä¿‚ã€‚å»ºè­°åœ¨æ„Ÿæƒ…æ–¹é¢å¤šç”¨å¿ƒç¶“ç‡Ÿã€‚`;
		}
	}

	static getElementLoveTraits(element) {
		const traits = {
			é‡‘: "æ€§æ ¼å …æ¯…ï¼Œå°æ„Ÿæƒ…å°ˆä¸€ï¼Œä½†æœ‰æ™‚éæ–¼ç†æ€§ï¼Œéœ€è¦å­¸æœƒè¡¨é”æƒ…æ„Ÿ",
			æœ¨: "å……æ»¿ç”Ÿå‘½åŠ›ï¼Œå®¹æ˜“å¸å¼•ç•°æ€§ï¼Œä½†è¦æ³¨æ„ä¸è¦å¤ªéä¾è³´å°æ–¹",
			æ°´: "æ„Ÿæƒ…è±å¯Œï¼Œç›´è¦ºæ•éŠ³ï¼Œä½†æƒ…ç·’æ³¢å‹•è¼ƒå¤§ï¼Œéœ€è¦ç©©å®šçš„ä¼´ä¾¶",
			ç«: "ç†±æƒ…å¦‚ç«ï¼Œæ„›æ†åˆ†æ˜ï¼Œä½†è¦æ§åˆ¶è„¾æ°£ï¼Œå­¸æœƒåŒ…å®¹",
			åœŸ: "è¸å¯¦å¯é ï¼Œå€¼å¾—ä¿¡è³´ï¼Œä½†è¦ä¸»å‹•ä¸€äº›ï¼Œä¸è¦å¤ªè¢«å‹•",
		};
		return traits[element] || "å…·æœ‰ç¨ç‰¹çš„æ„Ÿæƒ…ç‰¹è³ª";
	}

	static getLoveForcast(element, concern) {
		return `${element}å‘½äººè¿‘æœŸæ„Ÿæƒ…é‹å‹¢ä¸Šå‡ï¼Œé©åˆä¸»å‹•å‡ºæ“Šæˆ–æ”¹å–„ç¾æœ‰é—œä¿‚`;
	}

	static getElementCareerTraits(element) {
		const traits = {
			é‡‘: "å …æ¯…æœæ±ºï¼Œé©åˆç®¡ç†è·ä½ï¼Œä½†è¦å­¸æœƒèˆ‡äººåˆä½œ",
			æœ¨: "å‰µæ„è±å¯Œï¼Œé©åˆå‰µæ–°å·¥ä½œï¼Œä½†è¦æ³¨æ„å …æŒåˆ°åº•",
			æ°´: "é©æ‡‰æ€§å¼·ï¼Œå–„æ–¼æºé€šï¼Œä½†è¦é¿å…éæ–¼è¢«å‹•",
			ç«: "å……æ»¿æ´»åŠ›ï¼Œé ˜å°èƒ½åŠ›å¼·ï¼Œä½†è¦æ§åˆ¶æ€¥èºæƒ…ç·’",
			åœŸ: "è¸å¯¦ç©©é‡ï¼ŒåŸ·è¡ŒåŠ›ä½³ï¼Œä½†è¦ä¸»å‹•çˆ­å–æ©Ÿæœƒ",
		};
		return traits[element] || "å…·æœ‰ç¨ç‰¹çš„äº‹æ¥­ç‰¹è³ª";
	}

	static getCareerForcast(element) {
		return `${element}å‘½äººäº‹æ¥­é‹å‹¢ç©©æ­¥ä¸Šå‡ï¼Œé©åˆåœ¨ç¾æœ‰åŸºç¤ä¸Šæ±‚ç™¼å±•`;
	}

	static getElementWealthTraits(element) {
		const traits = {
			é‡‘: "ç†è²¡è§€å¿µå¼·ï¼Œé©åˆç©©å¥æŠ•è³‡ï¼Œä½†è¦é¿å…éæ–¼ä¿å®ˆ",
			æœ¨: "è³ºéŒ¢èƒ½åŠ›å¼·ï¼Œä½†èŠ±éŒ¢ä¹Ÿå¿«ï¼Œéœ€è¦å­¸æœƒå„²è“„",
			æ°´: "è²¡é‹èµ·ä¼è¼ƒå¤§ï¼Œé©åˆå¤šå…ƒåŒ–æŠ•è³‡",
			ç«: "è³ºéŒ¢æ©Ÿæœƒå¤šï¼Œä½†è¦é¿å…è¡å‹•æ¶ˆè²»",
			åœŸ: "è²¡é‹ç©©å®šï¼Œé©åˆé•·æœŸæŠ•è³‡å’Œç½®æ¥­",
		};
		return traits[element] || "å…·æœ‰ç¨ç‰¹çš„è²¡é‹ç‰¹è³ª";
	}

	static getWealthForcast(element) {
		return `${element}å‘½äººè²¡é‹é€æ¼¸å¥½è½‰ï¼Œé©åˆè¬¹æ…ç†è²¡å’Œé•·æœŸè¦åŠƒ`;
	}

	static getSpecificAdvice(element, area, problem) {
		if (area === "æ„Ÿæƒ…") {
			return `å¤šæºé€šï¼Œç†è§£å°æ–¹æƒ³æ³•ï¼ŒåŒæ™‚ä¿æŒè‡ªå·±çš„ç¨ç«‹æ€§`;
		} else if (area === "å·¥ä½œ") {
			return `ç™¼æ®${element}å‘½çš„å„ªå‹¢ï¼Œä¿æŒç©æ¥µæ…‹åº¦ï¼Œæ©Ÿæœƒå³å°‡å‡ºç¾`;
		}
		return `æ ¹æ“šä½ çš„æƒ…æ³ï¼Œå»ºè­°ä¿æŒè€å¿ƒï¼Œæ™‚æ©Ÿæˆç†Ÿæ™‚è‡ªç„¶æœƒæœ‰æ”¹å–„`;
	}

	static getFengShuiAdvice(element, area) {
		const advice = {
			æ„Ÿæƒ…: {
				é‡‘: "åœ¨åºŠé ­æ”¾ç½®ç²‰è‰²æ°´æ™¶ï¼Œå¢å¼·æ¡ƒèŠ±é‹",
				æœ¨: "åœ¨æ±æ–¹ä½ç½®æ“ºæ”¾ç¶ è‰²æ¤ç‰©ï¼Œæå‡æ„Ÿæƒ…èƒ½é‡",
				æ°´: "ä¿æŒè‡¥å®¤æ•´æ½”ï¼Œä½¿ç”¨è—è‰²æˆ–é»‘è‰²è£é£¾",
				ç«: "åœ¨å—æ–¹æ”¾ç½®ç´…è‰²ç‰©å“ï¼Œä½†è¦é©åº¦",
				åœŸ: "ä½¿ç”¨é»ƒè‰²æˆ–æ£•è‰²ç³»è£é£¾ï¼Œå¢åŠ ç©©å®šæ„Ÿ",
			},
			å·¥ä½œ: {
				é‡‘: "è¾¦å…¬æ¡Œæ”¾ç½®é‡‘å±¬è£½å“ï¼Œå¢å¼·äº‹æ¥­é‹",
				æœ¨: "è¾¦å…¬ç’°å¢ƒå¤šç”¨ç¶ è‰²ï¼Œæ“ºæ”¾å°ç›†æ ½",
				æ°´: "ä¿æŒå·¥ä½œå€åŸŸæ¸…æ½”ï¼Œé©åº¦ä½¿ç”¨è—è‰²å…ƒç´ ",
				ç«: "è¾¦å…¬æ¡Œæœå—ï¼Œä½¿ç”¨æº«æš–è‰²èª¿è£é£¾",
				åœŸ: "ä½¿ç”¨ç©©é‡è‰²å½©ï¼Œè¾¦å…¬æ¡Œè¦æ•´é½Šæœ‰åº",
			},
			è²¡é‹: {
				é‡‘: "åœ¨è¾¦å…¬å®¤è¥¿æ–¹æˆ–è¥¿åŒ—æ–¹æ”¾ç½®é‡‘å±¬èšå¯¶ç›†",
				æœ¨: "æ±æ–¹æˆ–æ±å—æ–¹æ“ºæ”¾æ‹›è²¡æ¨¹æˆ–ç«¹å­",
				æ°´: "åŒ—æ–¹æ”¾ç½®æ°´æ™¶çƒæˆ–é­šç¼¸ï¼ˆä½†è¦å®šæœŸæ¸…æ½”ï¼‰",
				ç«: "å—æ–¹ä½¿ç”¨ç´…è‰²è£é£¾ï¼Œä½†é¿å…éåº¦",
				åœŸ: "ä¸­å¤®æˆ–è¥¿å—æ–¹æ”¾ç½®é»ƒè‰²æ°´æ™¶æˆ–é™¶ç“·è£½å“",
			},
		};

		return advice[area]?.[element] || "èª¿æ•´å±…ä½ç’°å¢ƒï¼Œå¢å¼·æ­£èƒ½é‡";
	}

	static generateCoupleAnalysis(userBirthday, partnerBirthday) {
		const userElement = this.getElement(userBirthday);
		const partnerElement = this.getElement(partnerBirthday);
		const compatibility = this.calculateCompatibility(
			userElement,
			partnerElement
		);

		return {
			userElement: userElement,
			partnerElement: partnerElement,
			compatibility: compatibility,
			advice: this.getRelationshipAdvice(
				userElement,
				partnerElement,
				compatibility
			),
		};
	}

	static getElement(birthday) {
		const elements = ["é‡‘", "æœ¨", "æ°´", "ç«", "åœŸ"];
		return elements[birthday.getFullYear() % 5];
	}

	static calculateCompatibility(element1, element2) {
		const compatibilityMatrix = {
			é‡‘: { é‡‘: 75, æœ¨: 45, æ°´: 85, ç«: 35, åœŸ: 80 },
			æœ¨: { é‡‘: 45, æœ¨: 70, æ°´: 80, ç«: 85, åœŸ: 50 },
			æ°´: { é‡‘: 85, æœ¨: 80, æ°´: 75, ç«: 40, åœŸ: 60 },
			ç«: { é‡‘: 35, æœ¨: 85, æ°´: 40, ç«: 70, åœŸ: 75 },
			åœŸ: { é‡‘: 80, æœ¨: 50, æ°´: 60, ç«: 75, åœŸ: 80 },
		};

		return compatibilityMatrix[element1]?.[element2] || 65;
	}

	static getRelationshipAdvice(userElement, partnerElement, compatibility) {
		if (compatibility >= 80) {
			return "ä½ å€‘çš„å…«å­—éå¸¸ç›¸é…ï¼äº”è¡Œç›¸ç”Ÿï¼Œæ„Ÿæƒ…æœƒè¶Šä¾†è¶Šå¥½ã€‚å»ºè­°å¤šæºé€šï¼Œçæƒœé€™æ®µç·£åˆ†ã€‚";
		} else if (compatibility >= 60) {
			return "ä½ å€‘çš„å…«å­—é…å°ä¸éŒ¯ï¼Œéœ€è¦äº’ç›¸ç†è§£å’ŒåŒ…å®¹ã€‚å»ºè­°åœ¨æºé€šä¸Šå¤šèŠ±å¿ƒæ€ï¼Œé—œä¿‚æœƒæ›´ç©©å®šã€‚";
		} else {
			return "ä½ å€‘çš„å…«å­—å­˜åœ¨ä¸€äº›è¡çªï¼Œä½†é€™ä¸ä»£è¡¨ä¸èƒ½åœ¨ä¸€èµ·ã€‚å»ºè­°é€šéé¢¨æ°´èª¿æ•´å’Œå¿ƒæ…‹èª¿ç¯€ä¾†æ”¹å–„é—œä¿‚ã€‚";
		}
	}

	// è§£é‡‹åˆå©šåˆ†æå¦‚ä½•é‹ä½œ
	static generateCoupleAnalysisExplanation() {
		return `**ğŸ’• åˆå©šé…å°åˆ†æä¿‚é»æ¨£é‹ä½œå˜…ï¼Ÿ**

æˆ‘å˜…å°ˆæ¥­åˆå©šåˆ†ææœƒå¹«ä½ äº†è§£å…©å€‹äººå˜…æ„Ÿæƒ…é…å°åº¦ï¼ŒåŒ…æ‹¬ï¼š

**ğŸ”® å…«å­—äº”è¡Œåˆ†æ**
â€¢ æ ¹æ“šé›™æ–¹å‡ºç”Ÿå¹´æœˆæ—¥ï¼Œè¨ˆç®—å„è‡ªå˜…äº”è¡Œå±¬æ€§
â€¢ åˆ†æå…©äººäº”è¡Œä¿‚ç›¸ç”Ÿã€ç›¸å‰‹é‚„ä¿‚ç›¸å’Œ
â€¢ è©•ä¼°æ•´é«”åˆé…åº¦ç™¾åˆ†æ¯”

**ğŸ’– æ„Ÿæƒ…é‹å‹¢é æ¸¬**
â€¢ åˆ†ææ„Ÿæƒ…ç™¼å±•å˜…æœ€ä½³æ™‚æ©Ÿ
â€¢ é æ¸¬å¯èƒ½é‡åˆ°å˜…æ„Ÿæƒ…æŒ‘æˆ°
â€¢ æä¾›å¢é€²æ„Ÿæƒ…å˜…å…·é«”å»ºè­°

**ğŸ  é¢¨æ°´èª¿æ•´æ–¹æ¡ˆ**
â€¢ ç‚ºä½ å€‘å˜…å±…ä½ç’°å¢ƒæä¾›é¢¨æ°´å»ºè­°
â€¢ æ¨è–¦é©åˆå˜…é¢¨æ°´æ“ºè¨­å’Œé¡è‰²æ­é…
â€¢ åŒ–è§£æ„Ÿæƒ…éšœç¤™å˜…é¢¨æ°´æ–¹æ³•

**ğŸ“Š è©³ç´°åˆ†æå ±å‘Š**
åŸºæœ¬åˆ†æå…è²»æä¾›ï¼Œè©³ç´°å ±å‘ŠæœƒåŒ…å«ï¼š
â€¢ å®Œæ•´å…«å­—åˆå©šåœ–è¡¨
â€¢ å€‹äººåŒ–æ„Ÿæƒ…å»ºè­°
â€¢ æœªä¾†ä¸€å¹´æ„Ÿæƒ…é‹å‹¢
â€¢ å°ˆæ¥­é¢¨æ°´èª¿æ•´æ–¹æ¡ˆ

æƒ³é–‹å§‹åˆå©šåˆ†æå—ï¼Ÿæˆ‘éœ€è¦ä½ åŒä¼´ä¾¶å˜…å‡ºç”Ÿå¹´æœˆæ—¥ã€‚`;
	}

	// æ„Ÿæƒ…ç‰¹è³ªåˆ†æ
	static getElementLoveTraits(element) {
		const traits = {
			é‡‘: "å …å®šå°ˆä¸€ï¼Œå°æ„›æƒ…æœ‰è‘—æ˜ç¢ºçš„æ¨™æº–ã€‚ä¸€æ—¦èªå®šå°æ–¹ï¼Œæœƒå…¨å¿ƒå…¨æ„ä»˜å‡ºï¼Œä½†æœ‰æ™‚éæ–¼ç†æ€§ï¼Œéœ€è¦å­¸æœƒè¡¨é”æº«æŸ”",
			æœ¨: "æº«æŸ”é«”è²¼ï¼Œå¯Œæœ‰åŒ…å®¹å¿ƒã€‚åœ¨æ„›æƒ…ä¸­å–„æ–¼ç…§é¡§å°æ–¹ï¼Œä½†æœ‰æ™‚æœƒå› ç‚ºå¤ªéé·å°±è€Œå¤±å»è‡ªæˆ‘ï¼Œéœ€è¦ä¿æŒé©ç•¶çš„å …æŒ",
			æ°´: "æ„Ÿæƒ…è±å¯Œï¼Œç›´è¦ºæ•éŠ³ã€‚èƒ½å¤ æ·±åº¦ç†è§£ä¼´ä¾¶çš„å…§å¿ƒä¸–ç•Œï¼Œä½†æƒ…ç·’è®ŠåŒ–è¼ƒå¤§ï¼Œéœ€è¦å­¸æœƒç©©å®šè‡ªå·±çš„æƒ…æ„Ÿç‹€æ…‹",
			ç«: "ç†±æƒ…å¥”æ”¾ï¼Œæ„›æ†åˆ†æ˜ã€‚åœ¨æ„Ÿæƒ…ä¸­å……æ»¿æ¿€æƒ…å’Œæ´»åŠ›ï¼Œä½†æœ‰æ™‚éæ–¼è¡å‹•ï¼Œéœ€è¦å­¸æœƒå†·éœæ€è€ƒå’Œè€å¿ƒç­‰å¾…",
			åœŸ: "å¿ èª å¯é ï¼Œé‡è¦–æ‰¿è«¾ã€‚åœ¨æ„›æƒ…ä¸­èƒ½çµ¦äºˆå°æ–¹å¼·çƒˆçš„å®‰å…¨æ„Ÿï¼Œä½†æœ‰æ™‚éæ–¼å›ºåŸ·ï¼Œéœ€è¦å­¸æœƒè®Šé€šå’Œé©æ‡‰",
		};
		return traits[element] || "åœ¨æ„Ÿæƒ…ä¸­æœ‰è‘—ç¨ç‰¹çš„é­…åŠ›";
	}

	// æ„Ÿæƒ…æŒ‘æˆ°åˆ†æ
	static getElementLoveChallenges(element) {
		const challenges = {
			é‡‘: "éæ–¼ç†æ€§è€Œå¿½ç•¥æ„Ÿæ€§éœ€æ±‚",
			æœ¨: "å¤ªéé·å°±è€Œå¤±å»å€‹äººç«‹å ´",
			æ°´: "æƒ…ç·’æ³¢å‹•å½±éŸ¿é—œä¿‚ç©©å®š",
			ç«: "è¡å‹•è¡Œäº‹è€Œå¿½ç•¥å¾Œæœ",
			åœŸ: "å›ºåŸ·å·±è¦‹è€Œç¼ºä¹è®Šé€š",
		};
		return challenges[element] || "åœ¨æ„Ÿæƒ…è¡¨é”ä¸Šéœ€è¦æ”¹é€²";
	}

	// ğŸ¯ æª¢æ¸¬ç”¨æˆ¶æ˜¯å¦è¡¨ç¾å‡ºæ·±å…¥èˆˆè¶£ï¼ˆæ–°å¢ï¼‰
	static detectDeepInterest(message, conversationHistory = []) {
		// æª¢æ¸¬è¡¨é”å…¨é¢èˆˆè¶£çš„é—œéµè©
		const deepInterestKeywords = [
			"æ‰€æœ‰",
			"å…¨éƒ¨",
			"è©³ç´°",
			"æ›´å¤š",
			"å®Œæ•´",
			"æ·±å…¥",
			"å…·é«”",
			"è©³ç´°ä¸€é»",
			"è©³ç´°å•²",
			"æ›´è©³ç´°",
			"å…¨é¢",
			"å¾¹åº•",
			"å®Œå…¨",
			"every",
			"all",
			"detail",
			"more",
			"complete",
		];

		// æª¢æ¸¬è¡¨é”è¿«åˆ‡éœ€è¦çš„è©èª
		const urgencyKeywords = [
			"éœ€è¦",
			"æƒ³è¦",
			"å¿…é ˆ",
			"ä¸€å®šè¦",
			"é¦¬ä¸Š",
			"ç«‹å³",
			"æ€¥éœ€",
			"è¿«åˆ‡",
			"æƒ³çŸ¥é“",
			"æƒ³äº†è§£",
			"å¸Œæœ›",
		];

		// æª¢æ¸¬æŒçºŒé—œæ³¨çš„æ¨¡å¼
		const continuousInterest = [
			"é‚„æœ‰å‘¢",
			"ä»²æœ‰å’©",
			"ç„¶å¾Œå‘¢",
			"è·Ÿä½å‘¢",
			"æ¥ä¸‹ä¾†",
			"ä¸‹ä¸€æ­¥",
			"that's it",
			"what else",
			"anything else",
			"more tips",
		];

		const hasDeepInterest = deepInterestKeywords.some((keyword) =>
			message.includes(keyword)
		);

		const hasUrgency = urgencyKeywords.some((keyword) =>
			message.includes(keyword)
		);

		const hasContinuousInterest = continuousInterest.some((phrase) =>
			message.includes(phrase)
		);

		// æª¢æŸ¥å°è©±æ­·å²ä¸­æ˜¯å¦å·²ç¶“å¤šæ¬¡è©¢å•ç›¸é—œå•é¡Œ
		const conversationTurns = conversationHistory.length;
		const hasMultipleQuestions = conversationTurns >= 3; // 3è¼ªå°è©±ä»¥ä¸Š

		return {
			hasDeepInterest,
			hasUrgency,
			hasContinuousInterest,
			hasMultipleQuestions,
			shouldPromotePersonalAnalysis:
				hasDeepInterest ||
				(hasUrgency && hasContinuousInterest) ||
				hasMultipleQuestions,
		};
	}

	// ğŸ¯ ç”Ÿæˆå€‹äººåˆ†ææ¨è–¦å›æ‡‰ï¼ˆæ–°å¢ï¼‰
	static generatePersonalAnalysisPromotion(concern, userMessage) {
		const promotionTemplates = {
			è²¡é‹: {
				intro: "æˆ‘äº†è§£ä½ å°è²¡é‹æ”¹å–„å¾ˆæœ‰èˆˆè¶£ï¼ğŸ’°",
				explanation:
					"ä¸éæ¯å€‹äººçš„è²¡é‹æ ¼å±€éƒ½ä¸åŒï¼ŒåŒæ¨£çš„é¢¨æ°´å¸ƒå±€å°ä¸åŒå…«å­—çš„äººæ•ˆæœæœƒå·®å¾ˆå¤šã€‚",
				value:
					"å¦‚æœä½ æä¾›å‡ºç”Ÿæ—¥æœŸï¼Œæˆ‘å¯ä»¥æ ¹æ“šä½ çš„å€‹äººå…«å­—é€²è¡Œç²¾æº–åˆ†æï¼š\n" +
					"â€¢ ä½ çš„å¤©ç”Ÿè²¡é‹æ ¼å±€å’Œç‰¹è³ª\n" +
					"â€¢ æœ€é©åˆä½ çš„å‚¬è²¡é¢¨æ°´æ–¹æ¡ˆ\n" +
					"â€¢ ä½ çš„è²¡é‹é«˜å³°æœŸå’Œæ³¨æ„æ™‚æ©Ÿ\n" +
					"â€¢ å€‹äººåŒ–çš„æ‹›è²¡å»ºè­°å’Œæ–¹æ³•",
				cta: "é€™æ¨£çš„å€‹äººåŒ–åˆ†ææœƒæ¯”ä¸€èˆ¬å»ºè­°æ›´æœ‰æ•ˆæœã€‚ä½ æƒ³è©¦è©¦å—ï¼Ÿ",
			},
			å·¥ä½œ: {
				intro: "æˆ‘æ„Ÿå—åˆ°ä½ å°å·¥ä½œç™¼å±•å¾ˆé‡è¦–ï¼ğŸ’¼",
				explanation:
					"æ¯å€‹äººçš„äº‹æ¥­é‹èµ°å‘éƒ½ä¸åŒï¼Œéœ€è¦æ ¹æ“šå€‹äººå…«å­—ä¾†çœ‹æœ€é©åˆçš„ç™¼å±•æ–¹å‘ã€‚",
				value:
					"å¦‚æœä½ æä¾›å‡ºç”Ÿæ—¥æœŸï¼Œæˆ‘å¯ä»¥ç‚ºä½ åˆ†æï¼š\n" +
					"â€¢ ä½ çš„äº‹æ¥­é‹å‹¢å’Œè·å ´æ€§æ ¼\n" +
					"â€¢ æœ€é©åˆä½ çš„å·¥ä½œæ–¹å‘å’Œç™¼å±•æ™‚æ©Ÿ\n" +
					"â€¢ æå‡å·¥ä½œé‹çš„é¢¨æ°´å¸ƒå±€\n" +
					"â€¢ åŒ–è§£è·å ´å›°é›£çš„å…·é«”æ–¹æ³•",
				cta: "é€™æ¨£çš„åˆ†æèƒ½å¹«ä½ æ‰¾åˆ°æœ€é©åˆçš„äº‹æ¥­ç™¼å±•è·¯å¾‘ã€‚æƒ³äº†è§£å—ï¼Ÿ",
			},
			æ„Ÿæƒ…: {
				intro: "çœ‹å¾—å‡ºä½ å°æ„Ÿæƒ…å¾ˆç”¨å¿ƒï¼ğŸ’•",
				explanation:
					"æ„Ÿæƒ…é‹å‹¢è·Ÿå€‹äººå…«å­—å’Œæ¡ƒèŠ±é‹å¯†åˆ‡ç›¸é—œï¼Œéœ€è¦å€‹äººåŒ–åˆ†ææ‰èƒ½çµ¦å‡ºç²¾æº–å»ºè­°ã€‚",
				value:
					"å¦‚æœä½ æä¾›å‡ºç”Ÿæ—¥æœŸï¼Œæˆ‘å¯ä»¥ç‚ºä½ åˆ†æï¼š\n" +
					"â€¢ ä½ çš„æ¡ƒèŠ±é‹å‹¢å’Œæ„Ÿæƒ…ç‰¹è³ª\n" +
					"â€¢ æœ€ä½³çš„è„«å–®æ™‚æ©Ÿå’Œæ„Ÿæƒ…ç™¼å±•æœŸ\n" +
					"â€¢ æå‡æ¡ƒèŠ±é‹çš„é¢¨æ°´æ–¹æ³•\n" +
					"â€¢ é©åˆä½ çš„ä¼´ä¾¶é¡å‹å’Œç›¸è™•æ¨¡å¼",
				cta: "å€‹äººåŒ–çš„æ„Ÿæƒ…åˆ†ææœƒæ¯”ä¸€èˆ¬å»ºè­°æ›´æœ‰é‡å°æ€§ã€‚ä½ æœ‰èˆˆè¶£å—ï¼Ÿ",
			},
			å¥åº·: {
				intro: "å¥åº·ç¢ºå¯¦æ˜¯æœ€é‡è¦çš„è²¡å¯Œï¼ğŸ¥",
				explanation:
					"æ¯å€‹äººçš„é«”è³ªå’Œå¥åº·é‹å‹¢éƒ½ä¸åŒï¼Œéœ€è¦æ ¹æ“šå€‹äººå…«å­—ä¾†åˆ¶å®šé¤Šç”Ÿæ–¹æ¡ˆã€‚",
				value:
					"å¦‚æœä½ æä¾›å‡ºç”Ÿæ—¥æœŸï¼Œæˆ‘å¯ä»¥ç‚ºä½ åˆ†æï¼š\n" +
					"â€¢ ä½ çš„é«”è³ªç‰¹é»å’Œå¥åº·é‹å‹¢\n" +
					"â€¢ æœ€é©åˆä½ çš„é¤Šç”Ÿæ–¹æ³•å’Œæ³¨æ„äº‹é …\n" +
					"â€¢ ä¿ƒé€²å¥åº·çš„é¢¨æ°´å¸ƒå±€\n" +
					"â€¢ é é˜²ç–¾ç—…çš„å€‹äººåŒ–å»ºè­°",
				cta: "å€‹äººåŒ–çš„å¥åº·åˆ†æèƒ½å¹«ä½ åˆ¶å®šæœ€é©åˆçš„é¤Šç”Ÿè¨ˆåŠƒã€‚æƒ³è©¦è©¦å—ï¼Ÿ",
			},
		};

		const template = promotionTemplates[concern] || {
			intro: `æˆ‘çœ‹å¾—å‡ºä½ å°${concern}å¾ˆé—œå¿ƒï¼`,
			explanation:
				"æ¯å€‹äººçš„é‹å‹¢æ ¼å±€éƒ½ä¸åŒï¼Œéœ€è¦æ ¹æ“šå€‹äººå…«å­—ä¾†æä¾›ç²¾æº–å»ºè­°ã€‚",
			value: `å¦‚æœä½ æä¾›å‡ºç”Ÿæ—¥æœŸï¼Œæˆ‘å¯ä»¥ç‚ºä½ é€²è¡Œå€‹äººåŒ–çš„${concern}åˆ†æï¼ŒåŒ…æ‹¬é‹å‹¢èµ°å‘ã€æ”¹å–„æ–¹æ³•å’Œæœ€ä½³æ™‚æ©Ÿã€‚`,
			cta: "å€‹äººåŒ–åˆ†ææœƒæ¯”ä¸€èˆ¬å»ºè­°æ›´æœ‰æ•ˆæœã€‚ä½ æœ‰èˆˆè¶£å—ï¼Ÿ",
		};

		return `${template.intro}\n\n${template.explanation}\n\n${template.value}\n\n${template.cta}`;
	}
}
