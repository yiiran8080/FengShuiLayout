<!doctype html>
<html>
	<head>
		<title>Couple Content Save Test</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 20px;
			}
			.result {
				margin: 10px 0;
				padding: 10px;
				border-radius: 5px;
			}
			.success {
				background-color: #d4edda;
				border: 1px solid #c3e6cb;
				color: #155724;
			}
			.error {
				background-color: #f8d7da;
				border: 1px solid #f5c6cb;
				color: #721c24;
			}
			button {
				margin: 5px;
				padding: 10px 15px;
				background: #007bff;
				color: white;
				border: none;
				border-radius: 5px;
				cursor: pointer;
			}
			button:hover {
				background: #0056b3;
			}
		</style>
	</head>
	<body>
		<h1>üß™ Couple Content Save Integration Test</h1>
		<button onclick="testSaveComponents()">Test Save All Components</button>
		<button onclick="testRetrieveData()">Test Retrieve Data</button>
		<button onclick="clearResults()">Clear Results</button>

		<div id="results"></div>

		<script>
			const API_BASE = window.location.origin;
			const sessionId = "test_couple_1990-01-01_1992-02-02".replace(
				/[^a-zA-Z0-9]/g,
				"_"
			);

			function addResult(message, isSuccess = true) {
				const div = document.createElement("div");
				div.className = `result ${isSuccess ? "success" : "error"}`;
				div.textContent = message;
				document.getElementById("results").appendChild(div);
			}

			function clearResults() {
				document.getElementById("results").innerHTML = "";
			}

			const testComponents = [
				{
					name: "coupleAnnualAnalysis",
					content: {
						compatibility: { score: 85, level: "ÂÑ™ÁßÄÈÖçÂ∞ç" },
						annualAnalysis: {
							2024: "‰ªäÂπ¥ÈÅãÂã¢ËâØÂ•Ω",
							2025: "ÊòéÂπ¥Êõ¥‰Ω≥",
						},
						predictions: ["ÊÑüÊÉÖÁ©©ÂÆö", "‰∫ãÊ•≠È†ÜÂà©"],
					},
				},
				{
					name: "coupleMingJu",
					content: {
						mingjuAnalysis: "ÂÖ´Â≠óÂêàÂ©öÂàÜÊûêÁµêÊûú",
						compatibility: "‰∏≠‰∏äÈÖçÂ∞ç",
						recommendations: ["‰∫íÁõ∏Êâ∂ÊåÅ", "ÂÖ±ÂêåÊàêÈï∑"],
					},
				},
				{
					name: "coupleGodExplain",
					content: {
						godAnalysis: "Á•ûÁÖûÂàÜÊûêÂÖßÂÆπ",
						explanations: ["Â§©‰πôË≤¥‰∫∫", "Ê°ÉËä±Êòü"],
						guidance: "È¢®Ê∞¥Âª∫Ë≠∞",
					},
				},
				{
					name: "coupleSeason",
					content: {
						seasonAnalysis: "ÂõõÂ≠£ÈÅãÂã¢ÂàÜÊûê",
						spring: "Êò•Â≠£ÈÅãÂã¢",
						summer: "Â§èÂ≠£ÈÅãÂã¢",
						autumn: "ÁßãÂ≠£ÈÅãÂã¢",
						winter: "ÂÜ¨Â≠£ÈÅãÂã¢",
					},
				},
				{
					name: "coupleCoreSuggestion",
					content: {
						coreSuggestions: "Ê†∏ÂøÉÂª∫Ë≠∞ÂÖßÂÆπ",
						priorities: ["Ê∫ùÈÄöÊîπÂñÑ", "È¢®Ê∞¥Ë™øÊï¥"],
						timeline: "Âª∫Ë≠∞ÂØ¶ÊñΩÊôÇÈñì",
					},
				},
				{
					name: "enhancedCoupleSpecificProblemSolution",
					content: {
						problemSolution: "ÂÖ∑È´îÂïèÈ°åËß£Ê±∫ÊñπÊ°à",
						female: { analysis: "Â•≥ÊñπÂàÜÊûê" },
						male: { analysis: "Áî∑ÊñπÂàÜÊûê" },
						specificProblem: "ÊÑüÊÉÖÂïèÈ°å",
					},
				},
			];

			async function testSaveComponents() {
				addResult("üß™ Starting component save tests...");

				let passedTests = 0;
				const metadata = {
					birthday: "1990-01-01T10:00:00.000Z",
					birthday2: "1992-02-02T14:00:00.000Z",
					gender: "female",
					gender2: "male",
				};

				for (const component of testComponents) {
					try {
						const response = await fetch(
							`${API_BASE}/api/couple-content`,
							{
								method: "POST",
								headers: { "Content-Type": "application/json" },
								body: JSON.stringify({
									sessionId,
									componentName: component.name,
									content: component.content,
									...metadata,
									...(component.name ===
									"enhancedCoupleSpecificProblemSolution"
										? { specificProblem: "ÊÑüÊÉÖÈôçÊ∫´" }
										: {}),
								}),
							}
						);

						if (response.ok) {
							const result = await response.json();
							addResult(
								`‚úÖ ${component.name}: SAVED successfully`
							);
							passedTests++;
						} else {
							const error = await response.text();
							addResult(
								`‚ùå ${component.name}: FAILED - ${error}`,
								false
							);
						}
					} catch (error) {
						addResult(
							`‚ùå ${component.name}: ERROR - ${error.message}`,
							false
						);
					}
				}

				addResult(
					`üìä Test Results: ${passedTests}/${testComponents.length} components saved successfully`
				);
			}

			async function testRetrieveData() {
				addResult("üîç Testing data retrieval...");

				try {
					const response = await fetch(
						`${API_BASE}/api/couple-content?sessionId=${sessionId}`
					);
					if (response.ok) {
						const savedData = await response.json();
						addResult("‚úÖ Data retrieval: SUCCESS");
						addResult(
							`üìã Components found: ${savedData.componentCount || 0}`
						);

						if (savedData.savedContent) {
							Object.keys(savedData.savedContent).forEach(
								(componentName) => {
									addResult(
										`   - ${componentName}: Data present ‚úì`
									);
								}
							);
						}
					} else {
						addResult("‚ùå Data retrieval: FAILED", false);
					}
				} catch (error) {
					addResult(
						`‚ùå Data retrieval: ERROR - ${error.message}`,
						false
					);
				}
			}
		</script>
	</body>
</html>
