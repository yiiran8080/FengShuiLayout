<!doctype html>
<html lang="zh-TW">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>測試合盤報告歷史 API</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 20px;
			}
			.report-card {
				border: 1px solid #ddd;
				margin: 10px 0;
				padding: 15px;
				border-radius: 8px;
			}
			.session-id {
				font-weight: bold;
				color: #666;
				font-size: 14px;
			}
			.couple-info {
				margin: 10px 0;
			}
			.btn {
				background: #007bff;
				color: white;
				padding: 8px 16px;
				text-decoration: none;
				border-radius: 4px;
			}
			.btn:hover {
				background: #0056b3;
			}
			.error {
				color: red;
			}
			.loading {
				color: #666;
			}
		</style>
	</head>
	<body>
		<h1>合盤報告歷史測試</h1>
		<div id="status" class="loading">載入中...</div>
		<div id="reports"></div>

		<script>
			async function fetchCoupleReports() {
				try {
					const response = await fetch(
						"/api/reports/couple-history?limit=10&page=1"
					);
					const data = await response.json();

					const statusDiv = document.getElementById("status");
					const reportsDiv = document.getElementById("reports");

					if (data.status === 0) {
						statusDiv.innerHTML = `找到 ${data.data.reports.length} 個合盤報告 (總共 ${data.data.pagination.totalCount} 個)`;

						data.data.reports.forEach((report) => {
							const reportCard = document.createElement("div");
							reportCard.className = "report-card";
							reportCard.innerHTML = `
                            <div class="session-id">會話ID: ${report.sessionId}</div>
                            <div class="couple-info">
                                <strong>對象一:</strong> ${report.userInputs?.birthday || "N/A"} (${report.userInputs?.gender || "N/A"})<br>
                                <strong>對象二:</strong> ${report.userInputs?.birthday2 || "N/A"} (${report.userInputs?.gender2 || "N/A"})<br>
                                <strong>問題:</strong> ${report.userInputs?.problem || "N/A"}<br>
                                <strong>組件數量:</strong> ${report.componentCount}<br>
                                <strong>生成時間:</strong> ${new Date(report.reportGeneratedAt).toLocaleString("zh-TW")}
                            </div>
                            <a href="/zh-TW/couple-report?sessionId=${report.sessionId}" class="btn">查看報告</a>
                        `;
							reportsDiv.appendChild(reportCard);
						});
					} else {
						statusDiv.innerHTML = `<span class="error">錯誤: ${data.error}</span>`;
					}
				} catch (error) {
					document.getElementById("status").innerHTML =
						`<span class="error">載入失敗: ${error.message}</span>`;
				}
			}

			fetchCoupleReports();
		</script>
	</body>
</html>
